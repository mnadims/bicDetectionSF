<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" revision="1.0.0" language="Java" filename="E:/01Courses@USASK/CMPT898-HumanDrivenSoftwareEngineeringForScientificResearch/ProjectProgress/data_files/final_dataset/gen_patch_codes/filtered/lucene/f5b5d3e17f.java"><expr_stmt><expr><name>From</name> <name>f5b5d3e17f6ca8b649ef1364726726a0b92d9921</name> <name>Mon</name> <name>Sep</name> <literal type="number">17</literal> <literal type="number">00</literal><operator>:</operator><literal type="number">00</literal><operator>:</operator><literal type="number">00</literal> <literal type="number">2001</literal>
<name>From</name><operator>:</operator> <name>Mark</name> <name>Robert</name> <name><name>Miller</name> <argument_list type="generic">&lt;<argument><name>markrmiller</name><annotation>@<name><name>apache</name><operator>.</operator><name>org</name></name></annotation></argument>&gt;</argument_list></name>
<name>Date</name><operator>:</operator> <name>Mon</name></expr><operator>,</operator> <expr><literal type="number">17</literal> <name>Dec</name> <literal type="number">2012</literal> <literal type="number">00</literal><operator>:</operator><literal type="number">38</literal><operator>:</operator><literal type="number">03</literal> <operator>+</operator><literal type="number">0000</literal>
<name>Subject</name><operator>:</operator> <index>[<expr><name>PATCH</name></expr>]</index> <name>SOLR</name><operator>-</operator><literal type="number">4204</literal><operator>:</operator> <name>Make</name> <name>SolrCloud</name> <name>tests</name> <name>more</name> <name>friendly</name> <name>to</name> <name>FreeBSD</name>
 <name>blackhole</name> <literal type="number">2</literal> <name><name>environments</name><operator>.</operator>

<name>git</name></name><operator>-</operator><name>svn</name><operator>-</operator><name>id</name><operator>:</operator> <name>https</name><operator>:</operator><comment type="line">//svn.apache.org/repos/asf/lucene/dev/trunk@1422728 13f79535-47bb-0310-9956-ffa450edef68</comment>
<operator>--</operator>
 <operator>...</operator><operator>/</operator><name><name>TestSolrEntityProcessorEndToEnd</name><operator>.</operator><name>java</name></name>      <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettySolrRunner</name><operator>.</operator><name>java</name></name>       <operator>|</operator>  <literal type="number">4</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>RecoveryStrategy</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">4</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkController</name><operator>.</operator><name>java</name></name>   <operator>|</operator> <literal type="number">47</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>+</operator><operator>--</operator><operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>CoreContainer</name><operator>.</operator><name>java</name></name>   <operator>|</operator> <literal type="number">68</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>+</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>PluginInfo</name><operator>.</operator><name>java</name></name> <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>handler</name><operator>/</operator><name>admin</name><operator>/</operator><name><name>CollectionsHandler</name><operator>.</operator><name>java</name></name>     <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>component</name><operator>/</operator><name><name>HttpShardHandlerFactory</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">8</literal> <operator>++</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributor</name><operator>.</operator><name>java</name></name>       <operator>|</operator> <literal type="number">25</literal> <operator>++</operator><operator>+</operator><operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateLog</name><operator>.</operator><name>java</name></name>     <operator>|</operator>  <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name>       <operator>|</operator> <literal type="number">69</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>+</operator>
 <operator>...</operator><operator>/</operator><name>processor</name><operator>/</operator><name><name>DistributedUpdateProcessor</name><operator>.</operator><name>java</name></name> <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>solr</name><operator>.</operator><name>xml</name></name>        <operator>|</operator> <literal type="number">10</literal> <operator>++</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZk2Test</name><operator>.</operator><name>java</name></name>   <operator>|</operator> <literal type="number">38</literal> <operator>++</operator><operator>+</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name>    <operator>|</operator> <literal type="number">26</literal> <operator>++</operator><operator>++</operator><operator>+</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>FullSolrCloudDistribCmdsTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>SyncSliceTest</name><operator>.</operator><name>java</name></name>  <operator>|</operator> <literal type="number">31</literal> <operator>++</operator><operator>+</operator><operator>--</operator><operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator> <literal type="number">14</literal> <operator>++</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name>  <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributorTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator> <literal type="number">22</literal> <operator>++</operator><operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>impl</name><operator>/</operator><name><name>ConcurrentUpdateSolrServer</name><operator>.</operator><name>java</name></name>      <operator>|</operator> <literal type="number">12</literal> <operator>++</operator><operator>++</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name>  <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name>  <operator>|</operator> <literal type="number">31</literal> <operator>++</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>TestHarness</name><operator>.</operator><name>java</name></name>     <operator>|</operator>  <literal type="number">1</literal> <operator>+</operator>
 <literal type="number">26</literal> <name>files</name> <name>changed</name></expr><operator>,</operator> <expr><literal type="number">251</literal> <call><name>insertions</name><argument_list>(<argument><expr><operator>+</operator></expr></argument>)</argument_list></call></expr><operator>,</operator> <expr><literal type="number">182</literal> <call><name>deletions</name><argument_list>(<argument><expr><operator>-</operator></expr></argument>)</argument_list></call>
 <name>create</name> <name>mode</name> <literal type="number">100644</literal> <name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name>

<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>contrib</name><operator>/</operator><name>dataimporthandler</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>dataimport</name><operator>/</operator><name><name>TestSolrEntityProcessorEndToEnd</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>contrib</name><operator>/</operator><name>dataimporthandler</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>dataimport</name><operator>/</operator><name><name>TestSolrEntityProcessorEndToEnd</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">082a74c9312</literal><operator>..</operator><literal type="number">15a21c771ea</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>contrib</name><operator>/</operator><name>dataimporthandler</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>dataimport</name><operator>/</operator><name><name>TestSolrEntityProcessorEndToEnd</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>contrib</name><operator>/</operator><name>dataimporthandler</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>dataimport</name><operator>/</operator><name><name>TestSolrEntityProcessorEndToEnd</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">267</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">267</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestSolrEntityProcessorEndToEnd</name> extends <name>AbstractDataImportHandlerTe</name></expr></expr_stmt>
     }
     
     HttpSolrServer <expr_stmt><expr><name>solrServer</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><call><name>getSourceUrl</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>solrServer</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>solrServer</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>solrServer</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name>sidl</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>solrServer</name><operator>.</operator><name>commit</name></name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   }
diff <expr_stmt><expr><operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettySolrRunner</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettySolrRunner</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">56e995db00b</literal><operator>..</operator><literal type="number">7260326ef31</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettySolrRunner</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettySolrRunner</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">176</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">176</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>JettySolrRunner</name> <block>{
       <if_stmt><if>if <condition>(<expr><name>threadPool</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
         <expr_stmt><expr><call><name><name>threadPool</name><operator>.</operator><name>setMaxThreads</name></name><argument_list>(<argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         <expr_stmt><expr><call><name><name>threadPool</name><operator>.</operator><name>setMaxIdleTimeMs</name></name><argument_list>(<argument><expr><literal type="number">5000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <if_stmt><if>if <condition>(<expr><operator>!</operator><name>stopAtShutdown</name></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><call><name><name>threadPool</name><operator>.</operator><name>setMaxStopTimeMs</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt/></block_content></block></if></if_stmt></block_content></block></if></if_stmt>}</block>
        <call><name><name>threadPool</name><operator>.</operator><name>setMaxStopTimeMs</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       }
       
       server<expr_stmt><expr><operator>.</operator><call><name>setConnectors</name><argument_list>(<argument><expr><operator>new</operator> <name><name>Connector</name><index>[]</index></name> <block>{<expr><name>connector</name></expr>}</block></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>RecoveryStrategy</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>RecoveryStrategy</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">14775a8dc1d</literal><operator>..</operator><literal type="number">3f5eec7698b</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>RecoveryStrategy</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>RecoveryStrategy</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">175</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">175</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>RecoveryStrategy</name> extends <name>Thread</name> implements <name>ClosableThread</name> <block>{
   <expr><specifier>private</specifier> <name>void</name> <call><name>commitOnLeader</name><argument_list>(<argument><expr><name>String</name> <name>leaderUrl</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>SolrServerException</name></expr></argument>, <argument><expr><name>IOException</name> <block>{
     <expr><name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>leaderUrl</name></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;
     <expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>UpdateRequest</name> <name>ureq</name> <operator>=</operator> <operator>new</operator> <call><name>UpdateRequest</name><argument_list>()</argument_list></call></expr>;
     <expr><call><name><name>ureq</name><operator>.</operator><name>setParams</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>ureq</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>set</name><argument_list>(<argument><expr><name><name>DistributedUpdateProcessor</name><operator>.</operator><name>COMMIT_END_POINT</name></name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">190</literal></expr>,<expr><literal type="number">7</literal> <operator>+</operator><literal type="number">190</literal></expr>,<expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>RecoveryStrategy</name> extends <name>Thread</name> implements <name>ClosableThread</name> <block>{
       <expr><name>IOException</name> <block>{
     <expr><name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>leaderBaseUrl</name></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">45000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">45000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">120000</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>WaitForState</name> <name>prepCmd</name> <operator>=</operator> <operator>new</operator> <call><name>WaitForState</name><argument_list>()</argument_list></call></expr>;
     <expr><call><name><name>prepCmd</name><operator>.</operator><name>setCoreName</name></name><argument_list>(<argument><expr><name>leaderCoreName</name></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>prepCmd</name><operator>.</operator><name>setNodeName</name></name><argument_list>(<argument><expr><call><name><name>zkController</name><operator>.</operator><name>getNodeName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkController</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkController</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a9f6a7a0778</name><operator>..</operator><literal type="number">3eedaa35e30</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkController</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkController</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">21</literal></expr>,<expr><literal type="number">8</literal> <operator>+</operator><literal type="number">21</literal></expr>,<expr><literal type="number">8</literal> @@</expr> <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>File</name></name>;</import></block></expr>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import></block></expr>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>UnsupportedEncodingException</name></name>;</import></block></expr></expr_stmt>
 <import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>InetAddress</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>URLEncoder</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>NetworkInterface</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>URLEncoder</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Enumeration</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>HashMap</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">31</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">31</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Properties</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Future</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>SynchronousQueue</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ThreadPoolExecutor</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>TimeUnit</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>TimeoutException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>regex</name><operator>.</operator><name>Matcher</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>regex</name><operator>.</operator><name>Pattern</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">55</literal></expr><operator>,</operator><expr><literal type="number">16</literal> <operator>+</operator><literal type="number">52</literal></expr><operator>,</operator><expr><literal type="number">14</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkNodeProps</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkStateReader</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZooKeeperException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>ExecutorUtil</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>Config</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>CoreContainer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>CoreDescriptor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>SolrCore</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>component</name><operator>.</operator><name>ShardHandler</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name><operator>.</operator><name>UpdateLog</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name><operator>.</operator><name>UpdateShardHandler</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>DOMUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>DefaultSolrThreadFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>zookeeper</name><operator>.</operator><name>CreateMode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>zookeeper</name><operator>.</operator><name>KeeperException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>zookeeper</name><operator>.</operator><name>KeeperException</name><operator>.</operator><name>NoNodeException</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">104</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">99</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>final</name> <name>class</name> <name>ZkController</name> <block>{
   <expr><specifier>public</specifier> <name>final</name> <specifier>static</specifier> <name>String</name> <name>COLLECTION_PARAM_PREFIX</name><operator>=</operator><literal type="string">"collection."</literal></expr>;
   <expr><specifier>public</specifier> <name>final</name> <specifier>static</specifier> <name>String</name> <name>CONFIGNAME_PROP</name><operator>=</operator><literal type="string">"configName"</literal></expr>;
 
  <expr><specifier>private</specifier> <name>ThreadPoolExecutor</name> <name>cmdDistribExecutor</name> <operator>=</operator> <operator>new</operator> <call><name>ThreadPoolExecutor</name><argument_list>(
      <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name><name>Integer</name><operator>.</operator><name>MAX_VALUE</name></name></expr></argument>, <argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>SECONDS</name></name></expr></argument>,
      <argument><expr><operator>new</operator> <call><name><name>SynchronousQueue</name><argument_list type="generic">&lt;<argument><name>Runnable</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><operator>new</operator> <call><name>DefaultSolrThreadFactory</name><argument_list>(
          <argument><expr><literal type="string">"cmdDistribExecutor"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
   
   <expr><specifier>private</specifier> <name>final</name> <name><name>Map</name><argument_list type="generic">&lt;<argument><name>String</name></argument>, <argument><name>ElectionContext</name></argument>&gt;</argument_list></name> <name>electionContexts</name> <operator>=</operator> <call><name><name>Collections</name><operator>.</operator><name>synchronizedMap</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name><name>HashMap</name><argument_list type="generic">&lt;<argument><name>String</name></argument>, <argument><name>ElectionContext</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
   
@@ <expr><operator>-</operator><literal type="number">141</literal></expr>,<expr><literal type="number">9</literal> <operator>+</operator><literal type="number">132</literal></expr>,<expr><literal type="number">11</literal> @@ <specifier>public</specifier> <name>final</name> <name>class</name> <name>ZkController</name> <block>{
   <expr><specifier>private</specifier> <name>int</name> <name>clientTimeout</name></expr>;
 
   <expr><specifier>private</specifier> <specifier>volatile</specifier> <name>boolean</name> <name>isClosed</name></expr>;
  
  <expr><specifier>private</specifier> <name>UpdateShardHandler</name> <name>updateShardHandler</name></expr>;
 
   <expr><specifier>public</specifier> <call><name>ZkController</name><argument_list>(<argument><expr><name>final</name> <name>CoreContainer</name> <name>cc</name></expr></argument>, <argument><expr><name>String</name> <name>zkServerAddress</name></expr></argument>, <argument><expr><name>int</name> <name>zkClientTimeout</name></expr></argument>, <argument><expr><name>int</name> <name>zkClientConnectTimeout</name></expr></argument>, <argument><expr><name>String</name> <name>localHost</name></expr></argument>, <argument><expr><name>String</name> <name>locaHostPort</name></expr></argument>,
      <argument><expr><name>String</name> <name>localHostContext</name></expr></argument>, <argument><expr><name>String</name> <name>leaderVoteWait</name></expr></argument>, <argument><expr><name>final</name> <name>CurrentCoreDescriptorProvider</name> <name>registerOnReconnect</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>InterruptedException</name></expr></argument>,
      <argument><expr><name>String</name> <name>localHostContext</name></expr></argument>, <argument><expr><name>String</name> <name>leaderVoteWait</name></expr></argument>, <argument><expr><name>int</name> <name>distribUpdateConnTimeout</name></expr></argument>, <argument><expr><name>int</name> <name>distribUpdateSoTimeout</name></expr></argument>, <argument><expr><name>final</name> <name>CurrentCoreDescriptorProvider</name> <name>registerOnReconnect</name></expr></argument></throws></expr>) <throws>throws <argument><expr><name>InterruptedException</name></expr></argument>,
       <argument><expr><name>TimeoutException</name></expr></argument>, <argument><expr><name>IOException</name> <block>{</block></expr></argument></throws></block></expr>
     <if_stmt><if>if <condition>(<expr><name>cc</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <throw>throw <expr><operator>new</operator> <call><name>IllegalArgumentException</name><argument_list>(<argument><expr><literal type="string">"CoreContainer cannot be null."</literal></expr></argument>)</argument_list></call></expr>;</throw></block_content></block></if></if_stmt>
     <name><name>this</name><operator>.</operator><name>cc</name></name> <operator>=</operator> <name>cc</name></block></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">159</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">152</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>final</name> <name>class</name> <name>ZkController</name> <block>{
       <expr><name>localHostContext</name> <operator>=</operator> <call><name><name>localHostContext</name><operator>.</operator><name>substring</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>,<argument><expr><call><name><name>localHostContext</name><operator>.</operator><name>length</name></name><argument_list>()</argument_list></call><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;
     }</block>
     
    <name>updateShardHandler</name> <operator>=</operator> <operator>new</operator> <call><name>UpdateShardHandler</name><argument_list>(<argument><expr><name>distribUpdateConnTimeout</name></expr></argument>, <argument><expr><name>distribUpdateSoTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     
     <expr_stmt><expr><name><name>this</name><operator>.</operator><name>zkServerAddress</name></name> <operator>=</operator> <name>zkServerAddress</name></expr>;</expr_stmt>
     <expr_stmt><expr><name><name>this</name><operator>.</operator><name>localHostPort</name></name> <operator>=</operator> <name>locaHostPort</name></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">315</literal></expr><operator>,</operator><expr><literal type="number">14</literal> <operator>+</operator><literal type="number">309</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>final</name> <name>class</name> <name>ZkController</name> <block>{
   <expr><specifier>public</specifier> <name>void</name> <call><name>close</name><argument_list>()</argument_list></call> <block>{
     <expr><name><name>this</name><operator>.</operator><name>isClosed</name></name> <operator>=</operator> <literal type="boolean">true</literal></expr>;
     
    <if_stmt><if>if <condition>(<expr><name>cmdDistribExecutor</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <try>try <block>{<block_content>
        <expr_stmt><expr><call><name><name>ExecutorUtil</name><operator>.</operator><name>shutdownNowAndAwaitTermination</name></name><argument_list>(<argument><expr><name>cmdDistribExecutor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/></block_content></block></try></block_content></block></if></if_stmt>}</block></expr> <catch>catch <parameter_list>(<parameter><decl><type><name>Throwable</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name><name>SolrException</name><operator>.</operator><name>log</name></name><argument_list>(<argument><expr><name>log</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/></block_content></block></catch>}</block></expr></expr_stmt>
    }
    
     for <expr_stmt><expr><operator>(</operator><name>ElectionContext</name> <name>context</name> <operator>:</operator> <call><name><name>electionContexts</name><operator>.</operator><name>values</name></name><argument_list>()</argument_list></call><operator>)</operator> <block>{
       <try>try <block>{<block_content>
         <expr_stmt><expr><call><name><name>context</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">336</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">322</literal></expr><operator>,</operator><expr><literal type="number">20</literal> @@ <specifier>public</specifier> <name>final</name> <name>class</name> <name>ZkController</name> <block>{
     }</block></expr></expr_stmt> <catch>catch<parameter_list>(<parameter><decl><type><name>Throwable</name></type> <name>t</name></decl></parameter>)</parameter_list> <block>{<block_content>
       <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>error</name></name><argument_list>(<argument><expr><literal type="string">"Error closing overseer"</literal></expr></argument>, <argument><expr><name>t</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></catch></block_content></block></try>}</block>
    <call><name><name>zkClient</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    
    <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>zkClient</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt><empty_stmt>;</empty_stmt>
    </block_content>}</block> <catch>catch<parameter_list>(<parameter><decl><type><name>Throwable</name></type> <name>t</name></decl></parameter>)</parameter_list> <block>{<block_content>
      <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>error</name></name><argument_list>(<argument><expr><literal type="string">"Error closing zkClient"</literal></expr></argument>, <argument><expr><name>t</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></catch></try> 
    
    <if_stmt><if>if <condition>(<expr><name>updateShardHandler</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <try>try <block>{<block_content>
        <expr_stmt><expr><call><name><name>updateShardHandler</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block> <catch>catch<parameter_list>(<parameter><decl><type><name>Throwable</name></type> <name>t</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>error</name></name><argument_list>(<argument><expr><literal type="string">"Error closing updateShardHandler"</literal></expr></argument>, <argument><expr><name>t</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></catch></try>
    </block_content>}</block></if></if_stmt>
   }
 
   <comment type="block" format="javadoc">/**
@@ -1178,7 +1177,7 @@ public final class ZkController {
       HttpSolrServer server = null;
       server = new HttpSolrServer(leaderBaseUrl);
       server.setConnectionTimeout(45000);
      server.setSoTimeout(45000);
      server.setSoTimeout(120000);
       WaitForState prepCmd = new WaitForState();
       prepCmd.setCoreName(leaderCoreName);
       prepCmd.setNodeName(getNodeName());
@@ -1293,8 +1292,8 @@ public final class ZkController {
   }
 
   // may return null if not in zk mode
  public ThreadPoolExecutor getCmdDistribExecutor() {
    return cmdDistribExecutor;
  public UpdateShardHandler getUpdateShardHandler() {
    return updateShardHandler;
   }
 
   /**
diff --git a/solr/core/src/java/org/apache/solr/core/CoreContainer.java b/solr/core/src/java/org/apache/solr/core/CoreContainer.java
index 321616fd6cd..aef07cf61ad 100644
-- a/solr/core/src/java/org/apache/solr/core/CoreContainer.java
++ b/solr/core/src/java/org/apache/solr/core/CoreContainer.java
@@ -159,6 +159,8 @@ public class CoreContainer
   private String zkHost;
   private Map&lt;SolrCore,String&gt; coreToOrigName = new ConcurrentHashMap&lt;SolrCore,String&gt;();
   private String leaderVoteWait = LEADER_VOTE_WAIT;
  private int distribUpdateConnTimeout = 0;
  private int distribUpdateSoTimeout = 0;
   protected int swappableCacheSize = Integer.MAX_VALUE; // Use as a flag too, if swappableCacheSize set in solr.xml this will be changed
   private int coreLoadThreads;
   
@@ -250,18 +252,21 @@ public class CoreContainer
               "A chroot was specified in ZkHost but the znode doesn't exist. ");
         }
         
        zkController = new ZkController(this, zookeeperHost, zkClientTimeout, zkClientConnectTimeout, host, hostPort, hostContext, leaderVoteWait, new CurrentCoreDescriptorProvider() {
          
          @Override
          public List&lt;CoreDescriptor&gt; getCurrentDescriptors() {
            List&lt;CoreDescriptor&gt; descriptors = new ArrayList&lt;CoreDescriptor&gt;(getCoreNames().size());
            for (SolrCore core : getCores()) {
              descriptors.add(core.getCoreDescriptor());
            }
            return descriptors;
          }
        });        

        zkController = new ZkController(this, zookeeperHost, zkClientTimeout,
            zkClientConnectTimeout, host, hostPort, hostContext,
            leaderVoteWait, distribUpdateConnTimeout, distribUpdateSoTimeout,
            new CurrentCoreDescriptorProvider() {
              
              @Override
              public List&lt;CoreDescriptor&gt; getCurrentDescriptors() {
                List&lt;CoreDescriptor&gt; descriptors = new ArrayList&lt;CoreDescriptor&gt;(
                    getCoreNames().size());
                for (SolrCore core : getCores()) {
                  descriptors.add(core.getCoreDescriptor());
                }
                return descriptors;
              }
            });
         
         
         if (zkRun != null &amp;&amp; zkServer.getServers().size() &gt; 1 &amp;&amp; confDir == null &amp;&amp; boostrapConf == false) {
@@ -428,6 +433,8 @@ public class CoreContainer
     // now.
     cfg.substituteProperties();
     
    initShardHandler(cfg);
    
     allocateLazyCores(cfg);
     
     // Initialize Logging
@@ -487,6 +494,9 @@ public class CoreContainer
     zkClientTimeout = cfg.getInt("solr/cores/@zkClientTimeout",
         DEFAULT_ZK_CLIENT_TIMEOUT);
     
    distribUpdateConnTimeout = cfg.getInt("solr/cores/@distribUpdateConnTimeout", 0);
    distribUpdateSoTimeout = cfg.getInt("solr/cores/@distribUpdateSoTimeout", 0);
    
     hostPort = cfg.get("solr/cores/@hostPort", DEFAULT_HOST_PORT);
     
     hostContext = cfg.get("solr/cores/@hostContext", DEFAULT_HOST_CONTEXT);
@@ -689,6 +699,27 @@ public class CoreContainer
     }
   }
 
  protected void initShardHandler(Config cfg) {
    PluginInfo info = null;
    if (cfg != null) {
      Node shfn = cfg.getNode("solr/cores/shardHandlerFactory", false);
  
      if (shfn != null) {
        info = new PluginInfo(shfn, "shardHandlerFactory", false, true);
      } else {
        Map m = new HashMap();
        m.put("class",HttpShardHandlerFactory.class.getName());
        info = new PluginInfo("shardHandlerFactory", m, null, Collections.&lt;PluginInfo&gt;emptyList());
      }
    }

    HttpShardHandlerFactory fac = new HttpShardHandlerFactory();
    if (info != null) {
      fac.init(info);
    }
    shardHandlerFactory = fac;
  }

   private Document copyDoc(Document document) throws TransformerException {
     TransformerFactory tfactory = TransformerFactory.newInstance();
     Transformer tx   = tfactory.newTransformer();
@@ -1568,18 +1599,7 @@ public class CoreContainer
 
   /** The default ShardHandlerFactory used to communicate with other solr instances */</comment>
   public <function><type><name>ShardHandlerFactory</name></type> <name>getShardHandlerFactory</name><parameter_list>()</parameter_list> <block>{<block_content>
    <synchronized>synchronized <init>(<expr><name>this</name></expr>)</init> <block>{<block_content>
      <if_stmt><if>if <condition>(<expr><name>shardHandlerFactory</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
        <decl_stmt><decl><type><name>Map</name></type> <name>m</name> <init>= <expr><operator>new</operator> <call><name>HashMap</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>m</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><literal type="string">"class"</literal></expr></argument>,<argument><expr><call><name><name>HttpShardHandlerFactory</name><operator>.</operator><name><name>class</name><operator>.</operator><name>getName</name></name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <decl_stmt><decl><type><name>PluginInfo</name></type> <name>info</name> <init>= <expr><operator>new</operator> <call><name>PluginInfo</name><argument_list>(<argument><expr><literal type="string">"shardHandlerFactory"</literal></expr></argument>, <argument><expr><name>m</name></expr></argument>,<argument><expr><literal type="null">null</literal></expr></argument>,<argument><expr><name><name>Collections</name><operator>.</operator></name>&lt;<name>PluginInfo</name><operator>&gt;</operator><call><name>emptyList</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <decl_stmt><decl><type><name>HttpShardHandlerFactory</name></type> <name>fac</name> <init>= <expr><operator>new</operator> <call><name>HttpShardHandlerFactory</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>fac</name><operator>.</operator><name>init</name></name><argument_list>(<argument><expr><name>info</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name>shardHandlerFactory</name> <operator>=</operator> <name>fac</name></expr>;</expr_stmt>
      </block_content>}</block></if></if_stmt>
      <return>return <expr><name>shardHandlerFactory</name></expr>;</return>
    </block_content>}</block></synchronized>
    <return>return <expr><name>shardHandlerFactory</name></expr>;</return>
   </block_content>}</block></function>
   
   <decl_stmt><decl><type><specifier>private</specifier> <name>SolrConfig</name></type> <name>getSolrConfigFromZk</name><argument_list>(<argument><expr><name>String</name> <name>zkConfigName</name></expr></argument>, <argument><expr><name>String</name> <name>solrConfigFileName</name></expr></argument>,
<argument><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>PluginInfo</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>PluginInfo</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>c6b6e3b1cac</name><operator>..</operator><literal type="number">2ecb617ad7d</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>PluginInfo</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>PluginInfo</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">74</literal></expr></argument>,<argument><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">74</literal></expr></argument>,<argument><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>PluginInfo</name> <block>{
     <if_stmt><if>if <condition>(<expr><name>type</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>sb</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><literal type="string">"type = "</literal> <operator>+</operator> <name>type</name> <operator>+</operator> <literal type="string">","</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt></block></expr></argument>
     <if_stmt><if>if <condition>(<expr><name>name</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>sb</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><literal type="string">"name = "</literal> <operator>+</operator> <name>name</name> <operator>+</operator> <literal type="string">","</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt></argument_list></decl></decl_stmt>
     <if_stmt><if>if <condition>(<expr><name>className</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>sb</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><literal type="string">"class = "</literal> <operator>+</operator> <name>className</name> <operator>+</operator> <literal type="string">","</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
    <if_stmt><if>if <condition>(<expr><call><name><name>initArgs</name><operator>.</operator><name>size</name></name><argument_list>()</argument_list></call> <operator>&gt;</operator> <literal type="number">0</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>sb</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><literal type="string">"args = "</literal> <operator>+</operator> <name>initArgs</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
    <if_stmt><if>if <condition>(<expr><name>initArgs</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <call><name><name>initArgs</name><operator>.</operator><name>size</name></name><argument_list>()</argument_list></call> <operator>&gt;</operator> <literal type="number">0</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>sb</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><literal type="string">"args = "</literal> <operator>+</operator> <name>initArgs</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
     <expr_stmt><expr><call><name><name>sb</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><literal type="string">"}"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <return>return <expr><call><name><name>sb</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr>;</return>
   }
diff <expr_stmt><expr><operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>admin</name><operator>/</operator><name><name>CollectionsHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>admin</name><operator>/</operator><name><name>CollectionsHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a4391a87fd2</name><operator>..</operator><literal type="number">1919c090775</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>admin</name><operator>/</operator><name><name>CollectionsHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>admin</name><operator>/</operator><name><name>CollectionsHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">150</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">150</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>CollectionsHandler</name> extends <name>RequestHandlerBase</name> <block>{
     <expr><name>ZkCoreNodeProps</name> <name>nodeProps</name> <operator>=</operator> <operator>new</operator> <call><name>ZkCoreNodeProps</name><argument_list>(<argument><expr><name>leaderProps</name></expr></argument>)</argument_list></call></expr>;
     
     <expr><name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><call><name><name>nodeProps</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>RequestSyncShard</name> <name>reqSyncShard</name> <operator>=</operator> <operator>new</operator> <call><name><name>CoreAdminRequest</name><operator>.</operator><name>RequestSyncShard</name></name><argument_list>()</argument_list></call></expr>;
     <expr><call><name><name>reqSyncShard</name><operator>.</operator><name>setCollection</name></name><argument_list>(<argument><expr><name>collection</name></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>reqSyncShard</name><operator>.</operator><name>setShard</name></name><argument_list>(<argument><expr><name>shard</name></expr></argument>)</argument_list></call></expr>;
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>HttpShardHandlerFactory</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>HttpShardHandlerFactory</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>ba847a88128</name><operator>..</operator><literal type="number">6e5be383f88</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>HttpShardHandlerFactory</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>HttpShardHandlerFactory</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">156</literal></expr>,<expr><literal type="number">19</literal> <operator>+</operator><literal type="number">156</literal></expr>,<expr><literal type="number">21</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpShardHandlerFactory</name> extends <name>ShardHandlerFactory</name> implements <name>Plug</name>
   @<name>Override</name>
   <specifier>public</specifier> <name>void</name> <call><name>close</name><argument_list>()</argument_list></call> <block>{
     <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>defaultClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>shutdown</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>ExecutorUtil</name><operator>.</operator><name>shutdownNowAndAwaitTermination</name></name><argument_list>(<argument><expr><name>commExecutor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></try>}</block></expr> <catch>catch <parameter_list>(<parameter><decl><type><name>Throwable</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
       <expr_stmt><expr><call><name><name>SolrException</name><operator>.</operator><name>log</name></name><argument_list>(<argument><expr><name>log</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></catch>}</block></expr></expr_stmt>
    
     <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>loadbalancer</name><operator>.</operator><name>shutdown</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>defaultClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>shutdown</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>Throwable</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
       <expr_stmt><expr><call><name><name>SolrException</name><operator>.</operator><name>log</name></name><argument_list>(<argument><expr><name>log</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></catch></try>
     <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>ExecutorUtil</name><operator>.</operator><name>shutdownNowAndAwaitTermination</name></name><argument_list>(<argument><expr><name>commExecutor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>loadbalancer</name><operator>.</operator><name>shutdown</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>Throwable</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
       <expr_stmt><expr><call><name><name>SolrException</name><operator>.</operator><name>log</name></name><argument_list>(<argument><expr><name>log</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></catch></try>

   }
 }
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributor</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributor</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">759802e8831</literal><operator>..</operator><literal type="number">7d1c68b6721</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributor</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributor</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">30</literal></expr><operator>,</operator><expr><literal type="number">11</literal> <operator>+</operator><literal type="number">30</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutionException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutorCompletionService</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Future</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>RejectedExecutionException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ThreadPoolExecutor</name></name>;</import>
 
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrServerException</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrServer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>AbstractUpdateRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>UpdateRequestExt</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">50</literal></expr><operator>,</operator><expr><literal type="number">19</literal> <operator>+</operator><literal type="number">47</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
 
 <class><specifier>public</specifier> class <name>SolrCmdDistributor</name> <block>{
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>int</name></type> <name>MAX_RETRIES_ON_FORWARD</name> <init>= <expr><literal type="number">10</literal></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>int</name></type> <name>MAX_RETRIES_ON_FORWARD</name> <init>= <expr><literal type="number">15</literal></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <name>Logger</name></type> <name>log</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><name><name>SolrCmdDistributor</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
  <decl_stmt><decl><type><specifier>static</specifier> <specifier>final</specifier> <name>HttpClient</name></type> <name>client</name></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>static</specifier> <name>AdjustableSemaphore</name></type> <name>semaphore</name> <init>= <expr><operator>new</operator> <call><name>AdjustableSemaphore</name><argument_list>(<argument><expr><literal type="number">8</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
   
  <static>static <block>{<block_content>
    <decl_stmt><decl><type><name>ModifiableSolrParams</name></type> <name>params</name> <init>= <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS</name></name></expr></argument>, <argument><expr><literal type="number">500</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS_PER_HOST</name></name></expr></argument>, <argument><expr><literal type="number">16</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><name>client</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></static>
  
   <decl_stmt><decl><type><name><name>CompletionService</name><argument_list type="generic">&lt;<argument><name>Request</name></argument>&gt;</argument_list></name></type> <name>completionService</name></decl>;</decl_stmt>
   <decl_stmt><decl><type><name><name>Set</name><argument_list type="generic">&lt;<argument><name><name>Future</name><argument_list type="generic">&lt;<argument><name>Request</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name></type> <name>pending</name></decl>;</decl_stmt>
   
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">73</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">62</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrCmdDistributor</name> <block>{
   
   <expr><specifier>private</specifier> <name>final</name> <name><name>Map</name><argument_list type="generic">&lt;<argument><name>Node</name></argument>,<argument><name><name>List</name><argument_list type="generic">&lt;<argument><name>AddRequest</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name> <name>adds</name> <operator>=</operator> <operator>new</operator> <call><name><name>HashMap</name><argument_list type="generic">&lt;<argument><name>Node</name></argument>,<argument><name><name>List</name><argument_list type="generic">&lt;<argument><name>AddRequest</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr>;
   <expr><specifier>private</specifier> <name>final</name> <name><name>Map</name><argument_list type="generic">&lt;<argument><name>Node</name></argument>,<argument><name><name>List</name><argument_list type="generic">&lt;<argument><name>DeleteRequest</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name> <name>deletes</name> <operator>=</operator> <operator>new</operator> <call><name><name>HashMap</name><argument_list type="generic">&lt;<argument><name>Node</name></argument>,<argument><name><name>List</name><argument_list type="generic">&lt;<argument><name>DeleteRequest</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr>;
  <expr><specifier>private</specifier> <name>UpdateShardHandler</name> <name>updateShardHandler</name></expr>;
   
   <expr><name>class</name> <name>AddRequest</name> <block>{
     <expr><name>AddUpdateCommand</name> <name>cmd</name></expr>;
@@ <expr><operator>-</operator><literal type="number">88</literal></expr>,<expr><literal type="number">14</literal> <operator>+</operator><literal type="number">78</literal></expr>,<expr><literal type="number">15</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrCmdDistributor</name> <block>{
     <expr><specifier>public</specifier> <name>boolean</name> <call><name>abortCheck</name><argument_list>()</argument_list></call></expr>;
   }</block>
   
  <specifier>public</specifier> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><name>int</name> <name>numHosts</name></expr></argument>, <argument><expr><name>ThreadPoolExecutor</name> <name>executor</name></expr></argument>)</argument_list></call> <block>{
  <expr><specifier>public</specifier> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><name>int</name> <name>numHosts</name></expr></argument>, <argument><expr><name>UpdateShardHandler</name> <name>updateShardHandler</name></expr></argument>)</argument_list></call> <block>{
     <expr><name>int</name> <name>maxPermits</name> <operator>=</operator> <call><name><name>Math</name><operator>.</operator><name>max</name></name><argument_list>(<argument><expr><literal type="number">16</literal></expr></argument>, <argument><expr><name>numHosts</name> <operator>*</operator> <literal type="number">16</literal></expr></argument>)</argument_list></call></expr>;
     <comment type="line">// limits how many tasks can actually execute at once</comment>
     <if_stmt><if>if <condition>(<expr><name>maxPermits</name> <operator>!=</operator> <call><name><name>semaphore</name><operator>.</operator><name>getMaxPermits</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
       <expr_stmt><expr><call><name><name>semaphore</name><operator>.</operator><name>setMaxPermits</name></name><argument_list>(<argument><expr><name>maxPermits</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></if></if_stmt>}</block>

    <name>completionService</name> <operator>=</operator> <operator>new</operator> <call><name><name>ExecutorCompletionService</name><argument_list type="generic">&lt;<argument><name>Request</name></argument>&gt;</argument_list></name><argument_list>(<argument><expr><name>executor</name></expr></argument>)</argument_list></call></expr>;
    
    <expr><name><name>this</name><operator>.</operator><name>updateShardHandler</name></name> <operator>=</operator> <name>updateShardHandler</name></expr>;
    <expr><name>completionService</name> <operator>=</operator> <operator>new</operator> <call><name><name>ExecutorCompletionService</name><argument_list type="generic">&lt;<argument><name>Request</name></argument>&gt;</argument_list></name><argument_list>(<argument><expr><call><name><name>updateShardHandler</name><operator>.</operator><name>getCmdDistribExecutor</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <expr><name>pending</name> <operator>=</operator> <operator>new</operator> <call><name><name>HashSet</name><argument_list type="generic">&lt;<argument><name><name>Future</name><argument_list type="generic">&lt;<argument><name>Request</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr>;
   }</block>
   
@@ <operator>-</operator><literal type="number">329</literal></expr>,<expr><literal type="number">7</literal> <operator>+</operator><literal type="number">320</literal></expr>,<expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrCmdDistributor</name> <block>{
           }</block>
   
           <name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>fullUrl</name></expr></argument>,
              <argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;
              <expr><call><name><name>updateShardHandler</name><operator>.</operator><name>getHttpClient</name></name><argument_list>()</argument_list></call></expr>)</block></expr>;
           
           <if_stmt><if>if <condition>(<expr><call><name><name>Thread</name><operator>.</operator><name>currentThread</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>isInterrupted</name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
             <expr_stmt><expr><name><name>clonedRequest</name><operator>.</operator><name>rspCode</name></name> <operator>=</operator> <literal type="number">503</literal></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">363</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">354</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrCmdDistributor</name> <block>{
       <expr><call><name><name>pending</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><call><name><name>completionService</name><operator>.</operator><name>submit</name></name><argument_list>(<argument><expr><name>task</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</block></expr></expr_stmt></block_content></block></if></if_stmt>
     }</block></expr></expr_stmt> <catch>catch <parameter_list>(<parameter><decl><type><name>RejectedExecutionException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
       <expr_stmt><expr><call><name><name>semaphore</name><operator>.</operator><name>release</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <throw>throw <expr><name>e</name></expr>;</throw>
      <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>(<argument><expr><name><name>ErrorCode</name><operator>.</operator><name>SERVICE_UNAVAILABLE</name></name></expr></argument>, <argument><expr><literal type="string">"Shutting down"</literal></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</throw>
     </block_content>}</block></catch>
     
   }</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateLog</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateLog</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">8e2b562ad02</literal><operator>..</operator><name>ffa8f8ce19c</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateLog</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateLog</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">23</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">23</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name><operator>.</operator><name>ErrorCode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputDocument</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>ExecutorUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>NamedList</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>PluginInfo</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>SolrCore</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">819</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">820</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>UpdateLog</name> implements <name>PluginInfoInitialized</name> <block>{
   <expr><specifier>public</specifier> <name>void</name> <call><name>close</name><argument_list>(<argument><expr><name>boolean</name> <name>committed</name></expr></argument>, <argument><expr><name>boolean</name> <name>deleteOnClose</name></expr></argument>)</argument_list></call> <block>{
     <synchronized>synchronized <init>(<expr><name>this</name></expr>)</init> <block>{<block_content>
       <try>try <block>{<block_content>
        <expr_stmt><expr><call><name><name>recoveryExecutor</name><operator>.</operator><name>shutdownNow</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>ExecutorUtil</name><operator>.</operator><name>shutdownNowAndAwaitTermination</name></name><argument_list>(<argument><expr><name>recoveryExecutor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt/></block_content></block></try></block_content></block></synchronized>}</block></expr> <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
         <expr_stmt><expr><call><name><name>SolrException</name><operator>.</operator><name>log</name></name><argument_list>(<argument><expr><name>log</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt/></block_content></block></catch>}</block>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name>
<operator>new</operator> <name>file</name> <name>mode</name> <literal type="number">100644</literal>
<name>index</name> <literal type="number">00000000000..c3d1499c8d1</literal>
<operator>--</operator> <operator>/</operator><name>dev</name><operator>/</operator><literal type="null">null</literal>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">0</literal></expr><operator>,</operator><expr><literal type="number">0</literal> <operator>+</operator><literal type="number">1</literal></expr><operator>,</operator><expr><literal type="number">69</literal> @@</expr></expr_stmt>
<package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name></name>;</package>

<comment type="block">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</comment>

<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>SynchronousQueue</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ThreadPoolExecutor</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>TimeUnit</name></name>;</import>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>ExecutorUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>DefaultSolrThreadFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>

<class><specifier>public</specifier> class <name>UpdateShardHandler</name> <block>{
  
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <name>Logger</name></type> <name>log</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><name><name>UpdateShardHandler</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
  
  <decl_stmt><decl><type><specifier>private</specifier> <name>ThreadPoolExecutor</name></type> <name>cmdDistribExecutor</name> <init>= <expr><operator>new</operator> <call><name>ThreadPoolExecutor</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>,
      <argument><expr><name><name>Integer</name><operator>.</operator><name>MAX_VALUE</name></name></expr></argument>, <argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>SECONDS</name></name></expr></argument>, <argument><expr><operator>new</operator> <call><name><name>SynchronousQueue</name><argument_list type="generic">&lt;<argument><name>Runnable</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></argument>,
      <argument><expr><operator>new</operator> <call><name>DefaultSolrThreadFactory</name><argument_list>(<argument><expr><literal type="string">"cmdDistribExecutor"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
  
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name>HttpClient</name></type> <name>client</name></decl>;</decl_stmt>

  <constructor><specifier>public</specifier> <name>UpdateShardHandler</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>distribUpdateConnTimeout</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>distribUpdateSoTimeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>ModifiableSolrParams</name></type> <name>params</name> <init>= <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS</name></name></expr></argument>, <argument><expr><literal type="number">500</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS_PER_HOST</name></name></expr></argument>, <argument><expr><literal type="number">16</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>, <argument><expr><name>distribUpdateConnTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_CONNECTION_TIMEOUT</name></name></expr></argument>, <argument><expr><name>distribUpdateSoTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><name>client</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></constructor>
  
  
  <function><type><specifier>public</specifier> <name>HttpClient</name></type> <name>getHttpClient</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>client</name></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <name>ThreadPoolExecutor</name></type> <name>getCmdDistribExecutor</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>cmdDistribExecutor</name></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>void</name></type> <name>close</name><parameter_list>()</parameter_list> <block>{<block_content>
    <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>ExecutorUtil</name><operator>.</operator><name>shutdownNowAndAwaitTermination</name></name><argument_list>(<argument><expr><name>cmdDistribExecutor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>Throwable</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
      <expr_stmt><expr><call><name><name>SolrException</name><operator>.</operator><name>log</name></name><argument_list>(<argument><expr><name>log</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></catch></try>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>shutdown</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>
}</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name>processor</name><operator>/</operator><name><name>DistributedUpdateProcessor</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name>processor</name><operator>/</operator><name><name>DistributedUpdateProcessor</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">44cfbbfefca</literal><operator>..</operator><name>f48ceefe38f</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name>processor</name><operator>/</operator><name><name>DistributedUpdateProcessor</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name>processor</name><operator>/</operator><name><name>DistributedUpdateProcessor</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">166</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">166</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>DistributedUpdateProcessor</name> extends <name>UpdateRequestProcessor</name> <block>{
     <expr><name>zkController</name> <operator>=</operator> <call><name><name>req</name><operator>.</operator><name>getCore</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCoreDescriptor</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCoreContainer</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkController</name><argument_list>()</argument_list></call></expr>;
     <if_stmt><if>if <condition>(<expr><name>zkEnabled</name></expr>)</condition> <block>{<block_content>
       <expr_stmt><expr><name>numNodes</name> <operator>=</operator>  <call><name><name>zkController</name><operator>.</operator><name>getZkStateReader</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getClusterState</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getLiveNodes</name><argument_list>()</argument_list></call><operator>.</operator><call><name>size</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><name>numNodes</name></expr></argument>, <argument><expr><call><name><name>coreDesc</name><operator>.</operator><name>getCoreContainer</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkController</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCmdDistribExecutor</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><name>numNodes</name></expr></argument>, <argument><expr><call><name><name>coreDesc</name><operator>.</operator><name>getCoreContainer</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkController</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getUpdateShardHandler</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></if></if_stmt>}</block>
     <comment type="line">//this.rsp = reqInfo != null ? reqInfo.getRsp() : null;</comment>
 
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>solr</name><operator>.</operator><name>xml</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>solr</name><operator>.</operator><name>xml</name></name>
<name>index</name> <name>c146f6af167</name><operator>..</operator><literal type="number">0123502db7d</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>solr</name><operator>.</operator><name>xml</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>solr</name><operator>.</operator><name>xml</name></name>
@@ <operator>-</operator><literal type="number">29</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">29</literal></expr><operator>,</operator><expr><literal type="number">15</literal> @@
     <name>If</name> <literal type="char">'null'</literal> <operator>(</operator><name>or</name> <name>absent</name><operator>)</operator></expr><operator>,</operator> <expr><name>cores</name> <name>will</name> <name>not</name> <name>be</name> <name>manageable</name> <name>via</name> <name>request</name> <name>handler</name>
   <operator>--</operator><operator>&gt;</operator>
   <operator>&lt;</operator><name>cores</name> <name>adminPath</name><operator>=</operator><literal type="string">"/admin/cores"</literal> <name>defaultCoreName</name><operator>=</operator><literal type="string">"collection1"</literal> <name>host</name><operator>=</operator><literal type="string">"127.0.0.1"</literal> <name>hostPort</name><operator>=</operator><literal type="string">"${hostPort:8983}"</literal> 
         <name>hostContext</name><operator>=</operator><literal type="string">"${hostContext:solr}"</literal> <name>zkClientTimeout</name><operator>=</operator><literal type="string">"8000"</literal> <name>numShards</name><operator>=</operator><literal type="string">"${numShards:3}"</literal> <name>shareSchema</name><operator>=</operator><literal type="string">"${shareSchema:false}"</literal><operator>&gt;</operator>
         <name>hostContext</name><operator>=</operator><literal type="string">"${hostContext:solr}"</literal> <name>zkClientTimeout</name><operator>=</operator><literal type="string">"30000"</literal> <name>numShards</name><operator>=</operator><literal type="string">"${numShards:3}"</literal> <name>shareSchema</name><operator>=</operator><literal type="string">"${shareSchema:false}"</literal> 
         <name>distribUpdateConnTimeout</name><operator>=</operator><literal type="string">"${distribUpdateConnTimeout:15000}"</literal> <name>distribUpdateSoTimeout</name><operator>=</operator><literal type="string">"${distribUpdateSoTimeout:30000}"</literal><operator>&gt;</operator>
     <operator>&lt;</operator><name>core</name> <name>name</name><operator>=</operator><literal type="string">"collection1"</literal> <name>instanceDir</name><operator>=</operator><literal type="string">"collection1"</literal> <name>shard</name><operator>=</operator><literal type="string">"${shard:}"</literal> <name>collection</name><operator>=</operator><literal type="string">"${collection:collection1}"</literal> <name>config</name><operator>=</operator><literal type="string">"${solrconfig:solrconfig.xml}"</literal> <name>schema</name><operator>=</operator><literal type="string">"${schema:schema.xml}"</literal><operator>/</operator><operator>&gt;</operator>
    <operator>&lt;</operator><name>shardHandlerFactory</name> <name>name</name><operator>=</operator><literal type="string">"shardHandlerFactory"</literal> <name>class</name><operator>=</operator><literal type="string">"HttpShardHandlerFactory"</literal><operator>&gt;</operator>
      <operator>&lt;</operator><name>int</name> <name>name</name><operator>=</operator><literal type="string">"socketTimeout"</literal><operator>&gt;</operator><name>$</name><block>{<expr><name>socketTimeout</name><operator>:</operator><literal type="number">30000</literal></expr>}</block><operator>&lt;</operator><operator>/</operator><name>int</name><operator>&gt;</operator>
      <operator>&lt;</operator><name>int</name> <name>name</name><operator>=</operator><literal type="string">"connTimeout"</literal><operator>&gt;</operator><name>$</name><block>{<expr><name>connTimeout</name><operator>:</operator><literal type="number">15000</literal></expr>}</block><operator>&lt;</operator><operator>/</operator><name>int</name><operator>&gt;</operator>
    <operator>&lt;</operator><operator>/</operator><name>shardHandlerFactory</name><operator>&gt;</operator>
   <operator>&lt;</operator><operator>/</operator><name>cores</name><operator>&gt;</operator>
  
    

 <operator>&lt;</operator><operator>/</operator><name>solr</name><operator>&gt;</operator>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZk2Test</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZk2Test</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">943e2799d6b</literal><operator>..</operator><name>fba1c467b42</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZk2Test</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZk2Test</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">200</literal></expr><operator>,</operator><expr><literal type="number">26</literal> <operator>+</operator><literal type="number">200</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZk2Test</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><call><name><name>jetties</name><operator>.</operator><name>addAll</name></name><argument_list>(<argument><expr><call><name><name>shardToJetty</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name>SHARD2</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>jetties</name><operator>.</operator><name>remove</name></name><argument_list>(<argument><expr><name>deadShard</name></expr></argument>)</argument_list></call></expr>;
     
    <comment type="line">// wait till live nodes drops by 1</comment>
    <expr><name>int</name> <name>liveNodes</name> <operator>=</operator> <call><name><name>cloudClient</name><operator>.</operator><name>getZkStateReader</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getChildren</name><argument_list>(<argument><expr><name><name>ZkStateReader</name><operator>.</operator><name>LIVE_NODES_ZKNODE</name></name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>size</name><argument_list>()</argument_list></call></expr>;
    <expr><name>int</name> <name>tries</name> <operator>=</operator> <literal type="number">50</literal></expr>;
    <while>while<condition>(<expr><name>oldLiveNodes</name> <operator>==</operator> <name>liveNodes</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <if_stmt><if>if <condition>(<expr><name>tries</name><operator>--</operator> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"We expected a node to drop..."</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/></block_content></block></if></if_stmt></block_content></block></while>}</block>
      <name>liveNodes</name> <operator>=</operator> <call><name><name>cloudClient</name><operator>.</operator><name>getZkStateReader</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getChildren</name><argument_list>(<argument><expr><name><name>ZkStateReader</name><operator>.</operator><name>LIVE_NODES_ZKNODE</name></name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>size</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    }
    assertEquals<expr_stmt><expr><operator>(</operator><literal type="number">4</literal><operator>,</operator> <name>liveNodes</name><operator>)</operator></expr>;</expr_stmt>

    <decl_stmt><decl><type><name>int</name></type> <name>cnt</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>
    <for>for <control>(<init><decl><type><name>CloudJettyRunner</name></type> <name>cjetty</name> <range>: <expr><name>jetties</name></expr></range></decl></init>)</control> <block>{<block_content>
      <expr_stmt><expr><call><name>waitToSeeNotLive</name><argument_list>(<argument><expr><operator>(</operator><operator>(</operator><name>SolrDispatchFilter</name><operator>)</operator> <call><name><name>cjetty</name><operator>.</operator><name>jetty</name><operator>.</operator><name>getDispatchFilter</name></name><argument_list>()</argument_list></call>
          <operator>.</operator><call><name>getFilter</name><argument_list>()</argument_list></call><operator>)</operator><operator>.</operator><call><name>getCores</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkController</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkStateReader</name><argument_list>()</argument_list></call></expr></argument>,
          <argument><expr><name>deadShard</name></expr></argument>, <argument><expr><name>cnt</name><operator>++</operator></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></for>
    <expr_stmt><expr><call><name>waitToSeeNotLive</name><argument_list>(<argument><expr><call><name><name>cloudClient</name><operator>.</operator><name>getZkStateReader</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>deadShard</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

     <comment type="line">// ensure shard is dead</comment>
     <try>try <block>{<block_content>
       <expr_stmt><expr><call><name>index_specific</name><argument_list>(<argument><expr><name><name>deadShard</name><operator>.</operator><name>client</name><operator>.</operator><name>solrClient</name></name></expr></argument>, <argument><expr><name>id</name></expr></argument>, <argument><expr><literal type="number">999</literal></expr></argument>, <argument><expr><name>i1</name></expr></argument>, <argument><expr><literal type="number">107</literal></expr></argument>, <argument><expr><name>t1</name></expr></argument>,
<argument>@@ <expr><operator>-</operator><literal type="number">269</literal></expr></argument>,<argument><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">249</literal></expr></argument>,<argument><expr><literal type="number">14</literal> @@ <specifier>public</specifier> class <name>BasicDistributedZk2Test</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><name>UpdateRequest</name> <name>ureq</name> <operator>=</operator> <operator>new</operator> <call><name>UpdateRequest</name><argument_list>()</argument_list></call></expr>;
     <expr><call><name><name>ureq</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name>doc</name></expr></argument>)</argument_list></call></expr>;
     <comment type="line">// ureq.setParam("update.chain", DISTRIB_UPDATE_CHAIN);</comment>
    <expr><call><name><name>ureq</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><name>cloudClient</name></expr></argument>)</argument_list></call></expr>;
    
    <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>ureq</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><name>cloudClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt/>}</block_content> catch(SolrServerException e</block></try>)<block>{
      <comment type="line">// try again</comment>
      <expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">500</literal></expr></argument>)</argument_list></call></expr>;
      <expr><call><name><name>ureq</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><name>cloudClient</name></expr></argument>)</argument_list></call></expr>;
    }</block></block>
     
     <call><name>commit</name><argument_list>()</argument_list></call></expr></argument>;
     
<argument>@@ <expr><operator>-</operator><literal type="number">319</literal></expr></argument>,<argument><expr><literal type="number">14</literal> <operator>+</operator><literal type="number">306</literal></expr></argument>,<argument><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>BasicDistributedZk2Test</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     
     <comment type="line">// recover over 100 docs so we do more than just peer sync (replicate recovery)</comment>
     <expr><call><name><name>chaosMonkey</name><operator>.</operator><name>stopJetty</name></name><argument_list>(<argument><expr><name>deadShard</name></expr></argument>)</argument_list></call></expr>;
    
    <for>for <control>(<init><decl><type><name>CloudJettyRunner</name></type> <name>cjetty</name> <range>: <expr><name>jetties</name></expr></range></decl></init>)</control> <block>{<block_content>
      <expr_stmt><expr><call><name>waitToSeeNotLive</name><argument_list>(<argument><expr><operator>(</operator><operator>(</operator><name>SolrDispatchFilter</name><operator>)</operator> <call><name><name>cjetty</name><operator>.</operator><name>jetty</name><operator>.</operator><name>getDispatchFilter</name></name><argument_list>()</argument_list></call>
          <operator>.</operator><call><name>getFilter</name><argument_list>()</argument_list></call><operator>)</operator><operator>.</operator><call><name>getCores</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkController</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkStateReader</name><argument_list>()</argument_list></call></expr></argument>,
          <argument><expr><name>deadShard</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt/>}</block_content>
    waitToSeeNotLive(cloudClient.getZkStateReader(</block></for>)<operator>,</operator> <name>deadShard</name></block></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    

     <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <literal type="number">226</literal></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
       <expr_stmt><expr><name>doc</name> <operator>=</operator> <operator>new</operator> <call><name>SolrInputDocument</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>doc</name><operator>.</operator><name>addField</name></name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>, <argument><expr><literal type="number">2000</literal> <operator>+</operator> <name>i</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">814138ca550</literal><operator>..</operator><name>c34de311adb</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">375</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">375</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><name>SolrServer</name> <name>client</name> <operator>=</operator> <call><name><name>clients</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>String</name> <name>url1</name> <operator>=</operator> <call><name>getBaseUrl</name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;
     <expr><name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>url1</name></expr></argument>)</argument_list></call></expr>;
    
    <expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>server</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>createCmd</name></expr></argument>)</argument_list></call></expr>;
     
     <expr><name>createCmd</name> <operator>=</operator> <operator>new</operator> <call><name>Create</name><argument_list>()</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">437</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">438</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><name>SolrServer</name> <name>client</name> <operator>=</operator> <call><name><name>clients</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>String</name> <name>url1</name> <operator>=</operator> <call><name>getBaseUrl</name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;
     <expr><name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>url1</name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;
     
     <expr><name>Create</name> <name>createCmd</name> <operator>=</operator> <operator>new</operator> <call><name>Create</name><argument_list>()</argument_list></call></expr>;
     <expr><call><name><name>createCmd</name><operator>.</operator><name>setCoreName</name></name><argument_list>(<argument><expr><literal type="string">"unloadcollection1"</literal></expr></argument>)</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">627</literal></expr>,<expr><literal type="number">7</literal> <operator>+</operator><literal type="number">630</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><name>SolrServer</name> <name>client</name> <operator>=</operator> <call><name><name>clients</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>String</name> <name>url3</name> <operator>=</operator> <call><name>getBaseUrl</name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;
     <expr><name>final</name> <name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>url3</name></expr></argument>)</argument_list></call></expr>;
    
    <expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>ThreadPoolExecutor</name> <name>executor</name> <operator>=</operator> <operator>new</operator> <call><name>ThreadPoolExecutor</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name><name>Integer</name><operator>.</operator><name>MAX_VALUE</name></name></expr></argument>,
         <argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>SECONDS</name></name></expr></argument>, <argument><expr><operator>new</operator> <call><name><name>SynchronousQueue</name><argument_list type="generic">&lt;<argument><name>Runnable</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></argument>,
         <argument><expr><operator>new</operator> <call><name>DefaultSolrThreadFactory</name><argument_list>(<argument><expr><literal type="string">"testExecutor"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">667</literal></expr>,<expr><literal type="number">7</literal> <operator>+</operator><literal type="number">671</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><name>SolrServer</name> <name>client</name> <operator>=</operator> <call><name><name>clients</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>String</name> <name>url3</name> <operator>=</operator> <call><name>getBaseUrl</name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;
     <expr><name>final</name> <name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>url3</name></expr></argument>)</argument_list></call></expr>;
    
    <expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>ThreadPoolExecutor</name> <name>executor</name> <operator>=</operator> <operator>new</operator> <call><name>ThreadPoolExecutor</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name><name>Integer</name><operator>.</operator><name>MAX_VALUE</name></name></expr></argument>,
         <argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>SECONDS</name></name></expr></argument>, <argument><expr><operator>new</operator> <call><name><name>SynchronousQueue</name><argument_list type="generic">&lt;<argument><name>Runnable</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></argument>,
         <argument><expr><operator>new</operator> <call><name>DefaultSolrThreadFactory</name><argument_list>(<argument><expr><literal type="string">"testExecutor"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">791</literal></expr>,<expr><literal type="number">7</literal> <operator>+</operator><literal type="number">796</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
       <expr><name>String</name> <name>url</name> <operator>=</operator> <call><name>getUrlFromZk</name><argument_list>(<argument><expr><name>collection</name></expr></argument>)</argument_list></call></expr>;
 
       <expr><name>HttpSolrServer</name> <name>collectionClient</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr>;
      
      <expr><call><name><name>collectionClient</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
      <expr><call><name><name>collectionClient</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;
       <comment type="line">// poll for a second - it can take a moment before we are ready to serve</comment>
       <expr><call><name>waitForNon403or404or503</name><argument_list>(<argument><expr><name>collectionClient</name></expr></argument>)</argument_list></call></expr>;
     }</block>
@@ <operator>-</operator><literal type="number">1291</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">1297</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
   <expr><specifier>private</specifier> <name>Long</name> <call><name>getNumCommits</name><argument_list>(<argument><expr><name>HttpSolrServer</name> <name>solrServer</name></expr></argument>)</argument_list></call> <throws>throws
       <argument><expr><name>SolrServerException</name></expr></argument>, <argument><expr><name>IOException</name> <block>{
     <expr><name>HttpSolrServer</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><call><name><name>solrServer</name><operator>.</operator><name>getBaseURL</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>ModifiableSolrParams</name> <name>params</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr>;
     <expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><literal type="string">"qt"</literal></expr></argument>, <argument><expr><literal type="string">"/admin/mbeans?key=updateHandler&amp;stats=true"</literal></expr></argument>)</argument_list></call></expr>;
     <comment type="line">// use generic request to avoid extra processing of queries</comment>
@@ <expr><operator>-</operator><literal type="number">1483</literal></expr>,<expr><literal type="number">7</literal> <operator>+</operator><literal type="number">1491</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
         <expr><name>HttpSolrServer</name> <name>server</name></expr>;
         <try>try <block>{<block_content>
           <expr_stmt><expr><name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>baseUrl</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          
          <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
           <decl_stmt><decl><type><name>Create</name></type> <name>createCmd</name> <init>= <expr><operator>new</operator> <call><name>Create</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
           <expr_stmt><expr><call><name><name>createCmd</name><operator>.</operator><name>setRoles</name></name><argument_list>(<argument><expr><literal type="string">"none"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
           <expr_stmt><expr><call><name><name>createCmd</name><operator>.</operator><name>setCoreName</name></name><argument_list>(<argument><expr><name>collection</name> <operator>+</operator> <name>num</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1649</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">1658</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
           <expr><name>HttpSolrServer</name> <name>server</name></expr>;
           <try>try <block>{<block_content>
             <expr_stmt><expr><name>server</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>baseUrl</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            
            <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
             <decl_stmt><decl><type><name>Create</name></type> <name>createCmd</name> <init>= <expr><operator>new</operator> <call><name>Create</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
             <expr_stmt><expr><call><name><name>createCmd</name><operator>.</operator><name>setCoreName</name></name><argument_list>(<argument><expr><name>collection</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
             <expr_stmt><expr><call><name><name>createCmd</name><operator>.</operator><name>setDataDir</name></name><argument_list>(<argument><expr><call><name><name>dataDir</name><operator>.</operator><name>getAbsolutePath</name></name><argument_list>()</argument_list></call> <operator>+</operator> <name><name>File</name><operator>.</operator><name>separator</name></name>
@@ <operator>-</operator><literal type="number">1679</literal></expr></argument>,<argument><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">1689</literal></expr></argument>,<argument><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <try>try <block>{<block_content>
       <comment type="line">// setup the server...</comment>
       <decl_stmt><decl><type><name>HttpSolrServer</name></type> <name>s</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>baseUrl</name> <operator>+</operator> <literal type="string">"/"</literal> <operator>+</operator> <name>collection</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>s</name></expr>;</return>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1696</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">1706</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> class <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
         <try>try <block>{<block_content>
           <expr_stmt><expr><name>commondCloudSolrServer</name> <operator>=</operator> <operator>new</operator> <call><name>CloudSolrServer</name><argument_list>(<argument><expr><call><name><name>zkServer</name><operator>.</operator><name>getZkAddress</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
           <expr_stmt><expr><call><name><name>commondCloudSolrServer</name><operator>.</operator><name>setDefaultCollection</name></name><argument_list>(<argument><expr><name>DEFAULT_COLLECTION</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>commondCloudSolrServer</name><operator>.</operator><name>getLbServer</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>setConnectionTimeout</name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>commondCloudSolrServer</name><operator>.</operator><name>getLbServer</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>setSoTimeout</name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
           <expr_stmt><expr><call><name><name>commondCloudSolrServer</name><operator>.</operator><name>connect</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
         <expr_stmt/>}</block_content> catch (MalformedURLException e</block></try>) <block>{
           <throw>throw <argument_list>new <argument><expr><call><name>RuntimeException</name><argument_list>(<argument><expr><name>e</name></expr></argument>)</argument_list></call></expr></argument></argument_list></throw>;
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>d9698d6bde6</name><operator>..</operator><literal type="number">21c9d196169</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">204</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">204</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> class <name>ChaosMonkeyNothingIsSafeTest</name> extends <name>AbstractFullDistribZkTestBase</name>
       <call><name>setName</name><argument_list>(<argument><expr><literal type="string">"FullThrottleStopableIndexingThread"</literal></expr></argument>)</argument_list></call></expr>;
       <expr><call><name>setDaemon</name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;
       <expr><name><name>this</name><operator>.</operator><name>clients</name></name> <operator>=</operator> <name>clients</name></expr>;
      <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
      <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
       <expr><name>suss</name> <operator>=</operator> <operator>new</operator> <class><super><name>ConcurrentUpdateSolrServer</name></super><argument_list>(
           <argument><expr><operator>(</operator><operator>(</operator><name>HttpSolrServer</name><operator>)</operator> <call><name><name>clients</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>)</operator><operator>.</operator><call><name>getBaseURL</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>, <argument><expr><literal type="number">8</literal></expr></argument>,
           <argument><expr><literal type="number">2</literal></expr></argument>)</argument_list> <block>{
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>FullSolrCloudDistribCmdsTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>FullSolrCloudDistribCmdsTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">22898f63593</literal><operator>..</operator><literal type="number">8ed0fa23f36</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>FullSolrCloudDistribCmdsTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>FullSolrCloudDistribCmdsTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">238</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">238</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> class <name>FullSolrCloudDistribCmdsTest</name> extends <name>AbstractFullDistribZkTestBase</name>
   <specifier>private</specifier> <name>void</name> <call><name>testIndexingWithSuss</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
     <expr><name>ConcurrentUpdateSolrServer</name> <name>suss</name> <operator>=</operator> <operator>new</operator> <call><name>ConcurrentUpdateSolrServer</name><argument_list>(
         <argument><expr><operator>(</operator><operator>(</operator><name>HttpSolrServer</name><operator>)</operator> <call><name><name>clients</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>)</operator><operator>.</operator><call><name>getBaseURL</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="number">3</literal></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;</expr_stmt>
    
    <expr_stmt><expr><call><name><name>suss</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>suss</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name><init>=<expr><literal type="number">100</literal></expr></init></decl>;</init> <condition><expr><name>i</name><operator>&lt;</operator><literal type="number">150</literal></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
       <expr_stmt><expr><call><name>index_specific</name><argument_list>(<argument><expr><name>suss</name></expr></argument>, <argument><expr><name>id</name></expr></argument>, <argument><expr><name>i</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>      
     <expr_stmt/>}</block_content>
diff --git a/solr/core/src/test/org/apache/solr/cloud/SyncSliceTest.java b/solr/core/src/test/org/apache/solr/cloud/SyncSliceTest.java
index fa6be408485..f51d86d0ead 100644
-- a/solr/core/src/test/org/apache/solr/cloud/SyncSliceTest.java
++ b/solr/core/src/test/org/apache/solr/cloud/SyncSliceTest.java
@@ -33</block><operator>,</operator><expr_stmt><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">33</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt></for> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>UpdateRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputDocument</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CollectionParams</name><operator>.</operator><name>CollectionAction</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>servlet</name><operator>.</operator><name>SolrDispatchFilter</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>After</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>AfterClass</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Before</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">130</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">129</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> class <name>SyncSliceTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><name>baseUrl</name> <operator>=</operator> <call><name><name>baseUrl</name><operator>.</operator><name>substring</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><call><name><name>baseUrl</name><operator>.</operator><name>length</name></name><argument_list>()</argument_list></call> <operator>-</operator> <literal type="string">"collection1"</literal><operator>.</operator><call><name>length</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
     
     <expr><name>HttpSolrServer</name> <name>baseServer</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>baseUrl</name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>baseServer</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>baseServer</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>baseServer</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>request</name></expr></argument>)</argument_list></call></expr>;
     
     <expr><call><name>waitForThingsToLevelOut</name><argument_list>(<argument><expr><literal type="number">15</literal></expr></argument>)</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">157</literal></expr>,<expr><literal type="number">12</literal> <operator>+</operator><literal type="number">158</literal></expr>,<expr><literal type="number">11</literal> @@ <specifier>public</specifier> class <name>SyncSliceTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     
     <expr><call><name><name>chaosMonkey</name><operator>.</operator><name>killJetty</name></name><argument_list>(<argument><expr><name>leaderJetty</name></expr></argument>)</argument_list></call></expr>;
 
    <comment type="line">// we are careful to make sure the downed node is no longer in the state,</comment>
    <comment type="line">// because on some systems (especially freebsd w/ blackhole enabled), trying</comment>
    <comment type="line">// to talk to a downed node causes grief</comment>
    <expr><call><name>waitToSeeDownInClusterState</name><argument_list>(<argument><expr><name>leaderJetty</name></expr></argument>, <argument><expr><name>jetties</name></expr></argument>)</argument_list></call></expr>;

    <expr><call><name>waitForThingsToLevelOut</name><argument_list>(<argument><expr><literal type="number">45</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">2000</literal></expr></argument>)</argument_list></call></expr>;
    
    <expr><call><name>waitForThingsToLevelOut</name><argument_list>(<argument><expr><literal type="number">90</literal></expr></argument>)</argument_list></call></expr>;
    
    <expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">1000</literal></expr></argument>)</argument_list></call></expr>;
     
     <expr><call><name>checkShardConsistency</name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;
     
@@ <expr><operator>-</operator><literal type="number">220</literal></expr>,<expr><literal type="number">9</literal> <operator>+</operator><literal type="number">220</literal></expr>,<expr><literal type="number">11</literal> @@ <specifier>public</specifier> class <name>SyncSliceTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <comment type="line">// kill the current leader</comment>
     <expr><call><name><name>chaosMonkey</name><operator>.</operator><name>killJetty</name></name><argument_list>(<argument><expr><name>leaderJetty</name></expr></argument>)</argument_list></call></expr>;
     
    <expr><call><name>waitToSeeDownInClusterState</name><argument_list>(<argument><expr><name>leaderJetty</name></expr></argument>, <argument><expr><name>jetties</name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">3000</literal></expr></argument>)</argument_list></call></expr>;
    
    <expr><call><name>waitForThingsToLevelOut</name><argument_list>(<argument><expr><literal type="number">90</literal></expr></argument>)</argument_list></call></expr>;
     
    <expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">4000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">2000</literal></expr></argument>)</argument_list></call></expr>;
     
     <expr><call><name>waitForRecoveriesToFinish</name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;
 
@@ <expr><operator>-</operator><literal type="number">251</literal></expr>,<expr><literal type="number">17</literal> <operator>+</operator><literal type="number">253</literal></expr>,<expr><literal type="number">6</literal> @@ <specifier>public</specifier> class <name>SyncSliceTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><call><name><name>skipServers</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name><name>cjetty</name><operator>.</operator><name>url</name></name> <operator>+</operator> <literal type="string">"/"</literal></expr></argument>)</argument_list></call></expr>;
     <return>return <expr><name>skipServers</name></expr>;</return>
   }</block>

  <specifier>private</specifier> <name>void</name> <call><name>waitToSeeDownInClusterState</name><argument_list>(<argument><expr><name>CloudJettyRunner</name> <name>leaderJetty</name></expr></argument>,
      <argument><expr><name><name>Set</name><argument_list type="generic">&lt;<argument><name>CloudJettyRunner</name></argument>&gt;</argument_list></name> <name>jetties</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>InterruptedException</name> <block>{</block></expr></argument></throws></expr>

    <for>for <control>(<init><decl><type><name>CloudJettyRunner</name></type> <name>cjetty</name> <range>: <expr><name>jetties</name></expr></range></decl></init>)</control> <block>{<block_content>
      <expr_stmt><expr><call><name>waitToSeeNotLive</name><argument_list>(<argument><expr><operator>(</operator><operator>(</operator><name>SolrDispatchFilter</name><operator>)</operator> <call><name><name>cjetty</name><operator>.</operator><name>jetty</name><operator>.</operator><name>getDispatchFilter</name></name><argument_list>()</argument_list></call>
          <operator>.</operator><call><name>getFilter</name><argument_list>()</argument_list></call><operator>)</operator><operator>.</operator><call><name>getCores</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkController</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkStateReader</name><argument_list>()</argument_list></call></expr></argument>,
          <argument><expr><name>leaderJetty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt/>}</block_content>
    waitToSeeNotLive(cloudClient.getZkStateReader(</block></for>)<operator>,</operator> <name>leaderJetty</name></block></expr></block></expr></block></expr></expr_stmt></block></class></expr></block></block></expr></expr_stmt></block_content></block></try></block></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  <expr_stmt/></block_content></block></try>}</block>
   
   <specifier>protected</specifier> <name>void</name> <call><name>indexDoc</name><argument_list>(<argument><expr><name><name>List</name><argument_list type="generic">&lt;<argument><name>String</name></argument>&gt;</argument_list></name> <name>skipServers</name></expr></argument>, <argument><expr><name>Object</name><operator>...</operator> <name>fields</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>IOException</name></expr></argument>,
       <argument><expr><name>SolrServerException</name> <block>{
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a0409b0c589</name><operator>..</operator><name>a661fd48ec6</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name></expr></block></expr></argument>
@<argument>@ <expr><operator>-</operator><literal type="number">137</literal></expr></argument>,<argument><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">137</literal></expr></argument>,<argument><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ZkControllerTest</name> extends <name>SolrTestCaseJ4</name></expr></argument></throws> <block>{<block_content>
       <expr_stmt><expr><name>cc</name> <operator>=</operator> <call><name>getCoreContainer</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       
       <decl_stmt><decl><type><name>ZkController</name></type> <name>zkController</name> <init>= <expr><operator>new</operator> <call><name>ZkController</name><argument_list>(<argument><expr><name>cc</name></expr></argument>, <argument><expr><call><name><name>server</name><operator>.</operator><name>getZkAddress</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>TIMEOUT</name></expr></argument>, <argument><expr><literal type="number">10000</literal></expr></argument>,
          <argument><expr><literal type="string">"127.0.0.1"</literal></expr></argument>, <argument><expr><literal type="string">"8983"</literal></expr></argument>, <argument><expr><literal type="string">"solr"</literal></expr></argument>, <argument><expr><literal type="string">"0"</literal></expr></argument>, <argument><expr><operator>new</operator> <class><super><name>CurrentCoreDescriptorProvider</name></super><argument_list>()</argument_list> <block>{
          <expr_stmt><expr><literal type="string">"127.0.0.1"</literal></expr><operator>,</operator> <expr><literal type="string">"8983"</literal></expr><operator>,</operator> <expr><literal type="string">"solr"</literal></expr><operator>,</operator> <expr><literal type="string">"0"</literal></expr><operator>,</operator> <expr><literal type="number">10000</literal></expr><operator>,</operator> <expr><literal type="number">10000</literal></expr><operator>,</operator> <expr><operator>new</operator> <class><super><name>CurrentCoreDescriptorProvider</name></super><argument_list>()</argument_list> <block>{
             
             <function><annotation>@<name>Override</name></annotation>
             <type><specifier>public</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>CoreDescriptor</name></argument>&gt;</argument_list></name></type> <name>getCurrentDescriptors</name><parameter_list>()</parameter_list> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">177</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">177</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>ZkControllerTest</name> extends <name>SolrTestCaseJ4</name> <block>{
       <expr><name>cc</name> <operator>=</operator> <call><name>getCoreContainer</name><argument_list>()</argument_list></call></expr>;
       
       <expr><name>zkController</name> <operator>=</operator> <operator>new</operator> <call><name>ZkController</name><argument_list>(<argument><expr><name>cc</name></expr></argument>, <argument><expr><call><name><name>server</name><operator>.</operator><name>getZkAddress</name></name><argument_list>()</argument_list></call></expr></argument>,
          <argument><expr><name>TIMEOUT</name></expr></argument>, <argument><expr><literal type="number">10000</literal></expr></argument>, <argument><expr><literal type="string">"127.0.0.1"</literal></expr></argument>, <argument><expr><literal type="string">"8983"</literal></expr></argument>, <argument><expr><literal type="string">"solr"</literal></expr></argument>, <argument><expr><literal type="string">"0"</literal></expr></argument>, <argument><expr><operator>new</operator> <class><super><name>CurrentCoreDescriptorProvider</name></super><argument_list>()</argument_list> <block>{
          <expr_stmt><expr><name>TIMEOUT</name></expr><operator>,</operator> <expr><literal type="number">10000</literal></expr><operator>,</operator> <expr><literal type="string">"127.0.0.1"</literal></expr><operator>,</operator> <expr><literal type="string">"8983"</literal></expr><operator>,</operator> <expr><literal type="string">"solr"</literal></expr><operator>,</operator> <expr><literal type="string">"0"</literal></expr><operator>,</operator> <expr><literal type="number">10000</literal></expr><operator>,</operator> <expr><literal type="number">10000</literal></expr><operator>,</operator> <expr><operator>new</operator> <class><super><name>CurrentCoreDescriptorProvider</name></super><argument_list>()</argument_list> <block>{
             
             <function><annotation>@<name>Override</name></annotation>
             <type><specifier>public</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>CoreDescriptor</name></argument>&gt;</argument_list></name></type> <name>getCurrentDescriptors</name><parameter_list>()</parameter_list> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">198</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">198</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>ZkControllerTest</name> extends <name>SolrTestCaseJ4</name> <block>{
       }</block>
       <name>testFinished</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;</expr_stmt>
     <expr_stmt/>}</block_content> finally <block>{<block_content>
      <if_stmt><if>if <condition>(<expr><operator>!</operator><name>testFinished</name></expr>)</condition> <block>{<block_content>
      <if_stmt><if>if <condition>(<expr><operator>!</operator><name>testFinished</name> <operator>&amp;</operator> <name>zkController</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
         <expr_stmt><expr><call><name><name>zkController</name><operator>.</operator><name>getZkClient</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>printLayoutToStdOut</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       <expr_stmt/>}</block_content>
       
@@ -214</block><operator>,</operator><expr_stmt><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">214</literal></expr><operator>,</operator><expr><literal type="number">13</literal> @@ <specifier>public</specifier> class <name>ZkControllerTest</name> extends <name>SolrTestCaseJ4</name> <block>{
   }</block>
 
   <specifier>private</specifier> <name>CoreContainer</name> <call><name>getCoreContainer</name><argument_list>()</argument_list></call> <block>{
    <return>return <expr><operator>new</operator> <call><name>CoreContainer</name><argument_list>(<argument><expr><call><name><name>TEMP_DIR</name><operator>.</operator><name>getAbsolutePath</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
    <name>CoreContainer</name> <name>cc</name> <operator>=</operator> <operator>new</operator> <class><super><name>CoreContainer</name></super><argument_list>(<argument><expr><call><name><name>TEMP_DIR</name><operator>.</operator><name>getAbsolutePath</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list> <block>{
      <block>{<block_content>
        <expr_stmt><expr><call><name>initShardHandler</name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/>}</block_content>
    }</block><empty_stmt>;</empty_stmt>
    
    <return>return <expr><name>cc</name></expr>;</return>
   <expr_stmt/>}</block>
 
   <annotation>@<name>Override</name></annotation>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">2f335877f19</literal><operator>..</operator><literal type="number">3d654334188</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">138</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">138</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> class <name>TestReplicationHandler</name> extends <name>SolrTestCaseJ4</name> <block>{
       <comment type="line">// setup the server...</comment>
       <expr><name>String</name> <name>url</name> <operator>=</operator> <literal type="string">"http://127.0.0.1:"</literal> <operator>+</operator> <name>port</name> <operator>+</operator> <name>context</name></expr>;
       <name>HttpSolrServer</name> <name>s</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt></class>
      <call><name><name>s</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt></if></if_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>s</name></expr>;</return>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributorTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributorTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">41fd6d5f744</literal><operator>..</operator><literal type="number">47ff0496b3e</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributorTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>SolrCmdDistributorTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">21</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">21</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>File</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>ArrayList</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>SynchronousQueue</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ThreadPoolExecutor</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>TimeUnit</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>atomic</name><operator>.</operator><name>AtomicInteger</name></name>;</import>
 
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>BaseDistributedSearchTestCase</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">37</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">34</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkCoreNodeProps</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkNodeProps</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkStateReader</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>ExecutorUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>NamedList</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>CoreContainer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>SolrCore</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">48</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">44</literal></expr><operator>,</operator><expr><literal type="number">9</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name><operator>.</operator><name>SolrCmdDistributor</name><operator>.</operator><name>Node</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name><operator>.</operator><name>SolrCmdDistributor</name><operator>.</operator><name>Response</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name><operator>.</operator><name>SolrCmdDistributor</name><operator>.</operator><name>StdNode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name><operator>.</operator><name>processor</name><operator>.</operator><name>DistributedUpdateProcessor</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>DefaultSolrThreadFactory</name></name>;</import>
 
 <class><specifier>public</specifier> class <name>SolrCmdDistributorTest</name> <super_list><extends>extends <super><name>BaseDistributedSearchTestCase</name></super></extends></super_list> <block>{
  <decl_stmt><decl><type><specifier>private</specifier> <name>ThreadPoolExecutor</name></type> <name>executor</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <name>UpdateShardHandler</name></type> <name>updateShardHandler</name></decl>;</decl_stmt>
   
   <constructor><specifier>public</specifier> <name>SolrCmdDistributorTest</name><parameter_list>()</parameter_list> <block>{<block_content>
     <expr_stmt><expr><name>fixShardCount</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">97</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">92</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>SolrCmdDistributorTest</name> extends <name>BaseDistributedSearchTestCase</name> <block>{
   <expr><specifier>public</specifier> <name>void</name> <call><name>doTest</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
     <expr><call><name>del</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;
     
    <name>SolrCmdDistributor</name> <name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name>executor</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>SolrCmdDistributor</name></type> <name>cmdDistrib</name> <init>= <expr><operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name>updateShardHandler</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     
     <decl_stmt><decl><type><name>ModifiableSolrParams</name></type> <name>params</name> <init>= <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">137</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">132</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>SolrCmdDistributorTest</name> extends <name>BaseDistributedSearchTestCase</name> <block>{
     <expr><call><name><name>nodes</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>StdNode</name><argument_list>(<argument><expr><operator>new</operator> <call><name>ZkCoreNodeProps</name><argument_list>(<argument><expr><name>nodeProps</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
     
     <comment type="line">// add another 2 docs to control and 3 to client</comment>
    <name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name>executor</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <expr_stmt><expr><name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name>updateShardHandler</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><name><name>cmd</name><operator>.</operator><name>solrDoc</name></name> <operator>=</operator> <call><name>sdoc</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>, <argument><expr><literal type="number">2</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><name>params</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>DistributedUpdateProcessor</name><operator>.</operator><name>COMMIT_END_POINT</name></name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">180</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">175</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>SolrCmdDistributorTest</name> extends <name>BaseDistributedSearchTestCase</name> <block>{
     
     
 
    <expr><name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name>executor</name></expr></argument>)</argument_list></call></expr>;
    <name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name>updateShardHandler</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
     
     <expr_stmt><expr><name>params</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>DistributedUpdateProcessor</name><operator>.</operator><name>COMMIT_END_POINT</name></name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">213</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">208</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>SolrCmdDistributorTest</name> extends <name>BaseDistributedSearchTestCase</name> <block>{
     
     <expr><name>int</name> <name>id</name> <operator>=</operator> <literal type="number">5</literal></expr>;
     
    <name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name>executor</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <expr_stmt><expr><name>cmdDistrib</name> <operator>=</operator> <operator>new</operator> <call><name>SolrCmdDistributor</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><name>updateShardHandler</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     
     <decl_stmt><decl><type><name>int</name></type> <name>cnt</name> <init>= <expr><call><name>atLeast</name><argument_list>(<argument><expr><literal type="number">303</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <name>cnt</name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">289</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">284</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> class <name>SolrCmdDistributorTest</name> extends <name>BaseDistributedSearchTestCase</name> <block>{
   @<expr><name>Override</name>
   <specifier>public</specifier> <name>void</name> <call><name>setUp</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
     <expr><call><name><name>super</name><operator>.</operator><name>setUp</name></name><argument_list>()</argument_list></call></expr></block></expr></argument></throws></expr>;
    <name>executor</name> <operator>=</operator> <operator>new</operator> <call><name>ThreadPoolExecutor</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name><name>Integer</name><operator>.</operator><name>MAX_VALUE</name></name></expr></argument>, <argument><expr><literal type="number">5</literal></expr></argument>,
        <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>SECONDS</name></name></expr></argument>, <argument><expr><operator>new</operator> <call><name><name>SynchronousQueue</name><argument_list type="generic">&lt;<argument><name>Runnable</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></argument>,
        <argument><expr><operator>new</operator> <call><name>DefaultSolrThreadFactory</name><argument_list>(<argument><expr><literal type="string">"cmdDistribExecutor"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <expr_stmt><expr><name>updateShardHandler</name> <operator>=</operator> <operator>new</operator> <call><name>UpdateShardHandler</name><argument_list>(<argument><expr><literal type="number">10000</literal></expr></argument>, <argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   <expr_stmt/>}</block_content>
   
   @Override
   public void tearDown(</block></for>)</block_content> <throws>throws <argument><expr><name>Exception</name> <block>{
    <expr><call><name><name>ExecutorUtil</name><operator>.</operator><name>shutdownNowAndAwaitTermination</name></name><argument_list>(<argument><expr><name>executor</name></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></block><empty_stmt>;</empty_stmt></constructor>
    <expr_stmt><expr><name>executor</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
    <expr_stmt><expr><name>updateShardHandler</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
     <constructor_decl><name><name>super</name><operator>.</operator><name>tearDown</name></name><parameter_list>()</parameter_list>;</constructor_decl>
   <expr_stmt/>}</block>
 <expr_stmt/></class>}</block_content>
diff --git a/solr/solrj/src/java/org/apache/solr/client/solrj/impl/ConcurrentUpdateSolrServer.java b/solr/solrj/src/java/org/apache/solr/client/solrj/impl/ConcurrentUpdateSolrServer.java
index 27f177ea58f..75519267874 100644
-- a/solr/solrj/src/java/org/apache/solr/client/solrj/impl/ConcurrentUpdateSolrServer.java
++ b/solr/solrj/src/java/org/apache/solr/client/solrj/impl/ConcurrentUpdateSolrServer.java
@@ -372</block><operator>,</operator><expr_stmt><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">372</literal></expr><operator>,</operator><expr><literal type="number">18</literal> @@ <specifier>public</specifier> class <name>ConcurrentUpdateSolrServer</name> extends <name>SolrServer</name> <block>{
       <expr><call><name><name>Thread</name><operator>.</operator><name>currentThread</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>interrupt</name><argument_list>()</argument_list></call></expr>;
     }</block>
   }
  
  <specifier>public</specifier> <name>void</name> <call><name>setConnectionTimeout</name><argument_list>(<argument><expr><name>int</name> <name>timeout</name></expr></argument>)</argument_list></call> <block>{
    <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><call><name><name>server</name><operator>.</operator><name>getHttpClient</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;
  }</block>

  <comment type="block" format="javadoc">/**
   * set soTimeout (read timeout) on the underlying HttpConnectionManager. This is desirable for queries, but probably
   * not for indexing.
   */</comment>
  <specifier>public</specifier> <name>void</name> <call><name>setSoTimeout</name><argument_list>(<argument><expr><name>int</name> <name>timeout</name></expr></argument>)</argument_list></call> <block>{
    <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><call><name><name>server</name><operator>.</operator><name>getHttpClient</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;
  }</block>
 
   <specifier>public</specifier> <name>void</name> <call><name>shutdownNow</name><argument_list>()</argument_list></call> <block>{
     <expr><call><name><name>server</name><operator>.</operator><name>shutdown</name></name><argument_list>()</argument_list></call></expr>;
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">54c87482f49</literal><operator>..</operator><literal type="number">0ad8d061127</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">367</literal>,<literal type="number">7</literal> <operator>+</operator><literal type="number">367</literal>,<literal type="number">8</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> class <name>BaseDistributedSearchTestCase</name> extends <name>SolrTestCaseJ4</name> <block>{
       <comment type="line">// setup the server...</comment>
       <expr><name>String</name> <name>url</name> <operator>=</operator> <literal type="string">"http://127.0.0.1:"</literal> <operator>+</operator> <name>port</name> <operator>+</operator> <name>context</name></expr>;
       <name>HttpSolrServer</name> <name>s</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></block></block></expr>;</expr_stmt></if></if_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><empty_stmt>;</empty_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>s</name></expr>;</return>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">169e986df02</literal><operator>..</operator><literal type="number">97d78f54130</literal> <literal type="number">100755</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">67</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">67</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>com</name><operator>.</operator><name>carrotsearch</name><operator>.</operator><name>randomizedtesting</name><operator>.</operator><name>rules</name><operator>.</operator><name>SystemPropertiesRestoreRule</name></name>;</import>
 <expr_stmt/>}</block_content></block></block></function>)</block>
 <class><specifier>public</specifier> <specifier>abstract</specifier> class <name>SolrTestCaseJ4</name> <super_list><extends>extends <super><name>LuceneTestCase</name></super></extends></super_list> <block>{
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <name>String</name></type> <name>coreName</name> <init>= <expr><name><name>CoreContainer</name><operator>.</operator><name>DEFAULT_DEFAULT_CORE_NAME</name></name></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <name>int</name></type> <name>DEFAULT_CONNECTION_TIMEOUT</name> <init>= <expr><literal type="number">1000</literal></expr></init></decl>;</decl_stmt>  <comment type="line">// default socket connection timeout in ms</comment>
  <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <name>int</name></type> <name>DEFAULT_CONNECTION_TIMEOUT</name> <init>= <expr><literal type="number">15000</literal></expr></init></decl>;</decl_stmt>  <comment type="line">// default socket connection timeout in ms</comment>
 
 
   <annotation>@<name>ClassRule</name></annotation>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>e98efa8d783</name><operator>..</operator><literal type="number">25395dd5c37</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">219</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">219</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> class <name>AbstractFullDistribZkTestBase</name> extends <name>AbstractDistribZkTes</name>
     <call><name><name>server</name><operator>.</operator><name>getLbServer</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHttpClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getParams</name><argument_list>()</argument_list></call>
         <operator>.</operator><call><name>setParameter</name><argument_list>(<argument><expr><name><name>CoreConnectionPNames</name><operator>.</operator><name>CONNECTION_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">5000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>getLbServer</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHttpClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getParams</name><argument_list>()</argument_list></call>
        <operator>.</operator><call><name>setParameter</name><argument_list>(<argument><expr><name><name>CoreConnectionPNames</name><operator>.</operator><name>SO_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">20000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><operator>.</operator><call><name>setParameter</name><argument_list>(<argument><expr><name><name>CoreConnectionPNames</name><operator>.</operator><name>SO_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <return>return <expr><name>server</name></expr>;</return>
   <expr_stmt/>}</block>
   
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1157</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">1157</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> class <name>AbstractFullDistribZkTestBase</name> extends <name>AbstractDistribZkTes</name>
         <name>retry</name>  <operator>=</operator> <literal type="boolean">true</literal></expr>;</expr_stmt></class></class></expr></expr_stmt>
       <expr_stmt/>}</block>
       <expr_stmt><expr><name>cnt</name><operator>++</operator></expr>;</expr_stmt></class></expr></argument></argument_list></call></expr></block></expr></expr_stmt>
      <if_stmt><if>if <condition>(<expr><name>cnt</name> <operator>&gt;</operator> <literal type="number">4</literal></expr>)</condition><block type="pseudo"><block_content> <break>break;</break></block_content></block></if></if_stmt>
      <if_stmt><if>if <condition>(<expr><name>cnt</name> <operator>&gt;</operator> <literal type="number">10</literal></expr>)</condition><block type="pseudo"><block_content> <break>break;</break></block_content></block></if></if_stmt>
       <expr_stmt><expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">2000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/>}</block_content> while (retry</block></function>)</block><empty_stmt>;</empty_stmt></class></expr></expr_stmt>
   <expr_stmt/>}</block>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1210</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">1210</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> class <name>AbstractFullDistribZkTestBase</name> extends <name>AbstractDistribZkTes</name>
           <operator>+</operator> <name>DEFAULT_COLLECTION</name></expr>;</expr_stmt></class></expr></argument></argument_list></call></expr></init></decl></decl_stmt>
       <decl_stmt><decl><type><name>HttpSolrServer</name></type> <name>s</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrServer</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">40000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>s</name></expr>;</return>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1218</literal></expr><operator>,</operator><expr><literal type="number">28</literal> <operator>+</operator><literal type="number">1218</literal></expr><operator>,</operator><expr><literal type="number">5</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>AbstractFullDistribZkTestBase</name> extends <name>AbstractDistribZkTes</name>
       <throw>throw <argument_list>new <argument><expr><call><name>RuntimeException</name><argument_list>(<argument><expr><name>ex</name></expr></argument>)</argument_list></call></expr></argument></argument_list></throw></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></expr></expr_stmt></block_content></block></try>}</block></expr>
   }</block>
  
  <specifier>protected</specifier> <name>void</name> <call><name>waitToSeeNotLive</name><argument_list>(<argument><expr><name>ZkStateReader</name> <name>zkStateReader</name></expr></argument>,
      <argument><expr><name>CloudJettyRunner</name> <name>cjetty</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>InterruptedException</name> <block>{
    <expr><call><name>waitToSeeNotLive</name><argument_list>(<argument><expr><name>zkStateReader</name></expr></argument>, <argument><expr><name>cjetty</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;
  }</block>
  
  <specifier>protected</specifier> <name>void</name> <call><name>waitToSeeNotLive</name><argument_list>(<argument><expr><name>ZkStateReader</name> <name>zkStateReader</name></expr></argument>,
      <argument><expr><name>CloudJettyRunner</name> <name>cjetty</name></expr></argument>, <argument><expr><name>int</name> <name>cnt</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>InterruptedException</name> <block>{
    <expr><name>int</name> <name>tries</name> <operator>=</operator> <literal type="number">0</literal></expr></block></expr></argument></throws></expr>;
    <expr><name>ClusterState</name> <name>clusterState</name> <operator>=</operator> <call><name><name>zkStateReader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call></expr>;
    <while>while <condition>(<expr><call><name><name>clusterState</name><operator>.</operator><name>liveNodesContain</name></name><argument_list>(<argument><expr><call><name><name>cjetty</name><operator>.</operator><name>info</name>
        <operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><name><name>ZkStateReader</name><operator>.</operator><name>NODE_NAME_PROP</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>out</name><operator>.</operator><name>println</name></name><argument_list>(<argument><expr><literal type="string">"scs:"</literal>
          <operator>+</operator> <call><name><name>zkStateReader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getZkClusterStateVersion</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">" "</literal>
          <operator>+</operator> <call><name><name>zkStateReader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getLiveNodes</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>out</name><operator>.</operator><name>println</name></name><argument_list>(<argument><expr><literal type="string">"see live nodes:"</literal>
          <operator>+</operator> <call><name><name>zkStateReader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getLiveNodes</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <if_stmt><if>if <condition>(<expr><name>tries</name><operator>++</operator> <operator>==</operator> <literal type="number">30</literal></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"Shard still reported as live in zk - "</literal> <operator>+</operator> <name>cnt</name> <operator>+</operator> <literal type="string">" jetty"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/></block_content></block></if></if_stmt></block_content></block></while>}</block>
      <call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">1000</literal></expr></argument>)</argument_list></call></expr>;
      <expr><name>clusterState</name> <operator>=</operator> <call><name><name>zkStateReader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call></expr>;
    }</block></expr>
  }</block></expr></expr_stmt>

 </block_content>}</block></for>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>TestHarness</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>TestHarness</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>f8554d16a46</name><operator>..</operator><literal type="number">1588524ad9f</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>TestHarness</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>TestHarness</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">191</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">191</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestHarness</name> <block>{
           <expr><name>hostPort</name> <operator>=</operator> <call><name><name>System</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><literal type="string">"hostPort"</literal></expr></argument>)</argument_list></call></expr>;
           <expr><name>hostContext</name> <operator>=</operator> <literal type="string">"solr"</literal></expr>;
           <expr><name>defaultCoreName</name> <operator>=</operator> <name><name>CoreContainer</name><operator>.</operator><name>DEFAULT_DEFAULT_CORE_NAME</name></name></expr>;
          <expr><call><name>initShardHandler</name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;
           <expr><call><name>initZooKeeper</name><argument_list>(<argument><expr><call><name><name>System</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><literal type="string">"zkHost"</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr>;
         }</block></expr></expr_stmt>
       </block_content>}</block></try><empty_stmt>;</empty_stmt>
<expr><operator>-</operator> 
<literal type="number">2.19.1.windows</literal><literal type="number">.1</literal></expr>

</unit>
