<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" revision="1.0.0" language="Java" filename="E:/01Courses@USASK/CMPT898-HumanDrivenSoftwareEngineeringForScientificResearch/ProjectProgress/data_files/final_dataset/gen_patch_codes/filtered/lucene/ce172acb8f.java"><expr><name>From</name> <name>ce172acb8fec6c3bbb18837a4d640da6c5aad649</name> <name>Mon</name> <name>Sep</name> <literal type="number">17</literal> <literal type="number">00</literal><operator>:</operator><literal type="number">00</literal><operator>:</operator><literal type="number">00</literal> <literal type="number">2001</literal>
<name>From</name><operator>:</operator> <name><name>markrmiller</name> <argument_list type="generic">&lt;<argument><name>markrmiller</name><annotation>@<name><name>apache</name><operator>.</operator><name>org</name></name></annotation></argument>&gt;</argument_list></name>
<name>Date</name><operator>:</operator> <name>Fri</name></expr><operator>,</operator> <expr><literal type="number">1</literal> <name>Apr</name> <literal type="number">2016</literal> <literal type="number">12</literal><operator>:</operator><literal type="number">21</literal><operator>:</operator><literal type="number">59</literal> <operator>-</operator><literal type="number">0400</literal>
<name>Subject</name><operator>:</operator> <index>[<expr><name>PATCH</name></expr>]</index> <name>SOLR</name><operator>-</operator><literal type="number">4509</literal><operator>:</operator> <name>Move</name> <name>to</name> <name>non</name> <name>deprecated</name> <name>HttpClient</name> <name>impl</name> <name>classes</name> <name>to</name>
 <name>remove</name> <name>stale</name> <name>connection</name> <name>check</name> <name>on</name> <name>every</name> <name>request</name> <name>and</name> <name>move</name> <name>connection</name> <name>lifecycle</name>
 <name>management</name> <name>towards</name> <name>the</name> <name><name>client</name><operator>.</operator></name>

--
 <name>solr</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name>                              <operator>|</operator>  <literal type="number">28</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettySolrRunner</name><operator>.</operator><name>java</name></name>       <operator>|</operator>  <literal type="number">25</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>BlobRepository</name><operator>.</operator><name>java</name></name>  <operator>|</operator>   <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>CoreContainer</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">78</literal> <operator>++</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>IndexFetcher</name><operator>.</operator><name>java</name></name> <operator>|</operator>  <literal type="number">44</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>ReplicationHandler</name><operator>.</operator><name>java</name></name>      <operator>|</operator>  <literal type="number">23</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>component</name><operator>/</operator><name><name>HttpShardHandlerFactory</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">45</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>component</name><operator>/</operator><name><name>IterativeMergeStrategy</name><operator>.</operator><name>java</name></name>     <operator>|</operator>   <literal type="number">3</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>AuthenticationPlugin</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">3</literal> <operator>-</operator>
 <operator>...</operator><name><name>ugin</name><operator>.</operator><name>java</name></name> <operator>=</operator><operator>&gt;</operator> <name><name>HttpClientBuilderPlugin</name><operator>.</operator><name>java</name></name></expr>} |  <expr><literal type="number">17</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>KerberosPlugin</name><operator>.</operator><name>java</name></name>  <operator>|</operator>  <literal type="number">17</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationPlugin</name><operator>.</operator><name>java</name></name>     <operator>|</operator>  <literal type="number">45</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>servlet</name><operator>/</operator><name><name>HttpSolrCall</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name>       <operator>|</operator>  <literal type="number">57</literal> <operator>+</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>SolrCLI</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">23</literal> <operator>+</operator><operator>-</operator>
 <name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name>     <operator>|</operator>   <literal type="number">4</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>TestDistributedSearch</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">12</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>ConnectionReuseTest</name><operator>.</operator><name>java</name></name>     <operator>|</operator> <literal type="number">195</literal> <operator>++</operator><operator>++</operator><operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>TestJettySolrRunner</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">12</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BaseCdcrDistributedZkTest</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">9</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">29</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">8</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name><name>CollectionsAPIDistributedZkTest</name><operator>.</operator><name>java</name></name>      <operator>|</operator>  <literal type="number">12</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>HttpPartitionTest</name><operator>.</operator><name>java</name></name>  <operator>|</operator>  <literal type="number">10</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name><name>LeaderFailoverAfterPartitionTest</name><operator>.</operator><name>java</name></name>     <operator>|</operator>   <literal type="number">9</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>SSLMigrationTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ShardSplitTest</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">1</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestAuthenticationFramework</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">52</literal> <operator>+</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestCloudDeleteByQuery</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">12</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestMiniSolrCloudClusterBase</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestRandomRequestDistribution</name><operator>.</operator><name>java</name></name>  <operator>|</operator> <literal type="number">104</literal> <operator>++</operator><operator>+</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestSolrCloudWithKerberosAlt</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">13</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>java</name></name>     <operator>|</operator>  <literal type="number">17</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><name><name>estTolerantUpdateProcessorRandomCloud</name><operator>.</operator><name>java</name></name> <operator>|</operator>  <literal type="number">58</literal> <operator>++</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">9</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name>overseer</name><operator>/</operator><name><name>ZkStateReaderTest</name><operator>.</operator><name>java</name></name>     <operator>|</operator>   <literal type="number">5</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>OpenCloseCoreStressTest</name><operator>.</operator><name>java</name></name>    <operator>|</operator>   <literal type="number">2</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>TestCoreContainer</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">1</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name>  <operator>|</operator>   <literal type="number">2</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandlerBackup</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">2</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestRestoreCore</name><operator>.</operator><name>java</name></name>  <operator>|</operator>   <literal type="number">2</literal> <operator>-</operator>
 <operator>...</operator><name><name>istributedQueryElevationComponentTest</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">1</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>search</name><operator>/</operator><name><name>AnalyticsMergeStrategyTest</name><operator>.</operator><name>java</name></name>    <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name>stats</name><operator>/</operator><name><name>TestDistribIDF</name><operator>.</operator><name>java</name></name>     <operator>|</operator>  <literal type="number">82</literal> <operator>++</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>security</name><operator>/</operator><name><name>BasicAuthIntegrationTest</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">41</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name><name>PKIAuthenticationIntegrationTest</name><operator>.</operator><name>java</name></name>     <operator>|</operator>   <literal type="number">2</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>security</name><operator>/</operator><name><name>TestAuthorizationFramework</name><operator>.</operator><name>java</name></name>  <operator>|</operator>   <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AutoCommitTest</name><operator>.</operator><name>java</name></name>    <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>http</name><operator>.</operator><name>xml</name></name>                <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>https</name><operator>.</operator><name>xml</name></name>               <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name><name>jetty</name><operator>.</operator><name>xml</name></name>                     <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClient</name><operator>.</operator><name>java</name></name>    <operator>|</operator>   <literal type="number">8</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>impl</name><operator>/</operator><name><name>ConcurrentUpdateSolrClient</name><operator>.</operator><name>java</name></name>      <operator>|</operator>  <literal type="number">20</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientConfigurer</name><operator>.</operator><name>java</name></name>      <operator>|</operator> <literal type="number">100</literal> <operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtil</name><operator>.</operator><name>java</name></name>     <operator>|</operator> <literal type="number">438</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>+</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpSolrClient</name><operator>.</operator><name>java</name></name>     <operator>|</operator> <literal type="number">122</literal> <operator>++</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><name><name>igurer</name><operator>.</operator><name>java</name></name> <operator>=</operator><operator>&gt;</operator> <name><name>Krb5HttpClientBuilder</name><operator>.</operator><name>java</name></name></expr>} |  <expr_stmt><expr><literal type="number">81</literal> <operator>++</operator><operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClient</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">33</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientBuilder</name><operator>.</operator><name>java</name></name>     <operator>|</operator>  <literal type="number">91</literal> <operator>++</operator><operator>++</operator>
 <operator>...</operator><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientContextBuilder</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">96</literal> <operator>++</operator><operator>++</operator>
 <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name>    <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleBinaryTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">2</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleXMLTest</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">2</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExceptionTest</name><operator>.</operator><name>java</name></name>  <operator>|</operator>   <literal type="number">9</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrSchemalessExampleTest</name><operator>.</operator><name>java</name></name>      <operator>|</operator>   <literal type="number">7</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>TestLBHttpSolrClient</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">15</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettyWebappTest</name><operator>.</operator><name>java</name></name>       <operator>|</operator>   <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>SolrExampleJettyTest</name><operator>.</operator><name>java</name></name>  <operator>|</operator>   <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>BasicHttpSolrClientTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">87</literal> <operator>++</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClientTest</name><operator>.</operator><name>java</name></name>       <operator>|</operator>  <literal type="number">10</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ExternalHttpClientTest</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">75</literal> <operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtilTest</name><operator>.</operator><name>java</name></name> <operator>|</operator> <literal type="number">162</literal> <operator>--</operator><operator>--</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClientTest</name><operator>.</operator><name>java</name></name>      <operator>|</operator>  <literal type="number">17</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>request</name><operator>/</operator><name><name>SchemaTest</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">9</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">7</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrJettyTestBase</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">18</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name>  <operator>|</operator>   <literal type="number">7</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name>  <operator>|</operator>   <literal type="number">4</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>RestTestHarness</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">4</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>SSLTestConfig</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">79</literal> <operator>++</operator><operator>+</operator><operator>-</operator>
 <literal type="number">80</literal> <name>files</name> <name>changed</name></expr><operator>,</operator> <expr><literal type="number">1347</literal> <call><name>insertions</name><argument_list>(<argument><expr><operator>+</operator></expr></argument>)</argument_list></call></expr><operator>,</operator> <expr><literal type="number">1301</literal> <call><name>deletions</name><argument_list>(<argument><expr><operator>-</operator></expr></argument>)</argument_list></call>
 <name>rename</name> <name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><block>{<expr><name><name>HttpClientInterceptorPlugin</name><operator>.</operator><name>java</name></name> <operator>=</operator><operator>&gt;</operator> <name><name>HttpClientBuilderPlugin</name><operator>.</operator><name>java</name></name></expr>}</block> <operator>(</operator><literal type="number">63</literal><operator>%</operator><operator>)</operator>
 <name>delete</name> <name>mode</name> <literal type="number">100644</literal> <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientConfigurer</name><operator>.</operator><name>java</name></name>
 <name>rename</name> <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><block>{<expr><name><name>Krb5HttpClientConfigurer</name><operator>.</operator><name>java</name></name> <operator>=</operator><operator>&gt;</operator> <name><name>Krb5HttpClientBuilder</name><operator>.</operator><name>java</name></name></expr>}</block> <operator>(</operator><literal type="number">67</literal><operator>%</operator><operator>)</operator>
 <name>create</name> <name>mode</name> <literal type="number">100644</literal> <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientBuilder</name><operator>.</operator><name>java</name></name>
 <name>create</name> <name>mode</name> <literal type="number">100644</literal> <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientContextBuilder</name><operator>.</operator><name>java</name></name>
 <name>delete</name> <name>mode</name> <literal type="number">100644</literal> <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ExternalHttpClientTest</name><operator>.</operator><name>java</name></name>
 <name>delete</name> <name>mode</name> <literal type="number">100644</literal> <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtilTest</name><operator>.</operator><name>java</name></name>

<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name>
<name>index</name> <literal type="number">326beecbb27</literal><operator>..</operator><literal type="number">5ab52b29542</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name>
@@ <operator>-</operator><literal type="number">17</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">17</literal></expr><operator>,</operator><expr><literal type="number">33</literal> @@ <name>servlet</name> <name>container</name> <name>in</name> <name>the</name> <name>directory</name> <name>named</name> <literal type="string">"example"</literal><operator>.</operator>
 <name>See</name> <name>the</name> <name>Quick</name> <name>Start</name> <name>guide</name> <name>at</name> <name>http</name><operator>:</operator><comment type="line">//lucene.apache.org/solr/quickstart.html</comment>
 
 <operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator>  <literal type="number">7.0.0</literal> <operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator><operator>==</operator>
<operator>(</operator><name>No</name> <name>Changes</name><operator>)</operator>

<name>Upgrading</name> <name>from</name> <name>Solr</name> <literal type="number">5.x</literal>
<operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator>

<operator>*</operator> <name>HttpClientInterceptorPlugin</name> <name>is</name> <name>now</name> <name>HttpClientBuilderPlugin</name> <name>and</name> <name>must</name> <name>work</name> <name>with</name> <name>a</name> 
  <name>SolrHttpClientBuilder</name> <name>rather</name> <name>than</name> <name>an</name> <name><name>HttpClientConfigurer</name><operator>.</operator></name>
  
* <name>HttpClientUtil</name> <name>now</name> <name>allows</name> <name>configuring</name> <name>HttpClient</name> <name>instances</name> <name>via</name> <name>SolrHttpClientBuilder</name>
  <name>rather</name> <name>than</name> <name>an</name> <name><name>HttpClientConfigurer</name><operator>.</operator></name>

* <name>SolrClient</name> <name>implementations</name> <name>now</name> <name>use</name> <name>their</name> <name>own</name> <name>internal</name> <name>configuration</name></expr></expr_stmt> <for>for socket timeouts<operator>,</operator>
  <decl_stmt><decl><type><name>connect</name></type> <name>timeouts</name></decl>, <decl><type ref="prev"/><name>and</name> <name>allowing</name> <name>redirects</name> <name>rather</name> <name>than</name> <name>what</name> <name>is</name> <name>set</name> <name>as</name> <name>the</name> default <name>when</name>
  <name>building</name> <name>the</name> <name>HttpClient</name> <name><name>instance</name><operator>.</operator> <name>Use</name></name> <name>the</name> <name>appropriate</name> <name>setters</name> <name>on</name> <name>the</name> <name>SolrClient</name> <name><name>instance</name><operator>.</operator></name>
  
* <name>HttpSolrClient</name>#<name>setAllowCompression</name> <name>has</name> <name>been</name> <name>removed</name> <name>and</name> <name>compression</name> <name>must</name> <name>be</name> <name>enabled</name> <name>as</name>
  <name>a</name> <name>constructor</name> <name><name>param</name><operator>.</operator></name> 
  
* <name>HttpSolrClient</name>#<name>setDefaultMaxConnectionsPerHost</name> <name>and</name>
  <name>HttpSolrClient</name>#<name>setMaxTotalConnections</name> <name>have</name> <name>been</name> <name><name>removed</name><operator>.</operator> <name>These</name></name> <name>now</name> default <name>very</name>
  <name>high</name> <name>and</name> <name>can</name> <name>only</name> <name>be</name> <name>changed</name> <name>via</name> <name>param</name> <name>when</name> <name>creating</name> <name>an</name> <name>HttpClient</name> <name><name>instance</name><operator>.</operator>
  
<name>Optimizations</name></name>
----------------------

<modifier>*</modifier> <name>SOLR</name>-4509<range>: <expr><name>Move</name> <name>to</name> <name>non</name> <name>deprecated</name> <name>HttpClient</name> <name>impl</name> <name>classes</name> <name>to</name> <name>remove</name> <name>stale</name> <name>connection</name> 
  <name>check</name> <name>on</name> <name>every</name> <name>request</name> <name>and</name> <name>move</name> <name>connection</name> <name>lifecycle</name> <name>management</name> <name>towards</name> <name>the</name> <name><name>client</name><operator>.</operator></name>
  (<name>Ryan</name> <name>Zezeski</name></expr></range></decl>, <decl><type ref="prev"/><name>Mark</name> <name>Miller</name></decl>, <decl><type ref="prev"/><name>Shawn</name> <name>Heisey</name></decl>, <decl><type ref="prev"/><name>Steve</name> <name>Davids</name></decl>)
 
 ==================  6.1.0 ==================
 
diff --git a/solr/core/src/java/org/apache/solr/client/solrj/embedded/JettySolrRunner.java b/solr/core/src/java/org/apache/solr/client/solrj/embedded/JettySolrRunner.java
index 88ea5677aef..871fe4cf819 100644
-- a/solr/core/src/java/org/apache/solr/client/solrj/embedded/JettySolrRunner.java
++ b/solr/core/src/java/org/apache/solr/client/solrj/embedded/JettySolrRunner.java
@@ -35<operator>,</operator>7 +35<operator>,</operator>6 @@ import java.util.LinkedList;</decl_stmt></for>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Properties</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Random</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>SortedMap</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>TimeUnit</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>atomic</name><operator>.</operator><name>AtomicLong</name></name>;</import>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">44</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">43</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>servlet</name><operator>.</operator><name>SolrDispatchFilter</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>Connector</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>HttpConfiguration</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>HttpConnectionFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>LowResourceMonitor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>SecureRequestCustomizer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>Server</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>ServerConnector</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">71</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">69</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@ <specifier>public</specifier> <name>class</name> <name>JettySolrRunner</name> <block>{
 
   <expr><specifier>private</specifier> <specifier>static</specifier> <name>final</name> <name>Logger</name> <name>logger</name> <operator>=</operator> <call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><call><name><name>MethodHandles</name><operator>.</operator><name>lookup</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lookupClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
 
  <expr><specifier>private</specifier> <specifier>static</specifier> <name>final</name> <name>int</name> <name>THREAD_POOL_MAX_THREADS</name> <operator>=</operator> <literal type="number">10000</literal></expr>;
  <comment type="line">// NOTE: needs to be larger than SolrHttpClient.threadPoolSweeperMaxIdleTime</comment>
  <expr><specifier>private</specifier> <specifier>static</specifier> <name>final</name> <name>int</name> <name>THREAD_POOL_MAX_IDLE_TIME_MS</name> <operator>=</operator> <literal type="number">120000</literal></expr>;
  
   <expr><name>Server</name> <name>server</name></expr>;
 
   <expr><name>FilterHolder</name> <name>dispatchFilter</name></expr>;
@@ <expr><operator>-</operator><literal type="number">161</literal></expr>,<expr><literal type="number">8</literal> <operator>+</operator><literal type="number">163</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>JettySolrRunner</name> <block>{
   <expr><specifier>private</specifier> <name>void</name> <call><name>init</name><argument_list>(<argument><expr><name>int</name> <name>port</name></expr></argument>)</argument_list></call> <block>{
 
     <expr><name>QueuedThreadPool</name> <name>qtp</name> <operator>=</operator> <operator>new</operator> <call><name>QueuedThreadPool</name><argument_list>()</argument_list></call></expr>;
    <expr><call><name><name>qtp</name><operator>.</operator><name>setMaxThreads</name></name><argument_list>(<argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>qtp</name><operator>.</operator><name>setIdleTimeout</name></name><argument_list>(<argument><expr><operator>(</operator><name>int</name><operator>)</operator> <call><name><name>TimeUnit</name><operator>.</operator><name>SECONDS</name><operator>.</operator><name>toMillis</name></name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>qtp</name><operator>.</operator><name>setMaxThreads</name></name><argument_list>(<argument><expr><name>THREAD_POOL_MAX_THREADS</name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>qtp</name><operator>.</operator><name>setIdleTimeout</name></name><argument_list>(<argument><expr><name>THREAD_POOL_MAX_IDLE_TIME_MS</name></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>qtp</name><operator>.</operator><name>setStopTimeout</name></name><argument_list>(<argument><expr><operator>(</operator><name>int</name><operator>)</operator> <call><name><name>TimeUnit</name><operator>.</operator><name>MINUTES</name><operator>.</operator><name>toMillis</name></name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <expr><name>server</name> <operator>=</operator> <operator>new</operator> <call><name>Server</name><argument_list>(<argument><expr><name>qtp</name></expr></argument>)</argument_list></call></expr>;
     <expr><call><name><name>server</name><operator>.</operator><name>manage</name></name><argument_list>(<argument><expr><name>qtp</name></expr></argument>)</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">179</literal></expr>,<expr><literal type="number">7</literal> <operator>+</operator><literal type="number">181</literal></expr>,<expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>JettySolrRunner</name> <block>{
       <comment type="line">// talking to that server, but for the purposes of testing that should </comment>
       <comment type="line">// be good enough</comment>
       <expr><name>final</name> <name>SslContextFactory</name> <name>sslcontext</name> <operator>=</operator> <call><name><name>SSLConfig</name><operator>.</operator><name>createContextFactory</name></name><argument_list>(<argument><expr><name><name>config</name><operator>.</operator><name>sslConfig</name></name></expr></argument>)</argument_list></call></expr>;

      
       <expr><name>ServerConnector</name> <name>connector</name></expr>;
       <if_stmt><if>if <condition>(<expr><name>sslcontext</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
         <decl_stmt><decl><type><name>HttpConfiguration</name></type> <name>configuration</name> <init>= <expr><operator>new</operator> <call><name>HttpConfiguration</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">192</literal></expr><operator>,</operator><expr><literal type="number">21</literal> <operator>+</operator><literal type="number">194</literal></expr><operator>,</operator><expr><literal type="number">18</literal> @@ <specifier>public</specifier> <name>class</name> <name>JettySolrRunner</name> <block>{
       }</block>
 
       <call><name><name>connector</name><operator>.</operator><name>setReuseAddress</name></name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>connector</name><operator>.</operator><name>setSoLingerTime</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>connector</name><operator>.</operator><name>setSoLingerTime</name></name><argument_list>(<argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>connector</name><operator>.</operator><name>setPort</name></name><argument_list>(<argument><expr><name>port</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>connector</name><operator>.</operator><name>setHost</name></name><argument_list>(<argument><expr><literal type="string">"127.0.0.1"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <comment type="line">// Enable Low Resources Management</comment>
      <decl_stmt><decl><type><name>LowResourceMonitor</name></type> <name>lowResources</name> <init>= <expr><operator>new</operator> <call><name>LowResourceMonitor</name><argument_list>(<argument><expr><name>server</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>lowResources</name><operator>.</operator><name>setLowResourcesIdleTimeout</name></name><argument_list>(<argument><expr><literal type="number">1500</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>lowResources</name><operator>.</operator><name>setMaxConnections</name></name><argument_list>(<argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>addBean</name></name><argument_list>(<argument><expr><name>lowResources</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <expr_stmt><expr><call><name><name>connector</name><operator>.</operator><name>setIdleTimeout</name></name><argument_list>(<argument><expr><name>THREAD_POOL_MAX_IDLE_TIME_MS</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      
       <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>setConnectors</name></name><argument_list>(<argument><expr><operator>new</operator> <name><name>Connector</name><index>[]</index></name> <block>{<expr><name>connector</name></expr>}</block></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>setSessionIdManager</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>HashSessionIdManager</name><argument_list>(<argument><expr><operator>new</operator> <call><name>Random</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></if></if_stmt>}</block></expr> <if_stmt><else>else <block>{<block_content>
       <decl_stmt><decl><type><name>ServerConnector</name></type> <name>connector</name> <init>= <expr><operator>new</operator> <call><name>ServerConnector</name><argument_list>(<argument><expr><name>server</name></expr></argument>, <argument><expr><operator>new</operator> <call><name>HttpConnectionFactory</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <expr_stmt><expr><call><name><name>connector</name><operator>.</operator><name>setPort</name></name><argument_list>(<argument><expr><name>port</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>connector</name><operator>.</operator><name>setSoLingerTime</name></name><argument_list>(<argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>connector</name><operator>.</operator><name>setIdleTimeout</name></name><argument_list>(<argument><expr><name>THREAD_POOL_MAX_IDLE_TIME_MS</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>setConnectors</name></name><argument_list>(<argument><expr><operator>new</operator> <name><name>Connector</name><index>[]</index></name> <block>{<expr><name>connector</name></expr>}</block></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></else></if_stmt>}</block>
 
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>BlobRepository</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>BlobRepository</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">67398269113..09461f07b81</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>BlobRepository</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>BlobRepository</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">38</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">38</literal></expr>,<expr><literal type="number">7</literal> @@</expr> <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>zip</name><operator>.</operator><name>ZipInputStream</name></name>;</import></block></expr>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpResponse</name></name>;</import></block></expr></expr_stmt>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpGet</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ClusterState</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>DocCollection</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">116</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">117</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BlobRepository</name> <block>{
         <expr><name>HttpGet</name> <name>httpGet</name> <operator>=</operator> <operator>new</operator> <call><name>HttpGet</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr>;
         <expr><name>ByteBuffer</name> <name>b</name></expr>;
         <try>try <block>{<block_content>
          <decl_stmt><decl><type><name>HttpResponse</name></type> <name>entity</name> <init>= <expr><call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpGet</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <decl_stmt><decl><type><name>HttpResponse</name></type> <name>entity</name> <init>= <expr><call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpGet</name></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
           <decl_stmt><decl><type><name>int</name></type> <name>statusCode</name> <init>= <expr><call><name><name>entity</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
           <if_stmt><if>if <condition>(<expr><name>statusCode</name> <operator>!=</operator> <literal type="number">200</literal></expr>)</condition> <block>{<block_content>
             <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>(<argument><expr><name><name>SolrException</name><operator>.</operator><name>ErrorCode</name><operator>.</operator><name>NOT_FOUND</name></name></expr></argument>, <argument><expr><literal type="string">"no such blob or version available: "</literal> <operator>+</operator> <name>key</name></expr></argument>)</argument_list></call></expr>;</throw>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>CoreContainer</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>CoreContainer</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>c140fb4dba8</name><operator>..</operator><literal type="number">4d57ad1d054</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>CoreContainer</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>CoreContainer</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">17</literal> @@
  <operator>*</operator><operator>/</operator></expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name></name>;</package>
 
<import>import static <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>base</name><operator>.</operator><name>Preconditions</name><operator>.</operator><name>checkNotNull</name></name>;</import>
<import>import static <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name><operator>.</operator><name>EMPTY_MAP</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>AUTHC_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>AUTHZ_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>COLLECTIONS_HANDLER_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>CONFIGSETS_HANDLER_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>CORES_HANDLER_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>INFO_HANDLER_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>ZK_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>AuthenticationPlugin</name><operator>.</operator><name>AUTHENTICATION_PLUGIN_PROP</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>nio</name><operator>.</operator><name>file</name><operator>.</operator><name>Path</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">43</literal></expr><operator>,</operator><expr><literal type="number">14</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutionException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutorService</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Future</name></name>;</import>
 
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>collect</name><operator>.</operator><name>ImmutableMap</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>collect</name><operator>.</operator><name>Maps</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>AuthSchemeProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>CredentialsProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>Lookup</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientContextBuilder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientContextBuilder</name><operator>.</operator><name>AuthSchemeRegistryProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientContextBuilder</name><operator>.</operator><name>CredentialsProviderProvider</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>util</name><operator>.</operator><name>SolrIdentifierValidator</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>Overseer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkController</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">52</literal></expr><operator>,</operator><expr><literal type="number">14</literal> <operator>+</operator><literal type="number">67</literal></expr><operator>,</operator><expr><literal type="number">13</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>admin</name><operator>.</operator><name>CoreAdminHandler</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>admin</name><operator>.</operator><name>InfoHandler</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>admin</name><operator>.</operator><name>SecurityConfHandler</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>admin</name><operator>.</operator><name>ZookeeperInfoHandler</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>component</name><operator>.</operator><name>HttpShardHandlerFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>component</name><operator>.</operator><name>ShardHandlerFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>logging</name><operator>.</operator><name>LogWatcher</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>logging</name><operator>.</operator><name>MDCLoggingContext</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>request</name><operator>.</operator><name>SolrRequestHandler</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>AuthenticationPlugin</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>AuthorizationPlugin</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>HttpClientInterceptorPlugin</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>HttpClientBuilderPlugin</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>PKIAuthenticationPlugin</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>SecurityPluginHolder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name><operator>.</operator><name>SolrCoreState</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">69</literal></expr><operator>,</operator><expr><literal type="number">16</literal> <operator>+</operator><literal type="number">83</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>zookeeper</name><operator>.</operator><name>KeeperException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<import>import static <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>base</name><operator>.</operator><name>Preconditions</name><operator>.</operator><name>checkNotNull</name></name>;</import>
<import>import static <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name><operator>.</operator><name>EMPTY_MAP</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>AUTHC_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>AUTHZ_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>COLLECTIONS_HANDLER_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>CONFIGSETS_HANDLER_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>CORES_HANDLER_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>INFO_HANDLER_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>ZK_PATH</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>AuthenticationPlugin</name><operator>.</operator><name>AUTHENTICATION_PLUGIN_PROP</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>collect</name><operator>.</operator><name>ImmutableMap</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>collect</name><operator>.</operator><name>Maps</name></name>;</import>
 
 
 <comment type="block" format="javadoc">/**
@@ -291,7 +297,7 @@ public class CoreContainer {
     }
     if (authenticationPlugin != null) {
       authenticationPlugin.plugin.init(authenticationConfig);
      addHttpConfigurer(authenticationPlugin.plugin);
      setupHttpClientForAuthPlugin(authenticationPlugin.plugin);
     }
     this.authenticationPlugin = authenticationPlugin;
     try {
@@ -300,26 +306,44 @@ public class CoreContainer {
 
   }
 
  private void addHttpConfigurer(Object authcPlugin) {
    if (authcPlugin instanceof HttpClientInterceptorPlugin) {
      // Setup HttpClient to use the plugin's configurer for internode communication
      HttpClientConfigurer configurer = ((HttpClientInterceptorPlugin) authcPlugin).getClientConfigurer();
      HttpClientUtil.setConfigurer(configurer);

  private void setupHttpClientForAuthPlugin(Object authcPlugin) {
    if (authcPlugin instanceof HttpClientBuilderPlugin) {
      // Setup HttpClient for internode communication
      SolrHttpClientBuilder builder = ((HttpClientBuilderPlugin) authcPlugin).getHttpClientBuilder(HttpClientUtil.getHttpClientBuilder());
      
       // The default http client of the core container's shardHandlerFactory has already been created and
       // configured using the default httpclient configurer. We need to reconfigure it using the plugin's
       // http client configurer to set it up for internode communication.
      log.info("Reconfiguring the shard handler factory and update shard handler.");
      if (getShardHandlerFactory() instanceof HttpShardHandlerFactory) {
        ((HttpShardHandlerFactory) getShardHandlerFactory()).reconfigureHttpClient(configurer);
      log.info("Reconfiguring HttpClient settings.");

      SolrHttpClientContextBuilder httpClientBuilder = new SolrHttpClientContextBuilder();
      if (builder.getCredentialsProviderProvider() != null) {
        httpClientBuilder.setDefaultCredentialsProvider(new CredentialsProviderProvider() {
          
          @Override
          public CredentialsProvider getCredentialsProvider() {
            return builder.getCredentialsProviderProvider().getCredentialsProvider();
          }
        });
       }
      getUpdateShardHandler().reconfigureHttpClient(configurer);
      if (builder.getAuthSchemeRegistryProvider() != null) {
        httpClientBuilder.setAuthSchemeRegistryProvider(new AuthSchemeRegistryProvider() {
          
          @Override
          public Lookup&lt;AuthSchemeProvider&gt; getAuthSchemeRegistry() {
            return builder.getAuthSchemeRegistryProvider().getAuthSchemeRegistry();
          }
        });
      }

      HttpClientUtil.setHttpClientRequestContextBuilder(httpClientBuilder);

     } else {
       if (pkiAuthenticationPlugin != null) {
         //this happened due to an authc plugin reload. no need to register the pkiAuthc plugin again
         if(pkiAuthenticationPlugin.isInterceptorRegistered()) return;
         log.info("PKIAuthenticationPlugin is managing internode requests");
        addHttpConfigurer(pkiAuthenticationPlugin);
        setupHttpClientForAuthPlugin(pkiAuthenticationPlugin);
         pkiAuthenticationPlugin.setInterceptorRegistered();
       }
     }
diff --git a/solr/core/src/java/org/apache/solr/handler/IndexFetcher.java b/solr/core/src/java/org/apache/solr/handler/IndexFetcher.java
index 39c4158425d..7f38acd2dd2 100644
-- a/solr/core/src/java/org/apache/solr/handler/IndexFetcher.java
++ b/solr/core/src/java/org/apache/solr/handler/IndexFetcher.java
@@ -172,15 +172,17 @@ public class IndexFetcher {
 
   private final HttpClient myHttpClient;
 
  private static HttpClient createHttpClient(SolrCore core, String connTimeout, String readTimeout, String httpBasicAuthUser, String httpBasicAuthPassword, boolean useCompression) {
  private Integer connTimeout;

  private Integer soTimeout;

  private static HttpClient createHttpClient(SolrCore core, String httpBasicAuthUser, String httpBasicAuthPassword, boolean useCompression) {
     final ModifiableSolrParams httpClientParams = new ModifiableSolrParams();
    httpClientParams.set(HttpClientUtil.PROP_CONNECTION_TIMEOUT, connTimeout != null ? connTimeout : "5000");
    httpClientParams.set(HttpClientUtil.PROP_SO_TIMEOUT, readTimeout != null ? readTimeout : "20000");
     httpClientParams.set(HttpClientUtil.PROP_BASIC_AUTH_USER, httpBasicAuthUser);
     httpClientParams.set(HttpClientUtil.PROP_BASIC_AUTH_PASS, httpBasicAuthPassword);
     httpClientParams.set(HttpClientUtil.PROP_ALLOW_COMPRESSION, useCompression);
 
    return HttpClientUtil.createClient(httpClientParams, core.getCoreDescriptor().getCoreContainer().getUpdateShardHandler().getConnectionManager());
    return HttpClientUtil.createClient(httpClientParams, core.getCoreDescriptor().getCoreContainer().getUpdateShardHandler().getConnectionManager(), true);
   }
 
   public IndexFetcher(final NamedList initArgs, final ReplicationHandler handler, final SolrCore sc) {
@@ -199,11 +201,22 @@ public class IndexFetcher {
     String compress = (String) initArgs.get(COMPRESSION);
     useInternalCompression = INTERNAL.equals(compress);
     useExternalCompression = EXTERNAL.equals(compress);
    String connTimeout = (String) initArgs.get(HttpClientUtil.PROP_CONNECTION_TIMEOUT);
    String readTimeout = (String) initArgs.get(HttpClientUtil.PROP_SO_TIMEOUT);
    connTimeout = getParameter(initArgs, HttpClientUtil.PROP_CONNECTION_TIMEOUT, 30000, null);
    soTimeout = getParameter(initArgs, HttpClientUtil.PROP_SO_TIMEOUT, 120000, null);

     String httpBasicAuthUser = (String) initArgs.get(HttpClientUtil.PROP_BASIC_AUTH_USER);
     String httpBasicAuthPassword = (String) initArgs.get(HttpClientUtil.PROP_BASIC_AUTH_PASS);
    myHttpClient = createHttpClient(solrCore, connTimeout, readTimeout, httpBasicAuthUser, httpBasicAuthPassword, useExternalCompression);
    myHttpClient = createHttpClient(solrCore, httpBasicAuthUser, httpBasicAuthPassword, useExternalCompression);
  }
  
  protected &lt;T&gt; T getParameter(NamedList initArgs, String configKey, T defaultValue, StringBuilder sb) {
    T toReturn = defaultValue;
    if (initArgs != null) {
      T temp = (T) initArgs.get(configKey);
      toReturn = (temp != null) ? temp : defaultValue;
    }
    if(sb!=null &amp;&amp; toReturn != null) sb.append(configKey).append(" : ").append(toReturn).append(",");
    return toReturn;
   }
 
   /**
@@ -219,8 +232,8 @@ public class IndexFetcher {
 
     // TODO modify to use shardhandler
     try (HttpSolrClient client = new HttpSolrClient(masterUrl, myHttpClient)) {
      client.setSoTimeout(60000);
      client.setConnectionTimeout(15000);
      client.setSoTimeout(soTimeout);
      client.setConnectionTimeout(connTimeout);
 
       return client.request(req);
     } catch (SolrServerException e) {
@@ -241,8 +254,8 @@ public class IndexFetcher {
 
     // TODO modify to use shardhandler
     try (HttpSolrClient client = new HttpSolrClient(masterUrl, myHttpClient)) {
      client.setSoTimeout(60000);
      client.setConnectionTimeout(15000);
      client.setSoTimeout(soTimeout);
      client.setConnectionTimeout(connTimeout);
       NamedList response = client.request(req);
 
       List&lt;Map&lt;String, Object&gt;&gt; files = (List&lt;Map&lt;String,Object&gt;&gt;) response.get(CMD_GET_FILE_LIST);
@@ -1607,8 +1620,8 @@ public class IndexFetcher {
 
       // TODO use shardhandler
       try (HttpSolrClient client = new HttpSolrClient(masterUrl, myHttpClient, null)) {
        client.setSoTimeout(60000);
        client.setConnectionTimeout(15000);
        client.setSoTimeout(soTimeout);
        client.setConnectionTimeout(connTimeout);
         QueryRequest req = new QueryRequest(params);
         response = client.request(req);
         is = (InputStream) response.get("stream");
@@ -1716,8 +1729,8 @@ public class IndexFetcher {
 
     // TODO use shardhandler
     try (HttpSolrClient client = new HttpSolrClient(masterUrl, myHttpClient)) {
      client.setSoTimeout(60000);
      client.setConnectionTimeout(15000);
      client.setSoTimeout(soTimeout);
      client.setConnectionTimeout(connTimeout);
       QueryRequest request = new QueryRequest(params);
       return client.request(request);
     }
@@ -1725,6 +1738,7 @@ public class IndexFetcher {
 
   public void destroy() {
     abortFetch();
    HttpClientUtil.close(myHttpClient);
   }
 
   String getMasterUrl() {
diff --git a/solr/core/src/java/org/apache/solr/handler/ReplicationHandler.java b/solr/core/src/java/org/apache/solr/handler/ReplicationHandler.java
index b8c9692d2c9..267ab3d31c0 100644
-- a/solr/core/src/java/org/apache/solr/handler/ReplicationHandler.java
++ b/solr/core/src/java/org/apache/solr/handler/ReplicationHandler.java
@@ -387,8 +387,15 @@ public class ReplicationHandler extends RequestHandlerBase implements SolrCoreAw
       return currentIndexFetcher.fetchLatestIndex(forceReplication);
     } catch (Exception e) {
       SolrException.log(LOG, "Index fetch failed ", e);
      if (currentIndexFetcher != pollingIndexFetcher) {
        currentIndexFetcher.destroy();
      }
     } finally {
       if (pollingIndexFetcher != null) {
       if( currentIndexFetcher != pollingIndexFetcher) {
         currentIndexFetcher.destroy();
       }
        
         currentIndexFetcher = pollingIndexFetcher;
       }
       indexFetchLock.unlock();
@@ -1243,20 +1250,18 @@ public class ReplicationHandler extends RequestHandlerBase implements SolrCoreAw
     core.addCloseHook(new CloseHook() {
       @Override
       public void preClose(SolrCore core) {
        try {
          if (executorService != null) executorService.shutdown(); // we don't wait for shutdown - this can deadlock core reload
        } finally {
            if (pollingIndexFetcher != null) {
              pollingIndexFetcher.destroy();
            }
        if (executorService != null) executorService.shutdown(); // we don't wait for shutdown - this can deadlock core reload
      }

      @Override
      public void postClose(SolrCore core) {
        if (pollingIndexFetcher != null) {
          pollingIndexFetcher.destroy();
         }
         if (currentIndexFetcher != null &amp;&amp; currentIndexFetcher != pollingIndexFetcher) {
           currentIndexFetcher.destroy();
         }
       }

      @Override
      public void postClose(SolrCore core) {}
     });
 
     core.addCloseHook(new CloseHook() {
diff --git a/solr/core/src/java/org/apache/solr/handler/component/HttpShardHandlerFactory.java b/solr/core/src/java/org/apache/solr/handler/component/HttpShardHandlerFactory.java
index d2800d75ce0..04128382422 100644
-- a/solr/core/src/java/org/apache/solr/handler/component/HttpShardHandlerFactory.java
++ b/solr/core/src/java/org/apache/solr/handler/component/HttpShardHandlerFactory.java
@@ -15,12 +15,11 @@
  * limitations under the License.
  */</comment>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>component</name></name>;</package>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>commons</name><operator>.</operator><name>lang</name><operator>.</operator><name>StringUtils</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpRequestRetryHandler</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>CloseableHttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrServerException</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>LBHttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>QueryRequest</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">67</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">66</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpShardHandlerFactory</name> extends <name>ShardHandlerFactory</name> implements <name><name>org</name><operator>.</operator></name>
       new <call><name>DefaultSolrThreadFactory</name><argument_list>(<argument><expr><literal type="string">"httpShardExecutor"</literal></expr></argument>)</argument_list></call></expr></expr_stmt>
   )</block_content></block><empty_stmt>;</empty_stmt></if></if_stmt>
 
  <decl_stmt><decl><type><specifier>protected</specifier> <name>HttpClient</name></type> <name>defaultClient</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>protected</specifier> <name>CloseableHttpClient</name></type> <name>defaultClient</name></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <name>LBHttpSolrClient</name></type> <name>loadbalancer</name></decl>;</decl_stmt>
   <comment type="line">//default values:</comment>
   <decl_stmt><decl><type><name>int</name></type> <name>soTimeout</name> <init>= <expr><name><name>UpdateShardHandlerConfig</name><operator>.</operator><name>DEFAULT_DISTRIBUPDATESOTIMEOUT</name></name></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">79</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">78</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpShardHandlerFactory</name> extends <name>ShardHandlerFactory</name> implements <name><name>org</name><operator>.</operator>
   <name>int</name></name> <name>keepAliveTime</name> <operator>=</operator> <literal type="number">5</literal></expr>;</expr_stmt>
   <decl_stmt><decl><type><name>int</name></type> <name>queueSize</name> <init>= <expr><operator>-</operator><literal type="number">1</literal></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><name>boolean</name></type> <name>accessPolicy</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><name>boolean</name></type> <name>useRetries</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
 
   <decl_stmt><decl><type><specifier>private</specifier> <name>String</name></type> <name>scheme</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">140</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">138</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpShardHandlerFactory</name> extends <name>ShardHandlerFactory</name> implements <name><name>org</name><operator>.</operator>
     <name>this</name><operator>.</operator><name>keepAliveTime</name></name> <operator>=</operator> <call><name>getParameter</name><argument_list>(<argument><expr><name>args</name></expr></argument>, <argument><expr><name>MAX_THREAD_IDLE_TIME</name></expr></argument>, <argument><expr><name>keepAliveTime</name></expr></argument>,<argument><expr><name>sb</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><name><name>this</name><operator>.</operator><name>queueSize</name></name> <operator>=</operator> <call><name>getParameter</name><argument_list>(<argument><expr><name>args</name></expr></argument>, <argument><expr><name>INIT_SIZE_OF_QUEUE</name></expr></argument>, <argument><expr><name>queueSize</name></expr></argument>,<argument><expr><name>sb</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><name><name>this</name><operator>.</operator><name>accessPolicy</name></name> <operator>=</operator> <call><name>getParameter</name><argument_list>(<argument><expr><name>args</name></expr></argument>, <argument><expr><name>INIT_FAIRNESS_POLICY</name></expr></argument>, <argument><expr><name>accessPolicy</name></expr></argument>,<argument><expr><name>sb</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>useRetries</name></name> <operator>=</operator> <call><name>getParameter</name><argument_list>(<argument><expr><name>args</name></expr></argument>, <argument><expr><name>USE_RETRIES</name></expr></argument>, <argument><expr><name>useRetries</name></expr></argument>,<argument><expr><name>sb</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"created with {}"</literal></expr></argument>,<argument><expr><name>sb</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     
     <comment type="line">// magic sysprop to make tests reproducible: set by SolrTestCaseJ4.</comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">165</literal></expr><operator>,</operator><expr><literal type="number">13</literal> <operator>+</operator><literal type="number">162</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpShardHandlerFactory</name> extends <name>ShardHandlerFactory</name> implements <name><name>org</name><operator>.</operator>
 
     <name>this</name><operator>.</operator><name>defaultClient</name></name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>clientParams</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     
    <comment type="line">// must come after createClient</comment>
    <if_stmt><if>if <condition>(<expr><name>useRetries</name></expr>)</condition> <block>{<block_content>
      <comment type="line">// our default retry handler will never retry on IOException if the request has been sent already,</comment>
      <comment type="line">// but for these read only requests we can use the standard DefaultHttpRequestRetryHandler rules</comment>
      <expr_stmt><expr><operator>(</operator><operator>(</operator><name>DefaultHttpClient</name><operator>)</operator> <name><name>this</name><operator>.</operator><name>defaultClient</name></name><operator>)</operator><operator>.</operator><call><name>setHttpRequestRetryHandler</name><argument_list>(<argument><expr><operator>new</operator> <call><name>DefaultHttpRequestRetryHandler</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt/></block_content></block></if></if_stmt></block_content></block></try>}</block>
    
     <name><name>this</name><operator>.</operator><name>loadbalancer</name></name> <operator>=</operator> <call><name>createLoadbalancer</name><argument_list>(<argument><expr><name>defaultClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   }
   
@<annotation>@</annotation> -<expr_stmt><expr><literal type="number">179</literal></expr><operator>,</operator><expr><literal type="number">30</literal> <operator>+</operator><literal type="number">169</literal></expr><operator>,</operator><expr><literal type="number">18</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpShardHandlerFactory</name> extends <name>ShardHandlerFactory</name> implements <name><name>org</name><operator>.</operator>
     <name>ModifiableSolrParams</name></name> <name>clientParams</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>clientParams</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS_PER_HOST</name></name></expr></argument>, <argument><expr><name>maxConnectionsPerHost</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>clientParams</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS</name></name></expr></argument>, <argument><expr><name>maxConnections</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>clientParams</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>, <argument><expr><name>soTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>clientParams</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_CONNECTION_TIMEOUT</name></name></expr></argument>, <argument><expr><name>connectionTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <if_stmt><if>if <condition>(<expr><operator>!</operator><name>useRetries</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>clientParams</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_USE_RETRY</name></name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
     <return>return <expr><name>clientParams</name></expr>;</return>
   }
 
  <comment type="block" format="javadoc">/**
   * For an already created internal httpclient, this can be used to configure it 
   * again. Useful for authentication plugins.
   * @param configurer an HttpClientConfigurer instance
   */</comment>
  public <function><type><name>void</name></type> <name>reconfigureHttpClient</name><parameter_list>(<parameter><decl><type><name>HttpClientConfigurer</name></type> <name>configurer</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Reconfiguring the default client with: "</literal> <operator>+</operator> <name>configurer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>configurer</name><operator>.</operator><name>configure</name></name><argument_list>(<argument><expr><operator>(</operator><name>DefaultHttpClient</name><operator>)</operator><name><name>this</name><operator>.</operator><name>defaultClient</name></name></expr></argument>, <argument><expr><call><name>getClientParams</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>

   <function><type><specifier>protected</specifier> <name>ThreadPoolExecutor</name></type> <name>getThreadPoolExecutor</name><parameter_list>()</parameter_list><block>{<block_content>
     <return>return <expr><name><name>this</name><operator>.</operator><name>commExecutor</name></name></expr>;</return>
   </block_content>}</block></function>
 
   <function><type><specifier>protected</specifier> <name>LBHttpSolrClient</name></type> <name>createLoadbalancer</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>httpClient</name></decl></parameter>)</parameter_list><block>{<block_content>
    <return>return <expr><operator>new</operator> <call><name>LBHttpSolrClient</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</return>
    <decl_stmt><decl><type><name>LBHttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>LBHttpSolrClient</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>connectionTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>soTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <return>return <expr><name>client</name></expr>;</return>
   </block_content>}</block></function>
 
   <function><type><specifier>protected</specifier> <parameter_list type="generic">&lt;<parameter><name>T</name></parameter>&gt;</parameter_list> <name>T</name></type> <name>getParameter</name><parameter_list>(<parameter><decl><type><name>NamedList</name></type> <name>initArgs</name></decl></parameter>, <parameter><decl><type><name>String</name></type> <name>configKey</name></decl></parameter>, <parameter><decl><type><name>T</name></type> <name>defaultValue</name></decl></parameter>, <parameter><decl><type><name>StringBuilder</name></type> <name>sb</name></decl></parameter>)</parameter_list> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">222</literal></expr><operator>,</operator><expr><literal type="number">14</literal> <operator>+</operator><literal type="number">200</literal></expr><operator>,</operator><expr><literal type="number">13</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpShardHandlerFactory</name> extends <name>ShardHandlerFactory</name> implements <call><name><name>org</name><operator>.</operator>
       <name>ExecutorUtil</name><operator>.</operator><name>shutdownAndAwaitTermination</name></name><argument_list>(<argument><expr><name>commExecutor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></function> <finally>finally <block>{<block_content>
       <try>try <block>{<block_content>
        <if_stmt><if>if <condition>(<expr><name>defaultClient</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><call><name><name>defaultClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>shutdown</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
      </block_content>}</block> <finally>finally <block>{<block_content>
        
         <if_stmt><if>if <condition>(<expr><name>loadbalancer</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
           <expr_stmt><expr><call><name><name>loadbalancer</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
         </block_content>}</block></if></if_stmt>
      </block_content>}</block></finally> <finally>finally <block>{<block_content> 
        <if_stmt><if>if <condition>(<expr><name>defaultClient</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>defaultClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
       </block_content>}</block></finally></try>
     </block_content>}</block></finally>
   }
diff <expr_stmt><expr><operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>IterativeMergeStrategy</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>IterativeMergeStrategy</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a8f6ca96e8f</name><operator>..</operator><literal type="number">83677e42019</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>IterativeMergeStrategy</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>IterativeMergeStrategy</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">20</literal></expr><operator>,</operator><expr><literal type="number">13</literal> <operator>+</operator><literal type="number">20</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Callable</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Future</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutorService</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Executors</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>ArrayList</name></name>;</import>
 
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>NamedThreadFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrRequest</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>QueryRequest</name></name>;</import>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>AuthenticationPlugin</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>AuthenticationPlugin</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">52296337fef</literal><operator>..</operator><literal type="number">47daec1dd14</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>AuthenticationPlugin</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>AuthenticationPlugin</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">22</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">22</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@</expr></expr_stmt> <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletRequest</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletResponse</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequest</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequestWrapper</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletResponse</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>Closeable</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>nio</name><operator>.</operator><name>file</name><operator>.</operator><name>attribute</name><operator>.</operator><name>UserPrincipal</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>security</name><operator>.</operator><name>Principal</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
 
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>BasicUserPrincipal</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
 
 <comment type="block" format="javadoc">/**
  * 
diff --git a/solr/core/src/java/org/apache/solr/security/HttpClientInterceptorPlugin.java b/solr/core/src/java/org/apache/solr/security/HttpClientBuilderPlugin.java
similarity index 63%
rename from solr/core/src/java/org/apache/solr/security/HttpClientInterceptorPlugin.java
rename to solr/core/src/java/org/apache/solr/security/HttpClientBuilderPlugin.java
index d7598df6156..8b7e80bee75 100644
-- a/solr/core/src/java/org/apache/solr/security/HttpClientInterceptorPlugin.java
++ b/solr/core/src/java/org/apache/solr/security/HttpClientBuilderPlugin.java
@@ -16,15 +16,22 @@
  */</comment>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name></name>;</package>
 
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name></name>;</import>
 
<interface><specifier>public</specifier> interface <name>HttpClientInterceptorPlugin</name> <block>{
<comment type="block" format="javadoc">/**
 * Plugin interface for configuring internal HttpClients. This
 * relies on the internal HttpClient implementation and is subject to
 * change.
 * 
 * @lucene.experimental
 */</comment>
<interface><specifier>public</specifier> interface <name>HttpClientBuilderPlugin</name> <block>{
   <comment type="block" format="javadoc">/**
    *
   * @return Returns an instance of a HttpClientConfigurer to be used for configuring the
   * httpclients for use with SolrJ clients.
   * @return Returns an instance of a SolrHttpClientBuilder to be used for configuring the
   * HttpClients for use with SolrJ clients.
    *
    * @lucene.experimental
    */</comment>
  <function_decl><type><specifier>public</specifier> <name>HttpClientConfigurer</name></type> <name>getClientConfigurer</name><parameter_list>()</parameter_list>;</function_decl>
  <function_decl><type><specifier>public</specifier> <name>SolrHttpClientBuilder</name></type> <name>getHttpClientBuilder</name><parameter_list>(<parameter><decl><type><name>SolrHttpClientBuilder</name></type> <name>builder</name></decl></parameter>)</parameter_list>;</function_decl>
 }</block></interface>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>KerberosPlugin</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>KerberosPlugin</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>ad7f29bffe0</name><operator>..</operator><literal type="number">2ef7fb88ab1</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>KerberosPlugin</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>KerberosPlugin</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">30</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">30</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>Filter</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>FilterChain</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>FilterConfig</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>FilterRegistration</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>FilterRegistration</name><operator>.</operator><name>Dynamic</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>RequestDispatcher</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>Servlet</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletContext</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">39</literal></expr><operator>,</operator><expr><literal type="number">23</literal> <operator>+</operator><literal type="number">40</literal></expr><operator>,</operator><expr><literal type="number">22</literal> @@</expr></expr_stmt> <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletRequest</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletResponse</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>SessionCookieConfig</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>SessionTrackingMode</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>FilterRegistration</name><operator>.</operator><name>Dynamic</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>descriptor</name><operator>.</operator><name>JspConfigDescriptor</name></name>;</import>
 
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>commons</name><operator>.</operator><name>collections</name><operator>.</operator><name>iterators</name><operator>.</operator><name>IteratorEnumeration</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>Krb5HttpClientConfigurer</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkController</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClientBuilder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>Krb5HttpClientBuilder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name><operator>.</operator><name>ErrorCode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>CoreContainer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<class><specifier>public</specifier> class <name>KerberosPlugin</name> <super_list><extends>extends <super><name>AuthenticationPlugin</name></super></extends> <implements>implements <super><name>HttpClientInterceptorPlugin</name></super></implements></super_list> <block>{
<class><specifier>public</specifier> class <name>KerberosPlugin</name> <super_list><extends>extends <super><name>AuthenticationPlugin</name></super></extends> <implements>implements <super><name>HttpClientBuilderPlugin</name></super></implements></super_list> <block>{
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>Logger</name></type> <name>log</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><call><name><name>MethodHandles</name><operator>.</operator><name>lookup</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lookupClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
  <decl_stmt><decl><type><name>HttpClientConfigurer</name></type> <name>kerberosConfigurer</name> <init>= <expr><operator>new</operator> <call><name>Krb5HttpClientConfigurer</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><name>Krb5HttpClientBuilder</name></type> <name>kerberosBuilder</name> <init>= <expr><operator>new</operator> <call><name>Krb5HttpClientBuilder</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><name>Filter</name></type> <name>kerberosFilter</name> <init>= <expr><operator>new</operator> <call><name>KerberosFilter</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
   
   <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>NAME_RULES_PARAM</name> <init>= <expr><literal type="string">"solr.kerberos.name.rules"</literal></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">145</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">145</literal></expr><operator>,</operator><expr><literal type="number">13</literal> @@ <specifier>public</specifier> <name>class</name> <name>KerberosPlugin</name> extends <name>AuthenticationPlugin</name> implements <name>HttpClientIn</name></expr></expr_stmt>
   }</block></class>
 
   <function><annotation>@<name>Override</name></annotation>
  <type><specifier>public</specifier> <name>HttpClientConfigurer</name></type> <name>getClientConfigurer</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>kerberosConfigurer</name></expr>;</return>
  <function><type><specifier>public</specifier> <name>SolrHttpClientBuilder</name></type> <name>getHttpClientBuilder</name><parameter_list>(<parameter><decl><type><name>SolrHttpClientBuilder</name></type> <name>builder</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <return>return <expr><call><name><name>kerberosBuilder</name><operator>.</operator><name>getBuilder</name></name><argument_list>(<argument><expr><name>builder</name></expr></argument>)</argument_list></call></expr>;</return>
   </block_content>}</block></function>
 
   <function><type><specifier>public</specifier> <name>void</name></type> <name>close</name><parameter_list>()</parameter_list> <block>{<block_content>
     <expr_stmt><expr><call><name><name>kerberosFilter</name><operator>.</operator><name>destroy</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>kerberosBuilder</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></function>
 
   <decl_stmt><decl><type><specifier>protected</specifier> <specifier>static</specifier> <name>ServletContext</name></type> <name>noContext</name> <init>= <expr><operator>new</operator> <class><super><name>ServletContext</name></super><argument_list>()</argument_list> <block>{
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationPlugin</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationPlugin</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">3c65af29647</literal><operator>..</operator><literal type="number">26b29fe1fa8</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationPlugin</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationPlugin</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">11</literal> <operator>+</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@
  <operator>*</operator><operator>/</operator></expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name></name>;</package>
 
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>FilterChain</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletRequest</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletResponse</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequest</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequestWrapper</name></name>;</import>
<import>import static <name><name>java</name><operator>.</operator><name>nio</name><operator>.</operator><name>charset</name><operator>.</operator><name>StandardCharsets</name><operator>.</operator><name>UTF_8</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>nio</name><operator>.</operator><name>ByteBuffer</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">30</literal></expr><operator>,</operator><expr><literal type="number">17</literal> <operator>+</operator><literal type="number">27</literal></expr><operator>,</operator><expr><literal type="number">22</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ConcurrentHashMap</name></name>;</import>
 
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>FilterChain</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletRequest</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletResponse</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequest</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequestWrapper</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequestInterceptor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>BasicUserPrincipal</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpGet</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpContext</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>util</name><operator>.</operator><name>EntityUtils</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>Base64</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>ExecutorUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>StrUtils</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">56</literal></expr><operator>,</operator><expr><literal type="number">17</literal> <operator>+</operator><literal type="number">58</literal></expr><operator>,</operator><expr><literal type="number">15</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>CryptoKeys</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<import>import static <name><name>java</name><operator>.</operator><name>nio</name><operator>.</operator><name>charset</name><operator>.</operator><name>StandardCharsets</name><operator>.</operator><name>UTF_8</name></name>;</import>

 
<class><specifier>public</specifier> class <name>PKIAuthenticationPlugin</name> <super_list><extends>extends <super><name>AuthenticationPlugin</name></super></extends> <implements>implements <super><name>HttpClientInterceptorPlugin</name></super></implements></super_list> <block>{
<class><specifier>public</specifier> class <name>PKIAuthenticationPlugin</name> <super_list><extends>extends <super><name>AuthenticationPlugin</name></super></extends> <implements>implements <super><name>HttpClientBuilderPlugin</name></super></implements></super_list> <block>{
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>Logger</name></type> <name>log</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><call><name><name>MethodHandles</name><operator>.</operator><name>lookup</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lookupClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name><name>Map</name><argument_list type="generic">&lt;<argument><name>String</name></argument>, <argument><name>PublicKey</name></argument>&gt;</argument_list></name></type> <name>keyCache</name> <init>= <expr><operator>new</operator> <call><name><name>ConcurrentHashMap</name><argument_list type="generic">&lt;&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name><name>CryptoKeys</name><operator>.</operator><name>RSAKeyPair</name></name></type> <name>keyPair</name> <init>= <expr><operator>new</operator> <call><name><name>CryptoKeys</name><operator>.</operator><name>RSAKeyPair</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name>CoreContainer</name></type> <name>cores</name></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name>int</name></type> <name>MAX_VALIDITY</name> <init>= <expr><call><name><name>Integer</name><operator>.</operator><name>parseInt</name></name><argument_list>(<argument><expr><call><name><name>System</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><literal type="string">"pkiauth.ttl"</literal></expr></argument>, <argument><expr><literal type="string">"5000"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name>String</name></type> <name>myNodeName</name></decl>;</decl_stmt>

  <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name>HttpHeaderClientInterceptor</name></type> <name>interceptor</name> <init>= <expr><operator>new</operator> <call><name>HttpHeaderClientInterceptor</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <name>boolean</name></type> <name>interceptorRegistered</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
 
   <function><type><specifier>public</specifier> <name>void</name></type> <name>setInterceptorRegistered</name><parameter_list>()</parameter_list><block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">197</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">197</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>PKIAuthenticationPlugin</name> extends <name>AuthenticationPlugin</name> implements <name>Htt</name></expr></expr_stmt>
     <try>try <block>{<block_content>
       <decl_stmt><decl><type><name>String</name></type> <name>uri</name> <init>= <expr><name>url</name> <operator>+</operator> <name>PATH</name> <operator>+</operator> <literal type="string">"?wt=json&amp;omitHeader=true"</literal></expr></init></decl>;</decl_stmt>
       <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>debug</name></name><argument_list>(<argument><expr><literal type="string">"Fetching fresh public key from : {}"</literal></expr></argument>,<argument><expr><name>uri</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>HttpResponse</name></type> <name>rsp</name> <init>= <expr><call><name><name>cores</name><operator>.</operator><name>getUpdateShardHandler</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHttpClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>execute</name><argument_list>(<argument><expr><operator>new</operator> <call><name>HttpGet</name><argument_list>(<argument><expr><name>uri</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>HttpResponse</name></type> <name>rsp</name> <init>= <expr><call><name><name>cores</name><operator>.</operator><name>getUpdateShardHandler</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHttpClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>execute</name><argument_list>(<argument><expr><operator>new</operator> <call><name>HttpGet</name><argument_list>(<argument><expr><name>uri</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <decl_stmt><decl><type><name><name>byte</name><index>[]</index></name></type> <name>bytes</name> <init>= <expr><call><name><name>EntityUtils</name><operator>.</operator><name>toByteArray</name></name><argument_list>(<argument><expr><call><name><name>rsp</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <decl_stmt><decl><type><name>Map</name></type> <name>m</name> <init>= <expr><operator>(</operator><name>Map</name><operator>)</operator> <call><name><name>Utils</name><operator>.</operator><name>fromJSON</name></name><argument_list>(<argument><expr><name>bytes</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <decl_stmt><decl><type><name>String</name></type> <name>key</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>m</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"key"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">217</literal></expr><operator>,</operator><expr><literal type="number">11</literal> <operator>+</operator><literal type="number">217</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@ <specifier>public</specifier> <name>class</name> <name>PKIAuthenticationPlugin</name> extends <name>AuthenticationPlugin</name> implements <name>Htt</name></expr></expr_stmt>
 
   </block_content>}</block></try>
 
  <decl_stmt><decl><type><specifier>private</specifier> <name>HttpHeaderClientConfigurer</name></type> <name>clientConfigurer</name> <init>= <expr><operator>new</operator> <call><name>HttpHeaderClientConfigurer</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

   <function><annotation>@<name>Override</name></annotation>
  <type><specifier>public</specifier> <name>HttpClientConfigurer</name></type> <name>getClientConfigurer</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>clientConfigurer</name></expr>;</return>
  <function><type><specifier>public</specifier> <name>SolrHttpClientBuilder</name></type> <name>getHttpClientBuilder</name><parameter_list>(<parameter><decl><type><name>SolrHttpClientBuilder</name></type> <name>builder</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>addRequestInterceptor</name></name><argument_list>(<argument><expr><name>interceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <return>return <expr><name>builder</name></expr>;</return>
   </block_content>}</block></function>
 
   <function><type><specifier>public</specifier> <name>SolrRequestHandler</name></type> <name>getRequestHandler</name><parameter_list>()</parameter_list> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">242</literal></expr><operator>,</operator><expr><literal type="number">13</literal> <operator>+</operator><literal type="number">241</literal></expr><operator>,</operator><expr><literal type="number">9</literal> @@ <specifier>public</specifier> <name>class</name> <name>PKIAuthenticationPlugin</name> extends <name>AuthenticationPlugin</name> implements <name>Htt</name></expr></expr_stmt>
     <return>return <expr><call><name><name>req</name><operator>.</operator><name>getUserPrincipal</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <name>SU</name></expr>;</return>
   </block_content>}</block></function>
 
  <class><specifier>private</specifier> class <name>HttpHeaderClientConfigurer</name> <super_list><extends>extends <super><name>HttpClientConfigurer</name></super></extends> <implements>implements
      <super><name>HttpRequestInterceptor</name></super></implements></super_list> <block>{
  <class><specifier>private</specifier> class <name>HttpHeaderClientInterceptor</name> <super_list><implements>implements <super><name>HttpRequestInterceptor</name></super></implements></super_list> <block>{
 
    <function><annotation>@<name>Override</name></annotation>
    <type><specifier>public</specifier> <name>void</name></type> <name>configure</name><parameter_list>(<parameter><decl><type><name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>SolrParams</name></type> <name>config</name></decl></parameter>)</parameter_list> <block>{<block_content>
      <expr_stmt><expr><call><name><name>super</name><operator>.</operator><name>configure</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>addRequestInterceptor</name></name><argument_list>(<argument><expr><name>this</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <constructor><specifier>public</specifier> <name>HttpHeaderClientInterceptor</name><parameter_list>()</parameter_list> <block>{<block_content>
     </block_content>}</block></constructor>
 
     <annotation>@<name>Override</name></annotation>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">299</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">294</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> <name>class</name> <name>PKIAuthenticationPlugin</name> extends <name>AuthenticationPlugin</name> implements <name>Htt</name>
 
   <name>boolean</name> <call><name>disabled</name><argument_list>()</argument_list></call> <block>{
     <return>return <expr><call><name><name>cores</name><operator>.</operator><name>getAuthenticationPlugin</name></name><argument_list>()</argument_list></call> <operator>==</operator> <literal type="null">null</literal> <operator>||</operator>
        <call><name><name>cores</name><operator>.</operator><name>getAuthenticationPlugin</name></name><argument_list>()</argument_list></call> <operator>instanceof</operator> <name>HttpClientInterceptorPlugin</name></expr>;</return>
        <call><name><name>cores</name><operator>.</operator><name>getAuthenticationPlugin</name></name><argument_list>()</argument_list></call> <operator>instanceof</operator> <name>HttpClientBuilderPlugin</name></block></expr>;</expr_stmt>
   </block_content>}</block></function>
 
   <function><annotation>@<name>Override</name></annotation>
   <type><specifier>public</specifier> <name>void</name></type> <name>close</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>

    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>removeRequestInterceptor</name></name><argument_list>(<argument><expr><name>interceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></function>
 
   <function><type><specifier>public</specifier> <name>String</name></type> <name>getPublicKey</name><parameter_list>()</parameter_list> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>servlet</name><operator>/</operator><name><name>HttpSolrCall</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>servlet</name><operator>/</operator><name><name>HttpSolrCall</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">63cfb7cc9a2</literal><operator>..</operator><literal type="number">46871543521</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>servlet</name><operator>/</operator><name><name>HttpSolrCall</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>servlet</name><operator>/</operator><name><name>HttpSolrCall</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">58</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">58</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpPut</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpRequestBase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>InputStreamEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>CloudSolrClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name><operator>.</operator><name>ErrorCode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>Aliases</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">557</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">558</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpSolrCall</name> <block>{
         <expr><call><name><name>method</name><operator>.</operator><name>removeHeaders</name></name><argument_list>(<argument><expr><name>CONTENT_LENGTH_HEADER</name></expr></argument>)</argument_list></call></expr>;
       }</block>
 
      <name>final</name> <name>HttpResponse</name> <name>response</name> <operator>=</operator> <call><name><name>solrDispatchFilter</name><operator>.</operator><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>method</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><specifier>final</specifier> <name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>solrDispatchFilter</name><operator>.</operator><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>method</name></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <decl_stmt><decl><type><name>int</name></type> <name>httpStatus</name> <init>= <expr><call><name><name>response</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
       <expr_stmt><expr><name>httpEntity</name> <operator>=</operator> <call><name><name>response</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a44b8f87b76</name><operator>..</operator><literal type="number">4fe869c25c9</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateShardHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">27</literal> <operator>+</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">21</literal> @@
  <operator>*</operator><operator>/</operator></expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name></name>;</package>
 
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutorService</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ClientConnectionManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>CloseableHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingClientConnectionManager</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>SchemeRegistryFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingHttpClientConnectionManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>RecoveryStrategy</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>ExecutorUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>IOUtils</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>SolrjNamedThreadFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>core</name><operator>.</operator><name>NodeConfig</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutorService</name></name>;</import>

 <class><specifier>public</specifier> class <name>UpdateShardHandler</name> <block>{
   
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>Logger</name></type> <name>log</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><call><name><name>MethodHandles</name><operator>.</operator><name>lookup</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lookupClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">54</literal></expr><operator>,</operator><expr><literal type="number">53</literal> <operator>+</operator><literal type="number">48</literal></expr><operator>,</operator><expr><literal type="number">25</literal> @@ <specifier>public</specifier> <name>class</name> <name>UpdateShardHandler</name> <block>{
   <expr><specifier>private</specifier> <name>ExecutorService</name> <name>recoveryExecutor</name> <operator>=</operator> <call><name><name>ExecutorUtil</name><operator>.</operator><name>newMDCAwareCachedThreadPool</name></name><argument_list>(
       <argument><expr><operator>new</operator> <call><name>SolrjNamedThreadFactory</name><argument_list>(<argument><expr><literal type="string">"recoveryExecutor"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
   
  <expr><specifier>private</specifier> <name>PoolingClientConnectionManager</name> <name>clientConnectionManager</name></expr>;
  
   <expr><specifier>private</specifier> <name>final</name> <name>CloseableHttpClient</name> <name>client</name></expr>;
 
  <expr><specifier>private</specifier> <name>final</name> <name>UpdateShardHandlerConfig</name> <name>cfg</name></expr>;
  <expr><specifier>private</specifier> <name>final</name> <name>PoolingHttpClientConnectionManager</name> <name>clientConnectionManager</name></expr>;
 
   <expr><specifier>public</specifier> <call><name>UpdateShardHandler</name><argument_list>(<argument><expr><name>UpdateShardHandlerConfig</name> <name>cfg</name></expr></argument>)</argument_list></call> <block>{
    <expr><name><name>this</name><operator>.</operator><name>cfg</name></name> <operator>=</operator> <name>cfg</name></expr>;
    <expr><name>clientConnectionManager</name> <operator>=</operator> <operator>new</operator> <call><name>PoolingClientConnectionManager</name><argument_list>(<argument><expr><call><name><name>SchemeRegistryFactory</name><operator>.</operator><name>createSystemDefault</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
    <expr><name>clientConnectionManager</name> <operator>=</operator> <operator>new</operator> <call><name>PoolingHttpClientConnectionManager</name><argument_list>(<argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>getSchemaRegisteryProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSchemaRegistry</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <if_stmt><if>if <condition>(<expr><name>cfg</name> <operator>!=</operator> <literal type="null">null</literal></expr> )</condition> <block>{<block_content>
       <expr_stmt><expr><call><name><name>clientConnectionManager</name><operator>.</operator><name>setMaxTotal</name></name><argument_list>(<argument><expr><call><name><name>cfg</name><operator>.</operator><name>getMaxUpdateConnections</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>clientConnectionManager</name><operator>.</operator><name>setDefaultMaxPerRoute</name></name><argument_list>(<argument><expr><call><name><name>cfg</name><operator>.</operator><name>getMaxUpdateConnectionsPerHost</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/>}</block_content>
 
    ModifiableSolrParams clientParams = getClientParams(</block></if></if_stmt>)</block></expr>;
    <expr><name>ModifiableSolrParams</name> <name>clientParams</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr>;
     <expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Creating UpdateShardHandler HTTP client with params: {}"</literal></expr></argument>, <argument><expr><name>clientParams</name></expr></argument>)</argument_list></call></expr>;
     <expr><name>client</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>clientParams</name></expr></argument>, <argument><expr><name>clientConnectionManager</name></expr></argument>)</argument_list></call></expr>;
   }</block>

  <specifier>protected</specifier> <name>ModifiableSolrParams</name> <call><name>getClientParams</name><argument_list>()</argument_list></call> <block>{
    <expr><name>ModifiableSolrParams</name> <name>clientParams</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr>;
    <if_stmt><if>if <condition>(<expr><name>cfg</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>clientParams</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>,
          <argument><expr><call><name><name>cfg</name><operator>.</operator><name>getDistributedSocketTimeout</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>clientParams</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_CONNECTION_TIMEOUT</name></name></expr></argument>,
          <argument><expr><call><name><name>cfg</name><operator>.</operator><name>getDistributedConnectionTimeout</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt/>}</block_content>
    <comment type="line">// in the update case, we want to do retries, and to use</comment>
    <comment type="line">// the default Solr retry handler that createClient will </comment>
    <comment type="line">// give us</comment>
    clientParams.set(HttpClientUtil.PROP_USE_RETRY</block><operator>,</operator> <expr_stmt><expr><literal type="boolean">true</literal></expr></expr_stmt></if></if_stmt>)</block></expr>;</expr_stmt>
    <return>return <expr><name>clientParams</name></expr>;</return>
  }</block></class>
  
   
   <function><type><specifier>public</specifier> <name>HttpClient</name></type> <name>getHttpClient</name><parameter_list>()</parameter_list> <block>{<block_content>
     <return>return <expr><name>client</name></expr>;</return>
   </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>void</name></type> <name>reconfigureHttpClient</name><parameter_list>(<parameter><decl><type><name>HttpClientConfigurer</name></type> <name>configurer</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Reconfiguring the default client with: "</literal> <operator>+</operator> <name>configurer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>configurer</name><operator>.</operator><name>configure</name></name><argument_list>(<argument><expr><operator>(</operator><name>DefaultHttpClient</name><operator>)</operator><name>client</name></expr></argument>, <argument><expr><call><name>getClientParams</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>ClientConnectionManager</name></type> <name>getConnectionManager</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>clientConnectionManager</name></expr>;</return>
  </block_content>}</block></function>
   
   <comment type="block" format="javadoc">/**
    * This method returns an executor that is not meant for disk IO and that will
@@ -112,6 +78,11 @@ public class UpdateShardHandler {
     return updateExecutor;
   }
   

  public PoolingHttpClientConnectionManager getConnectionManager() {
    return clientConnectionManager;
  }

   /**
    * In general, RecoveryStrategy threads do not do disk IO, but they open and close SolrCores
    * in async threads, amoung other things, and can trigger disk IO, so we use this alternate 
@@ -131,8 +102,8 @@ public class UpdateShardHandler {
     } catch (Exception e) {
       SolrException.log(log, e);
     } finally {
      IOUtils.closeQuietly(client);
      clientConnectionManager.shutdown();
      HttpClientUtil.close(client);
      clientConnectionManager.close();
     }
   }
 
diff --git a/solr/core/src/java/org/apache/solr/util/SolrCLI.java b/solr/core/src/java/org/apache/solr/util/SolrCLI.java
index 19aa52ac184..ae11118954c 100644
-- a/solr/core/src/java/org/apache/solr/util/SolrCLI.java
++ b/solr/core/src/java/org/apache/solr/util/SolrCLI.java
@@ -16,6 +16,8 @@
  */</comment>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name></name>;</package>
 
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>NAME</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>File</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>FileNotFoundException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">35</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">37</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Arrays</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collection</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Enumeration</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>HashMap</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Iterator</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>LinkedHashMap</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Locale</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">79</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">80</literal></expr><operator>,</operator><expr><literal type="number">9</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrQuery</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrServerException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>CloudSolrClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>ContentStreamUpdateRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>QueryResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">101</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">102</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>noggit</name><operator>.</operator><name>ObjectBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name><operator>.</operator><name>NAME</name></name>;</import>

 <comment type="block" format="javadoc">/**
  * Command-line utility for working with Solr.
  */</comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">275</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">274</literal></expr><operator>,</operator><expr><literal type="number">15</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrCLI</name> <block>{
       <expr><call><name>exit</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;
     }</block>
 
    <name>String</name> <name>configurerClassName</name> <operator>=</operator> <call><name><name>System</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><literal type="string">"solr.authentication.httpclient.configurer"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <if_stmt><if>if <condition>(<expr><name>configurerClassName</name><operator>!=</operator><literal type="null">null</literal></expr>)</condition> <block>{<block_content>
    <decl_stmt><decl><type><name>String</name></type> <name>builderClassName</name> <init>= <expr><call><name><name>System</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><literal type="string">"solr.authentication.httpclient.builder"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><name>builderClassName</name><operator>!=</operator><literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <try>try <block>{<block_content>
        <decl_stmt><decl><type><name>Class</name></type> <name>c</name> <init>= <expr><call><name><name>Class</name><operator>.</operator><name>forName</name></name><argument_list>(<argument><expr><name>configurerClassName</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HttpClientConfigurer</name></type> <name>configurer</name> <init>= <expr><operator>(</operator><name>HttpClientConfigurer</name><operator>)</operator><call><name><name>c</name><operator>.</operator><name>newInstance</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConfigurer</name></name><argument_list>(<argument><expr><name>configurer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Set HttpClientConfigurer from: "</literal><operator>+</operator><name>configurerClassName</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <decl_stmt><decl><type><name>Class</name></type> <name>c</name> <init>= <expr><call><name><name>Class</name><operator>.</operator><name>forName</name></name><argument_list>(<argument><expr><name>builderClassName</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>SolrHttpClientBuilder</name></type> <name>builder</name> <init>= <expr><operator>(</operator><name>SolrHttpClientBuilder</name><operator>)</operator><call><name><name>c</name><operator>.</operator><name>newInstance</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setHttpClientBuilder</name></name><argument_list>(<argument><expr><name>builder</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Set HttpClientConfigurer from: "</literal><operator>+</operator><name>builderClassName</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <throw>throw <expr><operator>new</operator> <call><name>RuntimeException</name><argument_list>(<argument><expr><literal type="string">"Error during loading of configurer '"</literal><operator>+</operator><name>configurerClassName</name><operator>+</operator><literal type="string">"'."</literal></expr></argument>, <argument><expr><name>ex</name></expr></argument>)</argument_list></call></expr>;</throw>
        <throw>throw <expr><operator>new</operator> <call><name>RuntimeException</name><argument_list>(<argument><expr><literal type="string">"Error during loading of configurer '"</literal><operator>+</operator><name>builderClassName</name><operator>+</operator><literal type="string">"'."</literal></expr></argument>, <argument><expr><name>ex</name></expr></argument>)</argument_list></call></expr>;</throw>
       </block_content>}</block></catch></try>
     </block_content>}</block></if></if_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">651</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">650</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrCLI</name> <block>{
     <comment type="line">// ensure we're requesting JSON back from Solr</comment>
     <expr><name>HttpGet</name> <name>httpGet</name> <operator>=</operator> <operator>new</operator> <call><name>HttpGet</name><argument_list>(<argument><expr><operator>new</operator> <call><name>URIBuilder</name><argument_list>(<argument><expr><name>getUrl</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>setParameter</name><argument_list>(<argument><expr><name><name>CommonParams</name><operator>.</operator><name>WT</name></name></expr></argument>, <argument><expr><name><name>CommonParams</name><operator>.</operator><name>JSON</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>build</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <comment type="line">// make the request and get back a parsed JSON object</comment>
    <name><name>Map</name><argument_list type="generic">&lt;<argument><name>String</name></argument>,<argument><name>Object</name></argument>&gt;</argument_list></name> <name>json</name> <operator>=</operator> <call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpGet</name></expr></argument>, <argument><expr><operator>new</operator> <call><name>SolrResponseHandler</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <decl_stmt><decl><type><name><name>Map</name><argument_list type="generic">&lt;<argument><name>String</name></argument>,<argument><name>Object</name></argument>&gt;</argument_list></name></type> <name>json</name> <init>= <expr><call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpGet</name></expr></argument>, <argument><expr><operator>new</operator> <call><name>SolrResponseHandler</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <comment type="line">// check the response JSON from Solr to see if it is an error</comment>
     <decl_stmt><decl><type><name>Long</name></type> <name>statusCode</name> <init>= <expr><call><name>asLong</name><argument_list>(<argument><expr><literal type="string">"/responseHeader/status"</literal></expr></argument>, <argument><expr><name>json</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <if_stmt><if>if <condition>(<expr><name>statusCode</name> <operator>==</operator> <operator>-</operator><literal type="number">1</literal></expr>)</condition> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name>
<name>index</name> <name>e056163a660</name><operator>..</operator><literal type="number">26972038f9c</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name>
@@ <operator>-</operator><literal type="number">29</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">29</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>hadoop</name></name><operator>=</operator><name>INFO</name>
 #<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ClusterStateUtil</name></name><operator>=</operator><name>DEBUG</name>
 #<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>OverseerAutoReplicaFailoverThread</name></name><operator>=</operator><name>DEBUG</name>
 
#<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingClientConnectionManager</name></name><operator>=</operator><name>DEBUG</name>
#<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingHttpClientConnectionManager</name></name><operator>=</operator><name>DEBUG</name>
 #<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>BasicClientConnectionManager</name></name><operator>=</operator><name>DEBUG</name>
 #<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name></name><operator>=</operator><name>DEBUG</name>
 #<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpRequestRetryHandler</name></name><operator>=</operator><name>DEBUG</name>
#<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name></name><operator>=</operator><name>DEBUG</name>
#<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name></name><operator>=</operator><name>DEBUG</name>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>TestDistributedSearch</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>TestDistributedSearch</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>dbc48ddd7c0</name><operator>..</operator><name>a25498aef25</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>TestDistributedSearch</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>TestDistributedSearch</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">55</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">55</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>component</name><operator>.</operator><name>TrackingShardHandlerFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>component</name><operator>.</operator><name>TrackingShardHandlerFactory</name><operator>.</operator><name>RequestTrackingQueue</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>handler</name><operator>.</operator><name>component</name><operator>.</operator><name>TrackingShardHandlerFactory</name><operator>.</operator><name>ShardRequestAndParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>response</name><operator>.</operator><name>SolrQueryResponse</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>BeforeClass</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">89</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">90</literal></expr><operator>,</operator><expr><literal type="number">15</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestDistributedSearch</name> extends <name>BaseDistributedSearchTestCase</name> <block>{
     <return>return <expr><literal type="string">"solr-trackingshardhandler.xml"</literal></expr>;</return>
   }</block></expr></expr_stmt>
 
  <function><annotation>@<name>BeforeClass</name></annotation>
  <type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>beforeClass</name><parameter_list>()</parameter_list> <block>{<block_content>
    <comment type="line">// we shutdown a jetty and start it and try to use</comment>
    <comment type="line">// the same http client pretty fast - this lowered setting makes sure</comment>
    <comment type="line">// we validate the connection before use on the restarted</comment>
    <comment type="line">// server so that we don't use a bad one</comment>
    <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><literal type="string">"validateAfterInactivity"</literal></expr></argument>, <argument><expr><literal type="string">"200"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>
  
   <function><annotation>@<name>Test</name></annotation>
   <type><specifier>public</specifier> <name>void</name></type> <name>test</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
     <decl_stmt><decl><type><name>QueryResponse</name></type> <name>rsp</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">988</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">998</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestDistributedSearch</name> extends <name>BaseDistributedSearchTestCase</name> <block>{
 
       <comment type="line">// restart the jettys</comment>
       <for>for <control>(<init><decl><type><name>JettySolrRunner</name></type> <name>downJetty</name> <range>: <expr><name>downJettys</name></expr></range></decl></init>)</control> <block>{<block_content>
        <expr_stmt><expr><call><name><name>downJetty</name><operator>.</operator><name>start</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>ChaosMonkey</name><operator>.</operator><name>start</name></name><argument_list>(<argument><expr><name>downJetty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block></for>
     }</block></expr></expr_stmt>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>ConnectionReuseTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>ConnectionReuseTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">0ec9876b61f</literal><operator>..</operator><literal type="number">0d789750278</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>ConnectionReuseTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>ConnectionReuseTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">18</literal></expr><operator>,</operator><expr><literal type="number">24</literal> <operator>+</operator><literal type="number">18</literal></expr><operator>,</operator><expr><literal type="number">25</literal> @@</expr></expr_stmt> <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name></name>;</package>
 
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>URL</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutionException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>TimeUnit</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>atomic</name><operator>.</operator><name>AtomicInteger</name></name>;</import>
 
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>Configurable</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpClientContext</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpClientConnection</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpConnectionMetrics</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpHost</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpVersion</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ClientConnectionRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ConnectionPoolTimeoutException</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ManagedClientConnection</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ConnectionRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>routing</name><operator>.</operator><name>HttpRoute</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingClientConnectionManager</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>CloseableHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingHttpClientConnectionManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>message</name><operator>.</operator><name>BasicHttpRequest</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>params</name><operator>.</operator><name>BasicHttpParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>params</name><operator>.</operator><name>HttpProtocolParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>protocol</name><operator>.</operator><name>BasicHttpContext</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrTestCaseJ4</name><operator>.</operator><name>SuppressSSL</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>CloudSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>ConcurrentUpdateSolrClient</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">51</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">52</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>
 <class><specifier>public</specifier> class <name>ConnectionReuseTest</name> <super_list><extends>extends <super><name>AbstractFullDistribZkTestBase</name></super></extends></super_list> <block>{
   
   <decl_stmt><decl><type><specifier>private</specifier> <name>AtomicInteger</name></type> <name>id</name> <init>= <expr><operator>new</operator> <call><name>AtomicInteger</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
  
  <decl_stmt><decl><type><specifier>private</specifier> <name>HttpClientContext</name></type> <name>context</name> <init>= <expr><call><name><name>HttpClientContext</name><operator>.</operator><name>create</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
   <function><annotation>@<name>BeforeClass</name></annotation>
   <type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>beforeConnectionReuseTest</name><parameter_list>()</parameter_list> <block>{<block_content>
     <if_stmt><if>if <condition>(<expr><literal type="boolean">true</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><name><name>TestInjection</name><operator>.</operator><name>failUpdateRequests</name></name> <operator>=</operator> <literal type="string">"true:100"</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">74</literal></expr><operator>,</operator><expr><literal type="number">114</literal> <operator>+</operator><literal type="number">75</literal></expr><operator>,</operator><expr><literal type="number">122</literal> @@ <specifier>public</specifier> <name>class</name> <name>ConnectionReuseTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
   
   @<expr><name>Test</name>
   <specifier>public</specifier> <name>void</name> <call><name>test</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{

     <expr><name>URL</name> <name>url</name> <operator>=</operator> <operator>new</operator> <call><name>URL</name><argument_list>(<argument><expr><operator>(</operator><operator>(</operator><name>HttpSolrClient</name><operator>)</operator> <call><name><name>clients</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>)</operator><operator>.</operator><call><name>getBaseURL</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;
    
    <name>SolrClient</name> <name>client</name></block></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>HttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>int</name></type> <name>rndClient</name> <init>= <expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextInt</name><argument_list>(<argument><expr><literal type="number">3</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><name>rndClient</name> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><name>client</name> <operator>=</operator> <operator>new</operator> <call><name>ConcurrentUpdateSolrClient</name><argument_list>(<argument><expr><call><name><name>url</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>, <argument><expr><literal type="number">6</literal></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt> <comment type="line">// currently only testing with 1 thread</comment>
    </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><name>rndClient</name> <operator>==</operator> <literal type="number">1</literal></expr>)</condition>  <block>{<block_content>
      <expr_stmt><expr><name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>url</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><name>rndClient</name> <operator>==</operator> <literal type="number">2</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><name>client</name> <operator>=</operator> <operator>new</operator> <call><name>CloudSolrClient</name><argument_list>(<argument><expr><call><name><name>zkServer</name><operator>.</operator><name>getZkAddress</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><operator>(</operator><operator>(</operator><name>CloudSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>setParallelUpdates</name><argument_list>(<argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><operator>(</operator><operator>(</operator><name>CloudSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>setDefaultCollection</name><argument_list>(<argument><expr><name>DEFAULT_COLLECTION</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><operator>(</operator><operator>(</operator><name>CloudSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>getLbClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>setConnectionTimeout</name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><operator>(</operator><operator>(</operator><name>CloudSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>getLbClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>setSoTimeout</name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <else>else <block>{<block_content>
      <throw>throw <expr><operator>new</operator> <call><name>RuntimeException</name><argument_list>(<argument><expr><literal type="string">"impossible"</literal></expr></argument>)</argument_list></call></expr>;</throw>
    </block_content>}</block></else></if_stmt>
    
    <decl_stmt><decl><type><name>PoolingClientConnectionManager</name></type> <name>cm</name> <init>= <expr><operator>(</operator><name>PoolingClientConnectionManager</name><operator>)</operator> <call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <decl_stmt><decl><type><name>HttpHost</name></type> <name>target</name> <init>= <expr><operator>new</operator> <call><name>HttpHost</name><argument_list>(<argument><expr><call><name><name>url</name><operator>.</operator><name>getHost</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>url</name><operator>.</operator><name>getPort</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><ternary><condition><expr><call><name>isSSLMode</name><argument_list>()</argument_list></call></expr> ?</condition><then> <expr><literal type="string">"https"</literal></expr> </then><else>: <expr><literal type="string">"http"</literal></expr></else></ternary></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>HttpRoute</name></type> <name>route</name> <init>= <expr><operator>new</operator> <call><name>HttpRoute</name><argument_list>(<argument><expr><name>target</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    
    <decl_stmt><decl><type><name>ClientConnectionRequest</name></type> <name>mConn</name> <init>= <expr><call><name>getClientConnectionRequest</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>route</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
   
    <decl_stmt><decl><type><name>ManagedClientConnection</name></type> <name>conn1</name> <init>= <expr><call><name>getConn</name><argument_list>(<argument><expr><name>mConn</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name>headerRequest</name><argument_list>(<argument><expr><name>target</name></expr></argument>, <argument><expr><name>route</name></expr></argument>, <argument><expr><name>conn1</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>conn1</name><operator>.</operator><name>releaseConnection</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>releaseConnection</name></name><argument_list>(<argument><expr><name>conn1</name></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>MILLISECONDS</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <decl_stmt><decl><type><name>int</name></type> <name>queueBreaks</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>int</name></type> <name>cnt1</name> <init>= <expr><call><name>atLeast</name><argument_list>(<argument><expr><literal type="number">3</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>int</name></type> <name>cnt2</name> <init>= <expr><call><name>atLeast</name><argument_list>(<argument><expr><literal type="number">30</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <for>for <control>(<init><decl><type><name>int</name></type> <name>j</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>j</name> <operator>&lt;</operator> <name>cnt1</name></expr>;</condition> <incr><expr><name>j</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
      <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <name>cnt2</name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
        <decl_stmt><decl><type><name>boolean</name></type> <name>done</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>AddUpdateCommand</name></type> <name>c</name> <init>= <expr><operator>new</operator> <call><name>AddUpdateCommand</name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><name><name>c</name><operator>.</operator><name>solrDoc</name></name> <operator>=</operator> <call><name>sdoc</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>, <argument><expr><call><name><name>id</name><operator>.</operator><name>incrementAndGet</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <try>try <block>{<block_content>
          <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name><name>c</name><operator>.</operator><name>solrDoc</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
          <expr_stmt><expr><call><name><name>e</name><operator>.</operator><name>printStackTrace</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>PoolingHttpClientConnectionManager</name></type> <name>cm</name> <init>= <expr><operator>new</operator> <call><name>PoolingHttpClientConnectionManager</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>SolrClient</name></type> <name>client</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>cm</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <try>try <block>{<block_content>
      <decl_stmt><decl><type><name>int</name></type> <name>rndClient</name> <init>= <expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextInt</name><argument_list>(<argument><expr><literal type="number">3</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <if_stmt><if>if <condition>(<expr><name>rndClient</name> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><name>client</name> <operator>=</operator> <operator>new</operator> <call><name>ConcurrentUpdateSolrClient</name><argument_list>(<argument><expr><call><name><name>url</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>, <argument><expr><literal type="number">6</literal></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt> <comment type="line">// currently only testing with 1</comment>
                                                                                   <comment type="line">// thread</comment>
      </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><name>rndClient</name> <operator>==</operator> <literal type="number">1</literal></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>url</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><name>rndClient</name> <operator>==</operator> <literal type="number">2</literal></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><name>client</name> <operator>=</operator> <operator>new</operator> <call><name>CloudSolrClient</name><argument_list>(<argument><expr><call><name><name>zkServer</name><operator>.</operator><name>getZkAddress</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><operator>(</operator><operator>(</operator><name>CloudSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>setParallelUpdates</name><argument_list>(<argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><operator>(</operator><operator>(</operator><name>CloudSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>setDefaultCollection</name><argument_list>(<argument><expr><name>DEFAULT_COLLECTION</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><operator>(</operator><operator>(</operator><name>CloudSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>getLbClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>setConnectionTimeout</name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><operator>(</operator><operator>(</operator><name>CloudSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>getLbClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>setSoTimeout</name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></if> <else>else <block>{<block_content>
        <throw>throw <expr><operator>new</operator> <call><name>RuntimeException</name><argument_list>(<argument><expr><literal type="string">"impossible"</literal></expr></argument>)</argument_list></call></expr>;</throw>
      </block_content>}</block></else></if_stmt>

      <decl_stmt><decl><type><name>HttpHost</name></type> <name>target</name> <init>= <expr><operator>new</operator> <call><name>HttpHost</name><argument_list>(<argument><expr><call><name><name>url</name><operator>.</operator><name>getHost</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>url</name><operator>.</operator><name>getPort</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><ternary><condition><expr><call><name>isSSLMode</name><argument_list>()</argument_list></call></expr> ?</condition><then> <expr><literal type="string">"https"</literal></expr> </then><else>: <expr><literal type="string">"http"</literal></expr></else></ternary></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>HttpRoute</name></type> <name>route</name> <init>= <expr><operator>new</operator> <call><name>HttpRoute</name><argument_list>(<argument><expr><name>target</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

      <decl_stmt><decl><type><name>ConnectionRequest</name></type> <name>mConn</name> <init>= <expr><call><name>getClientConnectionRequest</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>route</name></expr></argument>, <argument><expr><name>cm</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

      <decl_stmt><decl><type><name>HttpClientConnection</name></type> <name>conn1</name> <init>= <expr><call><name>getConn</name><argument_list>(<argument><expr><name>mConn</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>headerRequest</name><argument_list>(<argument><expr><name>target</name></expr></argument>, <argument><expr><name>route</name></expr></argument>, <argument><expr><name>conn1</name></expr></argument>, <argument><expr><name>cm</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>releaseConnection</name></name><argument_list>(<argument><expr><name>conn1</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>MILLISECONDS</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <decl_stmt><decl><type><name>int</name></type> <name>queueBreaks</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>int</name></type> <name>cnt1</name> <init>= <expr><call><name>atLeast</name><argument_list>(<argument><expr><literal type="number">3</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>int</name></type> <name>cnt2</name> <init>= <expr><call><name>atLeast</name><argument_list>(<argument><expr><literal type="number">30</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <for>for <control>(<init><decl><type><name>int</name></type> <name>j</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>j</name> <operator>&lt;</operator> <name>cnt1</name></expr>;</condition> <incr><expr><name>j</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
        <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <name>cnt2</name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
          <decl_stmt><decl><type><name>boolean</name></type> <name>done</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
          <decl_stmt><decl><type><name>AddUpdateCommand</name></type> <name>c</name> <init>= <expr><operator>new</operator> <call><name>AddUpdateCommand</name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><name><name>c</name><operator>.</operator><name>solrDoc</name></name> <operator>=</operator> <call><name>sdoc</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>, <argument><expr><call><name><name>id</name><operator>.</operator><name>incrementAndGet</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <try>try <block>{<block_content>
            <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name><name>c</name><operator>.</operator><name>solrDoc</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <expr_stmt><expr><call><name><name>e</name><operator>.</operator><name>printStackTrace</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
          </block_content>}</block></catch></try>
          <if_stmt><if>if <condition>(<expr><operator>!</operator><name>done</name> <operator>&amp;&amp;</operator> <name>i</name> <operator>&gt;</operator> <literal type="number">0</literal> <operator>&amp;&amp;</operator> <name>i</name> <operator>&lt;</operator> <name>cnt2</name> <operator>-</operator> <literal type="number">1</literal> <operator>&amp;&amp;</operator> <name>client</name> <operator>instanceof</operator> <name>ConcurrentUpdateSolrClient</name>
              <operator>&amp;&amp;</operator> <call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextInt</name><argument_list>(<argument><expr><literal type="number">10</literal></expr></argument>)</argument_list></call> <operator>&gt;</operator> <literal type="number">8</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>queueBreaks</name><operator>++</operator></expr>;</expr_stmt>
            <expr_stmt><expr><name>done</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">350</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt> <comment type="line">// wait past streaming client poll time of 250ms</comment>
          </block_content>}</block></if></if_stmt>
         </block_content>}</block></for>
        <if_stmt><if>if <condition>(<expr><operator>!</operator><name>done</name> <operator>&amp;&amp;</operator> <name>i</name> <operator>&gt;</operator> <literal type="number">0</literal> <operator>&amp;&amp;</operator> <name>i</name> <operator>&lt;</operator> <name>cnt2</name> <operator>-</operator> <literal type="number">1</literal> <operator>&amp;&amp;</operator> <name>client</name> <operator>instanceof</operator> <name>ConcurrentUpdateSolrClient</name> <operator>&amp;&amp;</operator> <call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextInt</name><argument_list>(<argument><expr><literal type="number">10</literal></expr></argument>)</argument_list></call> <operator>&gt;</operator> <literal type="number">8</literal></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><name>queueBreaks</name><operator>++</operator></expr>;</expr_stmt>
          <expr_stmt><expr><name>done</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">350</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt> <comment type="line">// wait past streaming client poll time of 250ms</comment>
        <if_stmt><if>if <condition>(<expr><name>client</name> <operator>instanceof</operator> <name>ConcurrentUpdateSolrClient</name></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><operator>(</operator><operator>(</operator><name>ConcurrentUpdateSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>blockUntilFinished</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
         </block_content>}</block></if></if_stmt>
       </block_content>}</block></if></if_stmt>

      <expr_stmt><expr><name>route</name> <operator>=</operator> <operator>new</operator> <call><name>HttpRoute</name><argument_list>(<argument><expr><operator>new</operator> <call><name>HttpHost</name><argument_list>(<argument><expr><call><name><name>url</name><operator>.</operator><name>getHost</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>url</name><operator>.</operator><name>getPort</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><ternary><condition><expr><call><name>isSSLMode</name><argument_list>()</argument_list></call></expr> ?</condition><then> <expr><literal type="string">"https"</literal></expr> </then><else>: <expr><literal type="string">"http"</literal></expr></else></ternary></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <expr_stmt><expr><name>mConn</name> <operator>=</operator> <call><name><name>cm</name><operator>.</operator><name>requestConnection</name></name><argument_list>(<argument><expr><name>route</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <decl_stmt><decl><type><name>HttpClientConnection</name></type> <name>conn2</name> <init>= <expr><call><name>getConn</name><argument_list>(<argument><expr><name>mConn</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

      <decl_stmt><decl><type><name>HttpConnectionMetrics</name></type> <name>metrics</name> <init>= <expr><call><name><name>conn2</name><operator>.</operator><name>getMetrics</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>headerRequest</name><argument_list>(<argument><expr><name>target</name></expr></argument>, <argument><expr><name>route</name></expr></argument>, <argument><expr><name>conn2</name></expr></argument>, <argument><expr><name>cm</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>releaseConnection</name></name><argument_list>(<argument><expr><name>conn2</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>MILLISECONDS</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <expr_stmt><expr><call><name>assertNotNull</name><argument_list>(<argument><expr><literal type="string">"No connection metrics found - is the connection getting aborted? server closing the connection? "</literal>
          <operator>+</operator> <call><name><name>client</name><operator>.</operator><name>getClass</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSimpleName</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>metrics</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <comment type="line">// we try and make sure the connection we get has handled all of the requests in this test</comment>
       <if_stmt><if>if <condition>(<expr><name>client</name> <operator>instanceof</operator> <name>ConcurrentUpdateSolrClient</name></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><operator>(</operator><operator>(</operator><name>ConcurrentUpdateSolrClient</name><operator>)</operator> <name>client</name><operator>)</operator><operator>.</operator><call><name>blockUntilFinished</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <comment type="line">// we can't fully control queue polling breaking up requests - allow a bit of leeway</comment>
        <decl_stmt><decl><type><name>int</name></type> <name>exp</name> <init>= <expr><name>cnt1</name> <operator>+</operator> <name>queueBreaks</name> <operator>+</operator> <literal type="number">2</literal></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name>assertTrue</name><argument_list>(
            <argument><expr><literal type="string">"We expected all communication via streaming client to use one connection! expected="</literal> <operator>+</operator> <name>exp</name> <operator>+</operator> <literal type="string">" got="</literal>
                <operator>+</operator> <call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>,
            <argument><expr><call><name><name>Math</name><operator>.</operator><name>max</name></name><argument_list>(<argument><expr><name>exp</name></expr></argument>, <argument><expr><call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call> <operator>-</operator> <call><name><name>Math</name><operator>.</operator><name>min</name></name><argument_list>(<argument><expr><name>exp</name></expr></argument>, <argument><expr><call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call> <operator>&lt;</operator> <literal type="number">3</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></if> <else>else <block>{<block_content>
        <expr_stmt><expr><call><name>assertTrue</name><argument_list>(<argument><expr><literal type="string">"We expected all communication to use one connection! "</literal> <operator>+</operator> <call><name><name>client</name><operator>.</operator><name>getClass</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSimpleName</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">" "</literal>
            <operator>+</operator> <call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>,
            <argument><expr><name>cnt1</name> <operator>*</operator> <name>cnt2</name> <operator>+</operator> <literal type="number">2</literal> <operator>&lt;=</operator> <call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block></else></if_stmt>
    </block_content>}</block></for>
 
    <expr_stmt><expr><name>route</name> <operator>=</operator> <operator>new</operator> <call><name>HttpRoute</name><argument_list>(<argument><expr><operator>new</operator> <call><name>HttpHost</name><argument_list>(<argument><expr><call><name><name>url</name><operator>.</operator><name>getHost</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>url</name><operator>.</operator><name>getPort</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><ternary><condition><expr><call><name>isSSLMode</name><argument_list>()</argument_list></call></expr> ?</condition><then> <expr><literal type="string">"https"</literal></expr> </then><else>: <expr><literal type="string">"http"</literal></expr></else></ternary></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt><expr><name>mConn</name> <operator>=</operator> <call><name><name>cm</name><operator>.</operator><name>requestConnection</name></name><argument_list>(<argument><expr><name>route</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   
    <decl_stmt><decl><type><name>ManagedClientConnection</name></type> <name>conn2</name> <init>= <expr><call><name>getConn</name><argument_list>(<argument><expr><name>mConn</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <decl_stmt><decl><type><name>HttpConnectionMetrics</name></type> <name>metrics</name> <init>= <expr><call><name><name>conn2</name><operator>.</operator><name>getMetrics</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name>headerRequest</name><argument_list>(<argument><expr><name>target</name></expr></argument>, <argument><expr><name>route</name></expr></argument>, <argument><expr><name>conn2</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>conn2</name><operator>.</operator><name>releaseConnection</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>releaseConnection</name></name><argument_list>(<argument><expr><name>conn2</name></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>MILLISECONDS</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    
    <expr_stmt><expr><call><name>assertNotNull</name><argument_list>(<argument><expr><literal type="string">"No connection metrics found - is the connection getting aborted? server closing the connection? "</literal> <operator>+</operator> <call><name><name>client</name><operator>.</operator><name>getClass</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSimpleName</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>metrics</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <comment type="line">// we try and make sure the connection we get has handled all of the requests in this test</comment>
    <if_stmt><if>if <condition>(<expr><name>client</name> <operator>instanceof</operator> <name>ConcurrentUpdateSolrClient</name></expr>)</condition> <block>{<block_content>
      <comment type="line">// we can't fully control queue polling breaking up requests - allow a bit of leeway</comment>
      <decl_stmt><decl><type><name>int</name></type> <name>exp</name> <init>= <expr><name>cnt1</name> <operator>+</operator> <name>queueBreaks</name> <operator>+</operator> <literal type="number">2</literal></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertTrue</name><argument_list>(
          <argument><expr><literal type="string">"We expected all communication via streaming client to use one connection! expected="</literal> <operator>+</operator> <name>exp</name> <operator>+</operator> <literal type="string">" got="</literal>
              <operator>+</operator> <call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>,
          <argument><expr><call><name><name>Math</name><operator>.</operator><name>max</name></name><argument_list>(<argument><expr><name>exp</name></expr></argument>, <argument><expr><call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call> <operator>-</operator> <call><name><name>Math</name><operator>.</operator><name>min</name></name><argument_list>(<argument><expr><name>exp</name></expr></argument>, <argument><expr><call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call> <operator>&lt;</operator> <literal type="number">3</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <else>else <block>{<block_content>
      <expr_stmt><expr><call><name>assertTrue</name><argument_list>(<argument><expr><literal type="string">"We expected all communication to use one connection! "</literal> <operator>+</operator> <call><name><name>client</name><operator>.</operator><name>getClass</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSimpleName</name><argument_list>()</argument_list></call></expr></argument>,
          <argument><expr><name>cnt1</name> <operator>*</operator> <name>cnt2</name> <operator>+</operator> <literal type="number">2</literal> <operator>&lt;=</operator> <call><name><name>metrics</name><operator>.</operator><name>getRequestCount</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></else></if_stmt> <finally>finally <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></finally>
    
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></try>
 
  <function><type><specifier>public</specifier> <name>ManagedClientConnection</name></type> <name>getConn</name><parameter_list>(<parameter><decl><type><name>ClientConnectionRequest</name></type> <name>mConn</name></decl></parameter>)</parameter_list>
      <throws>throws <argument><expr><name>InterruptedException</name></expr></argument>, <argument><expr><name>ConnectionPoolTimeoutException</name></expr></argument></throws> <block>{<block_content>
    <decl_stmt><decl><type><name>ManagedClientConnection</name></type> <name>conn</name> <init>= <expr><call><name><name>mConn</name><operator>.</operator><name>getConnection</name></name><argument_list>(<argument><expr><literal type="number">30</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>SECONDS</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>conn</name><operator>.</operator><name>setIdleDuration</name></name><argument_list>(<argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>MILLISECONDS</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>conn</name><operator>.</operator><name>markReusable</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
  <function><type><specifier>public</specifier> <name>HttpClientConnection</name></type> <name>getConn</name><parameter_list>(<parameter><decl><type><name>ConnectionRequest</name></type> <name>mConn</name></decl></parameter>)</parameter_list>
      <throws>throws <argument><expr><name>InterruptedException</name></expr></argument>, <argument><expr><name>ConnectionPoolTimeoutException</name></expr></argument>, <argument><expr><name>ExecutionException</name></expr></argument></throws> <block>{<block_content>
    <decl_stmt><decl><type><name>HttpClientConnection</name></type> <name>conn</name> <init>= <expr><call><name><name>mConn</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">30</literal></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>SECONDS</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

     <return>return <expr><name>conn</name></expr>;</return>
   </block_content>}</block></function>
 
  <decl_stmt><decl><type><specifier>public</specifier> <name>void</name></type> <name>headerRequest</name><argument_list>(<argument><expr><name>HttpHost</name> <name>target</name></expr></argument>, <argument><expr><name>HttpRoute</name> <name>route</name></expr></argument>, <argument><expr><name>ManagedClientConnection</name> <name>conn</name></expr></argument>)</argument_list>
  public <name>void</name> <name>headerRequest</name><argument_list>(<argument><expr><name>HttpHost</name> <name>target</name></expr></argument>, <argument><expr><name>HttpRoute</name> <name>route</name></expr></argument>, <argument><expr><name>HttpClientConnection</name> <name>conn</name></expr></argument>, <argument><expr><name>PoolingHttpClientConnectionManager</name> <name>cm</name></expr></argument>)</argument_list>
       <throws>throws <argument><expr><name>IOException</name></expr></argument>, <argument><expr><name>HttpException</name> <block>{
     <expr><name>HttpRequest</name> <name>req</name> <operator>=</operator> <operator>new</operator> <call><name>BasicHttpRequest</name><argument_list>(<argument><expr><literal type="string">"OPTIONS"</literal></expr></argument>, <argument><expr><literal type="string">"*"</literal></expr></argument>, <argument><expr><name><name>HttpVersion</name><operator>.</operator><name>HTTP_1_1</name></name></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></decl>;</decl_stmt>
 
     <expr_stmt><expr><call><name><name>req</name><operator>.</operator><name>addHeader</name></name><argument_list>(<argument><expr><literal type="string">"Host"</literal></expr></argument>, <argument><expr><call><name><name>target</name><operator>.</operator><name>getHostName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>BasicHttpParams</name></type> <name>p</name> <init>= <expr><operator>new</operator> <call><name>BasicHttpParams</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>HttpProtocolParams</name><operator>.</operator><name>setVersion</name></name><argument_list>(<argument><expr><name>p</name></expr></argument>, <argument><expr><name><name>HttpVersion</name><operator>.</operator><name>HTTP_1_1</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <if_stmt><if>if <condition>(<expr><operator>!</operator><call><name><name>conn</name><operator>.</operator><name>isOpen</name></name><argument_list>()</argument_list></call></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>conn</name><operator>.</operator><name>open</name></name><argument_list>(<argument><expr><name>route</name></expr></argument>, <argument><expr><operator>new</operator> <call><name>BasicHttpContext</name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name>p</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
    <if_stmt><if>if <condition>(<expr><operator>!</operator><call><name><name>conn</name><operator>.</operator><name>isOpen</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
      <comment type="line">// establish connection based on its route info</comment>
      <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>connect</name></name><argument_list>(<argument><expr><name>conn</name></expr></argument>, <argument><expr><name>route</name></expr></argument>, <argument><expr><literal type="number">1000</literal></expr></argument>, <argument><expr><name>context</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <comment type="line">// and mark it as route complete</comment>
      <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>routeComplete</name></name><argument_list>(<argument><expr><name>conn</name></expr></argument>, <argument><expr><name>route</name></expr></argument>, <argument><expr><name>context</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
     <expr_stmt><expr><call><name><name>conn</name><operator>.</operator><name>sendRequestHeader</name></name><argument_list>(<argument><expr><name>req</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>conn</name><operator>.</operator><name>flush</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>conn</name><operator>.</operator><name>receiveResponseHeader</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></function>
 
  <function><type><specifier>public</specifier> <name>ClientConnectionRequest</name></type> <name>getClientConnectionRequest</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>HttpRoute</name></type> <name>route</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>ClientConnectionRequest</name></type> <name>mConn</name> <init>= <expr><operator>(</operator><operator>(</operator><name>PoolingClientConnectionManager</name><operator>)</operator> <call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>)</operator><operator>.</operator><call><name>requestConnection</name><argument_list>(<argument><expr><name>route</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
  <function><type><specifier>public</specifier> <name>ConnectionRequest</name></type> <name>getClientConnectionRequest</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>HttpRoute</name></type> <name>route</name></decl></parameter>, <parameter><decl><type><name>PoolingHttpClientConnectionManager</name></type> <name>cm</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>ConnectionRequest</name></type> <name>mConn</name> <init>= <expr><call><name><name>cm</name><operator>.</operator><name>requestConnection</name></name><argument_list>(<argument><expr><name>route</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <return>return <expr><name>mConn</name></expr>;</return>
   </block_content>}</block></function>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>TestJettySolrRunner</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>TestJettySolrRunner</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">17facec7241</literal><operator>..</operator><name>dc8896d0bea</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>TestJettySolrRunner</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>TestJettySolrRunner</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">53</literal></expr><operator>,</operator><expr><literal type="number">13</literal> <operator>+</operator><literal type="number">53</literal></expr><operator>,</operator><expr><literal type="number">13</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestJettySolrRunner</name> extends <name>SolrTestCaseJ4</name> <block>{
     <try>try <block>{<block_content>
       <expr_stmt><expr><call><name><name>runner</name><operator>.</operator><name>start</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
 
      <decl_stmt><decl><type><name>SolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>runner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <try>try <init>(<decl><type><name>SolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>runner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
        <decl_stmt><decl><type><name><name>CoreAdminRequest</name><operator>.</operator><name>Create</name></name></type> <name>createReq</name> <init>= <expr><operator>new</operator> <call><name><name>CoreAdminRequest</name><operator>.</operator><name>Create</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>createReq</name><operator>.</operator><name>setCoreName</name></name><argument_list>(<argument><expr><literal type="string">"newcore"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>createReq</name><operator>.</operator><name>setConfigSet</name></name><argument_list>(<argument><expr><literal type="string">"minimal"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
      <decl_stmt><decl><type><name><name>CoreAdminRequest</name><operator>.</operator><name>Create</name></name></type> <name>createReq</name> <init>= <expr><operator>new</operator> <call><name><name>CoreAdminRequest</name><operator>.</operator><name>Create</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>createReq</name><operator>.</operator><name>setCoreName</name></name><argument_list>(<argument><expr><literal type="string">"newcore"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>createReq</name><operator>.</operator><name>setConfigSet</name></name><argument_list>(<argument><expr><literal type="string">"minimal"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>createReq</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>createReq</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></try>
 
       <expr_stmt><expr><call><name>assertTrue</name><argument_list>(<argument><expr><call><name><name>Files</name><operator>.</operator><name>exists</name></name><argument_list>(<argument><expr><call><name><name>coresDir</name><operator>.</operator><name>resolve</name></name><argument_list>(<argument><expr><literal type="string">"newcore"</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>resolve</name><argument_list>(<argument><expr><literal type="string">"core.properties"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BaseCdcrDistributedZkTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BaseCdcrDistributedZkTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>fe94309bba2</name><operator>..</operator><name>ca4f91219b4</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BaseCdcrDistributedZkTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BaseCdcrDistributedZkTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">168</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">168</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@ <specifier>public</specifier> <name>class</name> <name>BaseCdcrDistributedZkTest</name> extends <name>AbstractDistribZkTestBase</name> <block>{
 
   @<expr><name>After</name>
   <specifier>public</specifier> <name>void</name> <call><name>baseAfter</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{</block></expr></argument></throws></expr>
    <for>for <control>(<init><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>CloudJettyRunner</name></argument>&gt;</argument_list></name></type> <name>runners</name> <range>: <expr><call><name><name>cloudJettys</name><operator>.</operator><name>values</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
      <for>for <control>(<init><decl><type><name>CloudJettyRunner</name></type> <name>runner</name> <range>: <expr><name>runners</name></expr></range></decl></init>)</control> <block>{<block_content>
        <expr_stmt><expr><call><name><name>runner</name><operator>.</operator><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></for>
    </block_content>}</block></for>
     <call><name>destroyServers</name><argument_list>()</argument_list></call></block></expr>;</expr_stmt>
   </block_content>}</block></try>
 
@@ <operator>-</operator><literal type="number">175</literal>,<literal type="number">8</literal> <operator>+</operator><literal type="number">180</literal>,<literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>BaseCdcrDistributedZkTest</name> extends <name>AbstractDistribZkTestBase</name> <block>{
     <expr><name>CloudSolrClient</name> <name>server</name> <operator>=</operator> <operator>new</operator> <call><name>CloudSolrClient</name><argument_list>(<argument><expr><call><name><name>zkServer</name><operator>.</operator><name>getZkAddress</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <call><name><name>server</name><operator>.</operator><name>setParallelUpdates</name></name><argument_list>(<argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></block></block></expr>;</expr_stmt>
     <if_stmt><if>if <condition>(<expr><name>defaultCollection</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>setDefaultCollection</name></name><argument_list>(<argument><expr><name>defaultCollection</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
    <expr_stmt><expr><call><name><name>server</name><operator>.</operator><name>getLbClient</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHttpClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getParams</name><argument_list>()</argument_list></call>
        <operator>.</operator><call><name>setParameter</name><argument_list>(<argument><expr><name><name>CoreConnectionPNames</name><operator>.</operator><name>CONNECTION_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <return>return <expr><name>server</name></expr>;</return>
   </block_content>}</block></function>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">747</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">750</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>BaseCdcrDistributedZkTest</name> extends <name>AbstractDistribZkTestBase</name> <block>{
       <comment type="line">// setup the server...</comment>
       <expr><name>HttpSolrClient</name> <name>s</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>baseUrl</name></expr></argument>)</argument_list></call></expr>;
       <call><name><name>s</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>s</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>s</name></expr>;</return>
     </block_content>}</block></catch> <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<block_content>
       <throw>throw <expr><operator>new</operator> <call><name>RuntimeException</name><argument_list>(<argument><expr><name>ex</name></expr></argument>)</argument_list></call></expr>;</throw>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">8222e91677f</literal><operator>..</operator><literal type="number">6eee7dbb947</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>BasicDistributedZkTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">404</literal></expr><operator>,</operator><expr><literal type="number">17</literal> <operator>+</operator><literal type="number">404</literal></expr><operator>,</operator><expr><literal type="number">18</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <for>for <control>(<init><decl><type><name>Slice</name></type> <name>slice</name> <range>: <expr><call><name><name>dColl</name><operator>.</operator><name>getActiveSlices</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
       <decl_stmt><decl><type><name>long</name></type> <name>sliceDocCount</name> <init>= <expr><operator>-</operator><literal type="number">1</literal></expr></init></decl>;</decl_stmt>
       <for>for <control>(<init><decl><type><name>Replica</name></type> <name>rep</name> <range>: <expr><call><name><name>slice</name><operator>.</operator><name>getReplicas</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
        <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>one</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>rep</name><operator>.</operator><name>getCoreUrl</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>SolrQuery</name></type> <name>query</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setDistrib</name></name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <decl_stmt><decl><type><name>QueryResponse</name></type> <name>resp</name> <init>= <expr><call><name><name>one</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>query</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>long</name></type> <name>hits</name> <init>= <expr><call><name><name>resp</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>sliceDocCount</name> <operator>==</operator> <operator>-</operator><literal type="number">1</literal></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><name>sliceDocCount</name> <operator>=</operator> <name>hits</name></expr>;</expr_stmt>
          <expr_stmt><expr><name>docTotal</name> <operator>+=</operator> <name>hits</name></expr>;</expr_stmt> 
        </block_content>}</block></if> <else>else <block>{<block_content>
          <if_stmt><if>if <condition>(<expr><name>hits</name> <operator>!=</operator> <name>sliceDocCount</name></expr>)</condition> <block>{<block_content>
            <return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>
        <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>one</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>rep</name><operator>.</operator><name>getCoreUrl</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
          <decl_stmt><decl><type><name>SolrQuery</name></type> <name>query</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setDistrib</name></name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name>QueryResponse</name></type> <name>resp</name> <init>= <expr><call><name><name>one</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>query</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <decl_stmt><decl><type><name>long</name></type> <name>hits</name> <init>= <expr><call><name><name>resp</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
          <if_stmt><if>if <condition>(<expr><name>sliceDocCount</name> <operator>==</operator> <operator>-</operator><literal type="number">1</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>sliceDocCount</name> <operator>=</operator> <name>hits</name></expr>;</expr_stmt>
            <expr_stmt><expr><name>docTotal</name> <operator>+=</operator> <name>hits</name></expr>;</expr_stmt>
          </block_content>}</block></if> <else>else <block>{<block_content>
            <if_stmt><if>if <condition>(<expr><name>hits</name> <operator>!=</operator> <name>sliceDocCount</name></expr>)</condition> <block>{<block_content>
              <return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>
            </block_content>}</block></if></if_stmt>
           </block_content>}</block></else></if_stmt>
         </block_content>}</block></try>
       </block_content>}</block></if></if_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">963</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">964</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
       @<expr><name>Override</name>
       <specifier>public</specifier> <name>Object</name> <call><name>call</name><argument_list>()</argument_list></call> <block>{
         <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>baseUrl</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
          <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <comment type="line">// client.setConnectionTimeout(15000);</comment>
           <decl_stmt><decl><type><name>Create</name></type> <name>createCmd</name> <init>= <expr><operator>new</operator> <call><name>Create</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
           <expr_stmt><expr><call><name><name>createCmd</name><operator>.</operator><name>setRoles</name></name><argument_list>(<argument><expr><literal type="string">"none"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
           <expr_stmt><expr><call><name><name>createCmd</name><operator>.</operator><name>setCoreName</name></name><argument_list>(<argument><expr><name>collection</name> <operator>+</operator> <name>num</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1124</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">1125</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicDistributedZkTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <try>try <block>{<block_content>
       <comment type="line">// setup the server...</comment>
       <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>baseUrl</name> <operator>+</operator> <literal type="string">"/"</literal> <operator>+</operator> <name>collection</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">120000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

       <return>return <expr><name>client</name></expr>;</return>
     <expr_stmt/>}</block_content>
     catch (Exception ex</block></try>)</block> <block>{
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">7dceada1668</literal><operator>..</operator><literal type="number">3ddf99da545</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ChaosMonkeyNothingIsSafeTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">70</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">70</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>ChaosMonkeyNothingIsSafeTest</name> extends <name>AbstractFullDistribZkTestBase</name>
   
   <specifier>protected</specifier> <specifier>static</specifier> <name>final</name> <name><name>String</name><index>[]</index></name> <name>fieldNames</name> <operator>=</operator> <operator>new</operator> <name><name>String</name><index>[]</index></name><block>{<expr><literal type="string">"f_i"</literal></expr>, <expr><literal type="string">"f_f"</literal></expr>, <expr><literal type="string">"f_d"</literal></expr>, <expr><literal type="string">"f_l"</literal></expr>, <expr><literal type="string">"f_dt"</literal></expr>}</block></expr>;
   <specifier>protected</specifier> <specifier>static</specifier> <name>final</name> <name><name>RandVal</name><index>[]</index></name> <name>randVals</name> <operator>=</operator> <operator>new</operator> <name><name>RandVal</name><index>[]</index></name><block>{<expr><name>rint</name></expr>, <expr><name>rfloat</name></expr>, <expr><name>rdouble</name></expr>, <expr><name>rlong</name></expr>, <expr><name>rdate</name></expr>}</block></block></expr>;</expr_stmt>

  <decl_stmt><decl><type><specifier>private</specifier> <name>int</name></type> <name>clientSoTimeout</name></decl>;</decl_stmt>
   
   <function><type><specifier>public</specifier> <name><name>String</name><index>[]</index></name></type> <name>getFieldNames</name><parameter_list>()</parameter_list> <block>{<block_content>
     <return>return <expr><name>fieldNames</name></expr>;</return>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">109</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">111</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ChaosMonkeyNothingIsSafeTest</name> extends <name>AbstractFullDistribZkTestBase</name>
 
   @<name>Test</name>
   <specifier>public</specifier> <name>void</name> <call><name>test</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
    <expr><call><name><name>cloudClient</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>clientSoTimeout</name></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;</expr_stmt>
     <decl_stmt><decl><type><name>boolean</name></type> <name>testSuccessful</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
     <try>try <block>{<block_content>
       <expr_stmt><expr><call><name><name>handle</name><operator>.</operator><name>clear</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">293</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">296</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ChaosMonkeyNothingIsSafeTest</name> extends <name>AbstractFullDistribZkTestBase</name>
       <call><name>setName</name><argument_list>(<argument><expr><literal type="string">"FullThrottleStopableIndexingThread"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name>setDaemon</name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><name><name>this</name><operator>.</operator><name>clients</name></name> <operator>=</operator> <name>clients</name></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>clientConnectionTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>clientSoTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

       <expr_stmt><expr><name>cusc</name> <operator>=</operator> <operator>new</operator> <class><super><name>ConcurrentUpdateSolrClient</name></super><argument_list>(
           <argument><expr><operator>(</operator><operator>(</operator><name>HttpSolrClient</name><operator>)</operator> <call><name><name>clients</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>)</operator><operator>.</operator><call><name>getBaseURL</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>, <argument><expr><literal type="number">8</literal></expr></argument>,
           <argument><expr><literal type="number">2</literal></expr></argument>)</argument_list> <block>{
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">303</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">305</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>ChaosMonkeyNothingIsSafeTest</name> extends <name>AbstractFullDistribZkTestBase</name>
           <call><name><name>log</name><operator>.</operator><name>warn</name></name><argument_list>(<argument><expr><literal type="string">"cusc error"</literal></expr></argument>, <argument><expr><name>ex</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         <expr_stmt/>}</block>
       <expr_stmt/></class></expr></expr_stmt>}</block_content></block><empty_stmt>;</empty_stmt></try>
      <expr_stmt><expr><call><name><name>cusc</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>cusc</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>clientSoTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/>}</block_content>
     
     @Override
diff --git a/solr/core/src/test/org/apache/solr/cloud/CollectionsAPIDistributedZkTest.java b/solr/core/src/test/org/apache/solr/cloud/CollectionsAPIDistributedZkTest.java
index 641dadfc236..5c80f2d691a 100644
-- a/solr/core/src/test/org/apache/solr/cloud/CollectionsAPIDistributedZkTest.java
++ b/solr/core/src/test/org/apache/solr/cloud/CollectionsAPIDistributedZkTest.java
@@ -97</block><operator>,</operator>6 +97<operator>,</operator>7 @@ public class CollectionsAPIDistributedZkTest extends AbstractFullDistribZkTestBa
   @BeforeClass
   public static void beforeCollectionsAPIDistributedZkTest<parameter_list>()</parameter_list> <block>{<block_content>
     <expr_stmt><expr><name><name>TestInjection</name><operator>.</operator><name>randomDelayInCoreCreation</name></name> <operator>=</operator> <literal type="string">"true:20"</literal></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><literal type="string">"validateAfterInactivity"</literal></expr></argument>, <argument><expr><literal type="string">"200"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   <expr_stmt/>}</block_content>
   
   @Override
@@ -1196</block><operator>,</operator>11 +1197<operator>,</operator>12 @@ public class CollectionsAPIDistributedZkTest extends AbstractFullDistribZkTestBa
           null<operator>,</operator> client<operator>,</operator> props</function>)</block_content></block><empty_stmt>;</empty_stmt></try>
       <call><name>assertNotNull</name><argument_list>(<argument><expr><name>newReplica</name></expr></argument>)</argument_list></call></block></expr>;
 
      <name>HttpSolrClient</name> <name>coreclient</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>newReplica</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><name><name>ZkStateReader</name><operator>.</operator><name>BASE_URL_PROP</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>CoreAdminResponse</name></type> <name>status</name> <init>= <expr><call><name><name>CoreAdminRequest</name><operator>.</operator><name>getStatus</name></name><argument_list>(<argument><expr><call><name><name>newReplica</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><literal type="string">"core"</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name>coreclient</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name><name>NamedList</name><argument_list type="generic">&lt;<argument><name>Object</name></argument>&gt;</argument_list></name></type> <name>coreStatus</name> <init>= <expr><call><name><name>status</name><operator>.</operator><name>getCoreStatus</name></name><argument_list>(<argument><expr><call><name><name>newReplica</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><literal type="string">"core"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>String</name></type> <name>instanceDirStr</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>coreStatus</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"instanceDir"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><call><name><name>Paths</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name>instanceDirStr</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>instancePathStr</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>coreclient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>newReplica</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><name><name>ZkStateReader</name><operator>.</operator><name>BASE_URL_PROP</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
        <decl_stmt><decl><type><name>CoreAdminResponse</name></type> <name>status</name> <init>= <expr><call><name><name>CoreAdminRequest</name><operator>.</operator><name>getStatus</name></name><argument_list>(<argument><expr><call><name><name>newReplica</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><literal type="string">"core"</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name>coreclient</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name><name>NamedList</name><argument_list type="generic">&lt;<argument><name>Object</name></argument>&gt;</argument_list></name></type> <name>coreStatus</name> <init>= <expr><call><name><name>status</name><operator>.</operator><name>getCoreStatus</name></name><argument_list>(<argument><expr><call><name><name>newReplica</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><literal type="string">"core"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>String</name></type> <name>instanceDirStr</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>coreStatus</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"instanceDir"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><call><name><name>Paths</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name>instanceDirStr</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>instancePathStr</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></try>
 
       <comment type="line">//Test to make sure we can't create another replica with an existing core_name of that collection</comment>
       <decl_stmt><decl><type><name>String</name></type> <name>coreName</name> <init>= <expr><call><name><name>newReplica</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><name>CORE_NAME_PROP</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>HttpPartitionTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>HttpPartitionTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>f1960aa952e</name><operator>..</operator><literal type="number">9dcbb8c4365</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>HttpPartitionTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>HttpPartitionTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">253</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">253</literal></expr><operator>,</operator><expr><literal type="number">14</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpPartitionTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
 
     <comment type="line">// Check that doc 3 is on the leader but not on the notLeaders</comment>
     <expr><name>Replica</name> <name>leader</name> <operator>=</operator> <call><name><name>cloudClient</name><operator>.</operator><name>getZkStateReader</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getLeaderRetry</name><argument_list>(<argument><expr><name>testCollectionName</name></expr></argument>, <argument><expr><literal type="string">"shard1"</literal></expr></argument>, <argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr>;
    <name>HttpSolrClient</name> <name>leaderSolr</name> <operator>=</operator> <call><name>getHttpSolrClient</name><argument_list>(<argument><expr><name>leader</name></expr></argument>, <argument><expr><name>testCollectionName</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <expr_stmt><expr><call><name>assertDocExists</name><argument_list>(<argument><expr><name>leaderSolr</name></expr></argument>, <argument><expr><name>testCollectionName</name></expr></argument>, <argument><expr><literal type="string">"3"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>leaderSolr</name> <init>= <expr><call><name>getHttpSolrClient</name><argument_list>(<argument><expr><name>leader</name></expr></argument>, <argument><expr><name>testCollectionName</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
      <expr_stmt><expr><call><name>assertDocExists</name><argument_list>(<argument><expr><name>leaderSolr</name></expr></argument>, <argument><expr><name>testCollectionName</name></expr></argument>, <argument><expr><literal type="string">"3"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></try>
 
     <for>for <control>(<init><decl><type><name>Replica</name></type> <name>notLeader</name> <range>: <expr><name>notLeaders</name></expr></range></decl></init>)</control> <block>{<block_content>
      <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>notLeaderSolr</name> <init>= <expr><call><name>getHttpSolrClient</name><argument_list>(<argument><expr><name>notLeader</name></expr></argument>, <argument><expr><name>testCollectionName</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertDocNotExists</name><argument_list>(<argument><expr><name>notLeaderSolr</name></expr></argument>, <argument><expr><name>testCollectionName</name></expr></argument>, <argument><expr><literal type="string">"3"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>notLeaderSolr</name> <init>= <expr><call><name>getHttpSolrClient</name><argument_list>(<argument><expr><name>notLeader</name></expr></argument>, <argument><expr><name>testCollectionName</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
        <expr_stmt><expr><call><name>assertDocNotExists</name><argument_list>(<argument><expr><name>notLeaderSolr</name></expr></argument>, <argument><expr><name>testCollectionName</name></expr></argument>, <argument><expr><literal type="string">"3"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></try>
     </block_content>}</block></for>
 
     <comment type="line">// Retry sending doc 3</comment>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>LeaderFailoverAfterPartitionTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>LeaderFailoverAfterPartitionTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">0436d5e874b</literal><operator>..</operator><literal type="number">9f1abdedc6d</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>LeaderFailoverAfterPartitionTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>LeaderFailoverAfterPartitionTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">21</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">21</literal></expr><operator>,</operator><expr><literal type="number">14</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrTestCaseJ4</name><operator>.</operator><name>SuppressSSL</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettySolrRunner</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>CollectionAdminRequest</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputDocument</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>Replica</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
 <import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>HashSet</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Set</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">170</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">172</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@ <specifier>public</specifier> <name>class</name> <name>LeaderFailoverAfterPartitionTest</name> extends <name>HttpPartitionTest</name> <block>{
             <expr><call><name>printClusterStateInfo</name><argument_list>(<argument><expr><name>testCollectionName</name></expr></argument>)</argument_list></call></expr>,
         <expr><call><name><name>participatingReplicas</name><operator>.</operator><name>size</name></name><argument_list>()</argument_list></call> <operator>&gt;=</operator> <literal type="number">2</literal></expr>)</block></expr>;</expr_stmt>
 
    
    <expr_stmt><expr><call><name>sendDoc</name><argument_list>(<argument><expr><literal type="number">6</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <decl_stmt><decl><type><name>SolrInputDocument</name></type> <name>doc</name> <init>= <expr><operator>new</operator> <call><name>SolrInputDocument</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>doc</name><operator>.</operator><name>addField</name></name><argument_list>(<argument><expr><name>id</name></expr></argument>, <argument><expr><call><name><name>String</name><operator>.</operator><name>valueOf</name></name><argument_list>(<argument><expr><literal type="number">6</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>doc</name><operator>.</operator><name>addField</name></name><argument_list>(<argument><expr><literal type="string">"a_t"</literal></expr></argument>, <argument><expr><literal type="string">"hello"</literal> <operator>+</operator> <literal type="number">6</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name>sendDocsWithRetry</name><argument_list>(<argument><expr><call><name><name>Collections</name><operator>.</operator><name>singletonList</name></name><argument_list>(<argument><expr><name>doc</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><literal type="number">3</literal></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
     <decl_stmt><decl><type><name><name>Set</name><argument_list type="generic">&lt;<argument><name>String</name></argument>&gt;</argument_list></name></type> <name>replicasToCheck</name> <init>= <expr><operator>new</operator> <call><name><name>HashSet</name><argument_list type="generic">&lt;&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
     <for>for <control>(<init><decl><type><name>Replica</name></type> <name>stillUp</name> <range>: <expr><name>participatingReplicas</name></expr></range></decl></init>)</control><block type="pseudo"><block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>SSLMigrationTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>SSLMigrationTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a0bb08f822a</name><operator>..</operator><name>c1b500ca09e</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>SSLMigrationTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>SSLMigrationTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">70</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">70</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>SSLMigrationTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
       <expr><call><name><name>runner</name><operator>.</operator><name>stop</name></name><argument_list>()</argument_list></call></expr>;
     }</block></expr></expr_stmt></block_content></block></for>
     
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConfigurer</name></name><argument_list>(<argument><expr><call><name><name>sslConfig</name><operator>.</operator><name>getHttpClientConfigurer</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setHttpClientBuilder</name></name><argument_list>(<argument><expr><call><name><name>sslConfig</name><operator>.</operator><name>getHttpClientBuilder</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <for>for<control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <call><name><name>this</name><operator>.</operator><name>jettys</name><operator>.</operator><name>size</name></name><argument_list>()</argument_list></call></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
       <decl_stmt><decl><type><name>JettySolrRunner</name></type> <name>runner</name> <init>= <expr><call><name><name>jettys</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name>i</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <decl_stmt><decl><type><name>JettyConfig</name></type> <name>config</name> <init>= <expr><call><name><name>JettyConfig</name><operator>.</operator><name>builder</name></name><argument_list>()</argument_list></call>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ShardSplitTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ShardSplitTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">6d4b9cc3b8f</literal><operator>..</operator><name>c691cf037c2</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ShardSplitTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ShardSplitTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">604</literal></expr></init></decl>,7 +604,6 @@ public <decl><type ref="prev"/><name>class</name> <name>ShardSplitTest</name> extends <name>BasicDistributedZkTest</name> <block>{<block_content>
   <function><annotation>@<name>Override</name></annotation>
   <type><specifier>protected</specifier> <name>CloudSolrClient</name></type> <name>createCloudClient</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>defaultCollection</name></decl></parameter>)</parameter_list> <block>{<block_content>
     <decl_stmt><decl><type><name>CloudSolrClient</name></type> <name>client</name> <init>= <expr><call><name><name>super</name><operator>.</operator><name>createCloudClient</name></name><argument_list>(<argument><expr><name>defaultCollection</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>getLbClient</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHttpClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getParams</name><argument_list>()</argument_list></call><operator>.</operator><call><name>setParameter</name><argument_list>(<argument><expr><name><name>CoreConnectionPNames</name><operator>.</operator><name>SO_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">5</literal> <operator>*</operator> <literal type="number">60</literal> <operator>*</operator> <literal type="number">1000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <return>return <expr><name>client</name></expr>;</return>
   </block_content>}</block></function>
 </block_content>}</block></decl></decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestAuthenticationFramework</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestAuthenticationFramework</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>b9c72643030</name><operator>..</operator><literal type="number">4ee983bca5a</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestAuthenticationFramework</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestAuthenticationFramework</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">26</literal> <operator>+</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">26</literal> @@
  <operator>*</operator><operator>/</operator></expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name></name>;</package>
 
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>

 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>FilterChain</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletRequest</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletResponse</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequest</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletResponse</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>carrotsearch</name><operator>.</operator><name>randomizedtesting</name><operator>.</operator><name>rules</name><operator>.</operator><name>SystemPropertiesRestoreRule</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequestInterceptor</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpContext</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>LuceneTestCase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>LuceneTestCase</name><operator>.</operator><name>SuppressSysoutChecks</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>AuthenticationPlugin</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>HttpClientInterceptorPlugin</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>security</name><operator>.</operator><name>HttpClientBuilderPlugin</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>RevertDefaultThreadHandlerRule</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>ClassRule</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Rule</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">45</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">45</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>rules</name><operator>.</operator><name>TestRule</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<import>import <name><name>com</name><operator>.</operator><name>carrotsearch</name><operator>.</operator><name>randomizedtesting</name><operator>.</operator><name>rules</name><operator>.</operator><name>SystemPropertiesRestoreRule</name></name>;</import>

 <comment type="block" format="javadoc">/**
  * Test of the MiniSolrCloudCluster functionality with authentication enabled.
  */</comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">114</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">116</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestAuthenticationFramework</name> extends <name>TestMiniSolrCloudCluster</name> <block>{
     <expr><call><name><name>super</name><operator>.</operator><name>tearDown</name></name><argument_list>()</argument_list></call></expr>;
   }</block></expr></expr_stmt>
   
  <class><specifier>public</specifier> <specifier>static</specifier> class <name>MockAuthenticationPlugin</name> <super_list><extends>extends <super><name>AuthenticationPlugin</name></super></extends> <implements>implements <super><name>HttpClientInterceptorPlugin</name></super></implements></super_list> <block>{
  <class><specifier>public</specifier> <specifier>static</specifier> class <name>MockAuthenticationPlugin</name> <super_list><extends>extends <super><name>AuthenticationPlugin</name></super></extends> <implements>implements <super><name>HttpClientBuilderPlugin</name></super></implements></super_list> <block>{
     <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <name>String</name></type> <name>expectedUsername</name></decl>;</decl_stmt>
     <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <name>String</name></type> <name>expectedPassword</name></decl>;</decl_stmt>

    <decl_stmt><decl><type><specifier>private</specifier> <name>HttpRequestInterceptor</name></type> <name>interceptor</name></decl>;</decl_stmt>
     <function><annotation>@<name>Override</name></annotation>
     <type><specifier>public</specifier> <name>void</name></type> <name>init</name><parameter_list>(<parameter><decl><type><name><name>Map</name><argument_list type="generic">&lt;<argument><name>String</name></argument>,<argument><name>Object</name></argument>&gt;</argument_list></name></type> <name>pluginConfig</name></decl></parameter>)</parameter_list> <block>{<block_content/>}</block></function>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">141</literal></expr><operator>,</operator><expr><literal type="number">25</literal> <operator>+</operator><literal type="number">143</literal></expr><operator>,</operator><expr><literal type="number">23</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestAuthenticationFramework</name> extends <name>TestMiniSolrCloudCluster</name> <block>{
     }</block>
 
     @<name>Override</name>
    <specifier>public</specifier> <name>HttpClientConfigurer</name> <call><name>getClientConfigurer</name><argument_list>()</argument_list></call> <block>{
      <return>return <expr><operator>new</operator> <call><name>MockClientConfigurer</name><argument_list>()</argument_list></call></expr>;</return>
    <specifier>public</specifier> <name>SolrHttpClientBuilder</name> <call><name>getHttpClientBuilder</name><argument_list>(<argument><expr><name>SolrHttpClientBuilder</name> <name>httpClientBuilder</name></expr></argument>)</argument_list></call> <block>{
      <expr><name>interceptor</name> <operator>=</operator> <operator>new</operator> <class><super><name>HttpRequestInterceptor</name></super><argument_list>()</argument_list> <block>{
        <function><annotation>@<name>Override</name></annotation>
        <type><specifier>public</specifier> <name>void</name></type> <name>process</name><parameter_list>(<parameter><decl><type><name>HttpRequest</name></type> <name>req</name></decl></parameter>, <parameter><decl><type><name>HttpContext</name></type> <name>rsp</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>HttpException</name></expr></argument>, <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>
          <expr_stmt><expr><call><name><name>req</name><operator>.</operator><name>addHeader</name></name><argument_list>(<argument><expr><literal type="string">"username"</literal></expr></argument>, <argument><expr><name>requestUsername</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>req</name><operator>.</operator><name>addHeader</name></name><argument_list>(<argument><expr><literal type="string">"password"</literal></expr></argument>, <argument><expr><name>requestPassword</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt/>}</block_content>
      }</block>;</function>

      <constructor_decl><name><name>HttpClientUtil</name><operator>.</operator><name>addRequestInterceptor</name></name><parameter_list>(<parameter><decl><type><name>interceptor</name></type></decl></parameter>)</parameter_list>;</constructor_decl>
      <return>return <expr><name>httpClientBuilder</name></expr>;</return>
     <expr_stmt/>}</block>
 
     <function><annotation>@<name>Override</name></annotation>
    <type><specifier>public</specifier> <name>void</name></type> <name>close</name><parameter_list>()</parameter_list> <block>{<block_content><expr_stmt/>}</block_content>
    
    private static class MockClientConfigurer extends HttpClientConfigurer <block>{<block_content>
      <function><annotation>@<name>Override</name></annotation>
      <type><specifier>public</specifier> <name>void</name></type> <name>configure</name><parameter_list>(<parameter><decl><type><name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>SolrParams</name></type> <name>config</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name><name>super</name><operator>.</operator><name>configure</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>addRequestInterceptor</name></name><argument_list>(<argument><expr><operator>new</operator> <class><super><name>HttpRequestInterceptor</name></super><argument_list>()</argument_list> <block>{
          <function><annotation>@<name>Override</name></annotation>
          <type><specifier>public</specifier> <name>void</name></type> <name>process</name><parameter_list>(<parameter><decl><type><name>HttpRequest</name></type> <name>req</name></decl></parameter>, <parameter><decl><type><name>HttpContext</name></type> <name>rsp</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>HttpException</name></expr></argument>, <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>
            <expr_stmt><expr><call><name><name>req</name><operator>.</operator><name>addHeader</name></name><argument_list>(<argument><expr><literal type="string">"username"</literal></expr></argument>, <argument><expr><name>requestUsername</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>req</name><operator>.</operator><name>addHeader</name></name><argument_list>(<argument><expr><literal type="string">"password"</literal></expr></argument>, <argument><expr><name>requestPassword</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt/>}</block_content>
        }</block></function>)</block><empty_stmt>;</empty_stmt></class></expr></argument></argument_list></call></expr></expr_stmt>
      <expr_stmt/>}</block_content>
    public void close(</block></function>)</block_content> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>removeRequestInterceptor</name></name><argument_list>(<argument><expr><name>interceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/>}</block_content>
    
   }
 }
diff --git a/solr/core/src/test/org/apache/solr/cloud/TestCloudDeleteByQuery.java b/solr/core/src/test/org/apache/solr/cloud/TestCloudDeleteByQuery.java
index 27818966c03..26db949e5c3 100644
-- a/solr/core/src/test/org/apache/solr/cloud/TestCloudDeleteByQuery.java
++ b/solr/core/src/test/org/apache/solr/cloud/TestCloudDeleteByQuery.java
@@ -48</block></block></block><operator>,</operator>7 +48<operator>,</operator>7 @@ import org.apache.solr.common.cloud.ZkStateReader;</function></class></expr></block></block></expr></expr_stmt>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>SimpleOrderedMap</name></name>;</import>

<import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>AfterClass</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Before</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>BeforeClass</name></name>;</import>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">89</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">89</literal></expr><operator>,</operator><expr><literal type="number">16</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestCloudDeleteByQuery</name> extends <name>SolrCloudTestCase</name> <block>{
   <comment type="block" format="javadoc">/** id field doc routing prefix for shard2 */</comment>
   <expr><specifier>private</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>S_TWO_PRE</name> <operator>=</operator> <literal type="string">"XYZ!"</literal></expr>;
   
  @<name>AfterClass</name>
  <specifier>private</specifier> <specifier>static</specifier> <name>void</name> <call><name>afterClass</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
    <expr><call><name><name>CLOUD_CLIENT</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr></block></expr></argument></throws></block></expr>;</expr_stmt>
    <constructor_decl><name><name>S_ONE_LEADER_CLIENT</name><operator>.</operator><name>close</name></name><parameter_list>()</parameter_list>;</constructor_decl>
    <constructor_decl><name><name>S_TWO_LEADER_CLIENT</name><operator>.</operator><name>close</name></name><parameter_list>()</parameter_list>;</constructor_decl>
    <constructor_decl><name><name>S_ONE_NON_LEADER_CLIENT</name><operator>.</operator><name>close</name></name><parameter_list>()</parameter_list>;</constructor_decl>
    <constructor_decl><name><name>S_TWO_NON_LEADER_CLIENT</name><operator>.</operator><name>close</name></name><parameter_list>()</parameter_list>;</constructor_decl>
    <constructor_decl><name><name>NO_COLLECTION_CLIENT</name><operator>.</operator><name>close</name></name><parameter_list>()</parameter_list>;</constructor_decl>
  }</block></class>
  
   <function><annotation>@<name>BeforeClass</name></annotation>
   <type><specifier>private</specifier> <specifier>static</specifier> <name>void</name></type> <name>createMiniSolrCloudCluster</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
     
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestMiniSolrCloudClusterBase</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestMiniSolrCloudClusterBase</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">18285617d9a</literal><operator>..</operator><literal type="number">33fa43b1588</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestMiniSolrCloudClusterBase</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestMiniSolrCloudClusterBase</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">63</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">63</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestMiniSolrCloudClusterBase</name> extends <name>LuceneTestCase</name> <block>{
     <expr><name>NUM_SHARDS</name> <operator>=</operator> <literal type="number">2</literal></expr>;
     <name>REPLICATION_FACTOR</name> <operator>=</operator> <literal type="number">2</literal></block></expr>;</expr_stmt>
   </block_content>}</block></function>

  
   <decl_stmt><decl><annotation>@<name>Rule</name></annotation>
   <type><specifier>public</specifier> <name>TestRule</name></type> <name>solrTestRules</name> <init>= <expr><call><name><name>RuleChain</name>
       <operator>.</operator><name>outerRule</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SystemPropertiesRestoreRule</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestRandomRequestDistribution</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestRandomRequestDistribution</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">256774d08c3</literal><operator>..</operator><name>d0c2da47f10</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestRandomRequestDistribution</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestRandomRequestDistribution</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">96</literal></expr><operator>,</operator><expr><literal type="number">13</literal> <operator>+</operator><literal type="number">96</literal></expr><operator>,</operator><expr><literal type="number">14</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestRandomRequestDistribution</name> extends <name>AbstractFullDistribZkTestBase</name>
     <call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><call><name><name>replicas</name><operator>.</operator><name>size</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <decl_stmt><decl><type><name>String</name></type> <name>baseUrl</name> <init>= <expr><call><name><name>replicas</name><operator>.</operator><name>iterator</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>next</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStr</name><argument_list>(<argument><expr><name><name>ZkStateReader</name><operator>.</operator><name>BASE_URL_PROP</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <if_stmt><if>if <condition>(<expr><operator>!</operator><call><name><name>baseUrl</name><operator>.</operator><name>endsWith</name></name><argument_list>(<argument><expr><literal type="string">"/"</literal></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><name>baseUrl</name> <operator>+=</operator> <literal type="string">"/"</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>
    <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>baseUrl</name> <operator>+</operator> <literal type="string">"a1x2"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">5000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">2000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>baseUrl</name> <operator>+</operator> <literal type="string">"a1x2"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">5000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">2000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
    <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Making requests to "</literal> <operator>+</operator> <name>baseUrl</name> <operator>+</operator> <literal type="string">"a1x2"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name><init>=<expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <literal type="number">10</literal></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control>  <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Making requests to "</literal> <operator>+</operator> <name>baseUrl</name> <operator>+</operator> <literal type="string">"a1x2"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <literal type="number">10</literal></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></for>
     </block_content>}</block></for>
 
     <decl_stmt><decl><type><name><name>Map</name><argument_list type="generic">&lt;<argument><name>String</name></argument>, <argument><name>Integer</name></argument>&gt;</argument_list></name></type> <name>shardVsCount</name> <init>= <expr><operator>new</operator> <call><name><name>HashMap</name><argument_list type="generic">&lt;&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">173</literal></expr><operator>,</operator><expr><literal type="number">58</literal> <operator>+</operator><literal type="number">174</literal></expr><operator>,</operator><expr><literal type="number">59</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestRandomRequestDistribution</name> extends <name>AbstractFullDistribZkTestBase</name></expr></expr_stmt>
     <if_stmt><if>if <condition>(<expr><operator>!</operator><call><name><name>baseUrl</name><operator>.</operator><name>endsWith</name></name><argument_list>(<argument><expr><literal type="string">"/"</literal></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><name>baseUrl</name> <operator>+=</operator> <literal type="string">"/"</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>
     <decl_stmt><decl><type><name>String</name></type> <name>path</name> <init>= <expr><name>baseUrl</name> <operator>+</operator> <literal type="string">"football"</literal></expr></init></decl>;</decl_stmt>
     <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Firing queries against path="</literal> <operator>+</operator> <name>path</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>path</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">5000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">2000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <decl_stmt><decl><type><name>SolrCore</name></type> <name>leaderCore</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
    <for>for <control>(<init><decl><type><name>JettySolrRunner</name></type> <name>jetty</name> <range>: <expr><name>jettys</name></expr></range></decl></init>)</control> <block>{<block_content>
      <decl_stmt><decl><type><name>CoreContainer</name></type> <name>container</name> <init>= <expr><call><name><name>jetty</name><operator>.</operator><name>getCoreContainer</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <for>for <control>(<init><decl><type><name>SolrCore</name></type> <name>core</name> <range>: <expr><call><name><name>container</name><operator>.</operator><name>getCores</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
        <if_stmt><if>if <condition>(<expr><call><name><name>core</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>equals</name><argument_list>(<argument><expr><call><name><name>leader</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><name><name>ZkStateReader</name><operator>.</operator><name>CORE_NAME_PROP</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><name>leaderCore</name> <operator>=</operator> <name>core</name></expr>;</expr_stmt>
          <break>break;</break>
    <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>path</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">5000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">2000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <decl_stmt><decl><type><name>SolrCore</name></type> <name>leaderCore</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
      <for>for <control>(<init><decl><type><name>JettySolrRunner</name></type> <name>jetty</name> <range>: <expr><name>jettys</name></expr></range></decl></init>)</control> <block>{<block_content>
        <decl_stmt><decl><type><name>CoreContainer</name></type> <name>container</name> <init>= <expr><call><name><name>jetty</name><operator>.</operator><name>getCoreContainer</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <for>for <control>(<init><decl><type><name>SolrCore</name></type> <name>core</name> <range>: <expr><call><name><name>container</name><operator>.</operator><name>getCores</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
          <if_stmt><if>if <condition>(<expr><call><name><name>core</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>equals</name><argument_list>(<argument><expr><call><name><name>leader</name><operator>.</operator><name>getStr</name></name><argument_list>(<argument><expr><name><name>ZkStateReader</name><operator>.</operator><name>CORE_NAME_PROP</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>leaderCore</name> <operator>=</operator> <name>core</name></expr>;</expr_stmt>
            <break>break;</break>
          </block_content>}</block></if></if_stmt>
         </block_content>}</block></for>
       </block_content>}</block></for>
    </block_content>}</block></try>
    <expr_stmt><expr><call><name>assertNotNull</name><argument_list>(<argument><expr><name>leaderCore</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <comment type="line">//All queries should be served by the active replica</comment>
    <comment type="line">//To make sure that's true we keep querying the down replica</comment>
    <comment type="line">//If queries are getting processed by the down replica then the cluster state hasn't updated for that replica locally</comment>
    <comment type="line">//So we keep trying till it has updated and then verify if ALL queries go to the active reploca</comment>
    <decl_stmt><decl><type><name>long</name></type> <name>count</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>
    <while>while <condition>(<expr><literal type="boolean">true</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><name>count</name><operator>++</operator></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <decl_stmt><decl><type><name>SolrRequestHandler</name></type> <name>select</name> <init>= <expr><call><name><name>leaderCore</name><operator>.</operator><name>getRequestHandler</name></name><argument_list>(<argument><expr><literal type="string">""</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>long</name></type> <name>c</name> <init>= <expr><operator>(</operator><name>long</name><operator>)</operator> <call><name><name>select</name><operator>.</operator><name>getStatistics</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"requests"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

      <if_stmt><if>if <condition>(<expr><name>c</name> <operator>==</operator> <literal type="number">1</literal></expr>)</condition> <block>{<block_content>
        <break>break;</break>  <comment type="line">//cluster state has got update locally</comment>
      </block_content>}</block></if> <else>else <block>{<block_content>
        <expr_stmt><expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></else></if_stmt>
      <expr_stmt><expr><call><name>assertNotNull</name><argument_list>(<argument><expr><name>leaderCore</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <comment type="line">// All queries should be served by the active replica</comment>
      <comment type="line">// To make sure that's true we keep querying the down replica</comment>
      <comment type="line">// If queries are getting processed by the down replica then the cluster state hasn't updated for that replica</comment>
      <comment type="line">// locally</comment>
      <comment type="line">// So we keep trying till it has updated and then verify if ALL queries go to the active reploca</comment>
      <decl_stmt><decl><type><name>long</name></type> <name>count</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>
      <while>while <condition>(<expr><literal type="boolean">true</literal></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><name>count</name><operator>++</operator></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <decl_stmt><decl><type><name>SolrRequestHandler</name></type> <name>select</name> <init>= <expr><call><name><name>leaderCore</name><operator>.</operator><name>getRequestHandler</name></name><argument_list>(<argument><expr><literal type="string">""</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>long</name></type> <name>c</name> <init>= <expr><operator>(</operator><name>long</name><operator>)</operator> <call><name><name>select</name><operator>.</operator><name>getStatistics</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"requests"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
      <if_stmt><if>if <condition>(<expr><name>count</name> <operator>&gt;</operator> <literal type="number">10000</literal></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"After 10k queries we still see all requests being processed by the down replica"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <if_stmt><if>if <condition>(<expr><name>c</name> <operator>==</operator> <literal type="number">1</literal></expr>)</condition> <block>{<block_content>
          <break>break;</break> <comment type="line">// cluster state has got update locally</comment>
        </block_content>}</block></if> <else>else <block>{<block_content>
          <expr_stmt><expr><call><name><name>Thread</name><operator>.</operator><name>sleep</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></else></if_stmt>

        <if_stmt><if>if <condition>(<expr><name>count</name> <operator>&gt;</operator> <literal type="number">10000</literal></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"After 10k queries we still see all requests being processed by the down replica"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
       </block_content>}</block></if></if_stmt>
    </block_content>}</block></while>
 
    <comment type="line">//Now we fire a few additional queries and make sure ALL of them</comment>
    <comment type="line">//are served by the active replica</comment>
    <decl_stmt><decl><type><name>int</name></type> <name>moreQueries</name> <init>= <expr><call><name><name>TestUtil</name><operator>.</operator><name>nextInt</name></name><argument_list>(<argument><expr><call><name>random</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="number">4</literal></expr></argument>, <argument><expr><literal type="number">10</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><name>count</name> <operator>=</operator> <literal type="number">1</literal></expr>;</expr_stmt> <comment type="line">//Since 1 query has already hit the leader</comment>
    <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name><init>=<expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name><operator>&lt;</operator><name>moreQueries</name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>count</name><operator>++</operator></expr>;</expr_stmt>
      <comment type="line">// Now we fire a few additional queries and make sure ALL of them</comment>
      <comment type="line">// are served by the active replica</comment>
      <decl_stmt><decl><type><name>int</name></type> <name>moreQueries</name> <init>= <expr><call><name><name>TestUtil</name><operator>.</operator><name>nextInt</name></name><argument_list>(<argument><expr><call><name>random</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="number">4</literal></expr></argument>, <argument><expr><literal type="number">10</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><name>count</name> <operator>=</operator> <literal type="number">1</literal></expr>;</expr_stmt> <comment type="line">// Since 1 query has already hit the leader</comment>
      <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <name>moreQueries</name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name>count</name><operator>++</operator></expr>;</expr_stmt>
 
      <decl_stmt><decl><type><name>SolrRequestHandler</name></type> <name>select</name> <init>= <expr><call><name><name>leaderCore</name><operator>.</operator><name>getRequestHandler</name></name><argument_list>(<argument><expr><literal type="string">""</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>long</name></type> <name>c</name> <init>= <expr><operator>(</operator><name>long</name><operator>)</operator> <call><name><name>select</name><operator>.</operator><name>getStatistics</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"requests"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>SolrRequestHandler</name></type> <name>select</name> <init>= <expr><call><name><name>leaderCore</name><operator>.</operator><name>getRequestHandler</name></name><argument_list>(<argument><expr><literal type="string">""</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>long</name></type> <name>c</name> <init>= <expr><operator>(</operator><name>long</name><operator>)</operator> <call><name><name>select</name><operator>.</operator><name>getStatistics</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"requests"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Query wasn't served by leader"</literal></expr></argument>, <argument><expr><name>count</name></expr></argument>, <argument><expr><name>c</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Query wasn't served by leader"</literal></expr></argument>, <argument><expr><name>count</name></expr></argument>, <argument><expr><name>c</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></for>
     </block_content>}</block></for>

   </block_content>}</block></while>
 </block_content>}</block></if></if_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestSolrCloudWithKerberosAlt</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestSolrCloudWithKerberosAlt</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>f4dc97de95b</name><operator>..</operator><literal type="number">1e2b2428f24</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestSolrCloudWithKerberosAlt</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>TestSolrCloudWithKerberosAlt</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@
  <operator>*</operator><operator>/</operator></expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name></name>;</package>
 
<import>import <name><name>javax</name><operator>.</operator><name>security</name><operator>.</operator><name>auth</name><operator>.</operator><name>login</name><operator>.</operator><name>Configuration</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>File</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Locale</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Properties</name></name>;</import>
 
<import>import <name><name>com</name><operator>.</operator><name>carrotsearch</name><operator>.</operator><name>randomizedtesting</name><operator>.</operator><name>annotations</name><operator>.</operator><name>ThreadLeakFilters</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>carrotsearch</name><operator>.</operator><name>randomizedtesting</name><operator>.</operator><name>rules</name><operator>.</operator><name>SystemPropertiesRestoreRule</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>security</name><operator>.</operator><name>auth</name><operator>.</operator><name>login</name><operator>.</operator><name>Configuration</name></name>;</import>
 
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>commons</name><operator>.</operator><name>io</name><operator>.</operator><name>FileUtils</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>hadoop</name><operator>.</operator><name>minikdc</name><operator>.</operator><name>MiniKdc</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">36</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">33</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrQuery</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettyConfig</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettySolrRunner</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>CloudSolrClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>Krb5HttpClientConfigurer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>CollectionAdminRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>QueryResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputDocument</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">54</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">49</literal></expr><operator>,</operator><expr><literal type="number">9</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>rules</name><operator>.</operator><name>RuleChain</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>rules</name><operator>.</operator><name>TestRule</name></name>;</import>
 
<import>import <name><name>com</name><operator>.</operator><name>carrotsearch</name><operator>.</operator><name>randomizedtesting</name><operator>.</operator><name>annotations</name><operator>.</operator><name>ThreadLeakFilters</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>carrotsearch</name><operator>.</operator><name>randomizedtesting</name><operator>.</operator><name>rules</name><operator>.</operator><name>SystemPropertiesRestoreRule</name></name>;</import>

 <comment type="block" format="javadoc">/**
  * Test 5 nodes Solr cluster with Kerberos plugin enabled.
  * This test is Ignored right now as Mini KDC has a known bug that
@@ -82,6 +80,7 @@ public class TestSolrCloudWithKerberosAlt extends LuceneTestCase {
   private MiniKdc kdc;
 
   private Locale savedLocale; // in case locale is broken and we need to fill in a working locale
  
   @Rule
   public TestRule solrTestRules = RuleChain
       .outerRule(new SystemPropertiesRestoreRule());
@@ -101,7 +100,6 @@ public class TestSolrCloudWithKerberosAlt extends LuceneTestCase {
     savedLocale = KerberosTestUtil.overrideLocaleIfNotSpportedByMiniKdc();
     super.setUp();
     setupMiniKdc();
    HttpClientUtil.setConfigurer(new Krb5HttpClientConfigurer());
   }
 
   private void setupMiniKdc() throws Exception {
@@ -157,7 +155,6 @@ public class TestSolrCloudWithKerberosAlt extends LuceneTestCase {
   }
 
   protected void testCollectionCreateSearchDelete() throws Exception {
    HttpClientUtil.setConfigurer(new Krb5HttpClientConfigurer());
     String collectionName = "testkerberoscollection";
 
     MiniSolrCloudCluster miniCluster
diff --git a/solr/core/src/test/org/apache/solr/cloud/TestTolerantUpdateProcessorCloud.java b/solr/core/src/test/org/apache/solr/cloud/TestTolerantUpdateProcessorCloud.java
index 054c0745fd4..929d736d79f 100644
-- a/solr/core/src/test/org/apache/solr/cloud/TestTolerantUpdateProcessorCloud.java
++ b/solr/core/src/test/org/apache/solr/cloud/TestTolerantUpdateProcessorCloud.java
@@ -17,6 +17,7 @@
 package org.apache.solr.cloud;
 
 import java.io.File;
import java.io.IOException;
 import java.lang.invoke.MethodHandles;
 import java.net.URL;
 import java.util.ArrayList;
@@ -49,7 +50,6 @@ import org.apache.solr.common.params.ModifiableSolrParams;
 import org.apache.solr.common.params.SolrParams;
 import org.apache.solr.common.util.NamedList;
 import org.apache.solr.common.util.SimpleOrderedMap;
import org.apache.solr.util.RevertDefaultThreadHandlerRule;
 
 import org.junit.AfterClass;
 import org.junit.Before;
@@ -204,6 +204,21 @@ public class TestTolerantUpdateProcessorCloud extends SolrCloudTestCase {
     }
   }
   
  @AfterClass
  public static void afterClass() throws IOException {
   close(S_ONE_LEADER_CLIENT);
   close(S_TWO_LEADER_CLIENT);
   close(S_ONE_NON_LEADER_CLIENT);
   close(S_TWO_NON_LEADER_CLIENT);
   close(NO_COLLECTION_CLIENT);
  }
  
  private static void close(SolrClient client) throws IOException {
    if (client != null) {
      client.close();
    }
  }
  
   @Before
   private void clearCollection() throws Exception {
     assertEquals(0, CLOUD_CLIENT.deleteByQuery("*:*").getStatus());
diff --git a/solr/core/src/test/org/apache/solr/cloud/TestTolerantUpdateProcessorRandomCloud.java b/solr/core/src/test/org/apache/solr/cloud/TestTolerantUpdateProcessorRandomCloud.java
index b3f0423c999..a722ad2cdb0 100644
-- a/solr/core/src/test/org/apache/solr/cloud/TestTolerantUpdateProcessorRandomCloud.java
++ b/solr/core/src/test/org/apache/solr/cloud/TestTolerantUpdateProcessorRandomCloud.java
@@ -16,59 +16,43 @@
  */</comment>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name></name>;</package>
 
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>addErr</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>assertUpdateTolerantErrors</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>delIErr</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>delQErr</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>f</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>update</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CursorMarkParams</name><operator>.</operator><name>CURSOR_MARK_PARAM</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CursorMarkParams</name><operator>.</operator><name>CURSOR_MARK_START</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>File</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>URL</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>ArrayList</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Arrays</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>BitSet</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>HashMap</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>LinkedHashSet</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Random</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Set</name></name>;</import>
 
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>TestUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>SolrCloudTestCase</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>assertUpdateTolerantErrors</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>addErr</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>delIErr</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>delQErr</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>f</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>update</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>ExpectedErr</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettySolrRunner</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>CloudSolrClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>UpdateRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>QueryResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>UpdateResponse</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CursorMarkParams</name><operator>.</operator><name>CURSOR_MARK_PARAM</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CursorMarkParams</name><operator>.</operator><name>CURSOR_MARK_NEXT</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CursorMarkParams</name><operator>.</operator><name>CURSOR_MARK_START</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>TestTolerantUpdateProcessorCloud</name><operator>.</operator><name>ExpectedErr</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrDocument</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrDocumentList</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputDocument</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputField</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>ToleratedUpdateError</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>ToleratedUpdateError</name><operator>.</operator><name>CmdType</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ClusterState</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>Replica</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>Slice</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkStateReader</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>NamedList</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>SimpleOrderedMap</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>RevertDefaultThreadHandlerRule</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>AfterClass</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Before</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>BeforeClass</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">92</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">76</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestTolerantUpdateProcessorRandomCloud</name> extends <name>SolrCloudTestCase</name> <block>{
   <comment type="block" format="javadoc">/** A basic client for operations at the cloud level, default collection will be set */</comment>
   <expr><specifier>private</specifier> <specifier>static</specifier> <name>CloudSolrClient</name> <name>CLOUD_CLIENT</name></expr>;
   <comment type="block" format="javadoc">/** one HttpSolrClient for each server */</comment>
  <specifier>private</specifier> <specifier>static</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>SolrClient</name></argument>&gt;</argument_list></name> <name>NODE_CLIENTS</name></block></expr>;</expr_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>HttpSolrClient</name></argument>&gt;</argument_list></name></type> <name>NODE_CLIENTS</name></decl>;</decl_stmt>
 
   <function><annotation>@<name>BeforeClass</name></annotation>
   <type><specifier>private</specifier> <specifier>static</specifier> <name>void</name></type> <name>createMiniSolrCloudCluster</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">123</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">107</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestTolerantUpdateProcessorRandomCloud</name> extends <name>SolrCloudTestCase</name> <block>{
     <expr><name>CLOUD_CLIENT</name> <operator>=</operator> <call><name><name>cluster</name><operator>.</operator><name>getSolrClient</name></name><argument_list>()</argument_list></call></expr>;
     <call><name><name>CLOUD_CLIENT</name><operator>.</operator><name>setDefaultCollection</name></name><argument_list>(<argument><expr><name>COLLECTION_NAME</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
 
    <expr_stmt><expr><name>NODE_CLIENTS</name> <operator>=</operator> <operator>new</operator> <call><name><name>ArrayList</name><argument_list type="generic">&lt;<argument><name>SolrClient</name></argument>&gt;</argument_list></name><argument_list>(<argument><expr><name>numServers</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <if_stmt><if>if <condition>(<expr><name>NODE_CLIENTS</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <for>for <control>(<init><decl><type><name>HttpSolrClient</name></type> <name>client</name> <range>: <expr><name>NODE_CLIENTS</name></expr></range></decl></init>)</control> <block>{<block_content>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></for>
    </block_content>}</block></if></if_stmt>
    <expr_stmt><expr><name>NODE_CLIENTS</name> <operator>=</operator> <operator>new</operator> <call><name><name>ArrayList</name><argument_list type="generic">&lt;<argument><name>HttpSolrClient</name></argument>&gt;</argument_list></name><argument_list>(<argument><expr><name>numServers</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     
     <for>for <control>(<init><decl><type><name>JettySolrRunner</name></type> <name>jetty</name> <range>: <expr><call><name><name>cluster</name><operator>.</operator><name>getJettySolrRunners</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
       <decl_stmt><decl><type><name>URL</name></type> <name>jettyURL</name> <init>= <expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">142</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">131</literal></expr><operator>,</operator><expr><literal type="number">15</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestTolerantUpdateProcessorRandomCloud</name> extends <name>SolrCloudTestCase</name> <block>{
     <expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"index should be empty"</literal></expr></argument>, <argument><expr><literal type="number">0L</literal></expr></argument>, <argument><expr><call><name>countDocs</name><argument_list>(<argument><expr><name>CLOUD_CLIENT</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
   }</block></expr></expr_stmt>
   
  <function><annotation>@<name>AfterClass</name></annotation>
  <type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>afterClass</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>NODE_CLIENTS</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <for>for <control>(<init><decl><type><name>HttpSolrClient</name></type> <name>client</name> <range>: <expr><name>NODE_CLIENTS</name></expr></range></decl></init>)</control> <block>{<block_content>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></for>
    </block_content>}</block></if></if_stmt>
  </block_content>}</block></function>
  
   <function><type><specifier>public</specifier> <name>void</name></type> <name>testRandomUpdates</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
     <decl_stmt><decl><type><specifier>final</specifier> <name>int</name></type> <name>maxDocId</name> <init>= <expr><call><name>atLeast</name><argument_list>(<argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <decl_stmt><decl><type><specifier>final</specifier> <name>BitSet</name></type> <name>expectedDocIds</name> <init>= <expr><operator>new</operator> <call><name>BitSet</name><argument_list>(<argument><expr><name>maxDocId</name><operator>+</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">7b293ca5ea6</literal><operator>..</operator><literal type="number">912369787a0</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>ZkControllerTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">326</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">326</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ZkControllerTest</name> extends <name>SolrTestCaseJ4</name> <block>{
   }</block>
 
   <specifier>private</specifier> <specifier>static</specifier> <name>class</name> <name>MockCoreContainer</name> extends <name>CoreContainer</name> <block>{

    <expr><name>UpdateShardHandler</name> <name>updateShardHandler</name> <operator>=</operator> <operator>new</operator> <call><name>UpdateShardHandler</name><argument_list>(<argument><expr><name><name>UpdateShardHandlerConfig</name><operator>.</operator><name>DEFAULT</name></name></expr></argument>)</argument_list></call></expr>;
     <specifier>public</specifier> <call><name>MockCoreContainer</name><argument_list>()</argument_list></call> <block>{
       <expr><call><name>super</name><argument_list>(<argument><expr><operator>(</operator><name>Object</name><operator>)</operator><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;
       <name><name>this</name><operator>.</operator><name>shardHandlerFactory</name></name> <operator>=</operator> <operator>new</operator> <call><name>HttpShardHandlerFactory</name><argument_list>()</argument_list></call></block></block></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">338</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">338</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> <name>class</name> <name>ZkControllerTest</name> extends <name>SolrTestCaseJ4</name> <block>{
     
     @<expr><name>Override</name>
     <specifier>public</specifier> <name>UpdateShardHandler</name> <call><name>getUpdateShardHandler</name><argument_list>()</argument_list></call> <block>{
      <return>return <expr><operator>new</operator> <call><name>UpdateShardHandler</name><argument_list>(<argument><expr><name><name>UpdateShardHandlerConfig</name><operator>.</operator><name>DEFAULT</name></name></expr></argument>)</argument_list></call></expr>;</return></block></expr>
      <return>return <expr><name>updateShardHandler</name></expr>;</return>
    }</block></expr></expr_stmt>
    
    <function><annotation>@<name>Override</name></annotation>
    <type><specifier>public</specifier> <name>void</name></type> <name>shutdown</name><parameter_list>()</parameter_list> <block>{<block_content>
      <expr_stmt><expr><call><name><name>updateShardHandler</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></function>
 
   </block_content>}</block></function>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name>overseer</name><operator>/</operator><name><name>ZkStateReaderTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name>overseer</name><operator>/</operator><name><name>ZkStateReaderTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">10cc46c5165</literal><operator>..</operator><literal type="number">3c45e2327e1</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name>overseer</name><operator>/</operator><name><name>ZkStateReaderTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name>overseer</name><operator>/</operator><name><name>ZkStateReaderTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>Slice</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>SolrZkClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkStateReader</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>Utils</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>zookeeper</name><operator>.</operator><name>KeeperException</name></name>;</import>
 
 <class><specifier>public</specifier> class <name>ZkStateReaderTest</name> <super_list><extends>extends <super><name>SolrTestCaseJ4</name></super></extends></super_list> <block>{
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">96</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">95</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ZkStateReaderTest</name> extends <name>SolrTestCaseJ4</name> <block>{
         <if_stmt><if>if <condition>(<expr><name>explicitRefresh</name></expr>)</condition> <block>{<block_content>
           <expr_stmt><expr><call><name><name>reader</name><operator>.</operator><name>forceUpdateCollection</name></name><argument_list>(<argument><expr><literal type="string">"c1"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         </block_content>}</block></if> <else>else <block>{<block_content>
          <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <literal type="number">100</literal></expr>;</condition> <incr><expr><operator>++</operator><name>i</name></expr></incr>)</control> <block>{<block_content>
          <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <literal type="number">500</literal></expr>;</condition> <incr><expr><operator>++</operator><name>i</name></expr></incr>)</control> <block>{<block_content>
             <if_stmt><if>if <condition>(<expr><call><name><name>reader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>hasCollection</name><argument_list>(<argument><expr><literal type="string">"c1"</literal></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
               <break>break;</break>
             </block_content>}</block></if></if_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">124</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">123</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ZkStateReaderTest</name> extends <name>SolrTestCaseJ4</name> <block>{
         <if_stmt><if>if <condition>(<expr><name>explicitRefresh</name></expr>)</condition> <block>{<block_content>
           <expr_stmt><expr><call><name><name>reader</name><operator>.</operator><name>forceUpdateCollection</name></name><argument_list>(<argument><expr><literal type="string">"c1"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         </block_content>}</block></if> <else>else <block>{<block_content>
          <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <literal type="number">100</literal></expr>;</condition> <incr><expr><operator>++</operator><name>i</name></expr></incr>)</control> <block>{<block_content>
          <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <literal type="number">500</literal></expr>;</condition> <incr><expr><operator>++</operator><name>i</name></expr></incr>)</control> <block>{<block_content>
             <if_stmt><if>if <condition>(<expr><call><name><name>reader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCollection</name><argument_list>(<argument><expr><literal type="string">"c1"</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>getStateFormat</name><argument_list>()</argument_list></call> <operator>==</operator> <literal type="number">2</literal></expr>)</condition> <block>{<block_content>
               <break>break;</break>
             </block_content>}</block></if></if_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>OpenCloseCoreStressTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>OpenCloseCoreStressTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">7875b7c6c13</literal><operator>..</operator><literal type="number">71f3ee9820e</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>OpenCloseCoreStressTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>OpenCloseCoreStressTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">149</literal></expr><operator>,</operator><expr><literal type="number">14</literal> <operator>+</operator><literal type="number">149</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> <name>class</name> <name>OpenCloseCoreStressTest</name> extends <name>SolrTestCaseJ4</name> <block>{
 
     <for>for <control>(<init><decl><type><name>int</name></type> <name>idx</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>idx</name> <operator>&lt;</operator> <name>indexingThreads</name></expr>;</condition> <incr><expr><operator>++</operator><name>idx</name></expr></incr>)</control> <block>{<block_content>
       <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">25</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>indexingClients</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></for></block></expr></expr_stmt>
     <for>for <control>(<init><decl><type><name>int</name></type> <name>idx</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>idx</name> <operator>&lt;</operator> <name>queryThreads</name></expr>;</condition> <incr><expr><operator>++</operator><name>idx</name></expr></incr>)</control> <block>{<block_content>
       <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">25</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">30000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>queryingClients</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>TestCoreContainer</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>TestCoreContainer</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">44f9e5c3c14</literal><operator>..</operator><name>d23b8b14714</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>TestCoreContainer</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name><name>TestCoreContainer</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">336</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">336</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestCoreContainer</name> extends <name>SolrTestCaseJ4</name> <block>{
 
     <expr><name>CoreContainer</name> <name>cc</name> <operator>=</operator> <call><name>init</name><argument_list>(<argument><expr><name>CUSTOM_HANDLERS_SOLR_XML</name></expr></argument>)</argument_list></call></expr>;</block></expr></expr_stmt>
     <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>cc</name><operator>.</operator><name>load</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name>assertThat</name><argument_list>(<argument><expr><call><name><name>cc</name><operator>.</operator><name>getCollectionsHandler</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>is</name><argument_list>(<argument><expr><call><name>instanceOf</name><argument_list>(<argument><expr><name><name>CustomCollectionsHandler</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name>assertThat</name><argument_list>(<argument><expr><call><name><name>cc</name><operator>.</operator><name>getInfoHandler</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>is</name><argument_list>(<argument><expr><call><name>instanceOf</name><argument_list>(<argument><expr><name><name>CustomInfoHandler</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name>assertThat</name><argument_list>(<argument><expr><call><name><name>cc</name><operator>.</operator><name>getMultiCoreHandler</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>is</name><argument_list>(<argument><expr><call><name>instanceOf</name><argument_list>(<argument><expr><name><name>CustomCoreAdminHandler</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>eab3e87ec49</name><operator>..</operator><literal type="number">8ea8d1b7e03</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">159</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">159</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestReplicationHandler</name> extends <name>SolrTestCaseJ4</name> <block>{
       <expr><name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name>buildUrl</name><argument_list>(<argument><expr><name>port</name></expr></argument>)</argument_list></call> <operator>+</operator> <literal type="string">"/"</literal> <operator>+</operator> <name>DEFAULT_TEST_CORENAME</name></expr></argument>)</argument_list></call></expr>;
       <call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>client</name></expr>;</return>
     </block_content>}</block>
     <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandlerBackup</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandlerBackup</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">29c0dd75239</literal><operator>..</operator><name>fe1a4ea14bb</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandlerBackup</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestReplicationHandlerBackup</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">82</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">82</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestReplicationHandlerBackup</name> extends <name>SolrJettyTestBase</name> <block>{
       <expr><name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name>buildUrl</name><argument_list>(<argument><expr><name>port</name></expr></argument>, <argument><expr><name>context</name></expr></argument>)</argument_list></call> <operator>+</operator> <literal type="string">"/"</literal> <operator>+</operator> <name>DEFAULT_TEST_CORENAME</name></expr></argument>)</argument_list></call></expr>;
       <call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>client</name></expr>;</return>
     </block_content>}</block></catch>
     <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestRestoreCore</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestRestoreCore</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">1218783d7b2</literal><operator>..</operator><literal type="number">0a8076474db</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestRestoreCore</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>TestRestoreCore</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">75</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">75</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestRestoreCore</name> extends <name>SolrJettyTestBase</name> <block>{
       <expr><name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name>buildUrl</name><argument_list>(<argument><expr><name>port</name></expr></argument>, <argument><expr><name>context</name></expr></argument>)</argument_list></call> <operator>+</operator> <literal type="string">"/"</literal> <operator>+</operator> <name>DEFAULT_TEST_CORENAME</name></expr></argument>)</argument_list></call></expr>;
       <call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">15000</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>client</name></expr>;</return>
     </block_content>}</block></catch>
     <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>DistributedQueryElevationComponentTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>DistributedQueryElevationComponentTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">0c18b25fc24</literal><operator>..</operator><literal type="number">91f39dcc8d1</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>DistributedQueryElevationComponentTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>component</name><operator>/</operator><name><name>DistributedQueryElevationComponentTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">116</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">116</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>DistributedQueryElevationComponentTest</name> extends <call><name><name>BaseDistributedSearc</name>
         <operator>.</operator><name>setSort</name></name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>, <argument><expr><name><name>SolrQuery</name><operator>.</operator><name>ORDER</name><operator>.</operator><name>desc</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>setDistributedParams</name><argument_list>(<argument><expr><name>solrQuery</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><name>response</name> <operator>=</operator> <call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>solrQuery</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
 
     <expr_stmt><expr><call><name>assertTrue</name><argument_list>(<argument><expr><call><name><name>response</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call> <operator>&gt;</operator> <literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><name>document</name> <operator>=</operator> <call><name><name>response</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name><name>AnalyticsMergeStrategyTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name><name>AnalyticsMergeStrategyTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>ed3318213d9</name><operator>..</operator><literal type="number">160d2f7fc0e</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name><name>AnalyticsMergeStrategyTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name><name>AnalyticsMergeStrategyTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">19</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">19</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>search</name></name>;</package>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>Constants</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>BaseDistributedSearchTestCase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrTestCaseJ4</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrTestCaseJ4</name><operator>.</operator><name>SuppressObjectReleaseTracker</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>QueryResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>NamedList</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">33</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>
  <expr_stmt><expr><operator>*</operator><operator>/</operator>
 
 @<call><name><name>SolrTestCaseJ4</name><operator>.</operator><name>SuppressSSL</name></name><argument_list>(<argument><expr><name>bugUrl</name><operator>=</operator><literal type="string">"https://issues.apache.org/jira/browse/SOLR-8433"</literal></expr></argument>)</argument_list></call>
@<call><name>SuppressObjectReleaseTracker</name><argument_list>(<argument><expr><name>bugUrl</name><operator>=</operator><literal type="string">"https://issues.apache.org/jira/browse/SOLR-8899"</literal></expr></argument>)</argument_list></call>
 <specifier>public</specifier> <name>class</name> <name>AnalyticsMergeStrategyTest</name> extends <name>BaseDistributedSearchTestCase</name> <block>{
 
 
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name>stats</name><operator>/</operator><name><name>TestDistribIDF</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name>stats</name><operator>/</operator><name><name>TestDistribIDF</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">9bb4d21eec2</literal><operator>..</operator><literal type="number">877742b8b7d</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name>stats</name><operator>/</operator><name><name>TestDistribIDF</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name>stats</name><operator>/</operator><name><name>TestDistribIDF</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">117</literal></expr>,<expr><literal type="number">27</literal> <operator>+</operator><literal type="number">117</literal></expr>,<expr><literal type="number">30</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestDistribIDF</name> extends <name>SolrTestCaseJ4</name> <block>{
 
     <comment type="line">//Test against all nodes</comment>
     <for>for <control>(<init><decl><type><name>JettySolrRunner</name></type> <name>jettySolrRunner</name> <range>: <expr><call><name><name>solrCluster</name><operator>.</operator><name>getJettySolrRunners</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
      <decl_stmt><decl><type><name>SolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jettySolrRunner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>SolrClient</name></type> <name>solrClient_local</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jettySolrRunner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <try>try <init>(<decl><type><name>SolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jettySolrRunner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
        <try>try <init>(<decl><type><name>SolrClient</name></type> <name>solrClient_local</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jettySolrRunner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
 
      <decl_stmt><decl><type><name>SolrQuery</name></type> <name>query</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"cat:football"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setFields</name></name><argument_list>(<argument><expr><literal type="string">"*,score"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>QueryResponse</name></type> <name>queryResponse</name> <init>= <expr><call><name><name>solrClient</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><literal type="string">"onecollection"</literal></expr></argument>, <argument><expr><name>query</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>float</name></type> <name>score1</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>float</name></type> <name>score2</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Doc1 score="</literal> <operator>+</operator> <name>score1</name> <operator>+</operator> <literal type="string">" Doc2 score="</literal> <operator>+</operator> <name>score2</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><call><name><name>Float</name><operator>.</operator><name>compare</name></name><argument_list>(<argument><expr><name>score1</name></expr></argument>, <argument><expr><name>score2</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name>SolrQuery</name></type> <name>query</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"cat:football"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setFields</name></name><argument_list>(<argument><expr><literal type="string">"*,score"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name>QueryResponse</name></type> <name>queryResponse</name> <init>= <expr><call><name><name>solrClient</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><literal type="string">"onecollection"</literal></expr></argument>, <argument><expr><name>query</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name>float</name></type> <name>score1</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <decl_stmt><decl><type><name>float</name></type> <name>score2</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Doc1 score="</literal> <operator>+</operator> <name>score1</name> <operator>+</operator> <literal type="string">" Doc2 score="</literal> <operator>+</operator> <name>score2</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><call><name><name>Float</name><operator>.</operator><name>compare</name></name><argument_list>(<argument><expr><name>score1</name></expr></argument>, <argument><expr><name>score2</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
      <expr_stmt><expr><name>query</name> <operator>=</operator> <operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"cat:football"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setShowDebugInfo</name></name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setFields</name></name><argument_list>(<argument><expr><literal type="string">"*,score"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>queryResponse</name> <operator>=</operator> <call><name><name>solrClient_local</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><literal type="string">"onecollection_local"</literal></expr></argument>, <argument><expr><name>query</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>float</name></type> <name>score1_local</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>float</name></type> <name>score2_local</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Doc1 score="</literal> <operator>+</operator> <name>score1_local</name> <operator>+</operator> <literal type="string">" Doc2 score="</literal> <operator>+</operator> <name>score2_local</name></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><call><name><name>Float</name><operator>.</operator><name>compare</name></name><argument_list>(<argument><expr><name>score1_local</name></expr></argument>, <argument><expr><name>score2_local</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><name>query</name> <operator>=</operator> <operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"cat:football"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setShowDebugInfo</name></name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setFields</name></name><argument_list>(<argument><expr><literal type="string">"*,score"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><name>queryResponse</name> <operator>=</operator> <call><name><name>solrClient_local</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><literal type="string">"onecollection_local"</literal></expr></argument>, <argument><expr><name>query</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name>float</name></type> <name>score1_local</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <decl_stmt><decl><type><name>float</name></type> <name>score2_local</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Doc1 score="</literal> <operator>+</operator> <name>score1_local</name> <operator>+</operator> <literal type="string">" Doc2 score="</literal> <operator>+</operator> <name>score2_local</name></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>,
              <argument><expr><call><name><name>Float</name><operator>.</operator><name>compare</name></name><argument_list>(<argument><expr><name>score1_local</name></expr></argument>, <argument><expr><name>score2_local</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt/>}</block_content>
      }
     }
   }
 
@@ -161</block><operator>,</operator><expr_stmt><expr><literal type="number">28</literal> <operator>+</operator><literal type="number">164</literal></expr><operator>,</operator><expr><literal type="number">33</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestDistribIDF</name> extends <name>SolrTestCaseJ4</name> <block>{
 
     <comment type="line">//Test against all nodes</comment>
     <for>for <control>(<init><decl><type><name>JettySolrRunner</name></type> <name>jettySolrRunner</name> <range>: <expr><call><name><name>solrCluster</name><operator>.</operator><name>getJettySolrRunners</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
      <decl_stmt><decl><type><name>SolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jettySolrRunner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>SolrClient</name></type> <name>solrClient_local</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jettySolrRunner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
      <decl_stmt><decl><type><name>SolrQuery</name></type> <name>query</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"cat:football"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setFields</name></name><argument_list>(<argument><expr><literal type="string">"*,score"</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>add</name><argument_list>(<argument><expr><literal type="string">"collection"</literal></expr></argument>, <argument><expr><literal type="string">"collection1,collection2"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>QueryResponse</name></type> <name>queryResponse</name> <init>= <expr><call><name><name>solrClient</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><literal type="string">"collection1"</literal></expr></argument>, <argument><expr><name>query</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>float</name></type> <name>score1</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>float</name></type> <name>score2</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Doc1 score="</literal> <operator>+</operator> <name>score1</name> <operator>+</operator> <literal type="string">" Doc2 score="</literal> <operator>+</operator> <name>score2</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><call><name><name>Float</name><operator>.</operator><name>compare</name></name><argument_list>(<argument><expr><name>score1</name></expr></argument>, <argument><expr><name>score2</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <try>try <init>(<decl><type><name>SolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jettySolrRunner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
 
        <try>try <init>(<decl><type><name>SolrClient</name></type> <name>solrClient_local</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jettySolrRunner</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
          <decl_stmt><decl><type><name>SolrQuery</name></type> <name>query</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"cat:football"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setFields</name></name><argument_list>(<argument><expr><literal type="string">"*,score"</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>add</name><argument_list>(<argument><expr><literal type="string">"collection"</literal></expr></argument>, <argument><expr><literal type="string">"collection1,collection2"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name>QueryResponse</name></type> <name>queryResponse</name> <init>= <expr><call><name><name>solrClient</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><literal type="string">"collection1"</literal></expr></argument>, <argument><expr><name>query</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name>float</name></type> <name>score1</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <decl_stmt><decl><type><name>float</name></type> <name>score2</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Doc1 score="</literal> <operator>+</operator> <name>score1</name> <operator>+</operator> <literal type="string">" Doc2 score="</literal> <operator>+</operator> <name>score2</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><call><name><name>Float</name><operator>.</operator><name>compare</name></name><argument_list>(<argument><expr><name>score1</name></expr></argument>, <argument><expr><name>score2</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
      <expr_stmt><expr><name>query</name> <operator>=</operator> <operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"cat:football"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setFields</name></name><argument_list>(<argument><expr><literal type="string">"*,score"</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>add</name><argument_list>(<argument><expr><literal type="string">"collection"</literal></expr></argument>, <argument><expr><literal type="string">"collection1_local,collection2_local"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>queryResponse</name> <operator>=</operator> <call><name><name>solrClient_local</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><literal type="string">"collection1_local"</literal></expr></argument>, <argument><expr><name>query</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>float</name></type> <name>score1_local</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>float</name></type> <name>score2_local</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Doc1 score="</literal> <operator>+</operator> <name>score1_local</name> <operator>+</operator> <literal type="string">" Doc2 score="</literal> <operator>+</operator> <name>score2_local</name></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><call><name><name>Float</name><operator>.</operator><name>compare</name></name><argument_list>(<argument><expr><name>score1_local</name></expr></argument>, <argument><expr><name>score2_local</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><name>query</name> <operator>=</operator> <operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"cat:football"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setFields</name></name><argument_list>(<argument><expr><literal type="string">"*,score"</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>add</name><argument_list>(<argument><expr><literal type="string">"collection"</literal></expr></argument>, <argument><expr><literal type="string">"collection1_local,collection2_local"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><name>queryResponse</name> <operator>=</operator> <call><name><name>solrClient_local</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><literal type="string">"collection1_local"</literal></expr></argument>, <argument><expr><name>query</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getNumFound</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">2</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name>float</name></type> <name>score1_local</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <decl_stmt><decl><type><name>float</name></type> <name>score2_local</name> <init>= <expr><operator>(</operator><name>float</name><operator>)</operator> <call><name><name>queryResponse</name><operator>.</operator><name>getResults</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"score"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
          <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Doc1 score="</literal> <operator>+</operator> <name>score1_local</name> <operator>+</operator> <literal type="string">" Doc2 score="</literal> <operator>+</operator> <name>score2_local</name></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>,
              <argument><expr><call><name><name>Float</name><operator>.</operator><name>compare</name></name><argument_list>(<argument><expr><name>score1_local</name></expr></argument>, <argument><expr><name>score2_local</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt/>}</block_content>

      }
     }
    
   }
 
   private void createCollection(String name</block><operator>,</operator> <expr_stmt><expr><name>String</name> <name>config</name></expr></expr_stmt></try>)</block_content> <throws>throws <argument><expr><name>Exception</name> <block>{
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>BasicAuthIntegrationTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>BasicAuthIntegrationTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">96a8c146eb0</literal><operator>..</operator><literal type="number">9361615d9ff</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>BasicAuthIntegrationTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>BasicAuthIntegrationTest</name><operator>.</operator><name>java</name></name></expr></block></expr></argument>
@<argument>@ <expr><operator>-</operator><literal type="number">36</literal></expr></argument>,<argument><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">36</literal></expr></argument>,<argument><expr><literal type="number">7</literal> @@</expr></argument></throws></block></try> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>util</name><operator>.</operator><name>EntityUtils</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettySolrRunner</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>CloudSolrClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>CollectionAdminRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>request</name><operator>.</operator><name>GenericSolrRequest</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">61</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">62</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import static <name><name>java</name><operator>.</operator><name>nio</name><operator>.</operator><name>charset</name><operator>.</operator><name>StandardCharsets</name><operator>.</operator><name>UTF_8</name></name>;</import>
 <import>import static <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name><operator>.</operator><name>singletonMap</name></name>;</import>
 <import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkStateReader</name><operator>.</operator><name>BASE_URL_PROP</name></name>;</import>
 

 <class><specifier>public</specifier> class <name>BasicAuthIntegrationTest</name> <super_list><extends>extends <super><name>TestMiniSolrCloudClusterBase</name></super></extends></super_list> <block>{
 
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>Logger</name></type> <name>log</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><call><name><name>MethodHandles</name><operator>.</operator><name>lookup</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lookupClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">78</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">78</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{
     <expr><call><name><name>cloudSolrClient</name><operator>.</operator><name>setDefaultCollection</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;
 
     <name><name>NamedList</name><argument_list type="generic">&lt;<argument><name>Object</name></argument>&gt;</argument_list></name> <name>rsp</name></block></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>HttpClient</name></type> <name>cl</name> <init>= <expr><call><name><name>cloudSolrClient</name><operator>.</operator><name>getLbClient</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHttpClient</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>HttpClient</name></type> <name>cl</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <decl_stmt><decl><type><name>String</name></type> <name>baseUrl</name> <init>= <expr><call><name>getRandomReplica</name><argument_list>(<argument><expr><call><name><name>zkStateReader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCollection</name><argument_list>(<argument><expr><name>defaultCollName</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name>random</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>getStr</name><argument_list>(<argument><expr><name>BASE_URL_PROP</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <expr_stmt><expr><call><name>verifySecurityStatus</name><argument_list>(<argument><expr><name>cl</name></expr></argument>, <argument><expr><name>baseUrl</name> <operator>+</operator> <name>authcPrefix</name></expr></argument>, <argument><expr><literal type="string">"/errorMessages"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><literal type="number">20</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>zkClient</name><operator>.</operator><name>setData</name></name><argument_list>(<argument><expr><literal type="string">"/security.json"</literal></expr></argument>, <argument><expr><call><name><name>STD_CONF</name><operator>.</operator><name>replaceAll</name></name><argument_list>(<argument><expr><literal type="string">"'"</literal></expr></argument>, <argument><expr><literal type="string">"\""</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>getBytes</name><argument_list>(<argument><expr><name>UTF_8</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">94</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">94</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{
         <break>break;</break>
       }</block>
     }

     <call><name>assertTrue</name><argument_list>(<argument><expr><literal type="string">"No server found to restart , looking for : "</literal><operator>+</operator><name>baseUrl</name></expr></argument> , <argument><expr><name>found</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
     <decl_stmt><decl><type><name>String</name></type> <name>command</name> <init>= <expr><literal type="string">"{\n"</literal> <operator>+</operator>
@@ <operator>-</operator><literal type="number">118</literal></expr></init></decl>,6 +119,7 @@ public <decl><type ref="prev"/><name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{<block_content>
     <expr_stmt><expr><call><name>verifySecurityStatus</name><argument_list>(<argument><expr><name>cl</name></expr></argument>, <argument><expr><name>baseUrl</name> <operator>+</operator> <name>authcPrefix</name></expr></argument>, <argument><expr><literal type="string">"authentication.enabled"</literal></expr></argument>, <argument><expr><literal type="string">"true"</literal></expr></argument>, <argument><expr><literal type="number">20</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <decl_stmt><decl><type><name>HttpResponse</name></type> <name>r</name> <init>= <expr><call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpPost</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <decl_stmt><decl><type><name>int</name></type> <name>statusCode</name> <init>= <expr><call><name><name>r</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>Utils</name><operator>.</operator><name>consumeFully</name></name><argument_list>(<argument><expr><call><name><name>r</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"proper_cred sent, but access denied"</literal></expr></argument>, <argument><expr><literal type="number">200</literal></expr></argument>, <argument><expr><name>statusCode</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><name>baseUrl</name> <operator>=</operator> <call><name>getRandomReplica</name><argument_list>(<argument><expr><call><name><name>zkStateReader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCollection</name><argument_list>(<argument><expr><name>defaultCollName</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name>random</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>getStr</name><argument_list>(<argument><expr><name>BASE_URL_PROP</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">132</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">134</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{
     <expr><call><name><name>httpPost</name><operator>.</operator><name>addHeader</name></name><argument_list>(<argument><expr><literal type="string">"Content-Type"</literal></expr></argument>, <argument><expr><literal type="string">"application/json; charset=UTF-8"</literal></expr></argument>)</argument_list></call></expr>;
     <name>r</name> <operator>=</operator> <call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpPost</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">200</literal></expr></argument>, <argument><expr><call><name><name>r</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>Utils</name><operator>.</operator><name>consumeFully</name></name><argument_list>(<argument><expr><call><name><name>r</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
     <expr_stmt><expr><name>baseUrl</name> <operator>=</operator> <call><name>getRandomReplica</name><argument_list>(<argument><expr><call><name><name>zkStateReader</name><operator>.</operator><name>getClusterState</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCollection</name><argument_list>(<argument><expr><name>defaultCollName</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name>random</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>getStr</name><argument_list>(<argument><expr><name>BASE_URL_PROP</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>verifySecurityStatus</name><argument_list>(<argument><expr><name>cl</name></expr></argument>, <argument><expr><name>baseUrl</name> <operator>+</operator> <name>authzPrefix</name></expr></argument>, <argument><expr><literal type="string">"authorization/user-role/harry"</literal></expr></argument>, <argument><expr><name>NOT_NULL_PREDICATE</name></expr></argument>, <argument><expr><literal type="number">20</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">148</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">151</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{
     <expr><call><name>verifySecurityStatus</name><argument_list>(<argument><expr><name>cl</name></expr></argument>, <argument><expr><name>baseUrl</name> <operator>+</operator> <name>authzPrefix</name></expr></argument>, <argument><expr><literal type="string">"authorization/user-role/harry"</literal></expr></argument>, <argument><expr><name>NOT_NULL_PREDICATE</name></expr></argument>, <argument><expr><literal type="number">20</literal></expr></argument>)</argument_list></call></expr>;
     <name>r</name> <operator>=</operator> <call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpPost</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">200</literal></expr></argument>, <argument><expr><call><name><name>r</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>Utils</name><operator>.</operator><name>consumeFully</name></name><argument_list>(<argument><expr><call><name><name>r</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
     <expr_stmt><expr><call><name>verifySecurityStatus</name><argument_list>(<argument><expr><name>cl</name></expr></argument>, <argument><expr><name>baseUrl</name> <operator>+</operator> <name>authzPrefix</name></expr></argument>, <argument><expr><literal type="string">"authorization/permissions[1]/collection"</literal></expr></argument>, <argument><expr><literal type="string">"x"</literal></expr></argument>, <argument><expr><literal type="number">20</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">156</literal></expr><operator>,</operator><expr><literal type="number">25</literal> <operator>+</operator><literal type="number">160</literal></expr><operator>,</operator><expr><literal type="number">26</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{
     <expr><call><name><name>httpPost</name><operator>.</operator><name>setEntity</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>ByteArrayEntity</name><argument_list>(<argument><expr><call><name><name>Utils</name><operator>.</operator><name>toJSON</name></name><argument_list>(<argument><expr><call><name>singletonMap</name><argument_list>(<argument><expr><literal type="string">"set-permission"</literal></expr></argument>, <argument><expr><call><name><name>Utils</name><operator>.</operator><name>makeMap</name></name>
         <argument_list>(<argument><expr><literal type="string">"name"</literal></expr></argument>,<argument><expr><literal type="string">"collection-admin-edit"</literal></expr></argument>, <argument><expr><literal type="string">"role"</literal></expr></argument>, <argument><expr><literal type="string">"admin"</literal></expr></argument> )</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <name>r</name> <operator>=</operator> <call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpPost</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>

    <expr_stmt><expr><call><name><name>Utils</name><operator>.</operator><name>consumeFully</name></name><argument_list>(<argument><expr><call><name><name>r</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>verifySecurityStatus</name><argument_list>(<argument><expr><name>cl</name></expr></argument>, <argument><expr><name>baseUrl</name> <operator>+</operator> <name>authzPrefix</name></expr></argument>, <argument><expr><literal type="string">"authorization/permissions[2]/name"</literal></expr></argument>, <argument><expr><literal type="string">"collection-admin-edit"</literal></expr></argument>, <argument><expr><literal type="number">20</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
     <decl_stmt><decl><type><name><name>CollectionAdminRequest</name><operator>.</operator><name>Reload</name></name></type> <name>reload</name> <init>= <expr><operator>new</operator> <call><name><name>CollectionAdminRequest</name><operator>.</operator><name>Reload</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
     <expr_stmt><expr><call><name><name>reload</name><operator>.</operator><name>setCollectionName</name></name><argument_list>(<argument><expr><name>defaultCollName</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
    <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>baseUrl</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <try>try <block>{<block_content>
      <expr_stmt><expr><name>rsp</name> <operator>=</operator> <call><name><name>solrClient</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>reload</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"must have failed"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt/>}</block_content> catch (HttpSolrClient.RemoteSolrException e</block></try>)</block_content> <block>{<block_content>
    <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>baseUrl</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
      <try>try <block>{<block_content>
        <expr_stmt><expr><name>rsp</name> <operator>=</operator> <call><name><name>solrClient</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>reload</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"must have failed"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/>}</block_content> catch (HttpSolrClient.RemoteSolrException e</block></try>)</block_content> <block>{<block_content>
 
    <expr_stmt/>}</block_content>
    reload.setMethod(SolrRequest.METHOD.POST</block></block></try>)</block_content></block></block></decl>;</decl_stmt>
    <try>try <block>{<block_content>
      <expr_stmt><expr><name>rsp</name> <operator>=</operator> <call><name><name>solrClient</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>reload</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"must have failed"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt/>}</block_content> catch (HttpSolrClient.RemoteSolrException e</block></try>)</block> <block>{<block_content>
      <expr_stmt/>}</block_content>
      reload.setMethod(SolrRequest.METHOD.POST</block></class>)</block_content></block><empty_stmt>;</empty_stmt></for></block></expr></expr_stmt></try>
      <try>try <block>{<block_content>
        <expr_stmt><expr><name>rsp</name> <operator>=</operator> <call><name><name>solrClient</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>reload</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"must have failed"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/>}</block_content> catch (HttpSolrClient.RemoteSolrException e</block></try>)</block_content> <block>{<block_content>
 
      <expr_stmt/>}</block_content>
     }
     cloudSolrClient.request(new CollectionAdminRequest.Reload(</block></block></try>)</block_content>
         .setCollectionName(defaultCollName</block></for>)</block>
@@ <operator>-</operator><literal type="number">197</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">202</literal></expr>,<expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{
     <expr><call><name><name>httpPost</name><operator>.</operator><name>addHeader</name></name><argument_list>(<argument><expr><literal type="string">"Content-Type"</literal></expr></argument>, <argument><expr><literal type="string">"application/json; charset=UTF-8"</literal></expr></argument>)</argument_list></call></expr>;
     <name>r</name> <operator>=</operator> <call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>httpPost</name></expr></argument>)</argument_list></call></block></expr>;
     <call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">200</literal></expr></argument>,<argument><expr><call><name><name>r</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>Utils</name><operator>.</operator><name>consumeFully</name></name><argument_list>(<argument><expr><call><name><name>r</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
     <decl_stmt><decl><type><name>SolrInputDocument</name></type> <name>doc</name> <init>= <expr><operator>new</operator> <call><name>SolrInputDocument</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
     <expr_stmt><expr><call><name><name>doc</name><operator>.</operator><name>setField</name></name><argument_list>(<argument><expr><literal type="string">"id"</literal></expr></argument>,<argument><expr><literal type="string">"4"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">205</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">211</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{
     <expr><call><name><name>update</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name>doc</name></expr></argument>)</argument_list></call></expr>;
     <call><name><name>update</name><operator>.</operator><name>setCommitWithin</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>cloudSolrClient</name><operator>.</operator><name>request</name></name><argument_list>(<argument><expr><name>update</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>cl</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></catch></try>
 
   <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>verifySecurityStatus</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>cl</name></decl></parameter>, <parameter><decl><type><name>String</name></type> <name>url</name></decl></parameter>, <parameter><decl><type><name>String</name></type> <name>objPath</name></decl></parameter>, <parameter><decl><type><name>Object</name></type> <name>expected</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>count</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">213</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">221</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicAuthIntegrationTest</name> extends <name>TestMiniSolrCloudClusterBase</name> <block>{
     <expr><name><name>List</name><argument_list type="generic">&lt;<argument><name>String</name></argument>&gt;</argument_list></name> <name>hierarchy</name> <operator>=</operator> <call><name><name>StrUtils</name><operator>.</operator><name>splitSmart</name></name><argument_list>(<argument><expr><name>objPath</name></expr></argument>, <argument><expr><literal type="char">'/'</literal></expr></argument>)</argument_list></call></expr>;</block></expr></expr_stmt>
     <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <name>count</name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
       <decl_stmt><decl><type><name>HttpGet</name></type> <name>get</name> <init>= <expr><operator>new</operator> <call><name>HttpGet</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><name>s</name> <operator>=</operator> <call><name><name>EntityUtils</name><operator>.</operator><name>toString</name></name><argument_list>(<argument><expr><call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>get</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getEntity</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>HttpResponse</name></type> <name>rsp</name> <init>= <expr><call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>get</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><name>s</name> <operator>=</operator> <call><name><name>EntityUtils</name><operator>.</operator><name>toString</name></name><argument_list>(<argument><expr><call><name><name>rsp</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <decl_stmt><decl><type><name>Map</name></type> <name>m</name> <init>= <expr><operator>(</operator><name>Map</name><operator>)</operator> <call><name><name>Utils</name><operator>.</operator><name>fromJSONString</name></name><argument_list>(<argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

      <expr_stmt><expr><call><name><name>Utils</name><operator>.</operator><name>consumeFully</name></name><argument_list>(<argument><expr><call><name><name>rsp</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <decl_stmt><decl><type><name>Object</name></type> <name>actual</name> <init>= <expr><call><name><name>Utils</name><operator>.</operator><name>getObjectByPath</name></name><argument_list>(<argument><expr><name>m</name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>, <argument><expr><name>hierarchy</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <if_stmt><if>if <condition>(<expr><name>expected</name> <operator>instanceof</operator> <name>Predicate</name></expr>)</condition> <block>{<block_content>
         <decl_stmt><decl><type><name>Predicate</name></type> <name>predicate</name> <init>= <expr><operator>(</operator><name>Predicate</name><operator>)</operator> <name>expected</name></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationIntegrationTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationIntegrationTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">26aee070d9a</literal><operator>..</operator><literal type="number">30fe9338f72</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationIntegrationTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>PKIAuthenticationIntegrationTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">31</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">31</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>AbstractFullDistribZkTestBase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkStateReader</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>Utils</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>request</name><operator>.</operator><name>LocalSolrQueryRequest</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>zookeeper</name><operator>.</operator><name>CreateMode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>TestAuthorizationFramework</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>TestAuthorizationFramework</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">3f573767981</literal><operator>..</operator><literal type="number">4c4b52eb867</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>TestAuthorizationFramework</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>security</name><operator>/</operator><name><name>TestAuthorizationFramework</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">28</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">28</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpGet</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>util</name><operator>.</operator><name>EntityUtils</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>LuceneTestCase</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>AbstractFullDistribZkTestBase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ZkStateReader</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">89</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">90</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestAuthorizationFramework</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
     <expr><name><name>List</name><argument_list type="generic">&lt;<argument><name>String</name></argument>&gt;</argument_list></name> <name>hierarchy</name> <operator>=</operator> <call><name><name>StrUtils</name><operator>.</operator><name>splitSmart</name></name><argument_list>(<argument><expr><name>objPath</name></expr></argument>, <argument><expr><literal type="char">'/'</literal></expr></argument>)</argument_list></call></expr>;</block></expr></expr_stmt>
     <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <name>count</name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
       <decl_stmt><decl><type><name>HttpGet</name></type> <name>get</name> <init>= <expr><operator>new</operator> <call><name>HttpGet</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><name>s</name> <operator>=</operator> <call><name><name>EntityUtils</name><operator>.</operator><name>toString</name></name><argument_list>(<argument><expr><call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>get</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getEntity</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>s</name> <operator>=</operator> <call><name><name>EntityUtils</name><operator>.</operator><name>toString</name></name><argument_list>(<argument><expr><call><name><name>cl</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>get</name></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>getEntity</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <decl_stmt><decl><type><name>Map</name></type> <name>m</name> <init>= <expr><operator>(</operator><name>Map</name><operator>)</operator> <call><name><name>Utils</name><operator>.</operator><name>fromJSONString</name></name><argument_list>(<argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
       <decl_stmt><decl><type><name>Object</name></type> <name>actual</name> <init>= <expr><call><name><name>Utils</name><operator>.</operator><name>getObjectByPath</name></name><argument_list>(<argument><expr><name>m</name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>, <argument><expr><name>hierarchy</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AutoCommitTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AutoCommitTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">080a02fd087</literal><operator>..</operator><literal type="number">3221693e547</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AutoCommitTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AutoCommitTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">317</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">317</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>AutoCommitTest</name> extends <name>AbstractSolrTestCase</name> <block>{
     
     <comment type="line">// Delete one document with commitWithin</comment>
     <expr><call><name><name>req</name><operator>.</operator><name>setContentStreams</name></name><argument_list>( <argument><expr><call><name>toContentStreams</name><argument_list>(
      <argument><expr><call><name>delI</name><argument_list>(<argument><expr><literal type="string">"529"</literal></expr></argument>, <argument><expr><literal type="string">"commitWithin"</literal></expr></argument>, <argument><expr><literal type="string">"1000"</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument> )</argument_list></call></expr></argument> )</argument_list></call></expr>;
      <call><name>delI</name><argument_list>(<argument><expr><literal type="string">"529"</literal></expr></argument>, <argument><expr><literal type="string">"commitWithin"</literal></expr></argument>, <argument><expr><literal type="string">"2000"</literal></expr></argument>)</argument_list></call>, <literal type="null">null</literal> )</block></expr></expr_stmt> )</block_content></block><empty_stmt>;</empty_stmt></for>
     <expr_stmt><expr><call><name><name>trigger</name><operator>.</operator><name>reset</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>handler</name><operator>.</operator><name>handleRequest</name></name><argument_list>( <argument><expr><name>req</name></expr></argument>, <argument><expr><name>rsp</name></expr></argument> )</argument_list></call></expr>;</expr_stmt>
       
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>http</name><operator>.</operator><name>xml</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>http</name><operator>.</operator><name>xml</name></name>
<name>index</name> <literal type="number">90e523ad4a8</literal><operator>..</operator><literal type="number">6d92830ec10</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>http</name><operator>.</operator><name>xml</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>http</name><operator>.</operator><name>xml</name></name>
@@ <operator>-</operator><literal type="number">35</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">35</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@
         <operator>&lt;</operator><operator>/</operator><name>Arg</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"host"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"jetty.host"</literal> <operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"port"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"jetty.port"</literal> default<operator>=</operator><literal type="string">"8983"</literal> <operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
        <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"idleTimeout"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.http.idleTimeout"</literal> default<operator>=</operator><literal type="string">"50000"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
        <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"idleTimeout"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.http.idleTimeout"</literal> default<operator>=</operator><literal type="string">"120000"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"soLingerTime"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.http.soLingerTime"</literal> default<operator>=</operator><literal type="string">"-1"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"acceptorPriorityDelta"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.http.acceptorPriorityDelta"</literal> default<operator>=</operator><literal type="string">"0"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"selectorPriorityDelta"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.http.selectorPriorityDelta"</literal> default<operator>=</operator><literal type="string">"0"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>https</name><operator>.</operator><name>xml</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>https</name><operator>.</operator><name>xml</name></name>
<name>index</name> <name>e2770b1eb30</name><operator>..</operator><name>d34d4bd14ce</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>https</name><operator>.</operator><name>xml</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name>jetty</name><operator>-</operator><name><name>https</name><operator>.</operator><name>xml</name></name>
@@ <operator>-</operator><literal type="number">42</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">42</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@
         <operator>&lt;</operator><operator>/</operator><name>Arg</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"host"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.host"</literal> <operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"port"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.https.port"</literal> default<operator>=</operator><literal type="string">"8983"</literal> <operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
        <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"idleTimeout"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.https.timeout"</literal> default<operator>=</operator><literal type="string">"50000"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
        <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"idleTimeout"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.https.timeout"</literal> default<operator>=</operator><literal type="string">"120000"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"soLingerTime"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.https.soLingerTime"</literal> default<operator>=</operator><literal type="string">"-1"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"acceptorPriorityDelta"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.ssl.acceptorPriorityDelta"</literal> default<operator>=</operator><literal type="string">"0"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
         <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"selectorPriorityDelta"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.ssl.selectorPriorityDelta"</literal> default<operator>=</operator><literal type="string">"0"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name><name>jetty</name><operator>.</operator><name>xml</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name><name>jetty</name><operator>.</operator><name>xml</name></name>
<name>index</name> <name>c819f0409cf</name><operator>..</operator><name>f1b94c855db</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name><name>jetty</name><operator>.</operator><name>xml</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>server</name><operator>/</operator><name>etc</name><operator>/</operator><name><name>jetty</name><operator>.</operator><name>xml</name></name>
@@ <operator>-</operator><literal type="number">35</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">35</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@
   <operator>&lt;</operator><name>Get</name> <name>name</name><operator>=</operator><literal type="string">"ThreadPool"</literal><operator>&gt;</operator>
     <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"minThreads"</literal> <name>type</name><operator>=</operator><literal type="string">"int"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.threads.min"</literal> default<operator>=</operator><literal type="string">"10"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
     <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"maxThreads"</literal> <name>type</name><operator>=</operator><literal type="string">"int"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.threads.max"</literal> default<operator>=</operator><literal type="string">"10000"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
    <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"idleTimeout"</literal> <name>type</name><operator>=</operator><literal type="string">"int"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.threads.idle.timeout"</literal> default<operator>=</operator><literal type="string">"5000"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
    <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"idleTimeout"</literal> <name>type</name><operator>=</operator><literal type="string">"int"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.threads.idle.timeout"</literal> default<operator>=</operator><literal type="string">"120000"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
     <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"stopTimeout"</literal> <name>type</name><operator>=</operator><literal type="string">"int"</literal><operator>&gt;</operator><operator>&lt;</operator><name>Property</name> <name>name</name><operator>=</operator><literal type="string">"solr.jetty.threads.stop.timeout"</literal> default<operator>=</operator><literal type="string">"60000"</literal><operator>/</operator><operator>&gt;</operator><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
     <operator>&lt;</operator><name>Set</name> <name>name</name><operator>=</operator><literal type="string">"detailedDump"</literal><operator>&gt;</operator><literal type="boolean">false</literal><operator>&lt;</operator><operator>/</operator><name>Set</name><operator>&gt;</operator>
   <operator>&lt;</operator><operator>/</operator><name>Get</name><operator>&gt;</operator>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClient</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClient</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>edfe1c3e117</name><operator>..</operator><literal type="number">43a4c183391</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClient</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClient</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">1345</literal></expr><operator>,</operator><expr><literal type="number">4</literal> <operator>+</operator><literal type="number">1345</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> <name>class</name> <name>CloudSolrClient</name> extends <name>SolrClient</name> <block>{
     }</block></expr></expr_stmt>    
     <return>return <expr><name>results</name></expr>;</return>
   </block_content>}</block></if></if_stmt>
  
  <function><type><specifier>public</specifier> <name>void</name></type> <name>setConnectionTimeout</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>timeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>lbClient</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt> 
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>void</name></type> <name>setSoTimeout</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>timeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>lbClient</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>
 </block_content>}</block></for>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ConcurrentUpdateSolrClient</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ConcurrentUpdateSolrClient</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">5bec96a27f5</literal><operator>..</operator><name>d197e4bb506</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ConcurrentUpdateSolrClient</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ConcurrentUpdateSolrClient</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">20</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">20</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpStatus</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>NameValuePair</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>RequestConfig</name><operator>.</operator><name>Builder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpPost</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>ContentProducer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>EntityTemplate</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">86</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">87</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>ConcurrentUpdateSolrClient</name> extends <name>SolrClient</name> <block>{
   <expr><name>int</name> <name>pollQueueTime</name> <operator>=</operator> <literal type="number">250</literal></expr>;
   <specifier>private</specifier> <name>final</name> <name>boolean</name> <name>streamDeletes</name></block></expr>;</expr_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <name>boolean</name></type> <name>internalHttpClient</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>volatile</specifier> <name>Integer</name></type> <name>connectionTimeout</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>volatile</specifier> <name>Integer</name></type> <name>soTimeout</name></decl>;</decl_stmt>
 
   <comment type="block" format="javadoc">/**
    * Uses an internally managed HttpClient instance.
@@ -274,11 +277,22 @@ public class ConcurrentUpdateSolrClient extends SolrClient {
 
           method = new HttpPost(client.getBaseURL() + "/update"
               + requestParams.toQueryString());
          
          Builder requestConfigBuilder = HttpClientUtil.createDefaultRequestConfigBuilder();
          if (soTimeout != null) {
            requestConfigBuilder.setSocketTimeout(soTimeout);
          }
          if (connectionTimeout != null) {
            requestConfigBuilder.setConnectTimeout(connectionTimeout);
          }
  
          method.setConfig(requestConfigBuilder.build());
          
           method.setEntity(template);
           method.addHeader("User-Agent", HttpSolrClient.AGENT);
           method.addHeader("Content-Type", contentType);
 
          response = client.getHttpClient().execute(method);
          response = client.getHttpClient().execute(method, HttpClientUtil.createNewHttpClientRequestContext());
           rspBody = response.getEntity().getContent();
           int statusCode = response.getStatusLine().getStatusCode();
           if (statusCode != HttpStatus.SC_OK) {
@@ -489,7 +503,7 @@ public class ConcurrentUpdateSolrClient extends SolrClient {
   }
   
   public void setConnectionTimeout(int timeout) {
    HttpClientUtil.setConnectionTimeout(client.getHttpClient(), timeout);
    this.connectionTimeout = timeout;
   }
 
   /**
@@ -497,7 +511,7 @@ public class ConcurrentUpdateSolrClient extends SolrClient {
    * not for indexing.
    */</comment>
   <function><type><specifier>public</specifier> <name>void</name></type> <name>setSoTimeout</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>timeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><call><name><name>client</name><operator>.</operator><name>getHttpClient</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>soTimeout</name></name> <operator>=</operator> <name>timeout</name></expr>;</expr_stmt>
   </block_content>}</block></function>
 
   <function><type><specifier>public</specifier> <name>void</name></type> <name>shutdownNow</name><parameter_list>()</parameter_list> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientConfigurer</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientConfigurer</name><operator>.</operator><name>java</name></name>
<name>deleted</name> <name>file</name> <name>mode</name> <literal type="number">100644</literal>
<name>index</name> <literal type="number">0f97bd0f894</literal><operator>..</operator><literal type="number">00000000000</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientConfigurer</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <operator>/</operator><name>dev</name><operator>/</operator><literal type="null">null</literal>
@@ <operator>-</operator><literal type="number">1</literal></expr><operator>,</operator><expr><literal type="number">100</literal> <operator>+</operator><literal type="number">0</literal></expr><operator>,</operator><expr><literal type="number">0</literal> @@</expr></expr_stmt>
<comment type="block">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</comment>
<package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name></name>;</package>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequest</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequestInterceptor</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>SSLSocketFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpContext</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name><operator>.</operator><name>ErrorCode</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>

<comment type="block" format="javadoc">/**
 * The default http client configurer. If the behaviour needs to be customized a
 * new HttpCilentConfigurer can be set by calling
 * {@link HttpClientUtil#setConfigurer(HttpClientConfigurer)}
 */</comment>
<class><specifier>public</specifier> class <name>HttpClientConfigurer</name> <block>{
  
  <function><type><specifier>public</specifier> <name>void</name></type> <name>configure</name><parameter_list>(<parameter><decl><type><name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>SolrParams</name></type> <name>config</name></decl></parameter>)</parameter_list> <block>{<block_content>
    
    <if_stmt><if>if <condition>(<expr><call><name><name>config</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setMaxConnections</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,
          <argument><expr><call><name><name>config</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    
    <if_stmt><if>if <condition>(<expr><call><name><name>config</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS_PER_HOST</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,
          <argument><expr><call><name><name>config</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS_PER_HOST</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    
    <if_stmt><if>if <condition>(<expr><call><name><name>config</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_CONNECTION_TIMEOUT</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,
          <argument><expr><call><name><name>config</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_CONNECTION_TIMEOUT</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    
    <if_stmt><if>if <condition>(<expr><call><name><name>config</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,
          <argument><expr><call><name><name>config</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    
    <if_stmt><if>if <condition>(<expr><call><name><name>config</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_FOLLOW_REDIRECTS</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setFollowRedirects</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,
          <argument><expr><call><name><name>config</name><operator>.</operator><name>getBool</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_FOLLOW_REDIRECTS</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    
    <comment type="line">// always call setUseRetry, whether it is in config or not</comment>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setUseRetry</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,
        <argument><expr><call><name><name>config</name><operator>.</operator><name>getBool</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_USE_RETRY</name></name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <decl_stmt><decl><type><specifier>final</specifier> <name>String</name></type> <name>basicAuthUser</name> <init>= <expr><call><name><name>config</name>
        <operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_BASIC_AUTH_USER</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>String</name></type> <name>basicAuthPass</name> <init>= <expr><call><name><name>config</name>
        <operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_BASIC_AUTH_PASS</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setBasicAuth</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>basicAuthUser</name></expr></argument>, <argument><expr><name>basicAuthPass</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <if_stmt><if>if <condition>(<expr><call><name><name>config</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_ALLOW_COMPRESSION</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setAllowCompression</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,
          <argument><expr><call><name><name>config</name><operator>.</operator><name>getBool</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_ALLOW_COMPRESSION</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    
    <decl_stmt><decl><type><name>boolean</name></type> <name>sslCheckPeerName</name> <init>= <expr><call><name>toBooleanDefaultIfNull</name><argument_list>(
        <argument><expr><call><name>toBooleanObject</name><argument_list>(<argument><expr><call><name><name>System</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>SYS_PROP_CHECK_PEER_NAME</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if<condition>(<expr><name>sslCheckPeerName</name> <operator>==</operator> <literal type="boolean">false</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setHostNameVerifier</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name><name>SSLSocketFactory</name><operator>.</operator><name>ALLOW_ALL_HOSTNAME_VERIFIER</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>boolean</name></type> <name>toBooleanDefaultIfNull</name><parameter_list>(<parameter><decl><type><name>Boolean</name></type> <name>bool</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>valueIfNull</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>bool</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <return>return <expr><name>valueIfNull</name></expr>;</return>
    </block_content>}</block></if></if_stmt>
    <return>return <expr><ternary><condition><expr><call><name><name>bool</name><operator>.</operator><name>booleanValue</name></name><argument_list>()</argument_list></call></expr> ?</condition><then> <expr><literal type="boolean">true</literal></expr> </then><else>: <expr><literal type="boolean">false</literal></expr></else></ternary></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>Boolean</name></type> <name>toBooleanObject</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>str</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><literal type="string">"true"</literal><operator>.</operator><call><name>equalsIgnoreCase</name><argument_list>(<argument><expr><name>str</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
      <return>return <expr><name><name>Boolean</name><operator>.</operator><name>TRUE</name></name></expr>;</return>
    </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><literal type="string">"false"</literal><operator>.</operator><call><name>equalsIgnoreCase</name><argument_list>(<argument><expr><name>str</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
      <return>return <expr><name><name>Boolean</name><operator>.</operator><name>FALSE</name></name></expr>;</return>
    </block_content>}</block></if></if_stmt>
    <comment type="line">// no match</comment>
    <return>return <expr><literal type="null">null</literal></expr>;</return>
  </block_content>}</block></function>
}</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtil</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtil</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">2ad89757e04</literal><operator>..</operator><literal type="number">72297b3499e</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtil</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtil</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">19</literal></expr><operator>,</operator><expr><literal type="number">11</literal> <operator>+</operator><literal type="number">19</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@</expr></expr_stmt> <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name></name>;</package>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>InputStream</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>reflect</name><operator>.</operator><name>Constructor</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>reflect</name><operator>.</operator><name>InvocationTargetException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>ArrayList</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>TimeUnit</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>function</name><operator>.</operator><name>Consumer</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>zip</name><operator>.</operator><name>GZIPInputStream</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>zip</name><operator>.</operator><name>InflaterInputStream</name></name>;</import>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">37</literal></expr><operator>,</operator><expr><literal type="number">40</literal> <operator>+</operator><literal type="number">37</literal></expr><operator>,</operator><expr><literal type="number">50</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpResponseInterceptor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>AuthScope</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>UsernamePasswordCredentials</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>CredentialsProvider</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>params</name><operator>.</operator><name>ClientParamBean</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ClientConnectionManager</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>scheme</name><operator>.</operator><name>Scheme</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>SSLSocketFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>X509HostnameVerifier</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>RequestConfig</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>RequestConfig</name><operator>.</operator><name>Builder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpClientContext</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>Registry</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>RegistryBuilder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ConnectionKeepAliveStrategy</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>socket</name><operator>.</operator><name>ConnectionSocketFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>socket</name><operator>.</operator><name>PlainConnectionSocketFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>HttpEntityWrapper</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>BasicCredentialsProvider</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>CloseableHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpRequestRetryHandler</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>SystemDefaultHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingClientConnectionManager</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>tsccm</name><operator>.</operator><name>ThreadSafeClientConnManager</name></name>;</import> <comment type="line">// jdoc</comment>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>params</name><operator>.</operator><name>HttpConnectionParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClientBuilder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingHttpClientConnectionManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpContext</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name><operator>.</operator><name>ErrorCode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>ObjectReleaseTracker</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
 <comment type="block" format="javadoc">/**
  * Utility class for creating/configuring httpclient instances. 
 * 
 * This class can touch internal HttpClient details and is subject to change.
 * 
 * @lucene.experimental
  */</comment>
 <class><specifier>public</specifier> class <name>HttpClientUtil</name> <block>{
  <comment type="line">// socket timeout measured in ms, closes a socket if read</comment>
  <comment type="line">// takes longer than x ms to complete. throws</comment>
  <comment type="line">// java.net.SocketTimeoutException: Read timed out exception</comment>
  <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>PROP_SO_TIMEOUT</name> <init>= <expr><literal type="string">"socketTimeout"</literal></expr></init></decl>;</decl_stmt>
  <comment type="line">// connection timeout measures in ms, closes a socket if connection</comment>
  <comment type="line">// cannot be established within x ms. with a</comment>
  <comment type="line">// java.net.SocketTimeoutException: Connection timed out</comment>
  <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>PROP_CONNECTION_TIMEOUT</name> <init>= <expr><literal type="string">"connTimeout"</literal></expr></init></decl>;</decl_stmt>
  
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>Logger</name></type> <name>logger</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><call><name><name>MethodHandles</name><operator>.</operator><name>lookup</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lookupClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
  
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>int</name></type> <name>DEFAULT_CONNECT_TIMEOUT</name> <init>= <expr><literal type="number">60000</literal></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>int</name></type> <name>DEFAULT_SO_TIMEOUT</name> <init>= <expr><literal type="number">600000</literal></expr></init></decl>;</decl_stmt>
  
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>int</name></type> <name>VALIDATE_AFTER_INACTIVITY_DEFAULT</name> <init>= <expr><literal type="number">3000</literal></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>int</name></type> <name>EVICT_IDLE_CONNECTIONS_DEFAULT</name> <init>= <expr><literal type="number">50000</literal></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>VALIDATE_AFTER_INACTIVITY</name> <init>= <expr><literal type="string">"validateAfterInactivity"</literal></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>EVICT_IDLE_CONNECTIONS</name> <init>= <expr><literal type="string">"evictIdleConnections"</literal></expr></init></decl>;</decl_stmt>

   <comment type="line">// Maximum connections allowed per host</comment>
   <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>PROP_MAX_CONNECTIONS_PER_HOST</name> <init>= <expr><literal type="string">"maxConnectionsPerHost"</literal></expr></init></decl>;</decl_stmt>
   <comment type="line">// Maximum total connections allowed</comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">79</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">89</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpClientUtil</name> <block>{
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>PROP_USE_RETRY</name> <operator>=</operator> <literal type="string">"retry"</literal></expr>;
   <comment type="line">// Allow compression (deflate,gzip) if server supports it</comment>
   <specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>PROP_ALLOW_COMPRESSION</name> <operator>=</operator> <literal type="string">"allowCompression"</literal></block></expr>;</expr_stmt>
  <comment type="line">// Follow redirects</comment>
  <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>PROP_FOLLOW_REDIRECTS</name> <init>= <expr><literal type="string">"followRedirects"</literal></expr></init></decl>;</decl_stmt>
   <comment type="line">// Basic auth username </comment>
   <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>PROP_BASIC_AUTH_USER</name> <init>= <expr><literal type="string">"httpBasicAuthUser"</literal></expr></init></decl>;</decl_stmt>
   <comment type="line">// Basic auth password </comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">88</literal></expr><operator>,</operator><expr><literal type="number">25</literal> <operator>+</operator><literal type="number">96</literal></expr><operator>,</operator><expr><literal type="number">92</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpClientUtil</name> <block>{
   
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SYS_PROP_CHECK_PEER_NAME</name> <operator>=</operator> <literal type="string">"solr.ssl.checkPeerName"</literal></expr>;
   
  <specifier>private</specifier> <specifier>static</specifier> <name>final</name> <name>Logger</name> <name>logger</name> <operator>=</operator> <call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><call><name><name>MethodHandles</name><operator>.</operator><name>lookup</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lookupClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
  <comment type="line">// * NOTE* The following params configure the default request config and this</comment>
  <comment type="line">// is overridden by SolrJ clients. Use the setters on the SolrJ clients to</comment>
  <comment type="line">// to configure these settings if that is the intent.</comment>
  
  <comment type="line">// Follow redirects</comment>
  <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>PROP_FOLLOW_REDIRECTS</name> <init>= <expr><literal type="string">"followRedirects"</literal></expr></init></decl>;</decl_stmt>
  
  <comment type="line">// socket timeout measured in ms, closes a socket if read</comment>
  <comment type="line">// takes longer than x ms to complete. throws</comment>
  <comment type="line">// java.net.SocketTimeoutException: Read timed out exception</comment>
  <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>PROP_SO_TIMEOUT</name> <init>= <expr><literal type="string">"socketTimeout"</literal></expr></init></decl>;</decl_stmt>
  <comment type="line">// connection timeout measures in ms, closes a socket if connection</comment>
  <comment type="line">// cannot be established within x ms. with a</comment>
  <comment type="line">// java.net.SocketTimeoutException: Connection timed out</comment>
  <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>PROP_CONNECTION_TIMEOUT</name> <init>= <expr><literal type="string">"connTimeout"</literal></expr></init></decl>;</decl_stmt>
   
   <decl_stmt><decl><type><specifier>static</specifier> <specifier>final</specifier> <name>DefaultHttpRequestRetryHandler</name></type> <name>NO_RETRY</name> <init>= <expr><operator>new</operator> <call><name>DefaultHttpRequestRetryHandler</name><argument_list>(
       <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <name>HttpClientConfigurer</name></type> <name>configurer</name> <init>= <expr><operator>new</operator> <call><name>HttpClientConfigurer</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>volatile</specifier> <name>SolrHttpClientBuilder</name></type> <name>httpClientBuilder</name></decl>;</decl_stmt>
  
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <name>SolrHttpClientContextBuilder</name></type> <name>httpClientRequestContextBuilder</name> <init>= <expr><operator>new</operator> <call><name>SolrHttpClientContextBuilder</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
  
  <static>static <block>{<block_content>
    <expr_stmt><expr><call><name>resetHttpClientBuilder</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></static>
  
  <class><specifier>public</specifier> <specifier>static</specifier> <specifier>abstract</specifier> class <name>SchemaRegistryProvider</name> <block>{
    <function_decl><type><specifier>public</specifier> <specifier>abstract</specifier> <name><name>Registry</name><argument_list type="generic">&lt;<argument><name>ConnectionSocketFactory</name></argument>&gt;</argument_list></name></type> <name>getSchemaRegistry</name><parameter_list>()</parameter_list>;</function_decl>
  }</block></class>
  
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>volatile</specifier> <name>SchemaRegistryProvider</name></type> <name>schemaRegistryProvider</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>volatile</specifier> <name>String</name></type> <name>cookiePolicy</name></decl>;</decl_stmt>
 
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>HttpRequestInterceptor</name></argument>&gt;</argument_list></name></type> <name>interceptors</name> <init>= <expr><call><name><name>Collections</name><operator>.</operator><name>synchronizedList</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name><name>ArrayList</name><argument_list type="generic">&lt;<argument><name>HttpRequestInterceptor</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
   
  <comment type="block" format="javadoc">/**
   * Replace the {@link HttpClientConfigurer} class used in configuring the http
   * clients with a custom implementation.
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setConfigurer</name><parameter_list>(<parameter><decl><type><name>HttpClientConfigurer</name></type> <name>newConfigurer</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name>configurer</name> <operator>=</operator> <name>newConfigurer</name></expr>;</expr_stmt>
  <class><specifier>private</specifier> <specifier>static</specifier> class <name>DynamicInterceptor</name> <super_list><implements>implements <super><name>HttpRequestInterceptor</name></super></implements></super_list> <block>{

    <function><annotation>@<name>Override</name></annotation>
    <type><specifier>public</specifier> <name>void</name></type> <name>process</name><parameter_list>(<parameter><decl><type><name>HttpRequest</name></type> <name>request</name></decl></parameter>, <parameter><decl><type><name>HttpContext</name></type> <name>context</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>HttpException</name></expr></argument>, <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>
      <expr_stmt><expr><call><name><name>interceptors</name><operator>.</operator><name>forEach</name></name><argument_list>(<argument><expr><operator>new</operator> <class><super><name><name>Consumer</name><argument_list type="generic">&lt;<argument><name>HttpRequestInterceptor</name></argument>&gt;</argument_list></name></super><argument_list>()</argument_list> <block>{

        <function><annotation>@<name>Override</name></annotation>
        <type><specifier>public</specifier> <name>void</name></type> <name>accept</name><parameter_list>(<parameter><decl><type><name>HttpRequestInterceptor</name></type> <name>interceptor</name></decl></parameter>)</parameter_list> <block>{<block_content>
          <try>try <block>{<block_content>
            <expr_stmt><expr><call><name><name>interceptor</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><name>request</name></expr></argument>, <argument><expr><name>context</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <expr_stmt><expr><call><name><name>logger</name><operator>.</operator><name>error</name></name><argument_list>(<argument><expr><literal type="string">""</literal></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          </block_content>}</block></catch></try>
        </block_content>}</block></function>
      }</block></class></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    </block_content>}</block></function>
   }</block></class>
   
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>HttpClientConfigurer</name></type> <name>getConfigurer</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>configurer</name></expr>;</return>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setHttpClientBuilder</name><parameter_list>(<parameter><decl><type><name>SolrHttpClientBuilder</name></type> <name>newHttpClientBuilder</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name>httpClientBuilder</name> <operator>=</operator> <name>newHttpClientBuilder</name></expr>;</expr_stmt>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setHttpClientProvider</name><parameter_list>(<parameter><decl><type><name>SolrHttpClientBuilder</name></type> <name>newHttpClientBuilder</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name>httpClientBuilder</name> <operator>=</operator> <name>newHttpClientBuilder</name></expr>;</expr_stmt>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setSchemeRegistryProvider</name><parameter_list>(<parameter><decl><type><name>SchemaRegistryProvider</name></type> <name>newRegistryProvider</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name>schemaRegistryProvider</name> <operator>=</operator> <name>newRegistryProvider</name></expr>;</expr_stmt>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>SolrHttpClientBuilder</name></type> <name>getHttpClientBuilder</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>httpClientBuilder</name></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>SchemaRegistryProvider</name></type> <name>getSchemaRegisteryProvider</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>schemaRegistryProvider</name></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>resetHttpClientBuilder</name><parameter_list>()</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name>schemaRegistryProvider</name> <operator>=</operator> <operator>new</operator> <class><super><name>SchemaRegistryProvider</name></super><argument_list>()</argument_list> <block>{

      <function><annotation>@<name>Override</name></annotation>
      <type><specifier>public</specifier> <name><name>Registry</name><argument_list type="generic">&lt;<argument><name>ConnectionSocketFactory</name></argument>&gt;</argument_list></name></type> <name>getSchemaRegistry</name><parameter_list>()</parameter_list> <block>{<block_content>
        <return>return <expr><name><name>RegistryBuilder</name><operator>.</operator></name>&lt;<name>ConnectionSocketFactory</name><operator>&gt;</operator> <call><name>create</name><argument_list>()</argument_list></call>
            <operator>.</operator><call><name>register</name><argument_list>(<argument><expr><literal type="string">"http"</literal></expr></argument>, <argument><expr><call><name><name>PlainConnectionSocketFactory</name><operator>.</operator><name>getSocketFactory</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>build</name><argument_list>()</argument_list></call></expr>;</return>
      </block_content>}</block></function>
    }</block></class></expr>;</expr_stmt>
    <expr_stmt><expr><name>httpClientBuilder</name> <operator>=</operator> <call><name><name>SolrHttpClientBuilder</name><operator>.</operator><name>create</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>

   </block_content>}</block></function>
   
   <comment type="block" format="javadoc">/**
@@ -116,195 +191,137 @@ public class HttpClientUtil {
    *          http client configuration, if null a client with default
    *          configuration (no additional configuration) is created. 
    */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>CloseableHttpClient</name></type> <name>createClient</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>SolrParams</name></type> <name>params</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><specifier>final</specifier> <name>ModifiableSolrParams</name></type> <name>config</name> <init>= <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><call><name><name>logger</name><operator>.</operator><name>isDebugEnabled</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>logger</name><operator>.</operator><name>debug</name></name><argument_list>(<argument><expr><literal type="string">"Creating new http client, config:"</literal> <operator>+</operator> <name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>CloseableHttpClient</name></type> <name>createClient</name><parameter_list>(<parameter><decl><type><name>SolrParams</name></type> <name>params</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>PoolingHttpClientConnectionManager</name></type> <name>cm</name> <init>= <expr><operator>new</operator> <call><name>PoolingHttpClientConnectionManager</name><argument_list>(<argument><expr><call><name><name>schemaRegistryProvider</name><operator>.</operator><name>getSchemaRegistry</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <return>return <expr><call><name>createClient</name><argument_list>(<argument><expr><name>params</name></expr></argument>, <argument><expr><name>cm</name></expr></argument>)</argument_list></call></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>CloseableHttpClient</name></type> <name>createClient</name><parameter_list>(<parameter><decl><type><name>SolrParams</name></type> <name>params</name></decl></parameter>, <parameter><decl><type><name>PoolingHttpClientConnectionManager</name></type> <name>cm</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>params</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><name>params</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if></if_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>DefaultHttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>HttpClientFactory</name><operator>.</operator><name>createHttpClient</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name>configureClient</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <return>return <expr><name>httpClient</name></expr>;</return>
    
    <return>return <expr><call><name>createClient</name><argument_list>(<argument><expr><name>params</name></expr></argument>, <argument><expr><name>cm</name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</return>
   </block_content>}</block></function>
   
   <comment type="block" format="javadoc">/**
    * Creates new http client by using the provided configuration.
    * 
    */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>CloseableHttpClient</name></type> <name>createClient</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>SolrParams</name></type> <name>params</name></decl></parameter>, <parameter><decl><type><name>ClientConnectionManager</name></type> <name>cm</name></decl></parameter>)</parameter_list> <block>{<block_content>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>CloseableHttpClient</name></type> <name>createClient</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>SolrParams</name></type> <name>params</name></decl></parameter>, <parameter><decl><type><name>PoolingHttpClientConnectionManager</name></type> <name>cm</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>sharedConnectionManager</name></decl></parameter>)</parameter_list> <block>{<block_content>
     <decl_stmt><decl><type><specifier>final</specifier> <name>ModifiableSolrParams</name></type> <name>config</name> <init>= <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <if_stmt><if>if <condition>(<expr><call><name><name>logger</name><operator>.</operator><name>isDebugEnabled</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
       <expr_stmt><expr><call><name><name>logger</name><operator>.</operator><name>debug</name></name><argument_list>(<argument><expr><literal type="string">"Creating new http client, config:"</literal> <operator>+</operator> <name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if></if_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>DefaultHttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>HttpClientFactory</name><operator>.</operator><name>createHttpClient</name></name><argument_list>(<argument><expr><name>cm</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name>configureClient</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <return>return <expr><name>httpClient</name></expr>;</return>
  </block_content>}</block></function>

  <comment type="block" format="javadoc">/**
   * Configures {@link DefaultHttpClient}, only sets parameters if they are
   * present in config.
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>configureClient</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>SolrParams</name></type> <name>config</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>configurer</name><operator>.</operator><name>configure</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,  <argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <synchronized>synchronized<init>(<expr><name>interceptors</name></expr>)</init> <block>{<block_content>
      <for>for<control>(<init><decl><type><name>HttpRequestInterceptor</name></type> <name>interceptor</name><range>: <expr><name>interceptors</name></expr></range></decl></init>)</control> <block>{<block_content>
        <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>addRequestInterceptor</name></name><argument_list>(<argument><expr><name>interceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></for>
 
    <if_stmt><if>if <condition>(<expr><call><name><name>params</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name>PROP_SO_TIMEOUT</name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal> <operator>||</operator> <call><name><name>params</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name>PROP_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>(<argument><expr><name><name>ErrorCode</name><operator>.</operator><name>SERVER_ERROR</name></name></expr></argument>, <argument><expr><literal type="string">"The socket connect and read timeout cannot be set here and must be set"</literal></expr></argument>)</argument_list></call></expr>;</throw>
     </block_content>}</block></if></if_stmt>
  </block_content>}</block></synchronized>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>close</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>httpClient</name></decl></parameter>)</parameter_list> <block>{<block_content> 
    <if_stmt><if>if <condition>(<expr><name>httpClient</name> <operator>instanceof</operator> <name>CloseableHttpClient</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>IOUtils</name><operator>.</operator><name>closeQuietly</name></name><argument_list>(<argument><expr><operator>(</operator><name>CloseableHttpClient</name><operator>)</operator> <name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>setMaxTotal</name></name><argument_list>(<argument><expr><call><name><name>params</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS</name></name></expr></argument>, <argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>setDefaultMaxPerRoute</name></name><argument_list>(<argument><expr><call><name><name>params</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS_PER_HOST</name></name></expr></argument>, <argument><expr><literal type="number">10000</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>cm</name><operator>.</operator><name>setValidateAfterInactivity</name></name><argument_list>(<argument><expr><call><name><name>Integer</name><operator>.</operator><name>getInteger</name></name><argument_list>(<argument><expr><name>VALIDATE_AFTER_INACTIVITY</name></expr></argument>, <argument><expr><name>VALIDATE_AFTER_INACTIVITY_DEFAULT</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    
    <decl_stmt><decl><type><name>HttpClientBuilder</name></type> <name>newHttpClientBuilder</name> <init>= <expr><call><name><name>HttpClientBuilder</name><operator>.</operator><name>create</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <if_stmt><if>if <condition>(<expr><name>sharedConnectionManager</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>newHttpClientBuilder</name><operator>.</operator><name>setConnectionManagerShared</name></name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if> <else>else <block>{<block_content>
      <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>shutdown</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>newHttpClientBuilder</name><operator>.</operator><name>setConnectionManagerShared</name></name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></else></if_stmt>
  </block_content>}</block></if></if_stmt>
    
    <decl_stmt><decl><type><name>ConnectionKeepAliveStrategy</name></type> <name>keepAliveStrat</name> <init>= <expr><operator>new</operator> <class><super><name>ConnectionKeepAliveStrategy</name></super><argument_list>()</argument_list> <block>{
      <function><annotation>@<name>Override</name></annotation>
      <type><specifier>public</specifier> <name>long</name></type> <name>getKeepAliveDuration</name><parameter_list>(<parameter><decl><type><name>HttpResponse</name></type> <name>response</name></decl></parameter>, <parameter><decl><type><name>HttpContext</name></type> <name>context</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <comment type="line">// we only close connections based on idle time, not ttl expiration</comment>
        <return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>
      </block_content>}</block></function>
    }</block></class></expr></init></decl>;</decl_stmt>
 
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>addRequestInterceptor</name><parameter_list>(<parameter><decl><type><name>HttpRequestInterceptor</name></type> <name>interceptor</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>interceptors</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name>interceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>
    <if_stmt><if>if <condition>(<expr><call><name><name>httpClientBuilder</name><operator>.</operator><name>getAuthSchemeRegistryProvider</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>newHttpClientBuilder</name><operator>.</operator><name>setDefaultAuthSchemeRegistry</name></name><argument_list>(<argument><expr><call><name><name>httpClientBuilder</name><operator>.</operator><name>getAuthSchemeRegistryProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getAuthSchemeRegistry</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    <if_stmt><if>if <condition>(<expr><call><name><name>httpClientBuilder</name><operator>.</operator><name>getCookieSpecRegistryProvider</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>newHttpClientBuilder</name><operator>.</operator><name>setDefaultCookieSpecRegistry</name></name><argument_list>(<argument><expr><call><name><name>httpClientBuilder</name><operator>.</operator><name>getCookieSpecRegistryProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCookieSpecRegistry</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    <if_stmt><if>if <condition>(<expr><call><name><name>httpClientBuilder</name><operator>.</operator><name>getCredentialsProviderProvider</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>newHttpClientBuilder</name><operator>.</operator><name>setDefaultCredentialsProvider</name></name><argument_list>(<argument><expr><call><name><name>httpClientBuilder</name><operator>.</operator><name>getCredentialsProviderProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCredentialsProvider</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
 
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>removeRequestInterceptor</name><parameter_list>(<parameter><decl><type><name>HttpRequestInterceptor</name></type> <name>interceptor</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>interceptors</name><operator>.</operator><name>remove</name></name><argument_list>(<argument><expr><name>interceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>newHttpClientBuilder</name><operator>.</operator><name>addInterceptorLast</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>DynamicInterceptor</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <expr_stmt><expr><name>newHttpClientBuilder</name> <operator>=</operator> <call><name><name>newHttpClientBuilder</name><operator>.</operator><name>setKeepAliveStrategy</name></name><argument_list>(<argument><expr><name>keepAliveStrat</name></expr></argument>)</argument_list></call>
        <operator>.</operator><call><name>evictIdleConnections</name><argument_list>(<argument><expr><operator>(</operator><name>long</name><operator>)</operator> <call><name><name>Integer</name><operator>.</operator><name>getInteger</name></name><argument_list>(<argument><expr><name>EVICT_IDLE_CONNECTIONS</name></expr></argument>, <argument><expr><name>EVICT_IDLE_CONNECTIONS_DEFAULT</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>MILLISECONDS</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <decl_stmt><decl><type><name>HttpClientBuilder</name></type> <name>builder</name> <init>= <expr><call><name>setupBuilder</name><argument_list>(<argument><expr><name>newHttpClientBuilder</name></expr></argument>, <argument><expr><ternary><condition><expr><name>params</name> <operator>==</operator> <literal type="null">null</literal></expr> ?</condition><then> <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr> </then><else>: <expr><name>params</name></expr></else></ternary></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    
    <decl_stmt><decl><type><name>HttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>builder</name><operator>.</operator><name>setConnectionManager</name></name><argument_list>(<argument><expr><name>cm</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>build</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    
    <assert>assert <expr><call><name><name>ObjectReleaseTracker</name><operator>.</operator><name>track</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</assert>
    <return>return <expr><operator>(</operator><name>CloseableHttpClient</name><operator>)</operator> <name>httpClient</name></expr>;</return>
   </block_content>}</block></function>
  
  <function><type><specifier>private</specifier> <specifier>static</specifier> <name>HttpClientBuilder</name></type> <name>setupBuilder</name><parameter_list>(<parameter><decl><type><name>HttpClientBuilder</name></type> <name>builder</name></decl></parameter>, <parameter><decl><type><name>SolrParams</name></type> <name>config</name></decl></parameter>)</parameter_list> <block>{<block_content>
   
    <decl_stmt><decl><type><name>Builder</name></type> <name>requestConfigBuilder</name> <init>= <expr><call><name><name>RequestConfig</name><operator>.</operator><name>custom</name></name><argument_list>()</argument_list></call>
        <operator>.</operator><call><name>setRedirectsEnabled</name><argument_list>(<argument><expr><call><name><name>config</name><operator>.</operator><name>getBool</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_FOLLOW_REDIRECTS</name></name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>setDecompressionEnabled</name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call>
        <operator>.</operator><call><name>setConnectTimeout</name><argument_list>(<argument><expr><call><name><name>config</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_CONNECTION_TIMEOUT</name></name></expr></argument>, <argument><expr><name>DEFAULT_CONNECT_TIMEOUT</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call>
        <operator>.</operator><call><name>setSocketTimeout</name><argument_list>(<argument><expr><call><name><name>config</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>, <argument><expr><name>DEFAULT_SO_TIMEOUT</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
  <comment type="block" format="javadoc">/**
   * Control HTTP payload compression.
   * 
   * @param allowCompression
   *          true will enable compression (needs support from server), false
   *          will disable compression.
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setAllowCompression</name><parameter_list>(<parameter><decl><type><name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>boolean</name></type> <name>allowCompression</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>httpClient</name>
        <operator>.</operator><name>removeRequestInterceptorByClass</name></name><argument_list>(<argument><expr><name><name>UseCompressionRequestInterceptor</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>httpClient</name>
        <operator>.</operator><name>removeResponseInterceptorByClass</name></name><argument_list>(<argument><expr><name><name>UseCompressionResponseInterceptor</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <if_stmt><if>if <condition>(<expr><name>allowCompression</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>addRequestInterceptor</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>UseCompressionRequestInterceptor</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>httpClient</name>
          <operator>.</operator><name>addResponseInterceptor</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>UseCompressionResponseInterceptor</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>String</name></type> <name>cpolicy</name> <init>= <expr><name>cookiePolicy</name></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><name>cpolicy</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>requestConfigBuilder</name><operator>.</operator><name>setCookieSpec</name></name><argument_list>(<argument><expr><name>cpolicy</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if></if_stmt>
  </block_content>}</block></if></if_stmt>
    
    <decl_stmt><decl><type><name>RequestConfig</name></type> <name>requestConfig</name> <init>= <expr><call><name><name>requestConfigBuilder</name><operator>.</operator><name>build</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    
    <decl_stmt><decl><type><name>HttpClientBuilder</name></type> <name>retBuilder</name> <init>= <expr><call><name><name>builder</name><operator>.</operator><name>setDefaultRequestConfig</name></name><argument_list>(<argument><expr><name>requestConfig</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <if_stmt><if>if <condition>(<expr><call><name><name>config</name><operator>.</operator><name>getBool</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_USE_RETRY</name></name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><name>retBuilder</name> <operator>=</operator> <call><name><name>retBuilder</name><operator>.</operator><name>setRetryHandler</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrHttpRequestRetryHandler</name><argument_list>(<argument><expr><literal type="number">3</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
  <comment type="block" format="javadoc">/**
   * Set http basic auth information. If basicAuthUser or basicAuthPass is null
   * the basic auth configuration is cleared. Currently this is not preemtive
   * authentication. So it is not currently possible to do a post request while
   * using this setting.
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setBasicAuth</name><parameter_list>(<parameter><decl><type><name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>String</name></type> <name>basicAuthUser</name></decl></parameter>, <parameter><decl><type><name>String</name></type> <name>basicAuthPass</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>basicAuthUser</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <name>basicAuthPass</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>getCredentialsProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>setCredentials</name><argument_list>(<argument><expr><name><name>AuthScope</name><operator>.</operator><name>ANY</name></name></expr></argument>,
          <argument><expr><operator>new</operator> <call><name>UsernamePasswordCredentials</name><argument_list>(<argument><expr><name>basicAuthUser</name></expr></argument>, <argument><expr><name>basicAuthPass</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if> <else>else <block>{<block_content>
      <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>getCredentialsProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>clear</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>retBuilder</name> <operator>=</operator> <call><name><name>retBuilder</name><operator>.</operator><name>setRetryHandler</name></name><argument_list>(<argument><expr><name>NO_RETRY</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></else></if_stmt>
  </block_content>}</block></function>
 
  <comment type="block" format="javadoc">/**
   * Set max connections allowed per host. This call will only work when
   * {@link ThreadSafeClientConnManager} or
   * {@link PoolingClientConnectionManager} is used.
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setMaxConnectionsPerHost</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>int</name></type> <name>max</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <comment type="line">// would have been nice if there was a common interface</comment>
    <if_stmt><if>if <condition>(<expr><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call> <operator>instanceof</operator> <name>ThreadSafeClientConnManager</name></expr>)</condition> <block>{<block_content>
      <decl_stmt><decl><type><name>ThreadSafeClientConnManager</name></type> <name>mgr</name> <init>= <expr><operator>(</operator><name>ThreadSafeClientConnManager</name><operator>)</operator><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>mgr</name><operator>.</operator><name>setDefaultMaxPerRoute</name></name><argument_list>(<argument><expr><name>max</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call> <operator>instanceof</operator> <name>PoolingClientConnectionManager</name></expr>)</condition> <block>{<block_content>
      <decl_stmt><decl><type><name>PoolingClientConnectionManager</name></type> <name>mgr</name> <init>= <expr><operator>(</operator><name>PoolingClientConnectionManager</name><operator>)</operator><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>mgr</name><operator>.</operator><name>setDefaultMaxPerRoute</name></name><argument_list>(<argument><expr><name>max</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>String</name></type> <name>basicAuthUser</name> <init>= <expr><call><name><name>config</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_BASIC_AUTH_USER</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>String</name></type> <name>basicAuthPass</name> <init>= <expr><call><name><name>config</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_BASIC_AUTH_PASS</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    
    <if_stmt><if>if <condition>(<expr><name>basicAuthUser</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <name>basicAuthPass</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <decl_stmt><decl><type><name>CredentialsProvider</name></type> <name>credsProvider</name> <init>= <expr><operator>new</operator> <call><name>BasicCredentialsProvider</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>credsProvider</name><operator>.</operator><name>setCredentials</name></name><argument_list>(<argument><expr><name><name>AuthScope</name><operator>.</operator><name>ANY</name></name></expr></argument>, <argument><expr><operator>new</operator> <call><name>UsernamePasswordCredentials</name><argument_list>(<argument><expr><name>basicAuthUser</name></expr></argument>, <argument><expr><name>basicAuthPass</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>retBuilder</name><operator>.</operator><name>setDefaultCredentialsProvider</name></name><argument_list>(<argument><expr><name>credsProvider</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if></if_stmt>
  </block_content>}</block></if></if_stmt>

  <comment type="block" format="javadoc">/**
   * Set max total connections allowed. This call will only work when
   * {@link ThreadSafeClientConnManager} or
   * {@link PoolingClientConnectionManager} is used.
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setMaxConnections</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>HttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>int</name></type> <name>max</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <comment type="line">// would have been nice if there was a common interface</comment>
    <if_stmt><if>if <condition>(<expr><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call> <operator>instanceof</operator> <name>ThreadSafeClientConnManager</name></expr>)</condition> <block>{<block_content>
      <decl_stmt><decl><type><name>ThreadSafeClientConnManager</name></type> <name>mgr</name> <init>= <expr><operator>(</operator><name>ThreadSafeClientConnManager</name><operator>)</operator><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>mgr</name><operator>.</operator><name>setMaxTotal</name></name><argument_list>(<argument><expr><name>max</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call> <operator>instanceof</operator> <name>PoolingClientConnectionManager</name></expr>)</condition> <block>{<block_content>
      <decl_stmt><decl><type><name>PoolingClientConnectionManager</name></type> <name>mgr</name> <init>= <expr><operator>(</operator><name>PoolingClientConnectionManager</name><operator>)</operator><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>mgr</name><operator>.</operator><name>setMaxTotal</name></name><argument_list>(<argument><expr><name>max</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <if_stmt><if>if <condition>(<expr><call><name><name>config</name><operator>.</operator><name>getBool</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_ALLOW_COMPRESSION</name></name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>retBuilder</name><operator>.</operator><name>addInterceptorFirst</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>UseCompressionRequestInterceptor</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>retBuilder</name><operator>.</operator><name>addInterceptorFirst</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>UseCompressionResponseInterceptor</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <else>else <block>{<block_content>
      <expr_stmt><expr><call><name><name>retBuilder</name><operator>.</operator><name>disableContentCompression</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></else></if_stmt>
  </block_content>}</block></if></if_stmt>
  
 
  <comment type="block" format="javadoc">/**
   * Defines the socket timeout (SO_TIMEOUT) in milliseconds. A timeout value of
   * zero is interpreted as an infinite timeout.
   * 
   * @param timeout timeout in milliseconds
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setSoTimeout</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>timeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpConnectionParams</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><call><name><name>httpClient</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>,
        <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <return>return <expr><name>retBuilder</name></expr>;</return>
   </block_content>}</block></function>
 
  <comment type="block" format="javadoc">/**
   * Control retry handler 
   * @param useRetry when false the client will not try to retry failed requests.
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setUseRetry</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>boolean</name></type> <name>useRetry</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><operator>!</operator><name>useRetry</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>setHttpRequestRetryHandler</name></name><argument_list>(<argument><expr><name>NO_RETRY</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <else>else <block>{<block_content>
      <comment type="line">// if the request is not fully sent, we retry</comment>
      <comment type="line">// streaming updates are not a problem, because they are not retryable</comment>
      <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>setHttpRequestRetryHandler</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrHttpRequestRetryHandler</name><argument_list>(<argument><expr><literal type="number">3</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></else></if_stmt>
  </block_content>}</block></function>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>close</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>httpClient</name></decl></parameter>)</parameter_list> <block>{<block_content> 
 
  <comment type="block" format="javadoc">/**
   * Set connection timeout. A timeout value of zero is interpreted as an
   * infinite timeout.
   * 
   * @param timeout
   *          connection Timeout in milliseconds
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setConnectionTimeout</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>HttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>int</name></type> <name>timeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpConnectionParams</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><call><name><name>httpClient</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>,
          <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>
    <expr_stmt><expr><call><name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>IOUtils</name><operator>.</operator><name>closeQuietly</name></name><argument_list>(<argument><expr><operator>(</operator><name>CloseableHttpClient</name><operator>)</operator> <name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
  <comment type="block" format="javadoc">/**
   * Set follow redirects.
   *
   * @param followRedirects  When true the client will follow redirects.
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setFollowRedirects</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>boolean</name></type> <name>followRedirects</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><operator>new</operator> <call><name>ClientParamBean</name><argument_list>(<argument><expr><call><name><name>httpClient</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>setHandleRedirects</name><argument_list>(<argument><expr><name>followRedirects</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <assert>assert <expr><call><name><name>ObjectReleaseTracker</name><operator>.</operator><name>release</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</assert>
   </block_content>}</block></function>
 
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setHostNameVerifier</name><parameter_list>(<parameter><decl><type><name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>,
      <parameter><decl><type><name>X509HostnameVerifier</name></type> <name>hostNameVerifier</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>Scheme</name></type> <name>httpsScheme</name> <init>= <expr><call><name><name>httpClient</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSchemeRegistry</name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"https"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><name>httpsScheme</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <decl_stmt><decl><type><name>SSLSocketFactory</name></type> <name>sslSocketFactory</name> <init>= <expr><operator>(</operator><name>SSLSocketFactory</name><operator>)</operator> <call><name><name>httpsScheme</name><operator>.</operator><name>getSchemeSocketFactory</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>sslSocketFactory</name><operator>.</operator><name>setHostnameVerifier</name></name><argument_list>(<argument><expr><name>hostNameVerifier</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>addRequestInterceptor</name><parameter_list>(<parameter><decl><type><name>HttpRequestInterceptor</name></type> <name>interceptor</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>interceptors</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name>interceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setStaleCheckingEnabled</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>HttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>enabled</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpConnectionParams</name><operator>.</operator><name>setStaleCheckingEnabled</name></name><argument_list>(<argument><expr><call><name><name>httpClient</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>enabled</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>removeRequestInterceptor</name><parameter_list>(<parameter><decl><type><name>HttpRequestInterceptor</name></type> <name>interceptor</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>interceptors</name><operator>.</operator><name>remove</name></name><argument_list>(<argument><expr><name>interceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></function>
   
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setTcpNoDelay</name><parameter_list>(<parameter><decl><type><specifier>final</specifier> <name>HttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>tcpNoDelay</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpConnectionParams</name><operator>.</operator><name>setTcpNoDelay</name></name><argument_list>(<argument><expr><call><name><name>httpClient</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>tcpNoDelay</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>clearRequestInterceptors</name><parameter_list>()</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>interceptors</name><operator>.</operator><name>clear</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></function>
   
   <expr_stmt><expr><specifier>private</specifier> <specifier>static</specifier> <name>class</name> <name>UseCompressionRequestInterceptor</name> implements
@@ <operator>-</operator><literal type="number">374</literal></expr><operator>,</operator><expr><literal type="number">35</literal> <operator>+</operator><literal type="number">391</literal></expr><operator>,</operator><expr><literal type="number">34</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpClientUtil</name> <block>{
     }</block></expr></expr_stmt>
   </block_content>}</block></function>
 
  <class><specifier>public</specifier> <specifier>static</specifier> class <name>HttpClientFactory</name> <block>{
    <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <name><name>Class</name><argument_list type="generic">&lt;<argument><name>?</name> <extends>extends <name>DefaultHttpClient</name></extends></argument>&gt;</argument_list></name></type> <name>defaultHttpClientClass</name> <init>= <expr><name><name>DefaultHttpClient</name><operator>.</operator><name>class</name></name></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <name><name>Class</name><argument_list type="generic">&lt;<argument><name>?</name> <extends>extends <name>SystemDefaultHttpClient</name></extends></argument>&gt;</argument_list></name></type> <name>systemDefaultHttpClientClass</name> <init>= <expr><name><name>SystemDefaultHttpClient</name><operator>.</operator><name>class</name></name></expr></init></decl>;</decl_stmt>

  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setHttpClientRequestContextBuilder</name><parameter_list>(<parameter><decl><type><name>SolrHttpClientContextBuilder</name></type> <name>httpClientContextBuilder</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name>httpClientRequestContextBuilder</name> <operator>=</operator> <name>httpClientContextBuilder</name></expr>;</expr_stmt>
  </block_content>}</block></function>
 
    <function><type><specifier>public</specifier> <specifier>static</specifier> <name>SystemDefaultHttpClient</name></type> <name>createHttpClient</name><parameter_list>()</parameter_list> <block>{<block_content>
      <decl_stmt><decl><type><name><name>Constructor</name><argument_list type="generic">&lt;<argument><name>?</name> <extends>extends <name>SystemDefaultHttpClient</name></extends></argument>&gt;</argument_list></name></type> <name>constructor</name></decl>;</decl_stmt>
      <try>try <block>{<block_content>
        <expr_stmt><expr><name>constructor</name> <operator>=</operator> <call><name><name>systemDefaultHttpClientClass</name><operator>.</operator><name>getDeclaredConstructor</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <return>return <expr><call><name><name>constructor</name><operator>.</operator><name>newInstance</name></name><argument_list>()</argument_list></call></expr>;</return>
      </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>NoSuchMethodException</name></type> | <type><name>SecurityException</name></type> | <type><name>InstantiationException</name></type> | <type><name>IllegalAccessException</name></type> | <type><name>IllegalArgumentException</name></type> | <type><name>InvocationTargetException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>(<argument><expr><name><name>ErrorCode</name><operator>.</operator><name>SERVER_ERROR</name></name></expr></argument>, <argument><expr><literal type="string">"Unable to create HttpClient instance. "</literal></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</throw>
      </block_content>}</block></catch></try>
    </block_content>}</block></function>
  <comment type="block" format="javadoc">/**
   * 
   */</comment>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>HttpClientContext</name></type> <name>createNewHttpClientRequestContext</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><call><name><name>httpClientRequestContextBuilder</name><operator>.</operator><name>createContext</name></name><argument_list>()</argument_list></call></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>Builder</name></type> <name>createDefaultRequestConfigBuilder</name><parameter_list>()</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>String</name></type> <name>cpolicy</name> <init>= <expr><name>cookiePolicy</name></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>Builder</name></type> <name>builder</name> <init>= <expr><call><name><name>RequestConfig</name><operator>.</operator><name>custom</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
 
    <function><type><specifier>public</specifier> <specifier>static</specifier> <name>DefaultHttpClient</name></type> <name>createHttpClient</name><parameter_list>(<parameter><decl><type><name>ClientConnectionManager</name></type> <name>cm</name></decl></parameter>)</parameter_list> <block>{<block_content>
      <decl_stmt><decl><type><name><name>Constructor</name><argument_list type="generic">&lt;<argument><name>?</name> <extends>extends <name>DefaultHttpClient</name></extends></argument>&gt;</argument_list></name></type> <name>constructor</name></decl>;</decl_stmt>
      <try>try <block>{<block_content>
        <expr_stmt><expr><name>constructor</name> <operator>=</operator> <call><name><name>defaultHttpClientClass</name><operator>.</operator><name>getDeclaredConstructor</name></name><argument_list>(<argument><expr><operator>new</operator> <name><name>Class</name><index>[]</index></name><block>{<expr><name><name>ClientConnectionManager</name><operator>.</operator><name>class</name></name></expr>}</block></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <return>return <expr><call><name><name>constructor</name><operator>.</operator><name>newInstance</name></name><argument_list>(<argument><expr><operator>new</operator> <name><name>Object</name><index>[]</index></name><block>{<expr><name>cm</name></expr>}</block></expr></argument>)</argument_list></call></expr>;</return>
      </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>NoSuchMethodException</name></type> | <type><name>SecurityException</name></type> | <type><name>InstantiationException</name></type> | <type><name>IllegalAccessException</name></type> | <type><name>IllegalArgumentException</name></type> | <type><name>InvocationTargetException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>(<argument><expr><name><name>ErrorCode</name><operator>.</operator><name>SERVER_ERROR</name></name></expr></argument>, <argument><expr><literal type="string">"Unable to create HttpClient instance, registered class is: "</literal> <operator>+</operator> <name>defaultHttpClientClass</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</throw>
      </block_content>}</block></catch></try>
    <expr_stmt><expr><call><name><name>builder</name><operator>.</operator><name>setSocketTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_SO_TIMEOUT</name></expr></argument>)</argument_list></call>
        <operator>.</operator><call><name>setConnectTimeout</name><argument_list>(<argument><expr><name>DEFAULT_CONNECT_TIMEOUT</name></expr></argument>)</argument_list></call>
        <operator>.</operator><call><name>setRedirectsEnabled</name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call>
        <operator>.</operator><call><name>setDecompressionEnabled</name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt> <comment type="line">// we do our own compression / decompression</comment>
    <if_stmt><if>if <condition>(<expr><name>cpolicy</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>builder</name><operator>.</operator><name>setCookieSpec</name></name><argument_list>(<argument><expr><name>cpolicy</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if></if_stmt>
    <return>return <expr><name>builder</name></expr>;</return>
  </block_content>}</block></function>
 
    <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setHttpClientImpl</name><parameter_list>(<parameter><decl><type><name><name>Class</name><argument_list type="generic">&lt;<argument><name>?</name> <extends>extends <name>DefaultHttpClient</name></extends></argument>&gt;</argument_list></name></type> <name>defaultHttpClient</name></decl></parameter>, <parameter><decl><type><name><name>Class</name><argument_list type="generic">&lt;<argument><name>?</name> <extends>extends <name>SystemDefaultHttpClient</name></extends></argument>&gt;</argument_list></name></type> <name>systemDefaultHttpClient</name></decl></parameter>)</parameter_list> <block>{<block_content>
      <expr_stmt><expr><name>defaultHttpClientClass</name> <operator>=</operator> <name>defaultHttpClient</name></expr>;</expr_stmt>
      <expr_stmt><expr><name>systemDefaultHttpClientClass</name> <operator>=</operator> <name>systemDefaultHttpClient</name></expr>;</expr_stmt>
    </block_content>}</block></function>
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>setCookiePolicy</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>policyName</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name>cookiePolicy</name> <operator>=</operator> <name>policyName</name></expr>;</expr_stmt>
   </block_content>}</block></function>
 

 </block_content>}</block></function>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpSolrClient</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpSolrClient</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>fe445970561</name><operator>..</operator><literal type="number">29a56a65194</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpSolrClient</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpSolrClient</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">24</literal> @@
  <operator>*</operator><operator>/</operator></expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name></name>;</package>
 
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>InputStream</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>UnsupportedEncodingException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>ConnectException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>SocketTimeoutException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>nio</name><operator>.</operator><name>charset</name><operator>.</operator><name>StandardCharsets</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collection</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Iterator</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>LinkedList</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Locale</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Set</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Callable</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutorService</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Future</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>commons</name><operator>.</operator><name>io</name><operator>.</operator><name>IOUtils</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>Header</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpEntity</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">23</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">41</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpStatus</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>NameValuePair</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>RequestConfig</name><operator>.</operator><name>Builder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>entity</name><operator>.</operator><name>UrlEncodedFormEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpEntityEnclosingRequestBase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpGet</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">30</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">49</literal></expr><operator>,</operator><expr><literal type="number">15</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpPost</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpPut</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpRequestBase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpUriRequest</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ClientConnectionManager</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>HttpClientConnectionManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>ContentType</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>InputStreamEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>mime</name><operator>.</operator><name>FormBodyPart</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>mime</name><operator>.</operator><name>HttpMultipartMode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>mime</name><operator>.</operator><name>MultipartEntity</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>mime</name><operator>.</operator><name>MultipartEntityBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>mime</name><operator>.</operator><name>content</name><operator>.</operator><name>InputStreamBody</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>mime</name><operator>.</operator><name>content</name><operator>.</operator><name>StringBody</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>message</name><operator>.</operator><name>BasicHeader</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>message</name><operator>.</operator><name>BasicNameValuePair</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>util</name><operator>.</operator><name>EntityUtils</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">61</literal></expr><operator>,</operator><expr><literal type="number">24</literal> <operator>+</operator><literal type="number">80</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>MDC</name></name>;</import>
 
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>InputStream</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>UnsupportedEncodingException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>ConnectException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>SocketTimeoutException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>nio</name><operator>.</operator><name>charset</name><operator>.</operator><name>StandardCharsets</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collection</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Iterator</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>LinkedList</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Locale</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Set</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Callable</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>ExecutorService</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>Future</name></name>;</import>

 <comment type="block" format="javadoc">/**
  * A SolrClient implementation that talks directly to a Solr server via HTTP
  *
@@ -145,13 +146,15 @@ public class HttpSolrClient extends SolrClient {
   
   private final HttpClient httpClient;
   
  private volatile boolean followRedirects = false;
  private volatile Boolean followRedirects = false;
   
   private volatile boolean useMultiPartPost;
   private final boolean internalClient;
 
   private volatile Set&lt;String&gt; queryParams = Collections.emptySet();

  private volatile Integer connectionTimeout;
  private volatile Integer soTimeout;
  
   /**
    * @param baseURL
    *          The URL of the Solr server. For example, "
@@ -166,7 +169,12 @@ public class HttpSolrClient extends SolrClient {
     this(baseURL, client, new BinaryResponseParser());
   }
   
  
   public HttpSolrClient(String baseURL, HttpClient client, ResponseParser parser) {
    this(baseURL, client, parser, false);
  }
  
  public HttpSolrClient(String baseURL, HttpClient client, ResponseParser parser, boolean allowCompression) {
     this.baseUrl = baseURL;
     if (baseUrl.endsWith("/")) {
       baseUrl = baseUrl.substring(0, baseUrl.length() - 1);
@@ -183,9 +191,8 @@ public class HttpSolrClient extends SolrClient {
     } else {
       internalClient = true;
       ModifiableSolrParams params = new ModifiableSolrParams();
      params.set(HttpClientUtil.PROP_MAX_CONNECTIONS, 128);
      params.set(HttpClientUtil.PROP_MAX_CONNECTIONS_PER_HOST, 32);
       params.set(HttpClientUtil.PROP_FOLLOW_REDIRECTS, followRedirects);
      params.set(HttpClientUtil.PROP_ALLOW_COMPRESSION, allowCompression);
       httpClient = HttpClientUtil.createClient(params);
     }
     
@@ -344,6 +351,7 @@ public class HttpSolrClient extends SolrClient {
       if (streams != null) {
         throw new SolrException(SolrException.ErrorCode.BAD_REQUEST, "GET can't send streams!");
       }

       return new HttpGet(basePath + path + wparams.toQueryString());
     }
 
@@ -370,6 +378,7 @@ public class HttpSolrClient extends SolrClient {
         String fullQueryUrl = url + queryParams.toQueryString();
         HttpEntityEnclosingRequestBase postOrPut = SolrRequest.METHOD.POST == request.getMethod() ?
             new HttpPost(fullQueryUrl) : new HttpPut(fullQueryUrl);

         if (!isMultipart) {
           postOrPut.addHeader("Content-Type",
               "application/x-www-form-urlencoded; charset=UTF-8");
@@ -391,6 +400,7 @@ public class HttpSolrClient extends SolrClient {
           }
         }
 
        // TODO: remove deprecated - first simple attempt failed, see {@link MultipartEntityBuilder}
         if (isMultipart &amp;&amp; streams != null) {
           for (ContentStream content : streams) {
             String contentType = content.getContentType();
@@ -473,13 +483,26 @@ public class HttpSolrClient extends SolrClient {
   
   protected NamedList&lt;Object&gt; executeMethod(HttpRequestBase method, final ResponseParser processor) throws SolrServerException {
     method.addHeader("User-Agent", AGENT);
 
    Builder requestConfigBuilder = HttpClientUtil.createDefaultRequestConfigBuilder();
    if (soTimeout != null) {
      requestConfigBuilder.setSocketTimeout(soTimeout);
    }
    if (connectionTimeout != null) {
      requestConfigBuilder.setConnectTimeout(connectionTimeout);
    }
    if (followRedirects != null) {
      requestConfigBuilder.setRedirectsEnabled(followRedirects);
    }

    method.setConfig(requestConfigBuilder.build());
     
     HttpEntity entity = null;
     InputStream respBody = null;
     boolean shouldClose = true;
     try {
       // Execute the method.
      final HttpResponse response = httpClient.execute(method);
      final HttpResponse response = httpClient.execute(method, HttpClientUtil.createNewHttpClientRequestContext());
       int httpStatus = response.getStatusLine().getStatusCode();
       
       // Read the contents
@@ -647,7 +670,7 @@ public class HttpSolrClient extends SolrClient {
    *          Timeout in milliseconds
    **/</comment>
   <function><type><specifier>public</specifier> <name>void</name></type> <name>setConnectionTimeout</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>timeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>connectionTimeout</name></name> <operator>=</operator> <name>timeout</name></expr>;</expr_stmt>
   </block_content>}</block></function>
   
   <comment type="block" format="javadoc">/**
@@ -658,7 +681,7 @@ public class HttpSolrClient extends SolrClient {
    *          Timeout in milliseconds
    **/</comment>
   <function><type><specifier>public</specifier> <name>void</name></type> <name>setSoTimeout</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>timeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>soTimeout</name></name> <operator>=</operator> <name>timeout</name></expr>;</expr_stmt>
   </block_content>}</block></function>
   
   <comment type="block" format="javadoc">/**
@@ -671,22 +694,6 @@ public class HttpSolrClient extends SolrClient {
    */</comment>
   <function><type><specifier>public</specifier> <name>void</name></type> <name>setFollowRedirects</name><parameter_list>(<parameter><decl><type><name>boolean</name></type> <name>followRedirects</name></decl></parameter>)</parameter_list> <block>{<block_content>
     <expr_stmt><expr><name><name>this</name><operator>.</operator><name>followRedirects</name></name> <operator>=</operator> <name>followRedirects</name></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setFollowRedirects</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,  <argument><expr><name>followRedirects</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>
  
  <comment type="block" format="javadoc">/**
   * Allow server-&amp;gt;client communication to be compressed. Currently gzip and
   * deflate are supported. If the server supports compression the response will
   * be compressed. This method is only allowed if the http client is of type
   * DefatulHttpClient.
   */</comment>
  <function><type><specifier>public</specifier> <name>void</name></type> <name>setAllowCompression</name><parameter_list>(<parameter><decl><type><name>boolean</name></type> <name>allowCompression</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>httpClient</name> <operator>instanceof</operator> <name>DefaultHttpClient</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setAllowCompression</name></name><argument_list>(<argument><expr><operator>(</operator><name>DefaultHttpClient</name><operator>)</operator> <name>httpClient</name></expr></argument>, <argument><expr><name>allowCompression</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <else>else <block>{<block_content>
      <throw>throw <expr><operator>new</operator> <call><name>UnsupportedOperationException</name><argument_list>(
          <argument><expr><literal type="string">"HttpClient instance was not of type DefaultHttpClient"</literal></expr></argument>)</argument_list></call></expr>;</throw>
    </block_content>}</block></else></if_stmt>
   </block_content>}</block></function>
   
   <function><type><specifier>public</specifier> <name>void</name></type> <name>setRequestWriter</name><parameter_list>(<parameter><decl><type><name>RequestWriter</name></type> <name>requestWriter</name></decl></parameter>)</parameter_list> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">694</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">701</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpSolrClient</name> extends <name>SolrClient</name> <block>{
   }</block>
   
   <comment type="block" format="javadoc">/**
   * Close the {@link ClientConnectionManager} from the internal client.
   * Close the {@link HttpClientConnectionManager} from the internal client.
    */</comment>
   @<name>Override</name>
   <specifier>public</specifier> <name>void</name> <call><name>close</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{</block></expr></argument>
@<argument>@ <expr><operator>-</operator><literal type="number">702</literal></expr></argument>,<argument><expr><literal type="number">33</literal> <operator>+</operator><literal type="number">709</literal></expr></argument>,<argument><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>HttpSolrClient</name> extends <name>SolrClient</name></expr></argument></throws> <block>{<block_content>
       <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></expr></expr_stmt>
   </block_content>}</block></function>

  <comment type="block" format="javadoc">/**
   * Set the maximum number of connections that can be open to a single host at
   * any given time. If http client was created outside the operation is not
   * allowed.
   */</comment>
  <function><type><specifier>public</specifier> <name>void</name></type> <name>setDefaultMaxConnectionsPerHost</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>max</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>internalClient</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>max</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <else>else <block>{<block_content>
      <throw>throw <expr><operator>new</operator> <call><name>UnsupportedOperationException</name><argument_list>(
          <argument><expr><literal type="string">"Client was created outside of HttpSolrServer"</literal></expr></argument>)</argument_list></call></expr>;</throw>
    </block_content>}</block></else></if_stmt>
  </block_content>}</block></function>
  
  <comment type="block" format="javadoc">/**
   * Set the maximum number of connections that can be open at any given time.
   * If http client was created outside the operation is not allowed.
   */</comment>
  <function><type><specifier>public</specifier> <name>void</name></type> <name>setMaxTotalConnections</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>max</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>internalClient</name></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setMaxConnections</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>max</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if> <else>else <block>{<block_content>
      <throw>throw <expr><operator>new</operator> <call><name>UnsupportedOperationException</name><argument_list>(
          <argument><expr><literal type="string">"Client was created outside of HttpSolrServer"</literal></expr></argument>)</argument_list></call></expr>;</throw>
    </block_content>}</block></else></if_stmt>
  </block_content>}</block></function>
   
   <function><type><specifier>public</specifier> <name>boolean</name></type> <name>isUseMultiPartPost</name><parameter_list>()</parameter_list> <block>{<block_content>
     <return>return <expr><name>useMultiPartPost</name></expr>;</return>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>Krb5HttpClientConfigurer</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>Krb5HttpClientBuilder</name><operator>.</operator><name>java</name></name>
<name>similarity</name> <name>index</name> <literal type="number">67</literal><operator>%</operator>
<name>rename</name> <name>from</name> <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>Krb5HttpClientConfigurer</name><operator>.</operator><name>java</name></name>
<name>rename</name> <name>to</name> <name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>Krb5HttpClientBuilder</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">8b2705bdc5f</literal><operator>..</operator><literal type="number">6c7c64f2cd1</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>Krb5HttpClientConfigurer</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>Krb5HttpClientBuilder</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">32</literal> <operator>+</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">47</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpEntityEnclosingRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequestInterceptor</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>AuthSchemeProvider</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>AuthScope</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>Credentials</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>AuthSchemeRegistry</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>CredentialsProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>AuthSchemes</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>Lookup</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>RegistryBuilder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>cookie</name><operator>.</operator><name>CookieSpecProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>BufferedHttpEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>auth</name><operator>.</operator><name>SPNegoSchemeFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>BasicCredentialsProvider</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpContext</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>AuthSchemes</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>params</name><operator>.</operator><name>ClientPNames</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name><operator>.</operator><name>AuthSchemeRegistryProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name><operator>.</operator><name>CookieSpecRegistryProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name><operator>.</operator><name>CredentialsProviderProvider</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>BufferedHttpEntity</name></name>;</import>
 
 <comment type="block" format="javadoc">/**
 * Kerberos-enabled HttpClientConfigurer
 * Kerberos-enabled SolrHttpClientBuilder
  */</comment>
<class><specifier>public</specifier> class <name>Krb5HttpClientConfigurer</name> <super_list><extends>extends <super><name>HttpClientConfigurer</name></super></extends></super_list> <block>{
<class><specifier>public</specifier> class <name>Krb5HttpClientBuilder</name>  <block>{
   
   <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>LOGIN_CONFIG_PROP</name> <init>= <expr><literal type="string">"java.security.auth.login.config"</literal></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>Logger</name></type> <name>logger</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><call><name><name>MethodHandles</name><operator>.</operator><name>lookup</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lookupClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
   
   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>Configuration</name></type> <name>jaasConfig</name> <init>= <expr><operator>new</operator> <call><name>SolrJaasConfiguration</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
 
  <function><type><specifier>public</specifier> <name>void</name></type> <name>configure</name><parameter_list>(<parameter><decl><type><name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>SolrParams</name></type> <name>config</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>super</name><operator>.</operator><name>configure</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  <constructor><specifier>public</specifier> <name>Krb5HttpClientBuilder</name><parameter_list>()</parameter_list> <block>{<block_content>
 
  </block_content>}</block></constructor>
  
  <function><type><specifier>public</specifier> <name>SolrHttpClientBuilder</name></type> <name>getBuilder</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><call><name>getBuilder</name><argument_list>(<argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>getHttpClientBuilder</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <name>void</name></type> <name>close</name><parameter_list>()</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>removeRequestInterceptor</name></name><argument_list>(<argument><expr><name>bufferedEntityInterceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <name>SolrHttpClientBuilder</name></type> <name>getBuilder</name><parameter_list>(<parameter><decl><type><name>SolrHttpClientBuilder</name></type> <name>builder</name></decl></parameter>)</parameter_list> <block>{<block_content>
     <if_stmt><if>if <condition>(<expr><call><name><name>System</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><name>LOGIN_CONFIG_PROP</name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <decl_stmt><decl><type><name>String</name></type> <name>configValue</name> <init>= <expr><call><name><name>System</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><name>LOGIN_CONFIG_PROP</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">80</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">95</literal></expr><operator>,</operator><expr><literal type="number">16</literal> @@ <specifier>public</specifier> <name>class</name> <name>Krb5HttpClientConfigurer</name> extends <name>HttpClientConfigurer</name> <block>{
 
         <expr><call><name><name>javax</name><operator>.</operator><name>security</name><operator>.</operator><name>auth</name><operator>.</operator><name>login</name><operator>.</operator><name>Configuration</name><operator>.</operator><name>setConfiguration</name></name><argument_list>(<argument><expr><name>jaasConfig</name></expr></argument>)</argument_list></call></expr>;
         <comment type="line">//Enable only SPNEGO authentication scheme.</comment>
        <name>AuthSchemeRegistry</name> <name>registry</name> <operator>=</operator> <operator>new</operator> <call><name>AuthSchemeRegistry</name><argument_list>()</argument_list></call></block></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>registry</name><operator>.</operator><name>register</name></name><argument_list>(<argument><expr><name><name>AuthSchemes</name><operator>.</operator><name>SPNEGO</name></name></expr></argument>, <argument><expr><operator>new</operator> <call><name>SPNegoSchemeFactory</name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>setAuthSchemes</name></name><argument_list>(<argument><expr><name>registry</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt><expr><call><name><name>builder</name><operator>.</operator><name>setAuthSchemeRegistryProvider</name></name><argument_list>(<argument><expr><operator>new</operator> <class><super><name>AuthSchemeRegistryProvider</name></super><argument_list>()</argument_list> <block>{
          <function><annotation>@<name>Override</name></annotation>
          <type><specifier>public</specifier> <name><name>Lookup</name><argument_list type="generic">&lt;<argument><name>AuthSchemeProvider</name></argument>&gt;</argument_list></name></type> <name>getAuthSchemeRegistry</name><parameter_list>()</parameter_list> <block>{<block_content>
            <decl_stmt><decl><type><name><name>Lookup</name><argument_list type="generic">&lt;<argument><name>AuthSchemeProvider</name></argument>&gt;</argument_list></name></type> <name>authProviders</name> <init>= <expr><name><name>RegistryBuilder</name><operator>.</operator></name>&lt;<name>AuthSchemeProvider</name><operator>&gt;</operator><call><name>create</name><argument_list>()</argument_list></call>
                <operator>.</operator><call><name>register</name><argument_list>(<argument><expr><name><name>AuthSchemes</name><operator>.</operator><name>SPNEGO</name></name></expr></argument>, <argument><expr><operator>new</operator> <call><name>SPNegoSchemeFactory</name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call>                
                <operator>.</operator><call><name>build</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
            <return>return <expr><name>authProviders</name></expr>;</return>
          </block_content>}</block></function>
        }</block></class></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         <comment type="line">// Get the credentials from the JAAS configuration rather than here</comment>
         <decl_stmt><decl><type><name>Credentials</name></type> <name>useJaasCreds</name> <init>= <expr><operator>new</operator> <class><super><name>Credentials</name></super><argument_list>()</argument_list> <block>{
           <function><type><specifier>public</specifier> <name>String</name></type> <name>getPassword</name><parameter_list>()</parameter_list> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">92</literal></expr><operator>,</operator><expr><literal type="number">18</literal> <operator>+</operator><literal type="number">114</literal></expr><operator>,</operator><expr><literal type="number">35</literal> @@ <specifier>public</specifier> <name>class</name> <name>Krb5HttpClientConfigurer</name> extends <name>HttpClientConfigurer</name> <block>{
             <return>return <expr><literal type="null">null</literal></expr>;</return>
           }</block></expr></expr_stmt>
         </block_content>}</block></function><empty_stmt>;</empty_stmt>

        <decl_stmt><decl><type><name>SolrPortAwareCookieSpecFactory</name></type> <name>cookieFactory</name> <init>= <expr><operator>new</operator> <call><name>SolrPortAwareCookieSpecFactory</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>getCookieSpecs</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>register</name><argument_list>(<argument><expr><name><name>cookieFactory</name><operator>.</operator><name>POLICY_NAME</name></name></expr></argument>, <argument><expr><name>cookieFactory</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>setParameter</name><argument_list>(<argument><expr><name><name>ClientPNames</name><operator>.</operator><name>COOKIE_POLICY</name></name></expr></argument>, <argument><expr><name><name>cookieFactory</name><operator>.</operator><name>POLICY_NAME</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         
        <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>getCredentialsProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>setCredentials</name><argument_list>(<argument><expr><name><name>AuthScope</name><operator>.</operator><name>ANY</name></name></expr></argument>, <argument><expr><name>useJaasCreds</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <constructor_decl><name><name>HttpClientUtil</name><operator>.</operator><name>setCookiePolicy</name></name><parameter_list>(<parameter><decl><type><name><name>SolrPortAwareCookieSpecFactory</name><operator>.</operator><name>POLICY_NAME</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        
        <expr_stmt><expr><call><name><name>builder</name><operator>.</operator><name>setCookieSpecRegistryProvider</name></name><argument_list>(<argument><expr><operator>new</operator> <class><super><name>CookieSpecRegistryProvider</name></super><argument_list>()</argument_list> <block>{
          <function><annotation>@<name>Override</name></annotation>
          <type><specifier>public</specifier> <name><name>Lookup</name><argument_list type="generic">&lt;<argument><name>CookieSpecProvider</name></argument>&gt;</argument_list></name></type> <name>getCookieSpecRegistry</name><parameter_list>()</parameter_list> <block>{<block_content>
            <decl_stmt><decl><type><name>SolrPortAwareCookieSpecFactory</name></type> <name>cookieFactory</name> <init>= <expr><operator>new</operator> <call><name>SolrPortAwareCookieSpecFactory</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
 
        <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>addRequestInterceptor</name></name><argument_list>(<argument><expr><name>bufferedEntityInterceptor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></function> <if_stmt><else>else <block>{<block_content>
        <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>getCredentialsProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>clear</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            <decl_stmt><decl><type><name><name>Lookup</name><argument_list type="generic">&lt;<argument><name>CookieSpecProvider</name></argument>&gt;</argument_list></name></type> <name>cookieRegistry</name> <init>= <expr><name><name>RegistryBuilder</name><operator>.</operator></name>&lt;<name>CookieSpecProvider</name><operator>&gt;</operator> <call><name>create</name><argument_list>()</argument_list></call>
                <operator>.</operator><call><name>register</name><argument_list>(<argument><expr><name><name>SolrPortAwareCookieSpecFactory</name><operator>.</operator><name>POLICY_NAME</name></name></expr></argument>, <argument><expr><name>cookieFactory</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>build</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

            <return>return <expr><name>cookieRegistry</name></expr>;</return>
          </block_content>}</block></else></if_stmt>
        }</block></class></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        
        <expr_stmt><expr><call><name><name>builder</name><operator>.</operator><name>setDefaultCredentialsProvider</name></name><argument_list>(<argument><expr><operator>new</operator> <class><super><name>CredentialsProviderProvider</name></super><argument_list>()</argument_list> <block>{
          
          <function><annotation>@<name>Override</name></annotation>
          <type><specifier>public</specifier> <name>CredentialsProvider</name></type> <name>getCredentialsProvider</name><parameter_list>()</parameter_list> <block>{<block_content>
            <decl_stmt><decl><type><name>CredentialsProvider</name></type> <name>credentialsProvider</name> <init>= <expr><operator>new</operator> <call><name>BasicCredentialsProvider</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>credentialsProvider</name><operator>.</operator><name>setCredentials</name></name><argument_list>(<argument><expr><name><name>AuthScope</name><operator>.</operator><name>ANY</name></name></expr></argument>, <argument><expr><name>useJaasCreds</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <return>return <expr><name>credentialsProvider</name></expr>;</return>
          </block_content>}</block></function>
        }</block></class></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <constructor_decl><name><name>HttpClientUtil</name><operator>.</operator><name>addRequestInterceptor</name></name><parameter_list>(<parameter><decl><type><name>bufferedEntityInterceptor</name></type></decl></parameter>)</parameter_list>;</constructor_decl>
       }</block></class></expr></init></decl></decl_stmt>
     </block_content>}</block></if></if_stmt>
    
    <return>return <expr><name>builder</name></expr>;</return>
   </block_content>}</block></function>
 
   <comment type="line">// Set a buffered entity based request interceptor</comment>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClient</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClient</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">6d4711e8faf</literal><operator>..</operator><name>fabb933d104</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClient</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClient</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">109</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">109</literal></expr><operator>,</operator><expr><literal type="number">9</literal> @@ <specifier>public</specifier> <name>class</name> <name>LBHttpSolrClient</name> extends <name>SolrClient</name> <block>{
   <expr><specifier>private</specifier> <specifier>volatile</specifier> <name>RequestWriter</name> <name>requestWriter</name></expr>;
 
   <specifier>private</specifier> <name><name>Set</name><argument_list type="generic">&lt;<argument><name>String</name></argument>&gt;</argument_list></name> <name>queryParams</name> <operator>=</operator> <operator>new</operator> <call><name><name>HashSet</name><argument_list type="generic">&lt;&gt;</argument_list></name><argument_list>()</argument_list></call></block></expr>;</expr_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <name>Integer</name></type> <name>connectionTimeout</name></decl>;</decl_stmt>

  <decl_stmt><decl><type><specifier>private</specifier> <name>Integer</name></type> <name>soTimeout</name></decl>;</decl_stmt>
 
   <static>static <block>{<block_content>
     <expr_stmt><expr><call><name><name>solrQuery</name><operator>.</operator><name>setRows</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">261</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">264</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> <name>class</name> <name>LBHttpSolrClient</name> extends <name>SolrClient</name> <block>{
 
   <expr><specifier>protected</specifier> <name>HttpSolrClient</name> <call><name>makeSolrClient</name><argument_list>(<argument><expr><name>String</name> <name>server</name></expr></argument>)</argument_list></call> <block>{
     <expr><name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>server</name></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>parser</name></expr></argument>)</argument_list></call></expr>;</block></expr>
    <if_stmt><if>if <condition>(<expr><name>connectionTimeout</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>connectionTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt></block></expr></expr_stmt>
    <if_stmt><if>if <condition>(<expr><name>soTimeout</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>soTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
     <if_stmt><if>if <condition>(<expr><name>requestWriter</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setRequestWriter</name></name><argument_list>(<argument><expr><name>requestWriter</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if></if_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">459</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">468</literal></expr><operator>,</operator><expr><literal type="number">17</literal> @@ <specifier>public</specifier> <name>class</name> <name>LBHttpSolrClient</name> extends <name>SolrClient</name> <block>{
   }</block>
 
   <specifier>public</specifier> <name>void</name> <call><name>setConnectionTimeout</name><argument_list>(<argument><expr><name>int</name> <name>timeout</name></expr></argument>)</argument_list></call> <block>{
    <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;
    <name><name>this</name><operator>.</operator><name>connectionTimeout</name></name> <operator>=</operator> <name>timeout</name></block></expr>;</expr_stmt>
    <synchronized>synchronized <init>(<expr><name>aliveServers</name></expr>)</init> <block>{<block_content>
      <decl_stmt><decl><type><name><name>Iterator</name><argument_list type="generic">&lt;<argument><name>ServerWrapper</name></argument>&gt;</argument_list></name></type> <name>wrappersIt</name> <init>= <expr><call><name><name>aliveServers</name><operator>.</operator><name>values</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>iterator</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <while>while <condition>(<expr><call><name><name>wrappersIt</name><operator>.</operator><name>hasNext</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><call><name><name>wrappersIt</name><operator>.</operator><name>next</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></while>
    </block_content>}</block></synchronized>
    <decl_stmt><decl><type><name><name>Iterator</name><argument_list type="generic">&lt;<argument><name>ServerWrapper</name></argument>&gt;</argument_list></name></type> <name>wrappersIt</name> <init>= <expr><call><name><name>zombieServers</name><operator>.</operator><name>values</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>iterator</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <while>while <condition>(<expr><call><name><name>wrappersIt</name><operator>.</operator><name>hasNext</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>wrappersIt</name><operator>.</operator><name>next</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></while>
   </block_content>}</block></static>
 
   <comment type="block" format="javadoc">/**
@@ -467,7 +486,17 @@ public class LBHttpSolrClient extends SolrClient {
    * not for indexing.
    */</comment>
   <function><type><specifier>public</specifier> <name>void</name></type> <name>setSoTimeout</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>timeout</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>soTimeout</name></name> <operator>=</operator> <name>timeout</name></expr>;</expr_stmt>
    <synchronized>synchronized <init>(<expr><name>aliveServers</name></expr>)</init> <block>{<block_content>
      <decl_stmt><decl><type><name><name>Iterator</name><argument_list type="generic">&lt;<argument><name>ServerWrapper</name></argument>&gt;</argument_list></name></type> <name>wrappersIt</name> <init>= <expr><call><name><name>aliveServers</name><operator>.</operator><name>values</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>iterator</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <while>while <condition>(<expr><call><name><name>wrappersIt</name><operator>.</operator><name>hasNext</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><call><name><name>wrappersIt</name><operator>.</operator><name>next</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></while>
    </block_content>}</block></synchronized>
    <decl_stmt><decl><type><name><name>Iterator</name><argument_list type="generic">&lt;<argument><name>ServerWrapper</name></argument>&gt;</argument_list></name></type> <name>wrappersIt</name> <init>= <expr><call><name><name>zombieServers</name><operator>.</operator><name>values</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>iterator</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <while>while <condition>(<expr><call><name><name>wrappersIt</name><operator>.</operator><name>hasNext</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>wrappersIt</name><operator>.</operator><name>next</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>timeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></while>
   </block_content>}</block></function>
 
   <annotation>@<name>Override</name></annotation>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientBuilder</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientBuilder</name><operator>.</operator><name>java</name></name>
<operator>new</operator> <name>file</name> <name>mode</name> <literal type="number">100644</literal>
<name>index</name> <literal type="number">00000000000..98217f81595</literal>
<operator>--</operator> <operator>/</operator><name>dev</name><operator>/</operator><literal type="null">null</literal>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientBuilder</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">0</literal></expr><operator>,</operator><expr><literal type="number">0</literal> <operator>+</operator><literal type="number">1</literal></expr><operator>,</operator><expr><literal type="number">91</literal> @@</expr></expr_stmt>
<comment type="block">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</comment>
<package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name></name>;</package>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequestInterceptor</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>AuthSchemeProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>CredentialsProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>Lookup</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>cookie</name><operator>.</operator><name>CookieSpecProvider</name></name>;</import>

<comment type="block" format="javadoc">/**
 * Builder class for configuring internal HttpClients. This
 * relies on the internal HttpClient implementation and is subject to
 * change.
 * 
 * @lucene.experimental
 */</comment>
<class><specifier>public</specifier> class <name>SolrHttpClientBuilder</name> <block>{
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>SolrHttpClientBuilder</name></type> <name>create</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><operator>new</operator> <call><name>SolrHttpClientBuilder</name><argument_list>()</argument_list></call></expr>;</return>
  </block_content>}</block></function>
  
  <interface><specifier>public</specifier> interface <name>HttpRequestInterceptorProvider</name> <block>{
    <function_decl><type><specifier>public</specifier> <name>HttpRequestInterceptor</name></type> <name>getHttpRequestInterceptor</name><parameter_list>()</parameter_list>;</function_decl>
  }</block></interface>
  
  <interface><specifier>public</specifier> interface <name>CredentialsProviderProvider</name> <block>{
    <function_decl><type><specifier>public</specifier> <name>CredentialsProvider</name></type> <name>getCredentialsProvider</name><parameter_list>()</parameter_list>;</function_decl>
  }</block></interface>
  
  <interface><specifier>public</specifier> interface <name>AuthSchemeRegistryProvider</name> <block>{
    <function_decl><type><specifier>public</specifier> <name><name>Lookup</name><argument_list type="generic">&lt;<argument><name>AuthSchemeProvider</name></argument>&gt;</argument_list></name></type> <name>getAuthSchemeRegistry</name><parameter_list>()</parameter_list>;</function_decl>
  }</block></interface>
  
  <interface><specifier>public</specifier> interface <name>CookieSpecRegistryProvider</name> <block>{
    <function_decl><type><specifier>public</specifier> <name><name>Lookup</name><argument_list type="generic">&lt;<argument><name>CookieSpecProvider</name></argument>&gt;</argument_list></name></type> <name>getCookieSpecRegistry</name><parameter_list>()</parameter_list>;</function_decl>
  }</block></interface>
  
  <decl_stmt><decl><type><specifier>private</specifier> <name>CookieSpecRegistryProvider</name></type> <name>cookieSpecRegistryProvider</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <name>AuthSchemeRegistryProvider</name></type> <name>authSchemeRegistryProvider</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <name>CredentialsProviderProvider</name></type> <name>credentialsProviderProvider</name></decl>;</decl_stmt>

  <constructor><specifier>protected</specifier> <name>SolrHttpClientBuilder</name><parameter_list>()</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name>super</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></constructor>

  <function><type><specifier>public</specifier> <specifier>final</specifier> <name>SolrHttpClientBuilder</name></type> <name>setCookieSpecRegistryProvider</name><parameter_list>(
      <parameter><decl><type><specifier>final</specifier> <name>CookieSpecRegistryProvider</name></type> <name>cookieSpecRegistryProvider</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>cookieSpecRegistryProvider</name></name> <operator>=</operator> <name>cookieSpecRegistryProvider</name></expr>;</expr_stmt>
    <return>return <expr><name>this</name></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>final</specifier> <name>SolrHttpClientBuilder</name></type> <name>setDefaultCredentialsProvider</name><parameter_list>(
      <parameter><decl><type><specifier>final</specifier> <name>CredentialsProviderProvider</name></type> <name>credentialsProviderProvider</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>credentialsProviderProvider</name></name> <operator>=</operator> <name>credentialsProviderProvider</name></expr>;</expr_stmt>
    <return>return <expr><name>this</name></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>final</specifier> <name>SolrHttpClientBuilder</name></type> <name>setAuthSchemeRegistryProvider</name><parameter_list>(
      <parameter><decl><type><specifier>final</specifier> <name>AuthSchemeRegistryProvider</name></type> <name>authSchemeRegistryProvider</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>authSchemeRegistryProvider</name></name> <operator>=</operator> <name>authSchemeRegistryProvider</name></expr>;</expr_stmt>
    <return>return <expr><name>this</name></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>AuthSchemeRegistryProvider</name></type> <name>getAuthSchemeRegistryProvider</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>authSchemeRegistryProvider</name></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>CookieSpecRegistryProvider</name></type> <name>getCookieSpecRegistryProvider</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>cookieSpecRegistryProvider</name></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>CredentialsProviderProvider</name></type> <name>getCredentialsProviderProvider</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>credentialsProviderProvider</name></expr>;</return>
  </block_content>}</block></function>

}</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientContextBuilder</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientContextBuilder</name><operator>.</operator><name>java</name></name>
<operator>new</operator> <name>file</name> <name>mode</name> <literal type="number">100644</literal>
<name>index</name> <literal type="number">00000000000..b678df7ea19</literal>
<operator>--</operator> <operator>/</operator><name>dev</name><operator>/</operator><literal type="null">null</literal>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>SolrHttpClientContextBuilder</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">0</literal></expr><operator>,</operator><expr><literal type="number">0</literal> <operator>+</operator><literal type="number">1</literal></expr><operator>,</operator><expr><literal type="number">96</literal> @@</expr></expr_stmt>
<comment type="block">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</comment>
<package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name></name>;</package>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>AuthSchemeProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>CredentialsProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpClientContext</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>Lookup</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>cookie</name><operator>.</operator><name>CookieSpecProvider</name></name>;</import>

<class><specifier>public</specifier> class <name>SolrHttpClientContextBuilder</name> <block>{
  <function><type><specifier>public</specifier> <specifier>static</specifier> <name>SolrHttpClientContextBuilder</name></type> <name>create</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><operator>new</operator> <call><name>SolrHttpClientContextBuilder</name><argument_list>()</argument_list></call></expr>;</return>
  </block_content>}</block></function>
  
  <class><specifier>public</specifier> <specifier>static</specifier> <specifier>abstract</specifier> class <name>CredentialsProviderProvider</name> <block>{
    <function_decl><type><specifier>public</specifier> <specifier>abstract</specifier> <name>CredentialsProvider</name></type> <name>getCredentialsProvider</name><parameter_list>()</parameter_list>;</function_decl>
  }</block></class>
  
  <class><specifier>public</specifier> <specifier>static</specifier> <specifier>abstract</specifier> class <name>AuthSchemeRegistryProvider</name> <block>{
    <function_decl><type><specifier>public</specifier> <specifier>abstract</specifier> <name><name>Lookup</name><argument_list type="generic">&lt;<argument><name>AuthSchemeProvider</name></argument>&gt;</argument_list></name></type> <name>getAuthSchemeRegistry</name><parameter_list>()</parameter_list>;</function_decl>
  }</block></class>
  
  <class><specifier>public</specifier> <specifier>static</specifier> <specifier>abstract</specifier> class <name>CookieSpecRegistryProvider</name> <block>{
    <function_decl><type><specifier>public</specifier> <specifier>abstract</specifier> <name><name>Lookup</name><argument_list type="generic">&lt;<argument><name>CookieSpecProvider</name></argument>&gt;</argument_list></name></type> <name>getCookieSpecRegistry</name><parameter_list>()</parameter_list>;</function_decl>
  }</block></class>
  
  <decl_stmt><decl><type><specifier>private</specifier> <name>CookieSpecRegistryProvider</name></type> <name>cookieSpecRegistryProvider</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <name>AuthSchemeRegistryProvider</name></type> <name>authSchemeRegistryProvider</name></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <name>CredentialsProviderProvider</name></type> <name>credentialsProviderProvider</name></decl>;</decl_stmt>

  <constructor><specifier>public</specifier> <name>SolrHttpClientContextBuilder</name><parameter_list>()</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name>super</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></constructor>

  <function><type><specifier>public</specifier> <specifier>final</specifier> <name>SolrHttpClientContextBuilder</name></type> <name>setCookieSpecRegistryProvider</name><parameter_list>(
      <parameter><decl><type><specifier>final</specifier> <name>CookieSpecRegistryProvider</name></type> <name>cookieSpecRegistryProvider</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>cookieSpecRegistryProvider</name></name> <operator>=</operator> <name>cookieSpecRegistryProvider</name></expr>;</expr_stmt>
    <return>return <expr><name>this</name></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>final</specifier> <name>SolrHttpClientContextBuilder</name></type> <name>setDefaultCredentialsProvider</name><parameter_list>(
      <parameter><decl><type><specifier>final</specifier> <name>CredentialsProviderProvider</name></type> <name>credentialsProviderProvider</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>credentialsProviderProvider</name></name> <operator>=</operator> <name>credentialsProviderProvider</name></expr>;</expr_stmt>
    <return>return <expr><name>this</name></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <specifier>final</specifier> <name>SolrHttpClientContextBuilder</name></type> <name>setAuthSchemeRegistryProvider</name><parameter_list>(
      <parameter><decl><type><specifier>final</specifier> <name>AuthSchemeRegistryProvider</name></type> <name>authSchemeRegistryProvider</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>authSchemeRegistryProvider</name></name> <operator>=</operator> <name>authSchemeRegistryProvider</name></expr>;</expr_stmt>
    <return>return <expr><name>this</name></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>AuthSchemeRegistryProvider</name></type> <name>getAuthSchemeRegistryProvider</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>authSchemeRegistryProvider</name></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>CookieSpecRegistryProvider</name></type> <name>getCookieSpecRegistryProvider</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>cookieSpecRegistryProvider</name></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>public</specifier> <name>CredentialsProviderProvider</name></type> <name>getCredentialsProviderProvider</name><parameter_list>()</parameter_list> <block>{<block_content>
    <return>return <expr><name>credentialsProviderProvider</name></expr>;</return>
  </block_content>}</block></function>
  
  <function><type><specifier>public</specifier> <name>HttpClientContext</name></type> <name>createContext</name><parameter_list>()</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>HttpClientContext</name></type> <name>context</name> <init>= <expr><operator>new</operator> <call><name>HttpClientContext</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><call><name>getCredentialsProviderProvider</name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>context</name><operator>.</operator><name>setCredentialsProvider</name></name><argument_list>(<argument><expr><call><name>getCredentialsProviderProvider</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCredentialsProvider</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    <if_stmt><if>if <condition>(<expr><call><name>getAuthSchemeRegistryProvider</name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>context</name><operator>.</operator><name>setAuthSchemeRegistry</name></name><argument_list>( <argument><expr><call><name>getAuthSchemeRegistryProvider</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getAuthSchemeRegistry</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    
    <if_stmt><if>if <condition>(<expr><call><name>getCookieSpecRegistryProvider</name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <expr_stmt><expr><call><name><name>context</name><operator>.</operator><name>setCookieSpecRegistry</name></name><argument_list>(<argument><expr><call><name>getCookieSpecRegistryProvider</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCookieSpecRegistry</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    
    <return>return <expr><name>context</name></expr>;</return>
  </block_content>}</block></function>

}</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name>
<name>index</name> <literal type="number">9355270fa82</literal><operator>..</operator><name>dae4f6f4181</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>-</operator><name>files</name><operator>/</operator><name><name>log4j</name><operator>.</operator><name>properties</name></name>
@@ <operator>-</operator><literal type="number">28</literal></expr><operator>,</operator><expr><literal type="number">3</literal> <operator>+</operator><literal type="number">28</literal></expr><operator>,</operator><expr><literal type="number">5</literal> @@ <name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>hadoop</name></name><operator>=</operator><name>INFO</name>
 
 #<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>cloud</name><operator>.</operator><name>ClusterStateUtil</name></name><operator>=</operator><name>DEBUG</name>
 #<name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>OverseerAutoReplicaFailoverThread</name></name><operator>=</operator><name>DEBUG</name>

# <name><name>log4j</name><operator>.</operator><name>logger</name><operator>.</operator><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingHttpClientConnectionManager</name></name><operator>=</operator><name>DEBUG</name>
<operator>\</operator> <name>No</name> <name>newline</name> <name>at</name> <name>end</name> <name>of</name> <name>file</name>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleBinaryTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleBinaryTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">04807fe2e75</literal><operator>..</operator><literal type="number">1d70cd9e605</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleBinaryTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleBinaryTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">42</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">42</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrExampleBinaryTest</name> extends <name>SolrExampleTests</name> <block>{
       <expr><name>String</name> <name>url</name> <operator>=</operator> <call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/collection1"</literal></expr>;
       <name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>( <argument><expr><name>url</name></expr></argument> )</argument_list></call></block></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setUseMultiPartPost</name></name><argument_list>(<argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
       <comment type="line">// where the magic happens</comment>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleXMLTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleXMLTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>f1b77e4e38d</name><operator>..</operator><literal type="number">338e449af18</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleXMLTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExampleXMLTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">40</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">40</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrExampleXMLTest</name> extends <name>SolrExampleTests</name> <block>{
       <expr><name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr>;
       <call><name><name>client</name><operator>.</operator><name>setUseMultiPartPost</name></name><argument_list>(<argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setParser</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>XMLResponseParser</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setRequestWriter</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>RequestWriter</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>client</name></expr>;</return>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExceptionTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExceptionTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">75a030d8fb7</literal><operator>..</operator><literal type="number">9fbaffbdc83</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExceptionTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrExceptionTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">38</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">38</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrExceptionTest</name> extends <name>LuceneTestCase</name> <block>{
       <comment type="line">// switched to a local address to avoid going out on the net, ns lookup issues, etc.</comment>
       <comment type="line">// set a 1ms timeout to let the connection fail faster.</comment>
       <expr><name>httpClient</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;
      <call><name><name>HttpClientUtil</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,  <argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>SolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><literal type="string">"http://[ff01::114]:11235/solr/"</literal></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>SolrQuery</name></type> <name>query</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"test123"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>query</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><literal type="string">"http://[ff01::114]:11235/solr/"</literal></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <decl_stmt><decl><type><name>SolrQuery</name></type> <name>query</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"test123"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>query</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></try>
       <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></function> <catch>catch <parameter_list>(<parameter><decl><type><name>SolrServerException</name></type> <name>sse</name></decl></parameter>)</parameter_list> <block>{<block_content>
       <expr_stmt><expr><name>gotExpectedError</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrSchemalessExampleTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrSchemalessExampleTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>dbef180a68e</name><operator>..</operator><literal type="number">317d4cd7c05</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrSchemalessExampleTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>SolrSchemalessExampleTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">23</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">23</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpPost</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>InputStreamEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>BinaryRequestWriter</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>BinaryResponseParser</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>QueryResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrDocument</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>Utils</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>ExternalPaths</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>BeforeClass</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">79</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">81</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrSchemalessExampleTest</name> extends <name>SolrExampleTestsBase</name> <block>{
     <expr><name>HttpPost</name> <name>post</name> <operator>=</operator> <operator>new</operator> <call><name>HttpPost</name><argument_list>(<argument><expr><call><name><name>client</name><operator>.</operator><name>getBaseURL</name></name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/update/json/docs"</literal></expr></argument>)</argument_list></call></expr>;
     <call><name><name>post</name><operator>.</operator><name>setHeader</name></name><argument_list>(<argument><expr><literal type="string">"Content-Type"</literal></expr></argument>, <argument><expr><literal type="string">"application/json"</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>post</name><operator>.</operator><name>setEntity</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>InputStreamEntity</name><argument_list>(<argument><expr><operator>new</operator> <call><name>ByteArrayInputStream</name><argument_list>(<argument><expr><call><name><name>json</name><operator>.</operator><name>getBytes</name></name><argument_list>(<argument><expr><literal type="string">"UTF-8"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>post</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>post</name></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>Utils</name><operator>.</operator><name>consumeFully</name></name><argument_list>(<argument><expr><call><name><name>response</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">200</literal></expr></argument>, <argument><expr><call><name><name>response</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>commit</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>assertNumFound</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>, <argument><expr><literal type="number">2</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">133</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">136</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrSchemalessExampleTest</name> extends <name>SolrExampleTestsBase</name> <block>{
       <expr><name>String</name> <name>url</name> <operator>=</operator> <call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/collection1"</literal></expr>;
       <name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setUseMultiPartPost</name></name><argument_list>(<argument><expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       
       <if_stmt><if>if <condition>(<expr><call><name>random</name><argument_list>()</argument_list></call><operator>.</operator><call><name>nextBoolean</name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>TestLBHttpSolrClient</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>TestLBHttpSolrClient</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">5bebd644617</literal><operator>..</operator><literal type="number">70cd77dc053</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>TestLBHttpSolrClient</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name><name>TestLBHttpSolrClient</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">33</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">33</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>LBHttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>QueryResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>SolrResponseBase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputDocument</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>TimeOut</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>AfterClass</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>BeforeClass</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">92</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">91</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestLBHttpSolrClient</name> extends <name>SolrTestCaseJ4</name> <block>{
   <expr><specifier>public</specifier> <name>void</name> <call><name>setUp</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
     <expr><call><name><name>super</name><operator>.</operator><name>setUp</name></name><argument_list>()</argument_list></call></expr></block></expr></argument></throws></expr>;
     <name>httpClient</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>,  <argument><expr><literal type="number">1000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

     <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <name><name>solr</name><operator>.</operator><name>length</name></name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
       <expr_stmt><expr><name><name>solr</name><index>[<expr><name>i</name></expr>]</index></name> <operator>=</operator> <operator>new</operator> <call><name>SolrInstance</name><argument_list>(<argument><expr><literal type="string">"solr/collection1"</literal> <operator>+</operator> <name>i</name></expr></argument>, <argument><expr><call><name>createTempDir</name><argument_list>(<argument><expr><literal type="string">"instance-"</literal> <operator>+</operator> <name>i</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toFile</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><name><name>solr</name><index>[<expr><name>i</name></expr>]</index></name><operator>.</operator><call><name>setUp</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">125</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">124</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestLBHttpSolrClient</name> extends <name>SolrTestCaseJ4</name> <block>{
         <expr><call><name><name>aSolr</name><operator>.</operator><name>tearDown</name></name><argument_list>()</argument_list></call></expr>;
       }</block></expr></expr_stmt>
     </block_content>}</block></for>
    <expr_stmt><expr><call><name><name>httpClient</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>super</name><operator>.</operator><name>tearDown</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></if></if_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">204</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">203</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestLBHttpSolrClient</name> extends <name>SolrTestCaseJ4</name> <block>{
     <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <name><name>solr</name><operator>.</operator><name>length</name></name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
       <expr_stmt><expr><name><name>s</name><index>[<expr><name>i</name></expr>]</index></name> <operator>=</operator> <name><name>solr</name><index>[<expr><name>i</name></expr>]</index></name><operator>.</operator><call><name>getUrl</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></for>
    <name>ModifiableSolrParams</name> <name>params</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></block></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_CONNECTION_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">250</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">250</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>myHttpClient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>myHttpClient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <try>try <block>{<block_content>
       <decl_stmt><decl><type><name>LBHttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>LBHttpSolrClient</name><argument_list>(<argument><expr><name>myHttpClient</name></expr></argument>, <argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><literal type="number">250</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">250</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setAliveCheckInterval</name></name><argument_list>(<argument><expr><literal type="number">500</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   
       <comment type="line">// Kill a server and test again</comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">225</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">224</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestLBHttpSolrClient</name> extends <name>SolrTestCaseJ4</name> <block>{
       <comment type="line">// Wait for the alive check to complete</comment>
       <expr><call><name>waitForServer</name><argument_list>(<argument><expr><literal type="number">30</literal></expr></argument>, <argument><expr><name>client</name></expr></argument>, <argument><expr><literal type="number">3</literal></expr></argument>, <argument><expr><literal type="string">"solr1"</literal></expr></argument>)</argument_list></call></expr>;
     }</block></expr></expr_stmt> <finally>finally <block>{<block_content>
      <expr_stmt><expr><call><name><name>myHttpClient</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>myHttpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></finally>
   </block_content>}</block></try>
   
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettyWebappTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettyWebappTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>fa22f80dcd2</name><operator>..</operator><literal type="number">467b5705b81</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettyWebappTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>JettyWebappTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">31</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">31</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpRequestBase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClients</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrJettyTestBase</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrTestCaseJ4</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>ExternalPaths</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>Connector</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>server</name><operator>.</operator><name>HttpConnectionFactory</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">108</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">109</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>JettyWebappTest</name> extends <name>SolrTestCaseJ4</name>
 
     <name>HttpClient</name> <name>client</name> <operator>=</operator> <call><name><name>HttpClients</name><operator>.</operator><name>createDefault</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <decl_stmt><decl><type><name>HttpRequestBase</name></type> <name>m</name> <init>= <expr><operator>new</operator> <call><name>HttpGet</name><argument_list>(<argument><expr><name>adminPath</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>client</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>m</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>client</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>m</name></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">200</literal></expr></argument>, <argument><expr><call><name><name>response</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <decl_stmt><decl><type><name>Header</name></type> <name>header</name> <init>= <expr><call><name><name>response</name><operator>.</operator><name>getFirstHeader</name></name><argument_list>(<argument><expr><literal type="string">"X-Frame-Options"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"DENY"</literal></expr></argument>, <argument><expr><call><name><name>header</name><operator>.</operator><name>getValue</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toUpperCase</name><argument_list>(<argument><expr><name><name>Locale</name><operator>.</operator><name>ROOT</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>SolrExampleJettyTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>SolrExampleJettyTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">035619698eb</literal><operator>..</operator><name>d8347cec3c7</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>SolrExampleJettyTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>embedded</name><operator>/</operator><name><name>SolrExampleJettyTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">23</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">23</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>entity</name><operator>.</operator><name>InputStreamEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrTestCaseJ4</name><operator>.</operator><name>SuppressSSL</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrExampleTests</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrQuery</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>response</name><operator>.</operator><name>QueryResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrDocument</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">75</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">76</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>SolrExampleJettyTest</name> extends <name>SolrExampleTests</name> <block>{
     <expr><name>HttpPost</name> <name>post</name> <operator>=</operator> <operator>new</operator> <call><name>HttpPost</name><argument_list>(<argument><expr><call><name><name>client</name><operator>.</operator><name>getBaseURL</name></name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/update/json/docs"</literal></expr></argument>)</argument_list></call></expr>;
     <call><name><name>post</name><operator>.</operator><name>setHeader</name></name><argument_list>(<argument><expr><literal type="string">"Content-Type"</literal></expr></argument>, <argument><expr><literal type="string">"application/json"</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>post</name><operator>.</operator><name>setEntity</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>InputStreamEntity</name><argument_list>(<argument><expr><operator>new</operator> <call><name>ByteArrayInputStream</name><argument_list>(<argument><expr><call><name><name>json</name><operator>.</operator><name>getBytes</name></name><argument_list>(<argument><expr><literal type="string">"UTF-8"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>post</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>post</name></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">200</literal></expr></argument>, <argument><expr><call><name><name>response</name><operator>.</operator><name>getStatusLine</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getStatusCode</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>commit</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <decl_stmt><decl><type><name>QueryResponse</name></type> <name>rsp</name> <init>= <expr><call><name>getSolrClient</name><argument_list>()</argument_list></call><operator>.</operator><call><name>query</name><argument_list>(<argument><expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>BasicHttpSolrClientTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>BasicHttpSolrClientTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">2c7ac9d9652</literal><operator>..</operator><name>ad20e956632</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>BasicHttpSolrClientTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>BasicHttpSolrClientTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">16</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@
  <operator>*</operator><operator>/</operator></expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name></name>;</package>
 
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletException</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServlet</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequest</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletResponse</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>InputStream</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>invoke</name><operator>.</operator><name>MethodHandles</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>URISyntaxException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Arrays</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collection</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Enumeration</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">35</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">31</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Set</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>TreeSet</name></name>;</import>
 
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletException</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServlet</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletRequest</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>servlet</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpServletResponse</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>Header</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpException</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">43</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">44</literal></expr><operator>,</operator><expr><literal type="number">14</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpRequestInterceptor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>HttpResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>ParseException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>CookieStore</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>RequestConfig</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpGet</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>params</name><operator>.</operator><name>HttpClientParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>protocol</name><operator>.</operator><name>ClientContext</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>methods</name><operator>.</operator><name>HttpRequestWrapper</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpClientContext</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>utils</name><operator>.</operator><name>URIBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>cookie</name><operator>.</operator><name>CookieSpec</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>cookie</name><operator>.</operator><name>CookieSpecRegistry</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>BasicCookieStore</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>CloseableHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>RequestWrapper</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>cookie</name><operator>.</operator><name>BasicClientCookie</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>protocol</name><operator>.</operator><name>HttpContext</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrJettyTestBase</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">68</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">68</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name><operator>.</operator><name>ErrorCode</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputDocument</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>CommonParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>NamedList</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>util</name><operator>.</operator><name>SuppressForbidden</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>SSLTestConfig</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">524</literal></expr><operator>,</operator><expr><literal type="number">49</literal> <operator>+</operator><literal type="number">525</literal></expr><operator>,</operator><expr><literal type="number">60</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicHttpSolrClientTest</name> extends <name>SolrJettyTestBase</name> <block>{
   
   @<expr><name>Test</name>
   <specifier>public</specifier> <name>void</name> <call><name>testCompression</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
    <expr><name>SolrQuery</name> <name>q</name> <operator>=</operator> <operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;</block></expr></expr_stmt>
    
     <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/debug/foo"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
      <decl_stmt><decl><type><name>SolrQuery</name></type> <name>q</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      
       <comment type="line">// verify request header gets set</comment>
       <expr_stmt><expr><call><name><name>DebugServlet</name><operator>.</operator><name>clear</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       <try>try <block>{<block_content>
         <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>q</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>ParseException</name></type> <name>ignored</name></decl></parameter>)</parameter_list> <block>{<block_content/>}</block></catch></try>
      <expr_stmt><expr><call><name>assertNull</name><argument_list>(<argument><expr><call><name><name>DebugServlet</name><operator>.</operator><name>headers</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"Accept-Encoding"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setAllowCompression</name></name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertNull</name><argument_list>(<argument><expr><call><name><name>DebugServlet</name><operator>.</operator><name>headers</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>DebugServlet</name><operator>.</operator><name>headers</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"Accept-Encoding"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt> 
    </block_content>}</block></try>
    
    <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/debug/foo"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
       <try>try <block>{<block_content>
         <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>q</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>ParseException</name></type> <name>ignored</name></decl></parameter>)</parameter_list> <block>{<block_content/>}</block></catch></try>
       <expr_stmt><expr><call><name>assertNotNull</name><argument_list>(<argument><expr><call><name><name>DebugServlet</name><operator>.</operator><name>headers</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"Accept-Encoding"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setAllowCompression</name></name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></try>
    
    <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/debug/foo"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
       <try>try <block>{<block_content>
         <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>q</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>ParseException</name></type> <name>ignored</name></decl></parameter>)</parameter_list> <block>{<block_content/>}</block></catch></try>
      <expr_stmt><expr><call><name>assertNull</name><argument_list>(<argument><expr><call><name><name>DebugServlet</name><operator>.</operator><name>headers</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"Accept-Encoding"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></try>

    <expr_stmt><expr><call><name>assertNull</name><argument_list>(<argument><expr><call><name><name>DebugServlet</name><operator>.</operator><name>headers</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"Accept-Encoding"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     
     <comment type="line">// verify server compresses output</comment>
     <decl_stmt><decl><type><name>HttpGet</name></type> <name>get</name> <init>= <expr><operator>new</operator> <call><name>HttpGet</name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/collection1"</literal> <operator>+</operator>
                               <literal type="string">"/select?q=foo&amp;wt=xml"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <expr_stmt><expr><call><name><name>get</name><operator>.</operator><name>setHeader</name></name><argument_list>(<argument><expr><literal type="string">"Accept-Encoding"</literal></expr></argument>, <argument><expr><literal type="string">"gzip"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>httpclient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>ModifiableSolrParams</name></type> <name>params</name> <init>= <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_ALLOW_COMPRESSION</name></name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <decl_stmt><decl><type><name>RequestConfig</name></type> <name>config</name> <init>= <expr><call><name><name>RequestConfig</name><operator>.</operator><name>custom</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>setDecompressionEnabled</name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>build</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>   
    <expr_stmt><expr><call><name><name>get</name><operator>.</operator><name>setConfig</name></name><argument_list>(<argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>httpclient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <decl_stmt><decl><type><name>HttpEntity</name></type> <name>entity</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
     <try>try <block>{<block_content>
      <decl_stmt><decl><type><name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>httpclient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>get</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>HttpResponse</name></type> <name>response</name> <init>= <expr><call><name><name>httpclient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>get</name></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <expr_stmt><expr><name>entity</name> <operator>=</operator> <call><name><name>response</name><operator>.</operator><name>getEntity</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       <decl_stmt><decl><type><name>Header</name></type> <name>ceheader</name> <init>= <expr><call><name><name>entity</name><operator>.</operator><name>getContentEncoding</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertNotNull</name><argument_list>(<argument><expr><call><name><name>Arrays</name><operator>.</operator><name>asList</name></name><argument_list>(<argument><expr><call><name><name>response</name><operator>.</operator><name>getAllHeaders</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>ceheader</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"gzip"</literal></expr></argument>, <argument><expr><call><name><name>ceheader</name><operator>.</operator><name>getValue</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block> <finally>finally <block>{<block_content>
       <if_stmt><if>if <condition>(<expr><name>entity</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
         <expr_stmt><expr><call><name><name>entity</name><operator>.</operator><name>getContent</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>close</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block></if></if_stmt>
      <expr_stmt><expr><call><name><name>httpclient</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>httpclient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></finally></try>
     
     <comment type="line">// verify compressed response can be handled</comment>
     <try>try <init>(<decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/collection1"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setAllowCompression</name></name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>SolrQuery</name></type> <name>q</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"foo"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><name>q</name> <operator>=</operator> <operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"foo"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <decl_stmt><decl><type><name>QueryResponse</name></type> <name>response</name> <init>= <expr><call><name><name>client</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>q</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><call><name><name>response</name><operator>.</operator><name>getStatus</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></try>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">589</literal></expr><operator>,</operator><expr><literal type="number">28</literal> <operator>+</operator><literal type="number">601</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicHttpSolrClientTest</name> extends <name>SolrJettyTestBase</name> <block>{
     }</block></expr></expr_stmt>
 
   </block_content>}</block></catch>
  
  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testSetParametersExternalClient</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>IOException</name></expr></argument></throws><block>{<block_content>

    <try>try <init>(<decl><type><name>CloseableHttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;
         <decl><type><name>HttpSolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>

      <try>try <block>{<block_content>
        <expr_stmt><expr><call><name><name>solrClient</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"Operation should not succeed."</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>UnsupportedOperationException</name></type> <name>ignored</name></decl></parameter>)</parameter_list> <block>{<block_content/>}</block></catch></try>
      <try>try <block>{<block_content>
        <expr_stmt><expr><call><name><name>solrClient</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"Operation should not succeed."</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>UnsupportedOperationException</name></type> <name>ignored</name></decl></parameter>)</parameter_list> <block>{<block_content/>}</block></catch></try>

    </block_content>}</block></try>
  </block_content>}</block></function>
 
   <function><annotation>@<name>Test</name></annotation>
   <type><specifier>public</specifier> <name>void</name></type> <name>testGetRawStream</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>SolrServerException</name></expr></argument>, <argument><expr><name>IOException</name></expr></argument></throws><block>{<block_content>
    <try>try <init>(<decl><type><name>CloseableHttpClient</name></type> <name>client</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>client</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <try>try <block>{<block_content>
       <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/collection1"</literal></expr></argument>,
           <argument><expr><name>client</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <decl_stmt><decl><type><name>QueryRequest</name></type> <name>req</name> <init>= <expr><operator>new</operator> <call><name>QueryRequest</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">618</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">613</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicHttpSolrClientTest</name> extends <name>SolrJettyTestBase</name> <block>{
       <expr><name>InputStream</name> <name>stream</name> <operator>=</operator> <operator>(</operator><name>InputStream</name><operator>)</operator> <call><name><name>response</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"stream"</literal></expr></argument>)</argument_list></call></expr>;
       <call><name>assertNotNull</name><argument_list>(<argument><expr><name>stream</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>stream</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block> <finally>finally <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;</expr_stmt><empty_stmt>;</empty_stmt>
     </block_content>}</block></finally></try>
   </block_content>}</block></try>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">646</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">643</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicHttpSolrClientTest</name> extends <name>SolrJettyTestBase</name> <block>{
     <expr><name>IOException</name> <block>{
       <expr><call><name><name>log</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Intercepted params: "</literal><operator>+</operator><name>context</name></expr></argument>)</argument_list></call></expr>;
 
      <name>RequestWrapper</name> <name>wrapper</name> <operator>=</operator> <operator>(</operator><name>RequestWrapper</name><operator>)</operator> <name>request</name></block></expr>;
      <name>HttpRequestWrapper</name> <name>wrapper</name> <operator>=</operator> <operator>(</operator><name>HttpRequestWrapper</name><operator>)</operator> <name>request</name></block></expr>;</expr_stmt>
       <decl_stmt><decl><type><name>URIBuilder</name></type> <name>uribuilder</name> <init>= <expr><operator>new</operator> <call><name>URIBuilder</name><argument_list>(<argument><expr><call><name><name>wrapper</name><operator>.</operator><name>getURI</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <expr_stmt><expr><call><name><name>uribuilder</name><operator>.</operator><name>addParameter</name></name><argument_list>(<argument><expr><literal type="string">"b"</literal></expr></argument>, <argument><expr><literal type="string">"\u4321"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <try>try <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">672</literal></expr><operator>,</operator><expr><literal type="number">17</literal> <operator>+</operator><literal type="number">669</literal></expr><operator>,</operator><expr><literal type="number">15</literal> @@ <specifier>public</specifier> <name>class</name> <name>BasicHttpSolrClientTest</name> extends <name>SolrJettyTestBase</name> <block>{
       <expr><call><name><name>cookie</name><operator>.</operator><name>setPath</name></name><argument_list>(<argument><expr><literal type="string">"/"</literal></expr></argument>)</argument_list></call></expr>;
       <call><name><name>cookie</name><operator>.</operator><name>setDomain</name></name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHost</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
 
      <decl_stmt><decl><type><name>CookieStore</name></type> <name>cookieStore</name> <init>= <expr><operator>new</operator> <call><name>BasicCookieStore</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>        
      <decl_stmt><decl><type><name>CookieSpecRegistry</name></type> <name>registry</name> <init>= <expr><operator>(</operator><name>CookieSpecRegistry</name><operator>)</operator> <call><name><name>context</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>ClientContext</name><operator>.</operator><name>COOKIESPEC_REGISTRY</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>String</name></type> <name>policy</name> <init>= <expr><call><name><name>HttpClientParams</name><operator>.</operator><name>getCookiePolicy</name></name><argument_list>(<argument><expr><call><name><name>request</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>CookieSpec</name></type> <name>cookieSpec</name> <init>= <expr><call><name><name>registry</name><operator>.</operator><name>getCookieSpec</name></name><argument_list>(<argument><expr><name>policy</name></expr></argument>, <argument><expr><call><name><name>request</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>CookieStore</name></type> <name>cookieStore</name> <init>= <expr><operator>new</operator> <call><name>BasicCookieStore</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>CookieSpec</name></type> <name>cookieSpec</name> <init>= <expr><operator>new</operator> <call><name>SolrPortAwareCookieSpecFactory</name><argument_list>()</argument_list></call><operator>.</operator><call><name>create</name><argument_list>(<argument><expr><name>context</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <comment type="line">// CookieSpec cookieSpec = registry.lookup(policy).create(context);</comment>
       <comment type="line">// Add the cookies to the request</comment>
       <decl_stmt><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>Header</name></argument>&gt;</argument_list></name></type> <name>headers</name> <init>= <expr><call><name><name>cookieSpec</name><operator>.</operator><name>formatCookies</name></name><argument_list>(<argument><expr><call><name><name>Collections</name><operator>.</operator><name>singletonList</name></name><argument_list>(<argument><expr><name>cookie</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
       <for>for <control>(<init><decl><type><name>Header</name></type> <name>header</name> <range>: <expr><name>headers</name></expr></range></decl></init>)</control> <block>{<block_content>
         <expr_stmt><expr><call><name><name>request</name><operator>.</operator><name>addHeader</name></name><argument_list>(<argument><expr><name>header</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block></for>
      <expr_stmt><expr><call><name><name>context</name><operator>.</operator><name>setAttribute</name></name><argument_list>(<argument><expr><name><name>ClientContext</name><operator>.</operator><name>COOKIE_STORE</name></name></expr></argument>, <argument><expr><name>cookieStore</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>context</name><operator>.</operator><name>setAttribute</name></name><argument_list>(<argument><expr><name><name>ClientContext</name><operator>.</operator><name>COOKIE_SPEC</name></name></expr></argument>, <argument><expr><name>cookieSpec</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>context</name><operator>.</operator><name>setAttribute</name></name><argument_list>(<argument><expr><name><name>HttpClientContext</name><operator>.</operator><name>COOKIE_STORE</name></name></expr></argument>, <argument><expr><name>cookieStore</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></try>
   </block_content>}</block></function><empty_stmt>;</empty_stmt>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClientTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClientTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">77d8d0fff3b</literal><operator>..</operator><literal type="number">8c50e8eb915</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClientTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>CloudSolrClientTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">631</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">631</literal></expr><operator>,</operator><expr><literal type="number">13</literal> @@ <specifier>public</specifier> <name>class</name> <name>CloudSolrClientTest</name> extends <name>AbstractFullDistribZkTestBase</name> <block>{
   }</block>
 
   <specifier>public</specifier> <name>void</name> <call><name>customHttpClientTest</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{

    <expr><name>ModifiableSolrParams</name> <name>params</name> <operator>=</operator> <operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></block></expr></argument></throws></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">1000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <try>try <init>(<decl><type><name>CloseableHttpClient</name></type> <name>client</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call></expr></init></decl>;
         <decl><type><name>CloudSolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>CloudSolrClient</name><argument_list>(<argument><expr><call><name><name>zkServer</name><operator>.</operator><name>getZkAddress</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>client</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>client</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <try>try <init>(<decl><type><name>CloudSolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>CloudSolrClient</name><argument_list>(<argument><expr><call><name><name>zkServer</name><operator>.</operator><name>getZkAddress</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>client</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
 
       <expr_stmt><expr><call><name>assertTrue</name><argument_list>(<argument><expr><call><name><name>solrClient</name><operator>.</operator><name>getLbClient</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getHttpClient</name><argument_list>()</argument_list></call> <operator>==</operator> <name>client</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
    </block_content>}</block> <finally>finally <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></finally></try>
   </block_content>}</block></try>
 }</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ExternalHttpClientTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ExternalHttpClientTest</name><operator>.</operator><name>java</name></name>
<name>deleted</name> <name>file</name> <name>mode</name> <literal type="number">100644</literal>
<name>index</name> <name>c788ae396ed</name><operator>..</operator><literal type="number">00000000000</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>ExternalHttpClientTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <operator>/</operator><name>dev</name><operator>/</operator><literal type="null">null</literal>
@@ <operator>-</operator><literal type="number">1</literal></expr><operator>,</operator><expr><literal type="number">75</literal> <operator>+</operator><literal type="number">0</literal></expr><operator>,</operator><expr><literal type="number">0</literal> @@</expr></expr_stmt>
<comment type="block">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</comment>
<package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name></name>;</package>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>RequestConfig</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>CloseableHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClientBuilder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrJettyTestBase</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>SolrTestCaseJ4</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrQuery</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrRequest</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrServerException</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettyConfig</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletHolder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>BeforeClass</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>

<class><annotation>@<name><name>SolrTestCaseJ4</name><operator>.</operator><name>SuppressSSL</name></name></annotation>
<specifier>public</specifier> class <name>ExternalHttpClientTest</name> <super_list><extends>extends <super><name>SolrJettyTestBase</name></super></extends></super_list> <block>{
  <function><annotation>@<name>BeforeClass</name></annotation>
  <type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>beforeTest</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
    <decl_stmt><decl><type><name>JettyConfig</name></type> <name>jettyConfig</name> <init>= <expr><call><name><name>JettyConfig</name><operator>.</operator><name>builder</name></name><argument_list>()</argument_list></call>
        <operator>.</operator><call><name>withServlet</name><argument_list>(<argument><expr><operator>new</operator> <call><name>ServletHolder</name><argument_list>(<argument><expr><name><name>BasicHttpSolrClientTest</name><operator>.</operator><name>SlowServlet</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"/slow/*"</literal></expr></argument>)</argument_list></call>
        <operator>.</operator><call><name>withSSLConfig</name><argument_list>(<argument><expr><name>sslConfig</name></expr></argument>)</argument_list></call>
        <operator>.</operator><call><name>build</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name>createJetty</name><argument_list>(<argument><expr><call><name>legacyExampleCollection1SolrHome</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>jettyConfig</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>

  <comment type="block" format="javadoc">/**
   * The internal client created by HttpSolrClient is a SystemDefaultHttpClient
   * which takes care of merging request level params (such as timeout) with the
   * configured defaults.
   *
   * However, if an external HttpClient is passed to HttpSolrClient,
   * the logic in InternalHttpClient.executeMethod replaces the configured defaults
   * by request level params if they exist. That is why we must test a setting such
   * as timeout with an external client to assert that the defaults are indeed being
   * used
   *
   * See SOLR-6245 for more details
   */</comment>
  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testTimeoutWithExternalClient</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>

    <decl_stmt><decl><type><name>HttpClientBuilder</name></type> <name>builder</name> <init>= <expr><call><name><name>HttpClientBuilder</name><operator>.</operator><name>create</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>RequestConfig</name></type> <name>config</name> <init>= <expr><call><name><name>RequestConfig</name><operator>.</operator><name>custom</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>setSocketTimeout</name><argument_list>(<argument><expr><literal type="number">2000</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>build</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>builder</name><operator>.</operator><name>setDefaultRequestConfig</name></name><argument_list>(<argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <try>try <init>(<decl><type><name>CloseableHttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>builder</name><operator>.</operator><name>build</name></name><argument_list>()</argument_list></call></expr></init></decl>;
         <decl><type><name>HttpSolrClient</name></type> <name>solrClient</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/slow/foo"</literal></expr></argument>, <argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>

      <decl_stmt><decl><type><name>SolrQuery</name></type> <name>q</name> <init>= <expr><operator>new</operator> <call><name>SolrQuery</name><argument_list>(<argument><expr><literal type="string">"*:*"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <try>try <block>{<block_content>
        <expr_stmt><expr><call><name><name>solrClient</name><operator>.</operator><name>query</name></name><argument_list>(<argument><expr><name>q</name></expr></argument>, <argument><expr><name><name>SolrRequest</name><operator>.</operator><name>METHOD</name><operator>.</operator><name>GET</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>fail</name><argument_list>(<argument><expr><literal type="string">"No exception thrown."</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>SolrServerException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name>assertTrue</name><argument_list>(<argument><expr><call><name><name>e</name><operator>.</operator><name>getMessage</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>contains</name><argument_list>(<argument><expr><literal type="string">"Timeout"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></catch></try>
    </block_content>}</block></try>
  </block_content>}</block></function>
}</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtilTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtilTest</name><operator>.</operator><name>java</name></name>
<name>deleted</name> <name>file</name> <name>mode</name> <literal type="number">100644</literal>
<name>index</name> <name>c881b7a93bf</name><operator>..</operator><literal type="number">00000000000</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>HttpClientUtilTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <operator>/</operator><name>dev</name><operator>/</operator><literal type="null">null</literal>
@@ <operator>-</operator><literal type="number">1</literal></expr><operator>,</operator><expr><literal type="number">162</literal> <operator>+</operator><literal type="number">0</literal></expr><operator>,</operator><expr><literal type="number">0</literal> @@</expr></expr_stmt>
<comment type="block">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</comment>
<package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name></name>;</package>

<import>import static <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Assert</name><operator>.</operator><name>assertEquals</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Assert</name><operator>.</operator><name>assertNotNull</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Assert</name><operator>.</operator><name>assertTrue</name></name>;</import>

<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>atomic</name><operator>.</operator><name>AtomicInteger</name></name>;</import>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>auth</name><operator>.</operator><name>AuthScope</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>config</name><operator>.</operator><name>AuthSchemes</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>HttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>client</name><operator>.</operator><name>params</name><operator>.</operator><name>ClientPNames</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>AllowAllHostnameVerifier</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>BrowserCompatHostnameVerifier</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>SSLSocketFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>X509HostnameVerifier</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>CloseableHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>AbstractHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>conn</name><operator>.</operator><name>PoolingClientConnectionManager</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>params</name><operator>.</operator><name>HttpConnectionParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>ModifiableSolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>SSLTestConfig</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>

<class><specifier>public</specifier> class <name>HttpClientUtilTest</name> <block>{

  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testNoParamsSucceeds</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>
    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>client</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>

  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testSetParams</name><parameter_list>()</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>ModifiableSolrParams</name></type> <name>params</name> <init>= <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_ALLOW_COMPRESSION</name></name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_BASIC_AUTH_PASS</name></name></expr></argument>, <argument><expr><literal type="string">"pass"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_BASIC_AUTH_USER</name></name></expr></argument>, <argument><expr><literal type="string">"user"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_CONNECTION_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">12345</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_FOLLOW_REDIRECTS</name></name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS</name></name></expr></argument>, <argument><expr><literal type="number">22345</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_MAX_CONNECTIONS_PER_HOST</name></name></expr></argument>, <argument><expr><literal type="number">32345</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_SO_TIMEOUT</name></name></expr></argument>, <argument><expr><literal type="number">42345</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>PROP_USE_RETRY</name></name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <decl_stmt><decl><type><name>DefaultHttpClient</name></type> <name>client</name> <init>= <expr><operator>(</operator><name>DefaultHttpClient</name><operator>)</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <try>try <block>{<block_content>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">12345</literal></expr></argument>, <argument><expr><call><name><name>HttpConnectionParams</name><operator>.</operator><name>getConnectionTimeout</name></name><argument_list>(<argument><expr><call><name><name>client</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><name><name>PoolingClientConnectionManager</name><operator>.</operator><name>class</name></name></expr></argument>, <argument><expr><call><name><name>client</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">22345</literal></expr></argument>, <argument><expr><operator>(</operator><operator>(</operator><name>PoolingClientConnectionManager</name><operator>)</operator><call><name><name>client</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>)</operator><operator>.</operator><call><name>getMaxTotal</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">32345</literal></expr></argument>, <argument><expr><operator>(</operator><operator>(</operator><name>PoolingClientConnectionManager</name><operator>)</operator><call><name><name>client</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>)</operator><operator>.</operator><call><name>getDefaultMaxPerRoute</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">42345</literal></expr></argument>, <argument><expr><call><name><name>HttpConnectionParams</name><operator>.</operator><name>getSoTimeout</name></name><argument_list>(<argument><expr><call><name><name>client</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>NO_RETRY</name></name></expr></argument>, <argument><expr><call><name><name>client</name><operator>.</operator><name>getHttpRequestRetryHandler</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"pass"</literal></expr></argument>, <argument><expr><call><name><name>client</name><operator>.</operator><name>getCredentialsProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCredentials</name><argument_list>(<argument><expr><operator>new</operator> <call><name>AuthScope</name><argument_list>(<argument><expr><literal type="string">"127.0.0.1"</literal></expr></argument>, <argument><expr><literal type="number">1234</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>getPassword</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"user"</literal></expr></argument>, <argument><expr><call><name><name>client</name><operator>.</operator><name>getCredentialsProvider</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getCredentials</name><argument_list>(<argument><expr><operator>new</operator> <call><name>AuthScope</name><argument_list>(<argument><expr><literal type="string">"127.0.0.1"</literal></expr></argument>, <argument><expr><literal type="number">1234</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>getUserPrincipal</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getName</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>, <argument><expr><call><name><name>client</name><operator>.</operator><name>getParams</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getParameter</name><argument_list>(<argument><expr><name><name>ClientPNames</name><operator>.</operator><name>HANDLE_REDIRECTS</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block> <finally>finally <block>{<block_content>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></finally></try>
  </block_content>}</block></function>

  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testAuthSchemeConfiguration</name><parameter_list>()</parameter_list> <block>{<block_content>
    <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><name><name>Krb5HttpClientConfigurer</name><operator>.</operator><name>LOGIN_CONFIG_PROP</name></name></expr></argument>, <argument><expr><literal type="string">"test"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConfigurer</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>Krb5HttpClientConfigurer</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <decl_stmt><decl><type><name>AbstractHttpClient</name></type> <name>client</name> <init>= <expr><operator>(</operator><name>AbstractHttpClient</name><operator>)</operator><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><call><name><name>client</name><operator>.</operator><name>getAuthSchemes</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSchemeNames</name><argument_list>()</argument_list></call><operator>.</operator><call><name>size</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertTrue</name><argument_list>(<argument><expr><call><name><name>AuthSchemes</name><operator>.</operator><name>SPNEGO</name><operator>.</operator><name>equalsIgnoreCase</name></name><argument_list>(<argument><expr><call><name><name>client</name><operator>.</operator><name>getAuthSchemes</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSchemeNames</name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block> <finally>finally <block>{<block_content>
      <comment type="line">//Cleanup the system property.</comment>
      <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>clearProperty</name></name><argument_list>(<argument><expr><name><name>Krb5HttpClientConfigurer</name><operator>.</operator><name>LOGIN_CONFIG_PROP</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></finally></try>
  </block_content>}</block></function>

  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testReplaceConfigurer</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>IOException</name></expr></argument></throws><block>{<block_content>
    
    <try>try <block>{<block_content>
    <decl_stmt><decl><type><specifier>final</specifier> <name>AtomicInteger</name></type> <name>counter</name> <init>= <expr><operator>new</operator> <call><name>AtomicInteger</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>HttpClientConfigurer</name></type> <name>custom</name> <init>= <expr><operator>new</operator> <class><super><name>HttpClientConfigurer</name></super><argument_list>()</argument_list><block>{
      <function><annotation>@<name>Override</name></annotation>
      <type><specifier>public</specifier> <name>void</name></type> <name>configure</name><parameter_list>(<parameter><decl><type><name>DefaultHttpClient</name></type> <name>httpClient</name></decl></parameter>, <parameter><decl><type><name>SolrParams</name></type> <name>config</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name><name>super</name><operator>.</operator><name>configure</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>config</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>counter</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><call><name><name>config</name><operator>.</operator><name>getInt</name></name><argument_list>(<argument><expr><literal type="string">"custom-param"</literal></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></function>
      
    }</block></class></expr></init></decl>;</decl_stmt>
    
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConfigurer</name></name><argument_list>(<argument><expr><name>custom</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    
    <decl_stmt><decl><type><name>ModifiableSolrParams</name></type> <name>params</name> <init>= <expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>params</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><literal type="string">"custom-param"</literal></expr></argument>, <argument><expr><literal type="number">5</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><name>params</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>close</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="number">5</literal></expr></argument>, <argument><expr><call><name><name>counter</name><operator>.</operator><name>get</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block> <finally>finally <block>{<block_content>
      <comment type="line">//restore default configurer</comment>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConfigurer</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>HttpClientConfigurer</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></finally></try>

  </block_content>}</block></function>
  
  <function><annotation>@<name>Test</name></annotation>
  <annotation>@<name>SuppressWarnings</name><argument_list>(<argument><expr><literal type="string">"deprecation"</literal></expr></argument>)</argument_list></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testSSLSystemProperties</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>
    <decl_stmt><decl><type><name>CloseableHttpClient</name></type> <name>client</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <try>try <block>{<block_content>
      <expr_stmt><expr><call><name><name>SSLTestConfig</name><operator>.</operator><name>setSSLSystemProperties</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertNotNull</name><argument_list>(<argument><expr><literal type="string">"HTTPS scheme could not be created using the javax.net.ssl.* system properties."</literal></expr></argument>, 
          <argument><expr><call><name><name>client</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSchemeRegistry</name><argument_list>()</argument_list></call><operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"https"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      
      <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>clearProperty</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>SYS_PROP_CHECK_PEER_NAME</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>client</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><name><name>BrowserCompatHostnameVerifier</name><operator>.</operator><name>class</name></name></expr></argument>, <argument><expr><call><name>getHostnameVerifier</name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      
      <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>SYS_PROP_CHECK_PEER_NAME</name></name></expr></argument>, <argument><expr><literal type="string">"true"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>client</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><name><name>BrowserCompatHostnameVerifier</name><operator>.</operator><name>class</name></name></expr></argument>, <argument><expr><call><name>getHostnameVerifier</name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      
      <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>SYS_PROP_CHECK_PEER_NAME</name></name></expr></argument>, <argument><expr><literal type="string">""</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>client</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><name><name>BrowserCompatHostnameVerifier</name><operator>.</operator><name>class</name></name></expr></argument>, <argument><expr><call><name>getHostnameVerifier</name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      
      <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>SYS_PROP_CHECK_PEER_NAME</name></name></expr></argument>, <argument><expr><literal type="string">"false"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>client</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><name><name>AllowAllHostnameVerifier</name><operator>.</operator><name>class</name></name></expr></argument>, <argument><expr><call><name>getHostnameVerifier</name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getClass</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block> <finally>finally <block>{<block_content>
      <expr_stmt><expr><call><name><name>SSLTestConfig</name><operator>.</operator><name>clearSSLSystemProperties</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>clearProperty</name></name><argument_list>(<argument><expr><name><name>HttpClientUtil</name><operator>.</operator><name>SYS_PROP_CHECK_PEER_NAME</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></finally></try>
  </block_content>}</block></function>
  
  <function><annotation>@<name>SuppressWarnings</name><argument_list>(<argument><expr><literal type="string">"deprecation"</literal></expr></argument>)</argument_list></annotation>
  <type><specifier>private</specifier> <name>X509HostnameVerifier</name></type> <name>getHostnameVerifier</name><parameter_list>(<parameter><decl><type><name>HttpClient</name></type> <name>client</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <return>return <expr><operator>(</operator><operator>(</operator><name>SSLSocketFactory</name><operator>)</operator> <call><name><name>client</name><operator>.</operator><name>getConnectionManager</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getSchemeRegistry</name><argument_list>()</argument_list></call>
        <operator>.</operator><call><name>get</name><argument_list>(<argument><expr><literal type="string">"https"</literal></expr></argument>)</argument_list></call><operator>.</operator><call><name>getSchemeSocketFactory</name><argument_list>()</argument_list></call><operator>)</operator><operator>.</operator><call><name>getHostnameVerifier</name><argument_list>()</argument_list></call></expr>;</return>
  </block_content>}</block></function>
  
}</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClientTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClientTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>dba18d07732</name><operator>..</operator><literal type="number">94af2ca26ce</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClientTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>impl</name><operator>/</operator><name><name>LBHttpSolrClientTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">38</literal></expr><operator>,</operator><expr><literal type="number">18</literal> <operator>+</operator><literal type="number">38</literal></expr><operator>,</operator><expr><literal type="number">23</literal> @@ <specifier>public</specifier> <name>class</name> <name>LBHttpSolrClientTest</name> <block>{
    <expr><operator>*</operator><operator>/</operator>
   @<name>Test</name>
   <specifier>public</specifier> <name>void</name> <call><name>testLBHttpSolrClientHttpClientResponseParserStringArray</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{</block></expr></argument></throws></expr>

    <try>try <init>(<decl><type><name>CloseableHttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;
    <decl><type><name>CloseableHttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;
    <try>try <init>(
          <decl><type><name>LBHttpSolrClient</name></type> <name>testClient</name> <init>= <expr><operator>new</operator> <call><name>LBHttpSolrClient</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><operator>(</operator><name>ResponseParser</name><operator>)</operator> <literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;
          <decl><type><name>HttpSolrClient</name></type> <name>httpSolrClient</name> <init>= <expr><call><name><name>testClient</name><operator>.</operator><name>makeSolrClient</name></name><argument_list>(<argument><expr><literal type="string">"http://127.0.0.1:8080"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
       <expr_stmt><expr><call><name>assertNull</name><argument_list>(<argument><expr><literal type="string">"Generated server should have null parser."</literal></expr></argument>, <argument><expr><call><name><name>httpSolrClient</name><operator>.</operator><name>getParser</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block> <finally>finally <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></finally></try>
 
     ResponseParser parser = new BinaryResponseParser()</init><empty_stmt>;</empty_stmt></try></block></expr></expr_stmt>
    <try>try <init>(<decl><type><name>CloseableHttpClient</name></type> <name>httpClient</name> <init>= <expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;
         <decl><type><name>LBHttpSolrClient</name></type> <name>testClient</name> <init>= <expr><operator>new</operator> <call><name>LBHttpSolrClient</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>parser</name></expr></argument>)</argument_list></call></expr></init></decl>;
         <decl><type><name>HttpSolrClient</name></type> <name>httpSolrClient</name> <init>= <expr><call><name><name>testClient</name><operator>.</operator><name>makeSolrClient</name></name><argument_list>(<argument><expr><literal type="string">"http://127.0.0.1:8080"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
      <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Invalid parser passed to generated server."</literal></expr></argument>, <argument><expr><name>parser</name></expr></argument>, <argument><expr><call><name><name>httpSolrClient</name><operator>.</operator><name>getParser</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><name>httpClient</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>createClient</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>ModifiableSolrParams</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <try>try <block>{<block_content>
      <try>try <init>( <decl><type><name>LBHttpSolrClient</name></type> <name>testClient</name> <init>= <expr><operator>new</operator> <call><name>LBHttpSolrClient</name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>, <argument><expr><name>parser</name></expr></argument>)</argument_list></call></expr></init></decl>; <decl><type><name>HttpSolrClient</name></type> <name>httpSolrClient</name> <init>= <expr><call><name><name>testClient</name><operator>.</operator><name>makeSolrClient</name></name><argument_list>(<argument><expr><literal type="string">"http://127.0.0.1:8080"</literal></expr></argument>)</argument_list></call></expr></init></decl>)</init> <block>{<block_content>
        <expr_stmt><expr><call><name>assertEquals</name><argument_list>(<argument><expr><literal type="string">"Invalid parser passed to generated server."</literal></expr></argument>, <argument><expr><name>parser</name></expr></argument>, <argument><expr><call><name><name>httpSolrClient</name><operator>.</operator><name>getParser</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></try>
    </block_content>}</block> <finally>finally <block>{<block_content>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></finally></try>
   </block_content>}</block></try>
   
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>request</name><operator>/</operator><name><name>SchemaTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>request</name><operator>/</operator><name><name>SchemaTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">72051b123aa</literal><operator>..</operator><name>be36bf3a61d</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>request</name><operator>/</operator><name><name>SchemaTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>solrj</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>client</name><operator>/</operator><name>solrj</name><operator>/</operator><name>request</name><operator>/</operator><name><name>SchemaTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">105</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">105</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@ <specifier>public</specifier> <name>class</name> <name>SchemaTest</name> extends <name>RestTestBase</name> <block>{
   }</block>
 
   @<name>After</name>
  <specifier>public</specifier> <name>void</name> <call><name>cleanup</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
  <expr><specifier>public</specifier> <name>void</name> <call><name>cleanup</name><argument_list>()</argument_list></call></expr></block></expr></argument></throws> <throws>throws <argument><expr><name>Exception</name>  <block>{</block></expr></argument></throws></expr></expr_stmt>
     <if_stmt><if>if <condition>(<expr><name>jetty</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <expr_stmt><expr><call><name><name>jetty</name><operator>.</operator><name>stop</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><name>jetty</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
     </block_content>}</block></if></if_stmt>
    <expr_stmt><expr><name>client</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
     <if_stmt><if>if <condition>(<expr><name>restTestHarness</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <expr_stmt><expr><call><name><name>restTestHarness</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     </block_content>}</block></if></if_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">424</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">423</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>SchemaTest</name> extends <name>RestTestBase</name> <block>{
     <expr><call><name><name>fieldAttributes</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><literal type="string">"type"</literal></expr></argument>, <argument><expr><literal type="string">"string"</literal></expr></argument>)</argument_list></call></expr>;
     <name><name>SchemaRequest</name><operator>.</operator><name>AddDynamicField</name></name> <name>addDFieldUpdateSchemaRequest</name> <operator>=</operator>
         <operator>new</operator> <call><name><name>SchemaRequest</name><operator>.</operator><name>AddDynamicField</name></name><argument_list>(<argument><expr><name>fieldAttributes</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <decl_stmt><decl><type><name><name>SchemaResponse</name><operator>.</operator><name>UpdateResponse</name></name></type> <name>addDFieldFirstResponse</name> <init>= <expr><call><name><name>addDFieldUpdateSchemaRequest</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><call><name>getSolrClient</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>SolrClient</name></type> <name>client</name> <init>= <expr><call><name>getSolrClient</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name><name>SchemaResponse</name><operator>.</operator><name>UpdateResponse</name></name></type> <name>addDFieldFirstResponse</name> <init>= <expr><call><name><name>addDFieldUpdateSchemaRequest</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><name>client</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <constructor_decl><name>assertValidSchemaResponse</name><parameter_list>(<parameter><decl><type><name>addDFieldFirstResponse</name></type></decl></parameter>)</parameter_list>;</constructor_decl>
 
     <decl_stmt><decl><type><name><name>SchemaResponse</name><operator>.</operator><name>UpdateResponse</name></name></type> <name>addDFieldSecondResponse</name> <init>= <expr><call><name><name>addDFieldUpdateSchemaRequest</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><call><name>getSolrClient</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">680</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">680</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>SchemaTest</name> extends <name>RestTestBase</name> <block>{
     <expr><call><name><name>fieldTypeDefinition</name><operator>.</operator><name>setAttributes</name></name><argument_list>(<argument><expr><name>fieldTypeAttributes</name></expr></argument>)</argument_list></call></expr>;
     <name><name>SchemaRequest</name><operator>.</operator><name>AddFieldType</name></name> <name>addFieldTypeRequest</name> <operator>=</operator>
         <operator>new</operator> <call><name><name>SchemaRequest</name><operator>.</operator><name>AddFieldType</name></name><argument_list>(<argument><expr><name>fieldTypeDefinition</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <decl_stmt><decl><type><name><name>SchemaResponse</name><operator>.</operator><name>UpdateResponse</name></name></type> <name>addFieldTypeResponse</name> <init>= <expr><call><name><name>addFieldTypeRequest</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><call><name>getSolrClient</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>SolrClient</name></type> <name>c</name> <init>= <expr><call><name>getSolrClient</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name><name>SchemaResponse</name><operator>.</operator><name>UpdateResponse</name></name></type> <name>addFieldTypeResponse</name> <init>= <expr><call><name><name>addFieldTypeRequest</name><operator>.</operator><name>process</name></name><argument_list>(<argument><expr><name>c</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <constructor_decl><name>assertValidSchemaResponse</name><parameter_list>(<parameter><decl><type><name>addFieldTypeResponse</name></type></decl></parameter>)</parameter_list>;</constructor_decl>
 
     <decl_stmt><decl><type><name><name>SchemaRequest</name><operator>.</operator><name>FieldType</name></name></type> <name>fieldTypeRequest</name> <init>= <expr><operator>new</operator> <call><name><name>SchemaRequest</name><operator>.</operator><name>FieldType</name></name><argument_list>(<argument><expr><name>fieldTypeName</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a751459e596</name><operator>..</operator><literal type="number">4ae46f8fa91</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>BaseDistributedSearchTestCase</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">229</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">229</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>BaseDistributedSearchTestCase</name> extends <name>SolrTestCaseJ4</name> <block>{
   <expr><specifier>protected</specifier> <name>boolean</name> <name>verifyStress</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;
   <specifier>protected</specifier> <name>int</name> <name>nThreads</name> <operator>=</operator> <literal type="number">3</literal></block></expr>;</expr_stmt>
 
  <decl_stmt><decl><type><specifier>protected</specifier> <name>int</name></type> <name>clientConnectionTimeout</name> <init>= <expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></init></decl>;</decl_stmt>
  <decl_stmt><decl><type><specifier>protected</specifier> <name>int</name></type> <name>clientSoTimeout</name> <init>= <expr><literal type="number">90000</literal></expr></init></decl>;</decl_stmt>

   <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <name>int</name></type> <name>ORDERED</name> <init>= <expr><literal type="number">1</literal></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <name>int</name></type> <name>SKIP</name> <init>= <expr><literal type="number">2</literal></expr></init></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <name>int</name></type> <name>SKIPVAL</name> <init>= <expr><literal type="number">4</literal></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">443</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">440</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>BaseDistributedSearchTestCase</name> extends <name>SolrTestCaseJ4</name> <block>{
     <try>try <block>{<block_content>
       <comment type="line">// setup the client...</comment>
       <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><call><name>buildUrl</name><argument_list>(<argument><expr><name>port</name></expr></argument>)</argument_list></call> <operator>+</operator> <literal type="string">"/"</literal> <operator>+</operator> <name>DEFAULT_TEST_CORENAME</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>clientConnectionTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><name>clientSoTimeout</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>client</name></expr>;</return>
     </block_content>}</block>
     <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrJettyTestBase</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrJettyTestBase</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">0e77a471381</literal><operator>..</operator><literal type="number">5924593e63c</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrJettyTestBase</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrJettyTestBase</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">22</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">22</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>SolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>EmbeddedSolrServer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettyConfig</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettySolrRunner</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpSolrClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>util</name><operator>.</operator><name>ExternalPaths</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>servlet</name><operator>.</operator><name>ServletHolder</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>After</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>AfterClass</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>BeforeClass</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">119</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">119</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@ <specifier>abstract</specifier> <specifier>public</specifier> <name>class</name> <name>SolrJettyTestBase</name> extends <name>SolrTestCaseJ4</name></expr></expr_stmt>
     <return>return <expr><name>jetty</name></expr>;</return>
   </block_content>}</block></catch></try>
 
  @<name>After</name>
  <specifier>public</specifier> <name>void</name> <call><name>afterClass</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{</block></expr></argument></throws></block></expr></expr_stmt>
    <if_stmt><if>if <condition>(<expr><name>client</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
    <expr_stmt><expr><name>client</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
  }</block></class>
 
   <function><annotation>@<name>AfterClass</name></annotation>
   <type><specifier>public</specifier> <specifier>static</specifier> <name>void</name></type> <name>afterSolrJettyTestBase</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">126</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">131</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>abstract</specifier> <specifier>public</specifier> <name>class</name> <name>SolrJettyTestBase</name> extends <name>SolrTestCaseJ4</name>
       <call><name><name>jetty</name><operator>.</operator><name>stop</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><name>jetty</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
     </block_content>}</block></function>
    <if_stmt><if>if <condition>(<expr><name>client</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
    <expr_stmt><expr><name>client</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
   </block_content>}</block></function>
 
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">153</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">156</literal></expr><operator>,</operator><expr><literal type="number">18</literal> @@ <specifier>abstract</specifier> <specifier>public</specifier> <name>class</name> <name>SolrJettyTestBase</name> extends <name>SolrTestCaseJ4</name>
         <name>String</name> <name>url</name> <operator>=</operator> <call><name><name>jetty</name><operator>.</operator><name>getBaseUrl</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call> <operator>+</operator> <literal type="string">"/"</literal> <operator>+</operator> <literal type="string">"collection1"</literal></expr>;</expr_stmt>
         <decl_stmt><decl><type><name>HttpSolrClient</name></type> <name>client</name> <init>= <expr><operator>new</operator> <call><name>HttpSolrClient</name><argument_list>( <argument><expr><name>url</name></expr></argument> )</argument_list></call></expr></init></decl>;</decl_stmt>
         <constructor_decl><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><parameter_list>(<parameter><decl><type><name>DEFAULT_CONNECTION_TIMEOUT</name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         <return>return <expr><name>client</name></expr>;</return>
       }</block></class>
       <catch>catch<parameter_list>( <parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter> )</parameter_list> <block>{<block_content>
         <throw>throw <expr><operator>new</operator> <call><name>RuntimeException</name><argument_list>( <argument><expr><name>ex</name></expr></argument> )</argument_list></call></expr>;</throw>
       </block_content>}</block></catch>
     </block_content>}</block></function> <if_stmt><else>else <block>{<block_content>
      <return>return <expr><operator>new</operator> <call><name>EmbeddedSolrServer</name><argument_list>( <argument><expr><call><name><name>h</name><operator>.</operator><name>getCoreContainer</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="string">"collection1"</literal></expr></argument> )</argument_list></call></expr>;</return>
      <return>return <expr><operator>new</operator> <class><super><name>EmbeddedSolrServer</name></super><argument_list>( <argument><expr><call><name><name>h</name><operator>.</operator><name>getCoreContainer</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="string">"collection1"</literal></expr></argument> )</argument_list> <block>{
        <function><annotation>@<name>Override</name></annotation>
        <type><specifier>public</specifier> <name>void</name></type> <name>close</name><parameter_list>()</parameter_list> <block>{<block_content>
          <comment type="line">// do not close core container</comment>
        </block_content>}</block></function>
      }</block></class></expr>;</return>
     </block_content>}</block></else></if_stmt>
   </block_content>}</block></function>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">3ce252f9b4d</literal><operator>..</operator><literal type="number">6b28eb81a07</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name><name>SolrTestCaseJ4</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">66</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">66</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>LuceneTestCase</name><operator>.</operator><name>SuppressSysoutChecks</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>QuickPatchThreadsFilter</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>TestUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>JettyConfig</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>util</name><operator>.</operator><name>ClientUtils</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>cloud</name><operator>.</operator><name>IpTables</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">226</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">225</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>SolrTestCaseJ4</name> extends <name>LuceneTestCase</name> <block>{
     
     <expr><name>sslConfig</name> <operator>=</operator> <call><name>buildSSLConfig</name><argument_list>()</argument_list></call></expr>;
     <comment type="line">//will use ssl specific or default depending on sslConfig</comment>
    <call><name><name>HttpClientUtil</name><operator>.</operator><name>setConfigurer</name></name><argument_list>(<argument><expr><call><name><name>sslConfig</name><operator>.</operator><name>getHttpClientConfigurer</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setHttpClientBuilder</name></name><argument_list>(<argument><expr><call><name><name>sslConfig</name><operator>.</operator><name>getHttpClientBuilder</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <if_stmt><if>if<condition>(<expr><call><name>isSSLMode</name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
       <comment type="line">// SolrCloud tests should usually clear this</comment>
       <expr_stmt><expr><call><name><name>System</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><literal type="string">"urlScheme"</literal></expr></argument>, <argument><expr><literal type="string">"https"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">269</literal></expr><operator>,</operator><expr><literal type="number">9</literal> <operator>+</operator><literal type="number">268</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>SolrTestCaseJ4</name> extends <name>LuceneTestCase</name> <block>{
       <expr><call><name><name>System</name><operator>.</operator><name>clearProperty</name></name><argument_list>(<argument><expr><literal type="string">"useCompoundFile"</literal></expr></argument>)</argument_list></call></expr>;
       <call><name><name>System</name><operator>.</operator><name>clearProperty</name></name><argument_list>(<argument><expr><literal type="string">"urlScheme"</literal></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
       
      <if_stmt><if>if <condition>(<expr><call><name>isSSLMode</name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>setConfigurer</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>HttpClientConfigurer</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></if></if_stmt>
      <expr_stmt><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>resetHttpClientBuilder</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
 
       <comment type="line">// clean up static</comment>
       <expr_stmt><expr><name>sslConfig</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a584dbd450b</name><operator>..</operator><literal type="number">090dfe8fddd</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>cloud</name><operator>/</operator><name><name>AbstractFullDistribZkTestBase</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">1629</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">1629</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>AbstractFullDistribZkTestBase</name> extends <name>AbstractDistribZkTes</name>
       <name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setSoTimeout</name></name><argument_list>(<argument><expr><literal type="number">60000</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>client</name></expr>;</return>
     </block_content>}</block></if></if_stmt> <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<block_content>
       <throw>throw <expr><operator>new</operator> <call><name>RuntimeException</name><argument_list>(<argument><expr><name>ex</name></expr></argument>)</argument_list></call></expr>;</throw>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1642</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">1640</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>AbstractFullDistribZkTestBase</name> extends <name>AbstractDistribZkTes</name>
       <comment type="line">// setup the server...</comment>
       <name>HttpSolrClient</name> <name>client</name> <operator>=</operator> <operator>new</operator> <call><name>HttpSolrClient</name><argument_list>(<argument><expr><name>baseUrl</name> <operator>+</operator> <literal type="string">"/"</literal> <operator>+</operator> <name>collection</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setConnectionTimeout</name></name><argument_list>(<argument><expr><name>DEFAULT_CONNECTION_TIMEOUT</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setDefaultMaxConnectionsPerHost</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><call><name><name>client</name><operator>.</operator><name>setMaxTotalConnections</name></name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><name>client</name></expr>;</return>
     </block_content>}</block></catch>
     <catch>catch <parameter_list>(<parameter><decl><type><name>Exception</name></type> <name>ex</name></decl></parameter>)</parameter_list> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>RestTestHarness</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>RestTestHarness</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>de5f6623dfe</name><operator>..</operator><literal type="number">3f2a699cae9</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>RestTestHarness</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>RestTestHarness</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">204</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">204</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>RestTestHarness</name> extends <name>BaseTestHarness</name> implements <name>Closeable</name> <block>{
   <expr><specifier>private</specifier> <name>String</name> <call><name>getResponse</name><argument_list>(<argument><expr><name>HttpUriRequest</name> <name>request</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{
     <expr><name>HttpEntity</name> <name>entity</name> <operator>=</operator> <literal type="null">null</literal></expr></block></expr></argument></throws></expr>;</block></expr></expr_stmt>
     <try>try <block>{<block_content>
      <expr_stmt><expr><name>entity</name> <operator>=</operator> <call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>request</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getEntity</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
      <expr_stmt><expr><name>entity</name> <operator>=</operator> <call><name><name>httpClient</name><operator>.</operator><name>execute</name></name><argument_list>(<argument><expr><name>request</name></expr></argument>, <argument><expr><call><name><name>HttpClientUtil</name><operator>.</operator><name>createNewHttpClientRequestContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator><call><name>getEntity</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
       <return>return <expr><call><name><name>EntityUtils</name><operator>.</operator><name>toString</name></name><argument_list>(<argument><expr><name>entity</name></expr></argument>, <argument><expr><name><name>StandardCharsets</name><operator>.</operator><name>UTF_8</name></name></expr></argument>)</argument_list></call></expr>;</return>
     </block_content>}</block> <finally>finally <block>{<block_content>
       <expr_stmt><expr><call><name><name>EntityUtils</name><operator>.</operator><name>consumeQuietly</name></name><argument_list>(<argument><expr><name>entity</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">213</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">213</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>RestTestHarness</name> extends <name>BaseTestHarness</name> implements <name>Closeable</name> <block>{
 
   @<expr><name>Override</name>
   <specifier>public</specifier> <name>void</name> <call><name>close</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{
    <expr><call><name><name>httpClient</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr></block></expr></argument></throws></expr>;
    <call><name><name>HttpClientUtil</name><operator>.</operator><name>close</name></name><argument_list>(<argument><expr><name>httpClient</name></expr></argument>)</argument_list></call></block></expr>;</expr_stmt>
   </block_content>}</block></finally></try>
 </block_content>}</block></catch>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>SSLTestConfig</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>SSLTestConfig</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">8d626dc1c2d</literal><operator>..</operator><literal type="number">68c4b076c0d</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>SSLTestConfig</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>test</name><operator>-</operator><name>framework</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>util</name><operator>/</operator><name><name>SSLTestConfig</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">25</literal></expr><operator>,</operator><expr><literal type="number">15</literal> <operator>+</operator><literal type="number">25</literal></expr><operator>,</operator><expr><literal type="number">21</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>security</name><operator>.</operator><name>UnrecoverableKeyException</name></name>;</import>
 
 <import>import <name><name>javax</name><operator>.</operator><name>net</name><operator>.</operator><name>ssl</name><operator>.</operator><name>SSLContext</name></name>;</import>
 
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>Registry</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>config</name><operator>.</operator><name>RegistryBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>scheme</name><operator>.</operator><name>Scheme</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>scheme</name><operator>.</operator><name>SchemeRegistry</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>socket</name><operator>.</operator><name>ConnectionSocketFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>socket</name><operator>.</operator><name>LayeredConnectionSocketFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>SSLConnectionSocketFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>SSLContexts</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>SSLSocketFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>conn</name><operator>.</operator><name>ssl</name><operator>.</operator><name>TrustSelfSignedStrategy</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>http</name><operator>.</operator><name>impl</name><operator>.</operator><name>client</name><operator>.</operator><name>DefaultHttpClient</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>embedded</name><operator>.</operator><name>SSLConfig</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientConfigurer</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>params</name><operator>.</operator><name>SolrParams</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>HttpClientUtil</name><operator>.</operator><name>SchemaRegistryProvider</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>client</name><operator>.</operator><name>solrj</name><operator>.</operator><name>impl</name><operator>.</operator><name>SolrHttpClientBuilder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>util</name><operator>.</operator><name>resource</name><operator>.</operator><name>Resource</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>eclipse</name><operator>.</operator><name>jetty</name><operator>.</operator><name>util</name><operator>.</operator><name>security</name><operator>.</operator><name>CertificateUtils</name></name>;</import>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">44</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">50</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>SSLTestConfig</name> extends <name>SSLConfig</name> <block>{
   <expr><specifier>private</specifier> <specifier>static</specifier> <name>String</name> <name>TEST_KEYSTORE_PATH</name> <operator>=</operator> <name>TEST_KEYSTORE</name> <operator>!=</operator> <literal type="null">null</literal>
       <operator>&amp;&amp;</operator> <call><name><name>TEST_KEYSTORE</name><operator>.</operator><name>exists</name></name><argument_list>()</argument_list></call> <operator>?</operator> <call><name><name>TEST_KEYSTORE</name><operator>.</operator><name>getAbsolutePath</name></name><argument_list>()</argument_list></call> <operator>:</operator> <literal type="null">null</literal></expr>;
   <specifier>private</specifier> <specifier>static</specifier> <name>String</name> <name>TEST_KEYSTORE_PASSWORD</name> <operator>=</operator> <literal type="string">"secret"</literal></block></expr>;</expr_stmt>
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <name>HttpClientConfigurer</name></type> <name>DEFAULT_CONFIGURER</name> <init>= <expr><operator>new</operator> <call><name>HttpClientConfigurer</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
   
   <constructor><specifier>public</specifier> <name>SSLTestConfig</name><parameter_list>()</parameter_list> <block>{<block_content>
     <expr_stmt><expr><call><name>this</name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">59</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">64</literal></expr><operator>,</operator><expr><literal type="number">13</literal> @@ <specifier>public</specifier> <name>class</name> <name>SSLTestConfig</name> extends <name>SSLConfig</name> <block>{
   }</block>
   
   <comment type="block" format="javadoc">/**
   * Will provide an HttpClientConfigurer for SSL support (adds https and
   * Will provide an SolrHttpClientBuilder for SSL support (adds https and
    * removes http schemes) is SSL is enabled, otherwise return the default
   * configurer
   * SolrHttpClientBuilder
    */</comment>
  <specifier>public</specifier> <name>HttpClientConfigurer</name> <call><name>getHttpClientConfigurer</name><argument_list>()</argument_list></call> <block>{
    <return>return <expr><call><name>isSSLMode</name><argument_list>()</argument_list></call> <operator>?</operator> <operator>new</operator> <call><name>SSLHttpClientConfigurer</name><argument_list>()</argument_list></call> <operator>:</operator> <name>DEFAULT_CONFIGURER</name></expr>;</return>
  <specifier>public</specifier> <name>SolrHttpClientBuilder</name> <call><name>getHttpClientBuilder</name><argument_list>()</argument_list></call> <block>{
    <expr><name>SolrHttpClientBuilder</name> <name>builder</name> <operator>=</operator> <call><name><name>HttpClientUtil</name><operator>.</operator><name>getHttpClientBuilder</name></name><argument_list>()</argument_list></call></expr>;</block></block></expr></expr_stmt>
    <return>return <expr><ternary><condition><expr><call><name>isSSLMode</name><argument_list>()</argument_list></call></expr> ?</condition><then> <expr><operator>new</operator> <call><name>SSLHttpClientBuilderProvider</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getBuilder</name><argument_list>(<argument><expr><name>builder</name></expr></argument>)</argument_list></call></expr> </then><else>: <expr><name>builder</name></expr></else></ternary></expr>;</return>
   </block_content>}</block></constructor></block_content></block></function></block_content></block></function></block_content></block></function></block_content></block></if></if_stmt></block_content></block></function></block_content></block></function></block_content></block></function></block_content></block></function></block_content></block></function></block_content></block></if></if_stmt></block_content></block></function></block_content></block></function></block_content></block></function></block></class></block_content></block></function></block_content></block></function></block_content></block></for></block_content></block></for></block_content></block></for></block_content></block></else></if_stmt></block></expr></expr_stmt></block_content></block></for></block_content></block></for></block_content></block></else></if_stmt></block></expr></expr_stmt></block></class></block_content></block></for></block_content></block></function></block_content></block></for></block_content></block></for></block_content></block></try></block></class></block_content></block></for></block_content></block></else></if_stmt></block_content></block></for></block_content></block></for></block></expr></expr_stmt></block_content></block></catch></try></block_content></block></for></block_content></block></for></block_content></block></function></block></class></block_content></block></function></block_content></block></if></if_stmt></block_content></block></if></if_stmt></block_content></block></function></block></class></block></class></block_content></block></function></block_content></block></function></block></class></block></class></block></class></expr></init></decl></decl_stmt></block_content></block></function></block></class></block></interface>
 
   <comment type="block" format="javadoc">/**
@@ -88,20 +94,53 @@ public class SSLTestConfig extends SSLConfig {
     }
   }
   
  private class SSLHttpClientConfigurer extends HttpClientConfigurer {
    @SuppressWarnings("deprecation")
    public void configure(DefaultHttpClient httpClient, SolrParams config) {
      super.configure(httpClient, config);
      SchemeRegistry registry = httpClient.getConnectionManager().getSchemeRegistry();
      // Make sure no tests cheat by using HTTP
      registry.unregister("http");
      try {
        registry.register(new Scheme("https", 443, new SSLSocketFactory(buildSSLContext())));
      } catch (KeyManagementException | UnrecoverableKeyException
          | NoSuchAlgorithmException | KeyStoreException ex) {
        throw new IllegalStateException("Unable to setup https scheme for HTTPClient to test SSL.", ex);
      }
  private class SSLHttpClientBuilderProvider  {
    

    public SolrHttpClientBuilder getBuilder(SolrHttpClientBuilder builder) {

      HttpClientUtil.setSchemeRegistryProvider(new SchemaRegistryProvider() {
        
        @Override
        public Registry&lt;ConnectionSocketFactory&gt; getSchemaRegistry() {
          SSLConnectionSocketFactory sslConnectionFactory;
          try {
            boolean sslCheckPeerName = toBooleanDefaultIfNull(
                toBooleanObject(System.getProperty(HttpClientUtil.SYS_PROP_CHECK_PEER_NAME)), true);
            if (sslCheckPeerName == false) {
              sslConnectionFactory = new SSLConnectionSocketFactory(buildSSLContext(),
                  SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
            } else {
              sslConnectionFactory = new SSLConnectionSocketFactory(buildSSLContext());
            }
          } catch (KeyManagementException | UnrecoverableKeyException | NoSuchAlgorithmException | KeyStoreException e) {
            throw new IllegalStateException("Unable to setup https scheme for HTTPClient to test SSL.", e);
          }
          return  RegistryBuilder.&lt;ConnectionSocketFactory&gt;create()
              .register("https", sslConnectionFactory).build();
        }
      });
      HttpClientUtil.setHttpClientBuilder(builder);
      return builder;
    }

  }
  
  public static boolean toBooleanDefaultIfNull(Boolean bool, boolean valueIfNull) {
    if (bool == null) {
      return valueIfNull;
    }
    return bool.booleanValue() ? true : false;
  }
  
  public static Boolean toBooleanObject(String str) {
    if ("true".equalsIgnoreCase(str)) {
      return Boolean.TRUE;
    } else if ("false".equalsIgnoreCase(str)) {
      return Boolean.FALSE;
     }
    // no match
    return null;
   }
   
   public static void setSSLSystemProperties() {
- 
2.19.1.windows.1

</comment></unit>
