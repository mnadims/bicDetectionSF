<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" revision="1.0.0" language="Java" filename="E:/01Courses@USASK/CMPT898-HumanDrivenSoftwareEngineeringForScientificResearch/ProjectProgress/data_files/final_dataset/gen_patch_codes/filtered/lucene/135d89c4bd.java"><expr_stmt><expr><name>From</name> <literal type="number">135d89c4bddb092a4b880921415a82833154f691</literal> <name>Mon</name> <name>Sep</name> <literal type="number">17</literal> <literal type="number">00</literal><operator>:</operator><literal type="number">00</literal><operator>:</operator><literal type="number">00</literal> <literal type="number">2001</literal>
<name>From</name><operator>:</operator> <name>Yonik</name> <name><name>Seeley</name> <argument_list type="generic">&lt;<argument><name>yonik</name><annotation>@<name><name>apache</name><operator>.</operator><name>org</name></name></annotation></argument>&gt;</argument_list></name>
<name>Date</name><operator>:</operator> <name>Sat</name></expr><operator>,</operator> <expr><literal type="number">30</literal> <name>Jul</name> <literal type="number">2011</literal> <literal type="number">19</literal><operator>:</operator><literal type="number">18</literal><operator>:</operator><literal type="number">09</literal> <operator>+</operator><literal type="number">0000</literal>
<name>Subject</name><operator>:</operator> <index>[<expr><name>PATCH</name></expr>]</index> <name>SOLR</name><operator>-</operator><literal type="number">2685</literal><operator>:</operator> <name>always</name> <name>use</name> <name>SolrInputDocument</name> <name>in</name> <name>update</name> <name>chain</name></expr><operator>,</operator>
 <expr><name>change</name> <name>from</name> <name>String</name> <name>to</name> <name>BytesRef</name>

<name>git</name><operator>-</operator><name>svn</name><operator>-</operator><name>id</name><operator>:</operator> <name>https</name><operator>:</operator><comment type="line">//svn.apache.org/repos/asf/lucene/dev/trunk@1152500 13f79535-47bb-0310-9956-ffa450edef68</comment>
<operator>--</operator>
 <operator>...</operator><operator>/</operator><name>extraction</name><operator>/</operator><name><name>ExtractingDocumentLoader</name><operator>.</operator><name>java</name></name>  <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>CSVRequestHandler</name><operator>.</operator><name>java</name></name>       <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>XMLLoader</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">3</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AddUpdateCommand</name><operator>.</operator><name>java</name></name>  <operator>|</operator> <literal type="number">51</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>+</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DeleteUpdateCommand</name><operator>.</operator><name>java</name></name>      <operator>|</operator> <literal type="number">26</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DirectUpdateHandler2</name><operator>.</operator><name>java</name></name>     <operator>|</operator> <literal type="number">11</literal> <operator>++</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateHandler</name><operator>.</operator><name>java</name></name> <operator>|</operator> <literal type="number">66</literal> <operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>processor</name><operator>/</operator><name><name>LogUpdateProcessorFactory</name><operator>.</operator><name>java</name></name>  <operator>|</operator>  <literal type="number">4</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>processor</name><operator>/</operator><name><name>RunUpdateProcessorFactory</name><operator>.</operator><name>java</name></name>  <operator>|</operator>  <literal type="number">1</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>search</name><operator>/</operator><name><name>TestRealTimeGet</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name><name>DirectUpdateHandlerOptimizeTest</name><operator>.</operator><name>java</name></name>      <operator>|</operator>  <literal type="number">7</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>TestIndexingPerformance</name><operator>.</operator><name>java</name></name>  <operator>|</operator> <literal type="number">42</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>--</operator><operator>--</operator><operator>--</operator>
 <literal type="number">12</literal> <name>files</name> <name>changed</name></expr><operator>,</operator> <expr><literal type="number">83</literal> <call><name>insertions</name><argument_list>(<argument><expr><operator>+</operator></expr></argument>)</argument_list></call></expr><operator>,</operator> <expr><literal type="number">134</literal> <call><name>deletions</name><argument_list>(<argument><expr><operator>-</operator></expr></argument>)</argument_list></call>

<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>contrib</name><operator>/</operator><name>extraction</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>extraction</name><operator>/</operator><name><name>ExtractingDocumentLoader</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>contrib</name><operator>/</operator><name>extraction</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>extraction</name><operator>/</operator><name><name>ExtractingDocumentLoader</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">4c1f7f20c57</literal><operator>..</operator><literal type="number">615a4586141</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>contrib</name><operator>/</operator><name>extraction</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>extraction</name><operator>/</operator><name><name>ExtractingDocumentLoader</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>contrib</name><operator>/</operator><name>extraction</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name>extraction</name><operator>/</operator><name><name>ExtractingDocumentLoader</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">119</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">119</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ExtractingDocumentLoader</name> extends <name>ContentStreamLoader</name> <block>{
   }</block>
 
   <name>void</name> <call><name>addDoc</name><argument_list>(<argument><expr><name>SolrContentHandler</name> <name>handler</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{
    <expr><name><name>templateAdd</name><operator>.</operator><name>indexedId</name></name> <operator>=</operator> <literal type="null">null</literal></expr></block></expr></argument></throws></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>templateAdd</name><operator>.</operator><name>clear</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>doAdd</name><argument_list>(<argument><expr><name>handler</name></expr></argument>, <argument><expr><name>templateAdd</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
   }
 
diff <expr_stmt><expr><operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>CSVRequestHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>CSVRequestHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>f1bfb118bb2</name><operator>..</operator><literal type="number">4f8ceb2acdd</literal> <literal type="number">100755</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>CSVRequestHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>CSVRequestHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">411</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">411</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <name>class</name> <name>SingleThreadedCSVLoader</name> extends <name>CSVLoader</name> <block>{
 
   @<expr><name>Override</name>
   <name>void</name> <call><name>addDoc</name><argument_list>(<argument><expr><name>int</name> <name>line</name></expr></argument>, <argument><expr><name><name>String</name><index>[]</index></name> <name>vals</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{
    <expr><name><name>templateAdd</name><operator>.</operator><name>indexedId</name></name> <operator>=</operator> <literal type="null">null</literal></expr></block></expr></argument></throws></expr>;
    <expr><call><name><name>templateAdd</name><operator>.</operator><name>clear</name></name><argument_list>()</argument_list></call></expr>;
     <expr><name>SolrInputDocument</name> <name>doc</name> <operator>=</operator> <operator>new</operator> <call><name>SolrInputDocument</name><argument_list>()</argument_list></call></expr>;
     <expr><call><name>doAdd</name><argument_list>(<argument><expr><name>line</name></expr></argument>, <argument><expr><name>vals</name></expr></argument>, <argument><expr><name>doc</name></expr></argument>, <argument><expr><name>templateAdd</name></expr></argument>)</argument_list></call></expr>;
   }</block>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>XMLLoader</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>XMLLoader</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>d2dea87d280</name><operator>..</operator><literal type="number">31e3fd0c008</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>XMLLoader</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>handler</name><operator>/</operator><name><name>XMLLoader</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">211</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">211</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <name>class</name> <name>XMLLoader</name> extends <name>ContentStreamLoader</name> <block>{
                     <expr><literal type="string">"unexpected XML tag /delete/"</literal> <operator>+</operator> <name>currTag</name></expr>)</block></expr>;</expr_stmt>
           }
           processor<expr_stmt><expr><operator>.</operator><call><name>processDelete</name><argument_list>(<argument><expr><name>deleteCmd</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <expr_stmt><expr><name><name>deleteCmd</name><operator>.</operator><name>id</name></name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
          <expr_stmt><expr><name><name>deleteCmd</name><operator>.</operator><name>query</name></name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>deleteCmd</name><operator>.</operator><name>clear</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
           <break>break;</break>
 
           <comment type="line">// Add everything to the text</comment>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AddUpdateCommand</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AddUpdateCommand</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>cf6ce93083e</name><operator>..</operator><literal type="number">4b246a2f3a3</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AddUpdateCommand</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>AddUpdateCommand</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">20</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">20</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@</expr></expr_stmt> <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name></name>;</package>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>document</name><operator>.</operator><name>Document</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>document</name><operator>.</operator><name>Fieldable</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>index</name><operator>.</operator><name>Term</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>BytesRef</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrException</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputDocument</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputField</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>request</name><operator>.</operator><name>SolrQueryRequest</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">34</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>schema</name><operator>.</operator><name>SchemaField</name></name>;</import>
 <class><specifier>public</specifier> class <name>AddUpdateCommand</name> <super_list><extends>extends <super><name>UpdateCommand</name></super></extends></super_list> <block>{
    <comment type="line">// optional id in "internal" indexed form... if it is needed and not supplied,</comment>
    <comment type="line">// it will be obtained from the doc.</comment>
   <decl_stmt><decl><type><specifier>public</specifier> <name>String</name></type> <name>indexedId</name></decl>;</decl_stmt>

   <comment type="line">// The Lucene document to be indexed</comment>
   <decl_stmt><decl><type><specifier>public</specifier> <name>Document</name></type> <name>doc</name></decl>;</decl_stmt>
   <decl_stmt><decl><type><specifier>private</specifier> <name>BytesRef</name></type> <name>indexedId</name></decl>;</decl_stmt>
 
    <comment type="line">// Higher level SolrInputDocument, normally used to construct the Lucene Document</comment>
    <comment type="line">// to index.</comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">52</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">51</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>AddUpdateCommand</name> extends <name>UpdateCommand</name> <block>{
 
    <comment type="block" format="javadoc">/** Reset state to reuse this object with a different document in the same request */</comment>
    <expr><specifier>public</specifier> <name>void</name> <call><name>clear</name><argument_list>()</argument_list></call> <block>{
     <expr><name>doc</name> <operator>=</operator> <literal type="null">null</literal></expr>;
      <expr><name>solrDoc</name> <operator>=</operator> <literal type="null">null</literal></expr>;
      <expr><name>indexedId</name> <operator>=</operator> <literal type="null">null</literal></expr>;
    }</block>
@@ <operator>-</operator><literal type="number">61</literal></expr>,<expr><literal type="number">26</literal> <operator>+</operator><literal type="number">59</literal></expr>,<expr><literal type="number">32</literal> @@ <specifier>public</specifier> <name>class</name> <name>AddUpdateCommand</name> extends <name>UpdateCommand</name> <block>{
      <return>return <expr><name>solrDoc</name></expr>;</return></block></expr>
    }</block>
 
   <specifier>public</specifier> <name>Document</name> <call><name>getLuceneDocument</name><argument_list>(<argument><expr><name>IndexSchema</name> <name>schema</name></expr></argument>)</argument_list></call> <block>{
     <if_stmt><if>if <condition>(<expr><name>doc</name> <operator>==</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <name>solrDoc</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <comment type="line">// TODO??  build the doc from the SolrDocument?</comment>
     <expr_stmt/></block_content></block></if></if_stmt>}</block></expr></expr_stmt>
     <return>return <expr><name>doc</name></expr>;</return>    
  <comment type="block" format="javadoc">/** Creates and returns a lucene Document to index.  Any changes made to the returned Document
   * will not be reflected in the SolrInputDocument, or future calls to this method.
   */</comment>
   <function><type><specifier>public</specifier> <name>Document</name></type> <name>getLuceneDocument</name><parameter_list>()</parameter_list> <block>{<block_content>
     <return>return <expr><call><name><name>DocumentBuilder</name><operator>.</operator><name>toDocument</name></name><argument_list>(<argument><expr><call><name>getSolrInputDocument</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>req</name><operator>.</operator><name>getSchema</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
    </block_content>}</block></function>
 
   <function><type><specifier>public</specifier> <name>String</name></type> <name>getIndexedId</name><parameter_list>(<parameter><decl><type><name>IndexSchema</name></type> <name>schema</name></decl></parameter>)</parameter_list> <block>{<block_content>
  <comment type="block" format="javadoc">/** Returns the indexed ID for this document.  The returned BytesRef is retained across multiple calls, and should not be modified. */</comment>
   <function><type><specifier>public</specifier> <name>BytesRef</name></type> <name>getIndexedId</name><parameter_list>()</parameter_list> <block>{<block_content>
      <if_stmt><if>if <condition>(<expr><name>indexedId</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <decl_stmt><decl><type><name>IndexSchema</name></type> <name>schema</name> <init>= <expr><call><name><name>req</name><operator>.</operator><name>getSchema</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>SchemaField</name></type> <name>sf</name> <init>= <expr><call><name><name>schema</name><operator>.</operator><name>getUniqueKeyField</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>sf</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
         <if_stmt><if>if <condition>(<expr><name>doc</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
           <expr_stmt><expr><call><name><name>schema</name><operator>.</operator><name>getUniqueKeyField</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
           <decl_stmt><decl><type><name>Fieldable</name></type> <name>storedId</name> <init>= <expr><call><name><name>doc</name><operator>.</operator><name>getFieldable</name></name><argument_list>(<argument><expr><call><name><name>sf</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
           <expr_stmt><expr><name>indexedId</name> <operator>=</operator> <call><name><name>sf</name><operator>.</operator><name>getType</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>storedToIndexed</name><argument_list>(<argument><expr><name>storedId</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         </block_content>}</block></if></if_stmt>
          <if_stmt><if>if <condition>(<expr><name>solrDoc</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <decl_stmt><decl><type><name>SolrInputField</name></type> <name>field</name> <init>= <expr><call><name><name>solrDoc</name><operator>.</operator><name>getField</name></name><argument_list>(<argument><expr><call><name><name>sf</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
           <if_stmt><if>if <condition>(<expr><name>field</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
             <expr_stmt><expr><name>indexedId</name> <operator>=</operator> <call><name><name>sf</name><operator>.</operator><name>getType</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toInternal</name><argument_list>( <argument><expr><call><name><name>field</name><operator>.</operator><name>getFirstValue</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument> )</argument_list></call></expr>;</expr_stmt>

           <decl_stmt><decl><type><name>int</name></type> <name>count</name> <init>= <expr><ternary><condition><expr><name>field</name><operator>==</operator><literal type="null">null</literal></expr> ?</condition><then> <expr><literal type="number">0</literal></expr> </then><else>: <expr><call><name><name>field</name><operator>.</operator><name>getValueCount</name></name><argument_list>()</argument_list></call></expr></else></ternary></expr></init></decl>;</decl_stmt>
           <if_stmt><if>if <condition>(<expr><name>count</name> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>
             <if_stmt><if>if <condition>(<expr><name>overwrite</name></expr>)</condition> <block>{<block_content>
               <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>( <argument><expr><name><name>SolrException</name><operator>.</operator><name>ErrorCode</name><operator>.</operator><name>BAD_REQUEST</name></name></expr></argument>,<argument><expr><literal type="string">"Document is missing mandatory uniqueKey field: "</literal> <operator>+</operator> <call><name><name>sf</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</throw>
             </block_content>}</block></if></if_stmt>
           </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><name>count</name>  <operator>&gt;</operator> <literal type="number">1</literal></expr>)</condition> <block>{<block_content>
             <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>( <argument><expr><name><name>SolrException</name><operator>.</operator><name>ErrorCode</name><operator>.</operator><name>BAD_REQUEST</name></name></expr></argument>,<argument><expr><literal type="string">"Document contains multiple values for uniqueKey field: "</literal> <operator>+</operator> <name>field</name></expr></argument>)</argument_list></call></expr>;</throw>
           </block_content>}</block></if> <else>else <block>{<block_content>
             <expr_stmt><expr><name>indexedId</name> <operator>=</operator> <operator>new</operator> <call><name>BytesRef</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
             <expr_stmt><expr><call><name><name>sf</name><operator>.</operator><name>getType</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>readableToIndexed</name><argument_list>(<argument><expr><call><name><name>field</name><operator>.</operator><name>getFirstValue</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>indexedId</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></else></if_stmt>
          </block_content>}</block></if></if_stmt>
        </block_content>}</block></if></if_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">88</literal></expr><operator>,</operator><expr><literal type="number">16</literal> <operator>+</operator><literal type="number">92</literal></expr><operator>,</operator><expr><literal type="number">9</literal> @@ <specifier>public</specifier> <name>class</name> <name>AddUpdateCommand</name> extends <name>UpdateCommand</name> <block>{
      <return>return <expr><name>indexedId</name></expr>;</return>
    }</block></expr></expr_stmt>
 
   <function><type><specifier>public</specifier> <name>String</name></type> <name>getPrintableId</name><parameter_list>(<parameter><decl><type><name>IndexSchema</name></type> <name>schema</name></decl></parameter>)</parameter_list> <block>{<block_content>
   <function><type><specifier>public</specifier> <name>String</name></type> <name>getPrintableId</name><parameter_list>()</parameter_list> <block>{<block_content>
     <decl_stmt><decl><type><name>IndexSchema</name></type> <name>schema</name> <init>= <expr><call><name><name>req</name><operator>.</operator><name>getSchema</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>SchemaField</name></type> <name>sf</name> <init>= <expr><call><name><name>schema</name><operator>.</operator><name>getUniqueKeyField</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
     <if_stmt><if>if <condition>(<expr><name>indexedId</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <name>sf</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <return>return <expr><call><name><name>sf</name><operator>.</operator><name>getType</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>indexedToReadable</name><argument_list>(<argument><expr><name>indexedId</name></expr></argument>)</argument_list></call></expr>;</return>
     </block_content>}</block></if></if_stmt>

     <if_stmt><if>if <condition>(<expr><name>doc</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
       <return>return <expr><call><name><name>schema</name><operator>.</operator><name>printableUniqueKey</name></name><argument_list>(<argument><expr><name>doc</name></expr></argument>)</argument_list></call></expr>;</return>
     </block_content>}</block></if></if_stmt>

      <if_stmt><if>if <condition>(<expr><name>solrDoc</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <name>sf</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
        <decl_stmt><decl><type><name>SolrInputField</name></type> <name>field</name> <init>= <expr><call><name><name>solrDoc</name><operator>.</operator><name>getField</name></name><argument_list>(<argument><expr><call><name><name>sf</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>field</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DeleteUpdateCommand</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DeleteUpdateCommand</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>adfd5ca2578</name><operator>..</operator><name>e7fa495e443</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DeleteUpdateCommand</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DeleteUpdateCommand</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">17</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">17</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@</expr></expr_stmt>
 
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>update</name></name>;</package>
 
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>lucene</name><operator>.</operator><name>util</name><operator>.</operator><name>BytesRef</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>common</name><operator>.</operator><name>SolrInputField</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>request</name><operator>.</operator><name>SolrQueryRequest</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>schema</name><operator>.</operator><name>IndexSchema</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>solr</name><operator>.</operator><name>schema</name><operator>.</operator><name>SchemaField</name></name>;</import>
 
 <comment type="block" format="javadoc">/**
  *
@@ -25,11 +29,33 @@ import org.apache.solr.request.SolrQueryRequest;
 public class DeleteUpdateCommand extends UpdateCommand {
   public String id;    // external (printable) id, for delete-by-id
   public String query; // query string for delete-by-query
  private BytesRef indexedId;

 
   public DeleteUpdateCommand(SolrQueryRequest req) {
     super("delete", req);
   }
 
  public void clear() {
    id = null;
    query = null;
    indexedId = null;
  }

  /** Returns the indexed ID for this delete.  The returned BytesRef is retained across multiple calls, and should not be modified. */</comment>
  <function><type><specifier>public</specifier> <name>BytesRef</name></type> <name>getIndexedId</name><parameter_list>()</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>indexedId</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <decl_stmt><decl><type><name>IndexSchema</name></type> <name>schema</name> <init>= <expr><call><name><name>req</name><operator>.</operator><name>getSchema</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name>SchemaField</name></type> <name>sf</name> <init>= <expr><call><name><name>schema</name><operator>.</operator><name>getUniqueKeyField</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <if_stmt><if>if <condition>(<expr><name>sf</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <name>id</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
        <expr_stmt><expr><name>indexedId</name> <operator>=</operator> <operator>new</operator> <call><name>BytesRef</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>sf</name><operator>.</operator><name>getType</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>readableToIndexed</name><argument_list>(<argument><expr><name>id</name></expr></argument>, <argument><expr><name>indexedId</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></if></if_stmt>
    </block_content>}</block></if></if_stmt>
    <return>return <expr><name>indexedId</name></expr>;</return>
  </block_content>}</block></function>


   <function><annotation>@<name>Override</name></annotation>
   <type><specifier>public</specifier> <name>String</name></type> <name>toString</name><parameter_list>()</parameter_list> <block>{<block_content>
     <decl_stmt><decl><type><name>StringBuilder</name></type> <name>sb</name> <init>= <expr><operator>new</operator> <call><name>StringBuilder</name><argument_list>(<argument><expr><name>commandName</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DirectUpdateHandler2</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DirectUpdateHandler2</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>d2efaef4314</name><operator>..</operator><name>b316b522b98</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DirectUpdateHandler2</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>DirectUpdateHandler2</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">154</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">154</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>DirectUpdateHandler2</name> extends <name>UpdateHandler</name> <block>{
 			<expr><name>Term</name> <name>updateTerm</name> <operator>=</operator> <literal type="null">null</literal></expr>;</block></expr></expr_stmt>
 
       <if_stmt><if>if <condition>(<expr><name><name>cmd</name><operator>.</operator><name>overwrite</name></name></expr>)</condition> <block>{<block_content>
        <if_stmt><if>if <condition>(<expr><name><name>cmd</name><operator>.</operator><name>indexedId</name></name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><name><name>cmd</name><operator>.</operator><name>indexedId</name></name> <operator>=</operator> <call><name>getIndexedId</name><argument_list>(<argument><expr><name><name>cmd</name><operator>.</operator><name>doc</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
        <decl_stmt><decl><type><name>Term</name></type> <name>idTerm</name> <init>= <expr><operator>new</operator> <call><name>Term</name><argument_list>(<argument><expr><call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name><name>cmd</name><operator>.</operator><name>indexedId</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>Term</name></type> <name>idTerm</name> <init>= <expr><operator>new</operator> <call><name>Term</name><argument_list>(<argument><expr><call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>cmd</name><operator>.</operator><name>getIndexedId</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
         <decl_stmt><decl><type><name>boolean</name></type> <name>del</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
         <if_stmt><if>if <condition>(<expr><name><name>cmd</name><operator>.</operator><name>updateTerm</name></name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
           <expr_stmt><expr><name>updateTerm</name> <operator>=</operator> <name>idTerm</name></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">166</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">163</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>DirectUpdateHandler2</name> extends <name>UpdateHandler</name> <block>{
           <expr><name>updateTerm</name> <operator>=</operator> <name><name>cmd</name><operator>.</operator><name>updateTerm</name></name></expr>;
         }</block></expr></expr_stmt>
 
        <expr_stmt><expr><call><name><name>writer</name><operator>.</operator><name>updateDocument</name></name><argument_list>(<argument><expr><name>updateTerm</name></expr></argument>, <argument><expr><call><name><name>cmd</name><operator>.</operator><name>getLuceneDocument</name></name><argument_list>(<argument><expr><name>schema</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>writer</name><operator>.</operator><name>updateDocument</name></name><argument_list>(<argument><expr><name>updateTerm</name></expr></argument>, <argument><expr><call><name><name>cmd</name><operator>.</operator><name>getLuceneDocument</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         <if_stmt><if>if<condition>(<expr><name>del</name></expr>)</condition> <block>{<block_content> <comment type="line">// ensure id remains unique</comment>
           <decl_stmt><decl><type><name>BooleanQuery</name></type> <name>bq</name> <init>= <expr><operator>new</operator> <call><name>BooleanQuery</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
           <expr_stmt><expr><call><name><name>bq</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>BooleanClause</name><argument_list>(<argument><expr><operator>new</operator> <call><name>TermQuery</name><argument_list>(<argument><expr><name>updateTerm</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name><name>Occur</name><operator>.</operator><name>MUST_NOT</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">175</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">172</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>DirectUpdateHandler2</name> extends <name>UpdateHandler</name> <block>{
         }</block></expr></expr_stmt>
       </block_content>}</block></if> <else>else <block>{<block_content>
         <comment type="line">// allow duplicates</comment>
        <expr_stmt><expr><call><name><name>writer</name><operator>.</operator><name>addDocument</name></name><argument_list>(<argument><expr><call><name><name>cmd</name><operator>.</operator><name>getLuceneDocument</name></name><argument_list>(<argument><expr><name>schema</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>writer</name><operator>.</operator><name>addDocument</name></name><argument_list>(<argument><expr><call><name><name>cmd</name><operator>.</operator><name>getLuceneDocument</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
       </block_content>}</block></else></if_stmt>
 
       <expr_stmt><expr><name>rc</name> <operator>=</operator> <literal type="number">1</literal></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">198</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">195</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>DirectUpdateHandler2</name> extends <name>UpdateHandler</name> <block>{
     <expr><call><name><name>deleteByIdCommands</name><operator>.</operator><name>incrementAndGet</name></name><argument_list>()</argument_list></call></expr>;
     <call><name><name>deleteByIdCommandsCumulative</name><operator>.</operator><name>incrementAndGet</name></name><argument_list>()</argument_list></call></block></expr>;</expr_stmt>
 
    <expr_stmt><expr><call><name><name>indexWriterProvider</name><operator>.</operator><name>getIndexWriter</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>deleteDocuments</name><argument_list>(<argument><expr><operator>new</operator> <call><name>Term</name><argument_list>(<argument><expr><call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>idFieldType</name><operator>.</operator><name>toInternal</name></name><argument_list>(<argument><expr><name><name>cmd</name><operator>.</operator><name>id</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>indexWriterProvider</name><operator>.</operator><name>getIndexWriter</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>deleteDocuments</name><argument_list>(<argument><expr><operator>new</operator> <call><name>Term</name><argument_list>(<argument><expr><call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>cmd</name><operator>.</operator><name>getIndexedId</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
     <if_stmt><if>if <condition>(<expr><name><name>commitTracker</name><operator>.</operator><name>timeUpperBound</name></name> <operator>&gt;</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>
       <expr_stmt><expr><call><name><name>commitTracker</name><operator>.</operator><name>scheduleCommitWithin</name></name><argument_list>(<argument><expr><name><name>commitTracker</name><operator>.</operator><name>timeUpperBound</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">0a5e32b81a7</literal><operator>..</operator><literal type="number">28f2aad53fd</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>solr</name><operator>/</operator><name>core</name><operator>/</operator><name>src</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>solr</name><operator>/</operator><name>update</name><operator>/</operator><name><name>UpdateHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">111</literal></expr><operator>,</operator><expr><literal type="number">34</literal> <operator>+</operator><literal type="number">111</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>UpdateHandler</name> implements <name>SolrInfoMBean</name> <block>{
     <expr><name>idFieldType</name> <operator>=</operator> <name>idField</name><operator>!=</operator><literal type="null">null</literal> <operator>?</operator> <call><name><name>idField</name><operator>.</operator><name>getType</name></name><argument_list>()</argument_list></call> <operator>:</operator> <literal type="null">null</literal></expr>;
     <call><name>parseEventListeners</name><argument_list>()</argument_list></call></block></expr>;</expr_stmt>
   </block_content>}</block></if></if_stmt>

  <function><type><specifier>protected</specifier> <specifier>final</specifier> <name>Term</name></type> <name>idTerm</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>readableId</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <comment type="line">// to correctly create the Term, the string needs to be run</comment>
    <comment type="line">// through the Analyzer for that field.</comment>
    <return>return <expr><operator>new</operator> <call><name>Term</name><argument_list>(<argument><expr><call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>idFieldType</name><operator>.</operator><name>toInternal</name></name><argument_list>(<argument><expr><name>readableId</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>protected</specifier> <specifier>final</specifier> <name>String</name></type> <name>getIndexedId</name><parameter_list>(<parameter><decl><type><name>Document</name></type> <name>doc</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>idField</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content>
      <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>( <argument><expr><name><name>SolrException</name><operator>.</operator><name>ErrorCode</name><operator>.</operator><name>BAD_REQUEST</name></name></expr></argument>,<argument><expr><literal type="string">"Operation requires schema to have a unique key field"</literal></expr></argument>)</argument_list></call></expr>;</throw></block_content></block></if></if_stmt>

    <comment type="line">// Right now, single valued fields that require value transformation from external to internal (indexed)</comment>
    <comment type="line">// form have that transformation already performed and stored as the field value.</comment>
    <decl_stmt><decl><type><name><name>Fieldable</name><index>[]</index></name></type> <name>id</name> <init>= <expr><call><name><name>doc</name><operator>.</operator><name>getFieldables</name></name><argument_list>( <argument><expr><call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument> )</argument_list></call></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><name>id</name> <operator>==</operator> <literal type="null">null</literal> <operator>||</operator> <name><name>id</name><operator>.</operator><name>length</name></name> <operator>&lt;</operator> <literal type="number">1</literal></expr>)</condition><block type="pseudo"><block_content>
      <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>( <argument><expr><name><name>SolrException</name><operator>.</operator><name>ErrorCode</name><operator>.</operator><name>BAD_REQUEST</name></name></expr></argument>,<argument><expr><literal type="string">"Document is missing mandatory uniqueKey field: "</literal> <operator>+</operator> <call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</throw></block_content></block></if></if_stmt>
    <if_stmt><if>if<condition>( <expr><name><name>id</name><operator>.</operator><name>length</name></name> <operator>&gt;</operator> <literal type="number">1</literal></expr> )</condition><block type="pseudo"><block_content>
      <throw>throw <expr><operator>new</operator> <call><name>SolrException</name><argument_list>( <argument><expr><name><name>SolrException</name><operator>.</operator><name>ErrorCode</name><operator>.</operator><name>BAD_REQUEST</name></name></expr></argument>,<argument><expr><literal type="string">"Document contains multiple values for uniqueKey field: "</literal> <operator>+</operator> <call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</throw></block_content></block></if></if_stmt>

    <return>return <expr><call><name><name>idFieldType</name><operator>.</operator><name>storedToIndexed</name></name><argument_list>( <argument><expr><name><name>id</name><index>[<expr><literal type="number">0</literal></expr>]</index></name></expr></argument> )</argument_list></call></expr>;</return>
  </block_content>}</block></function>

  <function><type><specifier>protected</specifier> <specifier>final</specifier> <name>String</name></type> <name>getIndexedIdOptional</name><parameter_list>(<parameter><decl><type><name>Document</name></type> <name>doc</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <if_stmt><if>if <condition>(<expr><name>idField</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <return>return <expr><literal type="null">null</literal></expr>;</return></block_content></block></if></if_stmt>
    <decl_stmt><decl><type><name>Fieldable</name></type> <name>f</name> <init>= <expr><call><name><name>doc</name><operator>.</operator><name>getFieldable</name></name><argument_list>(<argument><expr><call><name><name>idField</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><name>f</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <return>return <expr><literal type="null">null</literal></expr>;</return></block_content></block></if></if_stmt>
    <return>return <expr><call><name><name>idFieldType</name><operator>.</operator><name>storedToIndexed</name></name><argument_list>(<argument><expr><name>f</name></expr></argument>)</argument_list></call></expr>;</return>
  </block_content>}</block></function></block_content></block></if></if_stmt></block_content></block></if></if_stmt></block_content></block></function></block_content></block></if></if_stmt></block_content></block></if></if_stmt></block_content></block></function></block_content></block></function></block_content></block></if></if_stmt></block_content></block></if></if_stmt></block_content></block></function></block_content></block></function></block></class>
   
   <comment type="block" format="javadoc">/**
    * Allows the UpdateHandler to create the SolrIndexSearcher after it
@@ -167,44 +139,6 @@ public abstract class UpdateHandler implements SolrInfoMBean {
   public abstract void close() throws IOException;
 
 
  static class DeleteHitCollector extends Collector {
    public int deleted=0;
    public final SolrIndexSearcher searcher;
    private int docBase;

    public DeleteHitCollector(SolrIndexSearcher searcher) {
      this.searcher = searcher;
    }

    @Override
    public void collect(int doc) {
      try {
        searcher.getIndexReader().deleteDocument(doc + docBase);
        deleted++;
      } catch (IOException e) {
        // don't try to close the searcher on failure for now...
        // try { closeSearcher(); } catch (Exception ee) { SolrException.log(log,ee); }
        throw new SolrException( SolrException.ErrorCode.SERVER_ERROR,"Error deleting doc# "+doc,e,false);
      }
    }

    @Override
    public boolean acceptsDocsOutOfOrder() {
      return false;
    }

    @Override
    public void setNextReader(AtomicReaderContext context) throws IOException {
      docBase = context.docBase;
    }

    @Override
    public void setScorer(Scorer scorer) throws IOException {
      
    }
  }


   /**
    * NOTE: this function is not thread safe.  However, it is safe to call within the
    * &lt;code&gt;inform( SolrCore core )&lt;/code&gt; function for &lt;code&gt;SolrCoreAware&lt;/code&gt; classes.
diff --git a/solr/core/src/java/org/apache/solr/update/processor/LogUpdateProcessorFactory.java b/solr/core/src/java/org/apache/solr/update/processor/LogUpdateProcessorFactory.java
index 16df29e66b2..d53314e68bc 100644
-- a/solr/core/src/java/org/apache/solr/update/processor/LogUpdateProcessorFactory.java
++ b/solr/core/src/java/org/apache/solr/update/processor/LogUpdateProcessorFactory.java
@@ -106,9 +106,9 @@ class LogUpdateProcessor extends UpdateRequestProcessor {
     }
 
     if (adds.size() &lt; maxNumToLog) {
      adds.add(cmd.getPrintableId(req.getSchema()));
      adds.add(cmd.getPrintableId());
     }
    if (logDebug) { log.debug("add {}", cmd.getPrintableId(req.getSchema())); }
    if (logDebug) { log.debug("add {}", cmd.getPrintableId()); }
 
     numAdds++;
 
diff --git a/solr/core/src/java/org/apache/solr/update/processor/RunUpdateProcessorFactory.java b/solr/core/src/java/org/apache/solr/update/processor/RunUpdateProcessorFactory.java
index 3a91cda5ed0..c00be6f0284 100644
-- a/solr/core/src/java/org/apache/solr/update/processor/RunUpdateProcessorFactory.java
++ b/solr/core/src/java/org/apache/solr/update/processor/RunUpdateProcessorFactory.java
@@ -57,7 +57,6 @@ class RunUpdateProcessor extends UpdateRequestProcessor
 
   @Override
   public void processAdd(AddUpdateCommand cmd) throws IOException {
    cmd.doc = DocumentBuilder.toDocument(cmd.getSolrInputDocument(), req.getSchema());
     updateHandler.addDoc(cmd);
     super.processAdd(cmd);
   }
diff --git a/solr/core/src/test/org/apache/solr/search/TestRealTimeGet.java b/solr/core/src/test/org/apache/solr/search/TestRealTimeGet.java
index fbee38af0c1..8b6fed09bf2 100644
-- a/solr/core/src/test/org/apache/solr/search/TestRealTimeGet.java
++ b/solr/core/src/test/org/apache/solr/search/TestRealTimeGet.java
@@ -294,7 +294,7 @@ public class TestRealTimeGet extends SolrTestCaseJ4 {
     final boolean tombstones = false;
 
     // query variables
    final AtomicLong operations = new AtomicLong(10000000);  // number of query operations to perform in total       // TODO: temporarily high due to lack of stability
    final AtomicLong operations = new AtomicLong(0);  // number of query operations to perform in total       // TODO: temporarily high due to lack of stability
     int nReadThreads = 10;
 
     initModel(ndocs);
diff --git a/solr/core/src/test/org/apache/solr/update/DirectUpdateHandlerOptimizeTest.java b/solr/core/src/test/org/apache/solr/update/DirectUpdateHandlerOptimizeTest.java
index 2f425545d65..cabb3626112 100644
-- a/solr/core/src/test/org/apache/solr/update/DirectUpdateHandlerOptimizeTest.java
++ b/solr/core/src/test/org/apache/solr/update/DirectUpdateHandlerOptimizeTest.java
@@ -18,6 +18,7 @@ package org.apache.solr.update;
 
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
import org.apache.solr.common.SolrInputDocument;
 import org.apache.solr.core.SolrCore;
 import org.apache.solr.request.SolrQueryRequest;
 import org.apache.solr.util.AbstractSolrTestCase;
@@ -55,9 +56,9 @@ public class DirectUpdateHandlerOptimizeTest extends AbstractSolrTestCase {
     //the merge factor is 100 and the maxBufferedDocs is 2, so there should be 50 segments
     for (int i = 0; i &lt; 99; i++) {
       // Add a valid document
      cmd.doc = new Document();
      cmd.doc.add(new Field("id", "id_" + i, Field.Store.YES, Field.Index.NOT_ANALYZED));
      cmd.doc.add(new Field("subject", "subject_" + i, Field.Store.NO, Field.Index.ANALYZED));
      cmd.solrDoc = new SolrInputDocument();
      cmd.solrDoc.addField("id", "id_" + i);
      cmd.solrDoc.addField("subject", "subject_" + i);
       updater.addDoc(cmd);
     }
 
diff --git a/solr/core/src/test/org/apache/solr/update/TestIndexingPerformance.java b/solr/core/src/test/org/apache/solr/update/TestIndexingPerformance.java
index 51a55c4aaf1..5249cda0b16 100755
-- a/solr/core/src/test/org/apache/solr/update/TestIndexingPerformance.java
++ b/solr/core/src/test/org/apache/solr/update/TestIndexingPerformance.java
@@ -20,6 +20,7 @@ package org.apache.solr.update;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
 import org.apache.lucene.document.Fieldable;
import org.apache.solr.common.SolrInputDocument;
 import org.apache.solr.request.SolrQueryRequest;
 import org.apache.solr.schema.IndexSchema;
 import org.apache.solr.util.AbstractSolrTestCase;
@@ -50,7 +51,6 @@ public class TestIndexingPerformance extends AbstractSolrTestCase {
     int iter=1000;
     String iterS = System.getProperty("iter");
     if (iterS != null) iter=Integer.parseInt(iterS);
    boolean includeDoc = Boolean.parseBoolean(System.getProperty("includeDoc","true")); // include the time to create the document
     boolean overwrite = Boolean.parseBoolean(System.getProperty("overwrite","false"));
     String doc = System.getProperty("doc");
     if (doc != null) {
@@ -61,14 +61,15 @@ public class TestIndexingPerformance extends AbstractSolrTestCase {
     SolrQueryRequest req = lrf.makeRequest();
     IndexSchema schema = req.getSchema();
     UpdateHandler updateHandler = req.getCore().getUpdateHandler();

    String[] fields = {"text","simple"
            ,"text","test"
            ,"text","how now brown cow"
            ,"text","what's that?"
            ,"text","radical!"
            ,"text","what's all this about, anyway?"
            ,"text","just how fast is this text indexing?"
    String field = "textgap";

    String[] fields = {field,"simple"
            ,field,"test"
            ,field,"how now brown cow"
            ,field,"what's that?"
            ,field,"radical!"
            ,field,"what's all this about, anyway?"
            ,field,"just how fast is this text indexing?"
     };
 
 
@@ -91,26 +92,21 @@ public class TestIndexingPerformance extends AbstractSolrTestCase {
     long start = System.currentTimeMillis();
 
     AddUpdateCommand add = new AddUpdateCommand(req);

    Field idField=null;
    add.overwrite = overwrite;
 
     for (int i=0; i&lt;iter; i++) {
      if (includeDoc || add.doc==null) {
        add.doc = new Document();
        idField = new Field("id","", Field.Store.YES, Field.Index.NOT_ANALYZED);
        add.doc.add(idField);
        for (int j=0; j&lt;fields.length; j+=2) {
          String field = fields[j];
          String val = fields[j+1];
          Fieldable f = schema.getField(field).createField(val, 1.0f);
          add.doc.add(f);
        }
      add.clear();
      add.solrDoc = new SolrInputDocument();
      add.solrDoc.addField("id", Integer.toString(i));
      for (int j=0; j&lt;fields.length; j+=2) {
        String f = fields[j];
        String val = fields[j+1];
        add.solrDoc.addField(f, val);
       }
      idField.setValue(Integer.toString(i));
       updateHandler.addDoc(add);
     }
     long end = System.currentTimeMillis();
    log.info("includeDoc="+includeDoc+" doc="+ Arrays.toString(fields));
    log.info("doc="+ Arrays.toString(fields));
     log.info("iter="+iter +" time=" + (end-start) + " throughput=" + ((long)iter*1000)/(end-start));
 
     //discard all the changes
- 
2.19.1.windows.1

</comment></unit>
