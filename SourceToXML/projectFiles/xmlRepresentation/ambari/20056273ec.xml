<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" revision="1.0.0" language="Java" filename="E:/01Courses@USASK/CMPT898-HumanDrivenSoftwareEngineeringForScientificResearch/ProjectProgress/data_files/final_dataset/gen_patch_codes/filtered/ambari/20056273ec.java"><expr_stmt><expr><name>From</name> <literal type="number">20056273ec9279f4823e495cdecfe514537f1223</literal> <name>Mon</name> <name>Sep</name> <literal type="number">17</literal> <literal type="number">00</literal><operator>:</operator><literal type="number">00</literal><operator>:</operator><literal type="number">00</literal> <literal type="number">2001</literal>
<name>From</name><operator>:</operator> <name>Sumit</name> <name><name>Mohanty</name> <argument_list type="generic">&lt;<argument><name>smohanty</name><annotation>@<name><name>hortonworks</name><operator>.</operator><name>com</name></name></annotation></argument>&gt;</argument_list></name>
<name>Date</name><operator>:</operator> <name>Fri</name></expr><operator>,</operator> <expr><literal type="number">19</literal> <name>Feb</name> <literal type="number">2016</literal> <literal type="number">13</literal><operator>:</operator><literal type="number">33</literal><operator>:</operator><literal type="number">00</literal> <operator>-</operator><literal type="number">0800</literal>
<name>Subject</name><operator>:</operator> <index>[<expr><name>PATCH</name></expr>]</index> <name>AMBARI</name><operator>-</operator><literal type="number">15011.</literal> <name>Decrease</name> <name>the</name> <name>load</name> <name>on</name> <name>ambari</name> <name>database</name> <name>after</name>
 <name>cluster</name> <call><name>creation</name> <argument_list>(<argument><expr><name>Sebastian</name> <name>Toader</name> <name>via</name> <name>smohanty</name></expr></argument>)</argument_list></call>

<operator>--</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>Configuration</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">77</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>ControllerModule</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">16</literal> <operator>++</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>orm</name><operator>/</operator><name>dao</name><operator>/</operator><name><name>HostRoleCommandDAO</name><operator>.</operator><name>java</name></name>    <operator>|</operator> <literal type="number">166</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>orm</name><operator>/</operator><name>entities</name><operator>/</operator><name><name>HostRoleCommandEntity</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">7</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>serveraction</name><operator>/</operator><name><name>ServerActionExecutor</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">13</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name>cluster</name><operator>/</operator><name><name>ClusterImpl</name><operator>.</operator><name>java</name></name>     <operator>|</operator>  <literal type="number">36</literal> <operator>++</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222</name><operator>.</operator><name>java</name></name>     <operator>|</operator>   <literal type="number">5</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>MySQL</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>     <operator>|</operator>   <literal type="number">1</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Oracle</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>    <operator>|</operator>   <literal type="number">1</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>  <operator>|</operator>   <literal type="number">3</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name>EMBEDDED</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>   <operator>|</operator>   <literal type="number">1</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLAnywhere</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>         <operator>|</operator>   <literal type="number">1</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLServer</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name> <operator>|</operator>   <literal type="number">1</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>actionmanager</name><operator>/</operator><name><name>TestActionScheduler</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">24</literal> <operator>+</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>agent</name><operator>/</operator><name><name>AgentResourceTest</name><operator>.</operator><name>java</name></name>       <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>configuration</name><operator>/</operator><name><name>ConfigurationTest</name><operator>.</operator><name>java</name></name>      <operator>|</operator>  <literal type="number">95</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>KerberosHelperTest</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name><name>ConfigHelperTest</name><operator>.</operator><name>java</name></name> <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222Test</name><operator>.</operator><name>java</name></name> <operator>|</operator>  <literal type="number">55</literal> <operator>++</operator><operator>++</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>utils</name><operator>/</operator><name><name>StageUtilsTest</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator>
 <literal type="number">20</literal> <name>files</name> <name>changed</name></expr><operator>,</operator> <expr><literal type="number">435</literal> <call><name>insertions</name><argument_list>(<argument><expr><operator>+</operator></expr></argument>)</argument_list></call></expr><operator>,</operator> <expr><literal type="number">75</literal> <call><name>deletions</name><argument_list>(<argument><expr><operator>-</operator></expr></argument>)</argument_list></call>

<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>Configuration</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>Configuration</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>aec83a7ab1</name><operator>..</operator><literal type="number">4a980eeae3</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>Configuration</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>Configuration</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">184</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">184</literal></expr><operator>,</operator><expr><literal type="number">9</literal> @@ <specifier>public</specifier> <name>class</name> <name>Configuration</name> <block>{
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>LDAP_REFERRAL_KEY</name> <operator>=</operator> <literal type="string">"authentication.ldap.referral"</literal></expr>;
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>LDAP_PAGINATION_ENABLED_KEY</name> <operator>=</operator> <literal type="string">"authentication.ldap.pagination.enabled"</literal></expr>;
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SERVER_EC_CACHE_SIZE</name> <operator>=</operator> <literal type="string">"server.ecCacheSize"</literal></expr>;
  <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED</name> <operator>=</operator> <literal type="string">"server.hrcStatusSummary.cache.enabled"</literal></expr>;
  <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SERVER_HRC_STATUS_SUMMARY_CACHE_SIZE</name> <operator>=</operator> <literal type="string">"server.hrcStatusSummary.cache.size"</literal></expr>;
  <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SERVER_HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION</name> <operator>=</operator> <literal type="string">"server.hrcStatusSummary.cache.expiryDuration"</literal></expr>;
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SERVER_STALE_CONFIG_CACHE_ENABLED_KEY</name> <operator>=</operator> <literal type="string">"server.cache.isStale.enabled"</literal></expr>;
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SERVER_PERSISTENCE_TYPE_KEY</name> <operator>=</operator> <literal type="string">"server.persistence.type"</literal></expr>;
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SERVER_JDBC_USER_NAME_KEY</name> <operator>=</operator> <literal type="string">"server.jdbc.user.name"</literal></expr>;
@@ <expr><operator>-</operator><literal type="number">367</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">370</literal></expr>,<expr><literal type="number">11</literal> @@ <specifier>public</specifier> <name>class</name> <name>Configuration</name> <block>{
 
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>CUSTOM_ACTION_DEFINITION_KEY</name> <operator>=</operator> <literal type="string">"custom.action.definitions"</literal></expr>;
   <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>SHARED_RESOURCES_DIR_KEY</name> <operator>=</operator> <literal type="string">"shared.resources.dir"</literal></expr>;

  <expr><specifier>protected</specifier> <specifier>static</specifier> <name>final</name> <name>boolean</name> <name>SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED_DEFAULT</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;
  <expr><specifier>protected</specifier> <specifier>static</specifier> <name>final</name> <name>long</name> <name>SERVER_HRC_STATUS_SUMMARY_CACHE_SIZE_DEFAULT</name> <operator>=</operator> <literal type="number">10000L</literal></expr>;
  <expr><specifier>protected</specifier> <specifier>static</specifier> <name>final</name> <name>long</name> <name>SERVER_HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION_DEFAULT</name> <operator>=</operator> <literal type="number">30</literal></expr>; <comment type="line">//minutes</comment>

   <expr><specifier>private</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>CUSTOM_ACTION_DEFINITION_DEF_VALUE</name> <operator>=</operator> <literal type="string">"/var/lib/ambari-server/resources/custom_action_definitions"</literal></expr>;
 
   <expr><specifier>private</specifier> <specifier>static</specifier> <name>final</name> <name>long</name> <name>SERVER_EC_CACHE_SIZE_DEFAULT</name> <operator>=</operator> <literal type="number">10000L</literal></expr>;
@@ <expr><operator>-</operator><literal type="number">1756</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">1764</literal></expr>,<expr><literal type="number">75</literal> @@ <specifier>public</specifier> <name>class</name> <name>Configuration</name> <block>{
     <return>return <expr><name>value</name></expr>;</return></block></expr>
   }</block>
 
  <comment type="block" format="javadoc">/**
   * Caching of host role command status summary can be enabled/disabled
   * through the {@link #SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED} config property.
   * This method returns the value of {@link #SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED}
   * config property. If this config property is not defined than returns the default defined by {@link #SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED_DEFAULT}.
   * @return true if caching is to be enabled otherwise false.
   */</comment>
  <specifier>public</specifier> <name>boolean</name> <call><name>getHostRoleCommandStatusSummaryCacheEnabled</name><argument_list>()</argument_list></call> <block>{
    <expr><name>String</name> <name>stringValue</name> <operator>=</operator> <call><name><name>properties</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><name>SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED</name></expr></argument>)</argument_list></call></expr>;
    <expr><name>boolean</name> <name>value</name> <operator>=</operator> <name>SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED_DEFAULT</name></expr>;
    <if_stmt><if>if <condition>(<expr><name>stringValue</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <try>try <block>{<block_content>
        <expr_stmt><expr><name>value</name> <operator>=</operator> <call><name><name>Boolean</name><operator>.</operator><name>valueOf</name></name><argument_list>(<argument><expr><name>stringValue</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/></block_content></block></try></block_content></block></if></if_stmt>}</block></expr>
      <catch>catch <parameter_list>(<parameter><decl><type><name>NumberFormatException</name></type> <name>ignored</name></decl></parameter>)</parameter_list> <block>{<block_content>
      <expr_stmt/></block_content></block></catch>}</block></expr></expr_stmt>

    }

    return <expr_stmt><expr><name>value</name></expr>;</expr_stmt>
  }

  <comment type="block" format="javadoc">/**
   * In order to avoid the cache storing host role command status summary objects exhaust
   * memory we set a max record number allowed for the cache. This limit can be configured
   * through {@link #SERVER_HRC_STATUS_SUMMARY_CACHE_SIZE} config property. The method returns
   * the value of this config property. If this config property is not defined than
   * the default value specified by {@link #SERVER_HRC_STATUS_SUMMARY_CACHE_SIZE_DEFAULT} is returned.
   * @return the upper limit for the number of cached host role command summaries.
   */</comment>
  public <function><type><name>long</name></type> <name>getHostRoleCommandStatusSummaryCacheSize</name><parameter_list>()</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>String</name></type> <name>stringValue</name> <init>= <expr><call><name><name>properties</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><name>SERVER_HRC_STATUS_SUMMARY_CACHE_SIZE</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>long</name></type> <name>value</name> <init>= <expr><name>SERVER_HRC_STATUS_SUMMARY_CACHE_SIZE_DEFAULT</name></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><name>stringValue</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <try>try <block>{<block_content>
        <expr_stmt><expr><name>value</name> <operator>=</operator> <call><name><name>Long</name><operator>.</operator><name>valueOf</name></name><argument_list>(<argument><expr><name>stringValue</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block>
      <catch>catch <parameter_list>(<parameter><decl><type><name>NumberFormatException</name></type> <name>ignored</name></decl></parameter>)</parameter_list> <block>{<block_content>
      </block_content>}</block></catch></try>

    </block_content>}</block></if></if_stmt>

    <return>return <expr><name>value</name></expr>;</return>
  </block_content>}</block></function>

  <comment type="block" format="javadoc">/**
   * As a safety measure the cache storing host role command status summaries should auto expire after a while.
   * The expiry duration is specified through the {@link #SERVER_HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION} config property
   * expressed in minutes. The method returns the value of this config property. If this config property is not defined than
   * the default value specified by {@link #SERVER_HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION_DEFAULT}
   * @return the cache expiry duration in minutes
   */</comment>
  <function><type><specifier>public</specifier> <name>long</name></type> <name>getHostRoleCommandStatusSummaryCacheExpiryDuration</name><parameter_list>()</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name>String</name></type> <name>stringValue</name> <init>= <expr><call><name><name>properties</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><name>SERVER_HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><name>long</name></type> <name>value</name> <init>= <expr><name>SERVER_HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION_DEFAULT</name></expr></init></decl>;</decl_stmt>
    <if_stmt><if>if <condition>(<expr><name>stringValue</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <try>try <block>{<block_content>
        <expr_stmt><expr><name>value</name> <operator>=</operator> <call><name><name>Long</name><operator>.</operator><name>valueOf</name></name><argument_list>(<argument><expr><name>stringValue</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block>
      <catch>catch <parameter_list>(<parameter><decl><type><name>NumberFormatException</name></type> <name>ignored</name></decl></parameter>)</parameter_list> <block>{<block_content>
      </block_content>}</block></catch></try>

    </block_content>}</block></if></if_stmt>

    <return>return <expr><name>value</name></expr>;</return>
  </block_content>}</block></function>



   <comment type="block" format="javadoc">/**
    * @return whether staleConfig's flag is cached.
    */</comment>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>ControllerModule</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>ControllerModule</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">76ff6dbe41</literal><operator>..</operator><name>daca64dc80</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>ControllerModule</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>ControllerModule</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">65</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">65</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>notifications</name><operator>.</operator><name>NotificationDispatcher</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessorImpl</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>PersistenceType</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>HostRoleCommandDAO</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>scheduler</name><operator>.</operator><name>ExecutionScheduler</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>scheduler</name><operator>.</operator><name>ExecutionSchedulerImpl</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>AmbariEntryPoint</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">338</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">339</literal></expr><operator>,</operator><expr><literal type="number">21</literal> @@ <specifier>public</specifier> <name>class</name> <name>ControllerModule</name> extends <name>AbstractModule</name> <block>{
     <expr><call><name>bindConstant</name><argument_list>()</argument_list></call><operator>.</operator><call><name>annotatedWith</name><argument_list>(<argument><expr><call><name><name>Names</name><operator>.</operator><name>named</name></name><argument_list>(<argument><expr><literal type="string">"executionCommandCacheSize"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator>
         <call><name>to</name><argument_list>(<argument><expr><call><name><name>configuration</name><operator>.</operator><name>getExecutionCommandsCacheSize</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
 

    <comment type="line">// Host role commands status summary max cache enable/disable</comment>
    <expr><call><name>bindConstant</name><argument_list>()</argument_list></call><operator>.</operator><call><name>annotatedWith</name><argument_list>(<argument><expr><call><name><name>Names</name><operator>.</operator><name>named</name></name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>HRC_STATUS_SUMMARY_CACHE_ENABLED</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator>
      <call><name>to</name><argument_list>(<argument><expr><call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheEnabled</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;

    <comment type="line">// Host role commands status summary max cache size</comment>
    <expr><call><name>bindConstant</name><argument_list>()</argument_list></call><operator>.</operator><call><name>annotatedWith</name><argument_list>(<argument><expr><call><name><name>Names</name><operator>.</operator><name>named</name></name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>HRC_STATUS_SUMMARY_CACHE_SIZE</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator>
      <call><name>to</name><argument_list>(<argument><expr><call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheSize</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
    <comment type="line">// Host role command status summary cache expiry duration in minutes</comment>
    <expr><call><name>bindConstant</name><argument_list>()</argument_list></call><operator>.</operator><call><name>annotatedWith</name><argument_list>(<argument><expr><call><name><name>Names</name><operator>.</operator><name>named</name></name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION_MINUTES</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call><operator>.</operator>
      <call><name>to</name><argument_list>(<argument><expr><call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheExpiryDuration</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;




     <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>AmbariManagementController</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>to</name><argument_list>(
       <argument><expr><name><name>AmbariManagementControllerImpl</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;
     <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>AbstractRootServiceResponseFactory</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>to</name><argument_list>(<argument><expr><name><name>RootServiceResponseFactory</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>orm</name><operator>/</operator><name>dao</name><operator>/</operator><name><name>HostRoleCommandDAO</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>orm</name><operator>/</operator><name>dao</name><operator>/</operator><name><name>HostRoleCommandDAO</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">4fd03e5d4b</literal><operator>..</operator><name>deca9b1735</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>orm</name><operator>/</operator><name>dao</name><operator>/</operator><name><name>HostRoleCommandDAO</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>orm</name><operator>/</operator><name>dao</name><operator>/</operator><name><name>HostRoleCommandDAO</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">18</literal></expr>,<expr><literal type="number">9</literal> <operator>+</operator><literal type="number">18</literal></expr>,<expr><literal type="number">6</literal> @@</expr>
 
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name></name>;</package></block></expr></expr_stmt>
 
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessor</name><operator>.</operator><name>DbType</name><operator>.</operator><name>ORACLE</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>DaoUtils</name><operator>.</operator><name>ORACLE_LIST_LIMIT</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>text</name><operator>.</operator><name>MessageFormat</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>ArrayList</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collection</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">28</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">25</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Collections</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>HashMap</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>concurrent</name><operator>.</operator><name>TimeUnit</name></name>;</import>
 
 <import>import <name><name>javax</name><operator>.</operator><name>persistence</name><operator>.</operator><name>EntityManager</name></name>;</import>
 <import>import <name><name>javax</name><operator>.</operator><name>persistence</name><operator>.</operator><name>TypedQuery</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">49</literal></expr><operator>,</operator><expr><literal type="number">16</literal> <operator>+</operator><literal type="number">47</literal></expr><operator>,</operator><expr><literal type="number">27</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>entities</name><operator>.</operator><name>HostEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>entities</name><operator>.</operator><name>HostRoleCommandEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>entities</name><operator>.</operator><name>HostRoleCommandEntity_</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>entities</name><operator>.</operator><name>StageEntity</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>cache</name><operator>.</operator><name>CacheBuilder</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>cache</name><operator>.</operator><name>CacheLoader</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>cache</name><operator>.</operator><name>LoadingCache</name></name>;</import>
 <import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>collect</name><operator>.</operator><name>Lists</name></name>;</import>
 <import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Inject</name></name>;</import>
 <import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Provider</name></name>;</import>
 <import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Singleton</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>name</name><operator>.</operator><name>Named</name></name>;</import>
 <import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>persist</name><operator>.</operator><name>Transactional</name></name>;</import>
 
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessor</name><operator>.</operator><name>DbType</name><operator>.</operator><name>ORACLE</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>DaoUtils</name><operator>.</operator><name>ORACLE_LIST_LIMIT</name></name>;</import>

 <class><annotation>@<name>Singleton</name></annotation>
 <specifier>public</specifier> class <name>HostRoleCommandDAO</name> <block>{
 
  <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>Logger</name></type> <name>LOG</name> <init>= <expr><call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

   <decl_stmt><decl><type><specifier>private</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>SUMMARY_DTO</name> <init>= <expr><call><name><name>String</name><operator>.</operator><name>format</name></name><argument_list>(
     <argument><expr><literal type="string">"SELECT NEW %s("</literal> <operator>+</operator>
       <literal type="string">"MAX(hrc.stage.skippable), "</literal> <operator>+</operator>
@@ <operator>-</operator><literal type="number">92</literal></expr></argument>,<argument><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">101</literal></expr></argument>,<argument><expr><literal type="number">122</literal> @@ <specifier>public</specifier> class <name>HostRoleCommandDAO</name> <block>{
    <expr><operator>*</operator><operator>/</operator>
   <specifier>private</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>COMPLETED_REQUESTS_SQL</name> <operator>=</operator> <literal type="string">"SELECT DISTINCT task.requestId FROM HostRoleCommandEntity task WHERE task.requestId NOT IN (SELECT task.requestId FROM HostRoleCommandEntity task WHERE task.status IN :notCompletedStatuses) ORDER BY task.requestId {0}"</literal></expr>;
 
  <comment type="block" format="javadoc">/**
   * A cache that holds {@link HostRoleCommandStatusSummaryDTO} grouped by stage id for requests by request id.
   * The JPQL computing the host role command status summary for a request is rather expensive
   * thus this cache helps reducing the load on the database
   */</comment>
  <expr><specifier>private</specifier> <name>final</name> <name><name>LoadingCache</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name><name>Map</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name> <name>hrcStatusSummaryCache</name></expr>;

  <comment type="block" format="javadoc">/**
   * Specifies whether caching for {@link HostRoleCommandStatusSummaryDTO} grouped by stage id for requests
   * is enabled.
   */</comment>
  <expr><specifier>private</specifier> <name>final</name> <name>boolean</name> <name>hostRoleCommandStatusSummaryCacheEnabled</name></expr>;


   @<expr><name>Inject</name>
   <name><name>Provider</name><argument_list type="generic">&lt;<argument><name>EntityManager</name></argument>&gt;</argument_list></name> <name>entityManagerProvider</name></expr>;
 
   @<expr><name>Inject</name>
   <name>DaoUtils</name> <name>daoUtils</name></expr>;
 
  <expr><specifier>public</specifier> <name>final</name> <specifier>static</specifier> <name>String</name> <name>HRC_STATUS_SUMMARY_CACHE_SIZE</name> <operator>=</operator>  <literal type="string">"hostRoleCommandStatusSummaryCacheSize"</literal></expr>;
  <expr><specifier>public</specifier> <name>final</name> <specifier>static</specifier> <name>String</name> <name>HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION_MINUTES</name> <operator>=</operator> <literal type="string">"hostRoleCommandStatusCacheExpiryDurationMins"</literal></expr>;
  <expr><specifier>public</specifier> <name>final</name> <specifier>static</specifier> <name>String</name> <name>HRC_STATUS_SUMMARY_CACHE_ENABLED</name> <operator>=</operator>  <literal type="string">"hostRoleCommandStatusSummaryCacheEnabled"</literal></expr>;

  <comment type="block" format="javadoc">/**
   * Invalidates the host role command status summary cache entry that corresponds to the given request.
   * @param requestId the key of the cache entry to be invalidated.
   */</comment>
  <expr><specifier>protected</specifier> <name>void</name> <call><name>invalidateHostRoleCommandStatusSummaryCache</name><argument_list>(<argument><expr><name>Long</name> <name>requestId</name></expr></argument>)</argument_list></call> <block>{
    <if_stmt><if>if <condition>(<expr><operator>!</operator><name>hostRoleCommandStatusSummaryCacheEnabled</name></expr> )</condition><block type="pseudo"><block_content>
      <return>return;</return></block_content></block></if></if_stmt>

    <call><name><name>LOG</name><operator>.</operator><name>debug</name></name><argument_list>(<argument><expr><literal type="string">"Invalidating host role command status summary cache for request {} !"</literal></expr></argument>, <argument><expr><name>requestId</name></expr></argument>)</argument_list></call></block></expr>;
    <expr><call><name><name>hrcStatusSummaryCache</name><operator>.</operator><name>invalidate</name></name><argument_list>(<argument><expr><name>requestId</name></expr></argument>)</argument_list></call></expr>;

  }</block>

  <comment type="block" format="javadoc">/**
   * Invalidates those entries in host role command status cache which are dependent on the passed {@link org.apache.ambari.server.orm.entities.HostRoleCommandEntity}
   * entity.
   * @param hostRoleCommandEntity
   */</comment>
  <specifier>protected</specifier> <name>void</name> <call><name>invalidateHostRoleCommandStatusCache</name><argument_list>(<argument><expr><name>HostRoleCommandEntity</name> <name>hostRoleCommandEntity</name></expr></argument>)</argument_list></call> <block>{
    <if_stmt><if>if <condition>( <expr><operator>!</operator><name>hostRoleCommandStatusSummaryCacheEnabled</name></expr> )</condition><block type="pseudo"><block_content>
      <return>return;</return></block_content></block></if></if_stmt></block></expr></argument>

    <if_stmt><if>if <condition>(<expr><name>hostRoleCommandEntity</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
      <decl_stmt><decl><type><name>Long</name></type> <name>requestId</name> <init>= <expr><call><name><name>hostRoleCommandEntity</name><operator>.</operator><name>getRequestId</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <if_stmt><if>if <condition>(<expr><name>requestId</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
        <decl_stmt><decl><type><name>StageEntity</name></type> <name>stageEntity</name> <init>= <expr><call><name><name>hostRoleCommandEntity</name><operator>.</operator><name>getStage</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>stageEntity</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content>
          <expr_stmt><expr><name>requestId</name> <operator>=</operator> <call><name><name>stageEntity</name><operator>.</operator><name>getRequestId</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
      </block_content>}</block></if></if_stmt>

      <if_stmt><if>if <condition>(<expr><name>requestId</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content>
        <expr_stmt><expr><call><name>invalidateHostRoleCommandStatusSummaryCache</name><argument_list>(<argument><expr><call><name><name>requestId</name><operator>.</operator><name>longValue</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
    </block_content>}</block></if></if_stmt></argument_list></call></expr></init></decl></decl_stmt>

  }</block></class>

  <comment type="block" format="javadoc">/**
   * Loads the counts of tasks for a request and groups them by stage id.
   * This allows for very efficient loading when there are a huge number of stages
   * and tasks to iterate (for example, during a Stack Upgrade).
   * @param requestId the request id
   * @return the map of stage-to-summary objects
   */</comment>
  <function><annotation>@<name>RequiresSession</name></annotation>
  <type><specifier>protected</specifier> <name><name>Map</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name></type> <name>loadAggregateCounts</name><parameter_list>(<parameter><decl><type><name>Long</name></type> <name>requestId</name></decl></parameter>)</parameter_list> <block>{<block_content>

    <decl_stmt><decl><type><name><name>TypedQuery</name><argument_list type="generic">&lt;<argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name></type> <name>query</name> <init>= <expr><call><name><name>entityManagerProvider</name><operator>.</operator><name>get</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>createQuery</name><argument_list>(
      <argument><expr><name>SUMMARY_DTO</name></expr></argument>, <argument><expr><name><name>HostRoleCommandStatusSummaryDTO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"requestId"</literal></expr></argument>, <argument><expr><name>requestId</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"aborted"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>ABORTED</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"completed"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>COMPLETED</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"failed"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>FAILED</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"holding"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>HOLDING</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"holding_failed"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>HOLDING_FAILED</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"holding_timedout"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>HOLDING_TIMEDOUT</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"in_progress"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>IN_PROGRESS</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"pending"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>PENDING</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"queued"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>QUEUED</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"timedout"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>TIMEDOUT</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"skipped_failed"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>SKIPPED_FAILED</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <decl_stmt><decl><type><name><name>Map</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name></type> <name>map</name> <init>= <expr><operator>new</operator> <call><name><name>HashMap</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <for>for <control>(<init><decl><type><name>HostRoleCommandStatusSummaryDTO</name></type> <name>dto</name> <range>: <expr><call><name><name>daoUtils</name><operator>.</operator><name>selectList</name></name><argument_list>(<argument><expr><name>query</name></expr></argument>)</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
      <expr_stmt><expr><call><name><name>map</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><call><name><name>dto</name><operator>.</operator><name>getStageId</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>dto</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></for>

    <return>return <expr><name>map</name></expr>;</return>
  </block_content>}</block></function>

  <constructor><annotation>@<name>Inject</name></annotation>
  <specifier>public</specifier> <name>HostRoleCommandDAO</name><parameter_list>(<parameter><decl><type><annotation>@<name>Named</name><argument_list>(<argument><expr><name>HRC_STATUS_SUMMARY_CACHE_ENABLED</name></expr></argument>)</argument_list></annotation> <name>boolean</name></type> <name>hostRoleCommandStatusSummaryCacheEnabled</name></decl></parameter>, <parameter><decl><type><annotation>@<name>Named</name><argument_list>(<argument><expr><name>HRC_STATUS_SUMMARY_CACHE_SIZE</name></expr></argument>)</argument_list></annotation> <name>long</name></type> <name>hostRoleCommandStatusSummaryCacheLimit</name></decl></parameter>, <parameter><decl><type><annotation>@<name>Named</name><argument_list>(<argument><expr><name>HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION_MINUTES</name></expr></argument>)</argument_list></annotation> <name>long</name></type> <name>hostRoleCommandStatusSummaryCacheExpiryDurationMins</name></decl></parameter>)</parameter_list> <block>{<block_content>
    <expr_stmt><expr><name><name>this</name><operator>.</operator><name>hostRoleCommandStatusSummaryCacheEnabled</name></name> <operator>=</operator> <name>hostRoleCommandStatusSummaryCacheEnabled</name></expr>;</expr_stmt>

    <expr_stmt><expr><call><name><name>LOG</name><operator>.</operator><name>info</name></name><argument_list>(<argument><expr><literal type="string">"Host role command status summary cache {} !"</literal></expr></argument>, <argument><expr><ternary><condition><expr><name>hostRoleCommandStatusSummaryCacheEnabled</name></expr> ?</condition><then> <expr><literal type="string">"enabled"</literal></expr> </then><else>: <expr><literal type="string">"disabled"</literal></expr></else></ternary></expr></argument>)</argument_list></call></expr>;</expr_stmt>


    <expr_stmt><expr><name>hrcStatusSummaryCache</name> <operator>=</operator> <call><name><name>CacheBuilder</name><operator>.</operator><name>newBuilder</name></name><argument_list>()</argument_list></call>
      <operator>.</operator><call><name>maximumSize</name><argument_list>(<argument><expr><name>hostRoleCommandStatusSummaryCacheLimit</name></expr></argument>)</argument_list></call>
      <operator>.</operator><call><name>expireAfterAccess</name><argument_list>(<argument><expr><name>hostRoleCommandStatusSummaryCacheExpiryDurationMins</name></expr></argument>, <argument><expr><name><name>TimeUnit</name><operator>.</operator><name>MINUTES</name></name></expr></argument>)</argument_list></call>
      <operator>.</operator><call><name>build</name><argument_list>(<argument><expr><operator>new</operator> <class><super><name><name>CacheLoader</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name><name>Map</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name></super><argument_list>()</argument_list> <block>{
        <function><annotation>@<name>Override</name></annotation>
        <type><specifier>public</specifier> <name><name>Map</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name></type> <name>load</name><parameter_list>(<parameter><decl><type><name>Long</name></type> <name>requestId</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
          <expr_stmt><expr><call><name><name>LOG</name><operator>.</operator><name>debug</name></name><argument_list>(<argument><expr><literal type="string">"Cache miss for host role command status summary object for request {}, fetching from JPA"</literal></expr></argument>, <argument><expr><name>requestId</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
          <decl_stmt><decl><type><name><name>Map</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name></type> <name>hrcCommandStatusByStageId</name> <init>= <expr><call><name>loadAggregateCounts</name><argument_list>(<argument><expr><name>requestId</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

          <return>return <expr><name>hrcCommandStatusByStageId</name></expr>;</return>
        </block_content>}</block></function>
      }</block></class></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></constructor>

   <function><annotation>@<name>RequiresSession</name></annotation>
   <type><specifier>public</specifier> <name>HostRoleCommandEntity</name></type> <name>findByPK</name><parameter_list>(<parameter><decl><type><name>long</name></type> <name>taskId</name></decl></parameter>)</parameter_list> <block>{<block_content>
     <return>return <expr><call><name><name>entityManagerProvider</name><operator>.</operator><name>get</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>find</name><argument_list>(<argument><expr><name><name>HostRoleCommandEntity</name><operator>.</operator><name>class</name></name></expr></argument>, <argument><expr><name>taskId</name></expr></argument>)</argument_list></call></expr>;</return>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">425</literal></expr><operator>,</operator><expr><literal type="number">11</literal> <operator>+</operator><literal type="number">544</literal></expr><operator>,</operator><expr><literal type="number">16</literal> @@ <specifier>public</specifier> <name>class</name> <name>HostRoleCommandDAO</name> <block>{
   @<expr><name>Transactional</name>
   <specifier>public</specifier> <name>void</name> <call><name>create</name><argument_list>(<argument><expr><name>HostRoleCommandEntity</name> <name>stageEntity</name></expr></argument>)</argument_list></call> <block>{
     <expr><call><name><name>entityManagerProvider</name><operator>.</operator><name>get</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>persist</name><argument_list>(<argument><expr><name>stageEntity</name></expr></argument>)</argument_list></call></expr>;

    <expr><call><name>invalidateHostRoleCommandStatusCache</name><argument_list>(<argument><expr><name>stageEntity</name></expr></argument>)</argument_list></call></expr>;
   }</block>
 
   @<name>Transactional</name>
   <specifier>public</specifier> <name>HostRoleCommandEntity</name> <call><name>merge</name><argument_list>(<argument><expr><name>HostRoleCommandEntity</name> <name>stageEntity</name></expr></argument>)</argument_list></call> <block>{
     <expr><name>HostRoleCommandEntity</name> <name>entity</name> <operator>=</operator> <call><name><name>entityManagerProvider</name><operator>.</operator><name>get</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>merge</name><argument_list>(<argument><expr><name>stageEntity</name></expr></argument>)</argument_list></call></expr>;

    <expr><call><name>invalidateHostRoleCommandStatusCache</name><argument_list>(<argument><expr><name>entity</name></expr></argument>)</argument_list></call></expr>;

     <return>return <expr><name>entity</name></expr>;</return></block></expr>
   }</block>
 
@@ <operator>-</operator><literal type="number">446</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">570</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>HostRoleCommandDAO</name> <block>{
     <expr><name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommandEntity</name></argument>&gt;</argument_list></name> <name>managedList</name> <operator>=</operator> <operator>new</operator> <call><name><name>ArrayList</name><argument_list type="generic">&lt;<argument><name>HostRoleCommandEntity</name></argument>&gt;</argument_list></name><argument_list>(<argument><expr><call><name><name>entities</name><operator>.</operator><name>size</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
     <for>for <control>(<init><decl><type><name>HostRoleCommandEntity</name></type> <name>entity</name> <range>: <expr><name>entities</name></expr></range></decl></init>)</control> <block>{<block_content>
       <expr_stmt><expr><call><name><name>managedList</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><call><name><name>entityManagerProvider</name><operator>.</operator><name>get</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>merge</name><argument_list>(<argument><expr><name>entity</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

      <expr_stmt><expr><call><name>invalidateHostRoleCommandStatusCache</name><argument_list>(<argument><expr><name>entity</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <expr_stmt/></block_content></block></for>}</block></expr></expr_stmt>
     <return>return <expr><name>managedList</name></expr>;</return>
   </block_content>}</block></function>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">453</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">579</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>HostRoleCommandDAO</name> <block>{
   @<expr><name>Transactional</name>
   <specifier>public</specifier> <name>void</name> <call><name>remove</name><argument_list>(<argument><expr><name>HostRoleCommandEntity</name> <name>stageEntity</name></expr></argument>)</argument_list></call> <block>{
     <expr><call><name><name>entityManagerProvider</name><operator>.</operator><name>get</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>remove</name><argument_list>(<argument><expr><call><name>merge</name><argument_list>(<argument><expr><name>stageEntity</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;

    <expr><call><name>invalidateHostRoleCommandStatusCache</name><argument_list>(<argument><expr><name>stageEntity</name></expr></argument>)</argument_list></call></expr>;
   }</block>
 
   @<name>Transactional</name>
@@ <operator>-</operator><literal type="number">463</literal></expr>,<expr><literal type="number">39</literal> <operator>+</operator><literal type="number">591</literal></expr>,<expr><literal type="number">17</literal> @@ <specifier>public</specifier> <name>class</name> <name>HostRoleCommandDAO</name> <block>{
 
   <comment type="block" format="javadoc">/**
    * Finds the counts of tasks for a request and groups them by stage id.
   * This allows for very efficient loading when there are a huge number of stages
   * and tasks to iterate (for example, during a Stack Upgrade).
    * @param requestId the request id
    * @return the map of stage-to-summary objects
    */</comment>
  @<expr><name>RequiresSession</name>
   <specifier>public</specifier> <name><name>Map</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name> <call><name>findAggregateCounts</name><argument_list>(<argument><expr><name>Long</name> <name>requestId</name></expr></argument>)</argument_list></call> <block>{

    <expr><name><name>TypedQuery</name><argument_list type="generic">&lt;<argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name> <name>query</name> <operator>=</operator> <call><name><name>entityManagerProvider</name><operator>.</operator><name>get</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>createQuery</name><argument_list>(
        <argument><expr><name>SUMMARY_DTO</name></expr></argument>, <argument><expr><name><name>HostRoleCommandStatusSummaryDTO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;

    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"requestId"</literal></expr></argument>, <argument><expr><name>requestId</name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"aborted"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>ABORTED</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"completed"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>COMPLETED</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"failed"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>FAILED</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"holding"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>HOLDING</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"holding_failed"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>HOLDING_FAILED</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"holding_timedout"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>HOLDING_TIMEDOUT</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"in_progress"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>IN_PROGRESS</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"pending"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>PENDING</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"queued"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>QUEUED</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"timedout"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>TIMEDOUT</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>query</name><operator>.</operator><name>setParameter</name></name><argument_list>(<argument><expr><literal type="string">"skipped_failed"</literal></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>SKIPPED_FAILED</name></name></expr></argument>)</argument_list></call></expr>;

    <expr><name><name>Map</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name> <name>map</name> <operator>=</operator> <operator>new</operator> <call><name><name>HashMap</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>, <argument><name>HostRoleCommandStatusSummaryDTO</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr>;

    <for>for <control>(<init><decl><type><name>HostRoleCommandStatusSummaryDTO</name></type> <name>dto</name> <range>: <expr><call><name><name>daoUtils</name><operator>.</operator><name>selectList</name></name><argument_list>(<argument><expr><name>query</name></expr></argument>)</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
      <expr_stmt><expr><call><name><name>map</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><call><name><name>dto</name><operator>.</operator><name>getStageId</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>dto</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <expr_stmt/></block_content></block></for>}</block></expr>

    <return>return <expr><name>map</name></expr>;</return></block></expr>
    <if_stmt><if>if <condition>(<expr><name>hostRoleCommandStatusSummaryCacheEnabled</name></expr>)</condition><block type="pseudo"><block_content>
      <return>return <expr><call><name><name>hrcStatusSummaryCache</name><operator>.</operator><name>getUnchecked</name></name><argument_list>(<argument><expr><name>requestId</name></expr></argument>)</argument_list></call></expr>;</return></block_content></block></if>
    <else>else<block type="pseudo"><block_content>
      <return>return <expr><call><name>loadAggregateCounts</name><argument_list>(<argument><expr><name>requestId</name></expr></argument>)</argument_list></call></expr>;</return></block_content></block></else></if_stmt> <comment type="line">// if caching not enabled fall back to fetching through JPA</comment>
   }</block></expr></expr_stmt>
 

   <comment type="block" format="javadoc">/**
    * Updates the {@link HostRoleCommandEntity#isFailureAutoSkipped()} flag for
    * all commands for the given request.
diff --git a/ambari-server/src/main/java/org/apache/ambari/server/orm/entities/HostRoleCommandEntity.java b/ambari-server/src/main/java/org/apache/ambari/server/orm/entities/HostRoleCommandEntity.java
index af71c403f7..1674175aaa 100644
-- a/ambari-server/src/main/java/org/apache/ambari/server/orm/entities/HostRoleCommandEntity.java
++ b/ambari-server/src/main/java/org/apache/ambari/server/orm/entities/HostRoleCommandEntity.java
@@ -32,6 +32,7 @@ import javax.persistence.FetchType;
 import javax.persistence.GeneratedValue;
 import javax.persistence.GenerationType;
 import javax.persistence.Id;
import javax.persistence.Index;
 import javax.persistence.JoinColumn;
 import javax.persistence.JoinColumns;
 import javax.persistence.Lob;
@@ -48,7 +49,11 @@ import org.apache.ambari.server.actionmanager.HostRoleStatus;
 import org.apache.commons.lang.ArrayUtils;
 
 @Entity
@Table(name = "host_role_command")
@Table(name = "host_role_command"
       , indexes = {
           @Index(name = "idx_hrc_request_id", columnList = "request_id")
         , @Index(name = "idx_hrc_status_role", columnList = "status, role")
       })
 @TableGenerator(name = "host_role_command_id_generator",
     table = "ambari_sequences", pkColumnName = "sequence_name", valueColumnName = "sequence_value"
     , pkColumnValue = "host_role_command_id_seq"
diff --git a/ambari-server/src/main/java/org/apache/ambari/server/serveraction/ServerActionExecutor.java b/ambari-server/src/main/java/org/apache/ambari/server/serveraction/ServerActionExecutor.java
index 20cf5bb200..f93cf4371c 100644
-- a/ambari-server/src/main/java/org/apache/ambari/server/serveraction/ServerActionExecutor.java
++ b/ambari-server/src/main/java/org/apache/ambari/server/serveraction/ServerActionExecutor.java
@@ -392,17 +392,8 @@ public class ServerActionExecutor {
    * @throws InterruptedException
    */</comment>
   <function><type><specifier>public</specifier> <name>void</name></type> <name>doWork</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>InterruptedException</name></expr></argument></throws> <block>{<block_content>
    <decl_stmt><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></type> <name>tasks</name> <init>= <expr><call><name><name>db</name><operator>.</operator><name>getTasksByHostRoleAndStatus</name></name><argument_list>(<argument><expr><name>serverHostName</name></expr></argument>,
        <argument><expr><call><name><name>Role</name><operator>.</operator><name>AMBARI_SERVER_ACTION</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>QUEUED</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <if_stmt><if>if <condition>(<expr><literal type="null">null</literal> <operator>==</operator> <name>tasks</name> <operator>||</operator> <call><name><name>tasks</name><operator>.</operator><name>isEmpty</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
      <comment type="line">// !!! if the server is not a part of the cluster,</comment>
      <comment type="line">// !!! just look for anything designated AMBARI_SERVER_ACTION.</comment>
      <comment type="line">// !!! do we even need to worry about servername in the first place?  We're</comment>
      <comment type="line">// !!! _on_ the ambari server!</comment>
      <expr_stmt><expr><name>tasks</name> <operator>=</operator> <call><name><name>db</name><operator>.</operator><name>getTasksByRoleAndStatus</name></name><argument_list>(<argument><expr><call><name><name>Role</name><operator>.</operator><name>AMBARI_SERVER_ACTION</name><operator>.</operator><name>name</name></name><argument_list>()</argument_list></call></expr></argument>,
          <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>QUEUED</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></if></if_stmt>
    <decl_stmt><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></type> <name>tasks</name> <init>= <expr><call><name><name>db</name><operator>.</operator><name>getTasksByRoleAndStatus</name></name><argument_list>(<argument><expr><call><name><name>Role</name><operator>.</operator><name>AMBARI_SERVER_ACTION</name><operator>.</operator><name>name</name></name><argument_list>()</argument_list></call></expr></argument>,
      <argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>QUEUED</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
     <if_stmt><if>if <condition>(<expr><operator>(</operator><name>tasks</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator> <operator>&amp;&amp;</operator> <operator>!</operator><call><name><name>tasks</name><operator>.</operator><name>isEmpty</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
       <for>for <control>(<init><decl><type><name>HostRoleCommand</name></type> <name>task</name> <range>: <expr><name>tasks</name></expr></range></decl></init>)</control> <block>{<block_content>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name>cluster</name><operator>/</operator><name><name>ClusterImpl</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name>cluster</name><operator>/</operator><name><name>ClusterImpl</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">57941d01e9</literal><operator>..</operator><literal type="number">42129758f0</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name>cluster</name><operator>/</operator><name><name>ClusterImpl</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name>cluster</name><operator>/</operator><name><name>ClusterImpl</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">2462</literal></expr><operator>,</operator><expr><literal type="number">13</literal> <operator>+</operator><literal type="number">2462</literal></expr><operator>,</operator><expr><literal type="number">31</literal> @@ <specifier>public</specifier> <name>class</name> <name>ClusterImpl</name> implements <name>Cluster</name> <block>{
     <expr><call><name><name>clusterGlobalLock</name><operator>.</operator><name>readLock</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>lock</name><argument_list>()</argument_list></call></expr>;</block></expr></expr_stmt>
     <try>try <block>{<block_content>
       <decl_stmt><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>ServiceConfigVersionResponse</name></argument>&gt;</argument_list></name></type> <name>serviceConfigVersionResponses</name> <init>= <expr><operator>new</operator> <call><name><name>ArrayList</name><argument_list type="generic">&lt;<argument><name>ServiceConfigVersionResponse</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name><name>Set</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>&gt;</argument_list></name></type> <name>activeIds</name> <init>= <expr><call><name>getActiveServiceConfigVersionIds</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
 
      <for>for <control>(<init><decl><type><name>ServiceConfigEntity</name></type> <name>serviceConfigEntity</name> <range>: <expr><call><name><name>serviceConfigDAO</name><operator>.</operator><name>getServiceConfigs</name></name><argument_list>(<argument><expr><call><name>getClusterId</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
      <decl_stmt><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>ServiceConfigEntity</name></argument>&gt;</argument_list></name></type> <name>serviceConfigs</name> <init>= <expr><call><name><name>serviceConfigDAO</name><operator>.</operator><name>getServiceConfigs</name></name><argument_list>(<argument><expr><call><name>getClusterId</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
      <decl_stmt><decl><type><name><name>Map</name><argument_list type="generic">&lt;<argument><name>String</name></argument>, <argument><name>ServiceConfigVersionResponse</name></argument>&gt;</argument_list></name></type> <name>activeServiceConfigResponses</name> <init>= <expr><operator>new</operator> <call><name><name>HashMap</name><argument_list type="generic">&lt;&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

      <for>for <control>(<init><decl><type><name>ServiceConfigEntity</name></type> <name>serviceConfigEntity</name> <range>: <expr><name>serviceConfigs</name></expr></range></decl></init>)</control> <block>{<block_content>
         <decl_stmt><decl><type><name>ServiceConfigVersionResponse</name></type> <name>serviceConfigVersionResponse</name> <init>= <expr><call><name>convertToServiceConfigVersionResponse</name><argument_list>(<argument><expr><name>serviceConfigEntity</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
        <decl_stmt><decl><type><name>ServiceConfigVersionResponse</name></type> <name>activeServiceConfigResponse</name> <init>= <expr><call><name><name>activeServiceConfigResponses</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>getServiceName</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>activeServiceConfigResponse</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
          <expr_stmt><expr><name>activeServiceConfigResponse</name> <operator>=</operator> <name>serviceConfigVersionResponse</name></expr>;</expr_stmt>
          <expr_stmt><expr><call><name><name>activeServiceConfigResponses</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>getServiceName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>serviceConfigVersionResponse</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>

         <expr_stmt><expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>setConfigurations</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name><name>ArrayList</name><argument_list type="generic">&lt;<argument><name>ConfigurationResponse</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>setIsCurrent</name></name><argument_list>(<argument><expr><call><name><name>activeIds</name><operator>.</operator><name>contains</name></name><argument_list>(<argument><expr><call><name><name>serviceConfigEntity</name><operator>.</operator><name>getServiceConfigId</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <if_stmt><if>if <condition>(<expr><call><name><name>serviceConfigEntity</name><operator>.</operator><name>getGroupId</name></name><argument_list>()</argument_list></call> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
          <if_stmt><if>if <condition>(<expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>getCreateTime</name></name><argument_list>()</argument_list></call> <operator>&gt;</operator> <call><name><name>activeServiceConfigResponse</name><operator>.</operator><name>getCreateTime</name></name><argument_list>()</argument_list></call></expr>)</condition><block type="pseudo"><block_content>
            <expr_stmt><expr><call><name><name>activeServiceConfigResponses</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>getServiceName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>serviceConfigVersionResponse</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
        </block_content>}</block></if>
        <if type="elseif">else if <condition>(<expr><name>clusterConfigGroups</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <call><name><name>clusterConfigGroups</name><operator>.</operator><name>containsKey</name></name><argument_list>(<argument><expr><call><name><name>serviceConfigEntity</name><operator>.</operator><name>getGroupId</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>)</condition><block>{<block_content>
          <if_stmt><if>if <condition>(<expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>getVersion</name></name><argument_list>()</argument_list></call> <operator>&gt;</operator> <call><name><name>activeServiceConfigResponse</name><operator>.</operator><name>getVersion</name></name><argument_list>()</argument_list></call></expr>)</condition><block type="pseudo"><block_content>
            <expr_stmt><expr><call><name><name>activeServiceConfigResponses</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>getServiceName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>serviceConfigVersionResponse</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
        </block_content>}</block></if></if_stmt>

        <expr_stmt><expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>setIsCurrent</name></name><argument_list>(<argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
         <decl_stmt><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>ClusterConfigEntity</name></argument>&gt;</argument_list></name></type> <name>clusterConfigEntities</name> <init>= <expr><call><name><name>serviceConfigEntity</name><operator>.</operator><name>getClusterConfigEntities</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
         <for>for <control>(<init><decl><type><name>ClusterConfigEntity</name></type> <name>clusterConfigEntity</name> <range>: <expr><name>clusterConfigEntities</name></expr></range></decl></init>)</control> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">2484</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">2502</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@ <specifier>public</specifier> <name>class</name> <name>ClusterImpl</name> implements <name>Cluster</name> <block>{
         <expr><call><name><name>serviceConfigVersionResponses</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><name>serviceConfigVersionResponse</name></expr></argument>)</argument_list></call></expr>;
       }</block></expr></expr_stmt>
 
      <for>for <control>(<init><decl><type><name>ServiceConfigVersionResponse</name></type> <name>serviceConfigVersionResponse</name><range>: <expr><call><name><name>activeServiceConfigResponses</name><operator>.</operator><name>values</name></name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
        <expr_stmt><expr><call><name><name>serviceConfigVersionResponse</name><operator>.</operator><name>setIsCurrent</name></name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      </block_content>}</block></for>

       <return>return <expr><name>serviceConfigVersionResponses</name></expr>;</return>
     </block_content>}</block></for> <finally>finally <block>{<block_content>
       <expr_stmt><expr><call><name><name>clusterGlobalLock</name><operator>.</operator><name>readLock</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>unlock</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">2502</literal></expr><operator>,</operator><expr><literal type="number">14</literal> <operator>+</operator><literal type="number">2524</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>ClusterImpl</name> implements <name>Cluster</name> <block>{
     <return>return <expr><name>responses</name></expr>;</return>
   }</block></expr></expr_stmt>
 
  <function><type><specifier>private</specifier> <name><name>Set</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>&gt;</argument_list></name></type> <name>getActiveServiceConfigVersionIds</name><parameter_list>()</parameter_list> <block>{<block_content>
    <decl_stmt><decl><type><name><name>Set</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>&gt;</argument_list></name></type> <name>idSet</name> <init>= <expr><operator>new</operator> <call><name><name>HashSet</name><argument_list type="generic">&lt;<argument><name>Long</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <for>for <control>(<init><decl><type><name>ServiceConfigEntity</name></type> <name>entity</name> <range>: <expr><call><name>getActiveServiceConfigVersionEntities</name><argument_list>()</argument_list></call></expr></range></decl></init>)</control> <block>{<block_content>
      <expr_stmt><expr><call><name><name>idSet</name><operator>.</operator><name>add</name></name><argument_list>(<argument><expr><call><name><name>entity</name><operator>.</operator><name>getServiceConfigId</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></for>
    <return>return <expr><name>idSet</name></expr>;</return>
  </block_content>}</block></function>

   <function><type><specifier>private</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>ServiceConfigEntity</name></argument>&gt;</argument_list></name></type> <name>getActiveServiceConfigVersionEntities</name><parameter_list>()</parameter_list> <block>{<block_content>
 
     <decl_stmt><decl><type><name><name>List</name><argument_list type="generic">&lt;<argument><name>ServiceConfigEntity</name></argument>&gt;</argument_list></name></type> <name>activeServiceConfigVersions</name> <init>= <expr><operator>new</operator> <call><name><name>ArrayList</name><argument_list type="generic">&lt;<argument><name>ServiceConfigEntity</name></argument>&gt;</argument_list></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">88b3151fbc</literal><operator>..</operator><literal type="number">0aa1e7a850</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">115</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">115</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>UpgradeCatalog222</name> extends <name>AbstractUpgradeCatalog</name> <block>{
     <expr><call><name>updateAlerts</name><argument_list>()</argument_list></call></expr>;
     <call><name>updateStormConfigs</name><argument_list>()</argument_list></call></block></expr>;</expr_stmt>
     <expr_stmt><expr><call><name>updateAMSConfigs</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    <expr_stmt><expr><call><name>updateHostRoleCommands</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
   </block_content>}</block></function>
 
   <function><type><specifier>protected</specifier> <name>void</name></type> <name>updateStormConfigs</name><parameter_list>()</parameter_list> <throws>throws  <argument><expr><name>AmbariException</name></expr></argument></throws> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">153</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">154</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@ <specifier>public</specifier> <name>class</name> <name>UpgradeCatalog222</name> extends <name>AbstractUpgradeCatalog</name> <block>{
 
   }</block>
 
  <specifier>protected</specifier> <name>void</name> <call><name>updateHostRoleCommands</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>SQLException</name><block>{
    <expr><call><name><name>dbAccessor</name><operator>.</operator><name>createIndex</name></name><argument_list>(<argument><expr><literal type="string">"idx_hrc_status"</literal></expr></argument>, <argument><expr><literal type="string">"host_role_command"</literal></expr></argument>, <argument><expr><literal type="string">"status"</literal></expr></argument>, <argument><expr><literal type="string">"role"</literal></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;</expr_stmt>
  </block_content>}</block></function>

   <function><type><specifier>protected</specifier> <name>void</name></type> <name>updateAMSConfigs</name><parameter_list>()</parameter_list> <throws>throws <argument><expr><name>AmbariException</name></expr></argument></throws> <block>{<block_content>
     <decl_stmt><decl><type><name>AmbariManagementController</name></type> <name>ambariManagementController</name> <init>= <expr><call><name><name>injector</name><operator>.</operator><name>getInstance</name></name><argument_list>(<argument><expr><name><name>AmbariManagementController</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
     <decl_stmt><decl><type><name>Clusters</name></type> <name>clusters</name> <init>= <expr><call><name><name>ambariManagementController</name><operator>.</operator><name>getClusters</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>MySQL</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>MySQL</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<name>index</name> <name>e39590248e</name><operator>..</operator><literal type="number">1ea1646df6</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>MySQL</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>MySQL</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
@@ <operator>-</operator><literal type="number">677</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">677</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <name>CREATE</name> <name>TABLE</name> <call><name>setting</name> <argument_list>(
 <argument><expr><operator>--</operator> <name>tasks</name> <name>indices</name> <operator>--</operator>
 <name>CREATE</name> <name>INDEX</name> <name>idx_stage_request_id</name> <name>ON</name> <call><name>stage</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></call></expr></argument>;</argument_list></call></expr></expr_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_request_id</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
<decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_status_role</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>status</name></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_rsc_request_id</name> <name>ON</name></type> <name>role_success_criteria</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 
 <expr_stmt><expr><operator>--</operator> <name>altering</name> <name>tables</name> <name>by</name> <name>creating</name> <name>unique</name> <name>constraints</name><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Oracle</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Oracle</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<name>index</name> <literal type="number">0f957e6646</literal><operator>..</operator><name>e5fa3e19f2</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Oracle</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Oracle</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
@@ <operator>-</operator><literal type="number">666</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">666</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <name>CREATE</name> <name>TABLE</name> <call><name>setting</name> <argument_list>(
 <argument><expr><operator>--</operator> <name>tasks</name> <name>indices</name> <operator>--</operator>
 <name>CREATE</name> <name>INDEX</name> <name>idx_stage_request_id</name> <name>ON</name> <call><name>stage</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></call></expr></argument>;</argument_list></call></expr></expr_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_request_id</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
<decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_status_role</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>status</name></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_rsc_request_id</name> <name>ON</name></type> <name>role_success_criteria</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 
 <expr_stmt><expr><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><name>altering</name> <name>tables</name> <name>by</name> <name>creating</name> <name>unique</name> <name>constraints</name><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<name>index</name> <literal type="number">7daf4aee6f</literal><operator>..</operator><literal type="number">150ea9b401</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
@@ <operator>-</operator><literal type="number">670</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">670</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@ <name>CREATE</name> <name>TABLE</name> <call><name>setting</name> <argument_list>(
 <argument><expr><operator>--</operator> <name>tasks</name> <name>indices</name> <operator>--</operator>
 <name>CREATE</name> <name>INDEX</name> <name>idx_stage_request_id</name> <name>ON</name> <call><name>stage</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></call></expr></argument>;</argument_list></call></expr></expr_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_request_id</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
<decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_status_role</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>status</name></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_rsc_request_id</name> <name>ON</name></type> <name>role_success_criteria</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 


 <expr_stmt><expr><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><name>altering</name> <name>tables</name> <name>by</name> <name>creating</name> <name>unique</name> <name>constraints</name><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator>
 <name>ALTER</name> <name>TABLE</name> <name>users</name> <name>ADD</name> <name>CONSTRAINT</name> <name>UNQ_users_0</name> <call><name>UNIQUE</name> <argument_list>(<argument><expr><name>user_name</name></expr></argument>, <argument><expr><name>user_type</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 <decl_stmt><decl><type><name>ALTER</name> <name>TABLE</name> <name>clusterconfig</name> <name>ADD</name> <name>CONSTRAINT</name> <name>UQ_config_type_tag</name></type> <name>UNIQUE</name> <argument_list>(<argument><expr><name>cluster_id</name></expr></argument>, <argument><expr><name>type_name</name></expr></argument>, <argument><expr><name>version_tag</name></expr></argument>)</argument_list></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name>EMBEDDED</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name>EMBEDDED</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<name>index</name> <literal type="number">28c025f9c9</literal><operator>..</operator><literal type="number">044333641f</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name>EMBEDDED</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>Postgres</name><operator>-</operator><name>EMBEDDED</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
@@ <operator>-</operator><literal type="number">752</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">752</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <name>GRANT</name> <name>ALL</name> <name>PRIVILEGES</name> <name>ON</name> <name>TABLE</name> <name><name>ambari</name><operator>.</operator><name>setting</name></name> <name>TO</name> <operator>:</operator><name>username</name></expr>;</expr_stmt>
 <expr_stmt><expr><operator>--</operator> <name>tasks</name> <name>indices</name> <operator>--</operator>
 <name>CREATE</name> <name>INDEX</name> <name>idx_stage_request_id</name> <name>ON</name> <call><name><name>ambari</name><operator>.</operator><name>stage</name></name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_request_id</name> <name>ON</name></type> <name><name>ambari</name><operator>.</operator><name>host_role_command</name></name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
<decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_status_role</name> <name>ON</name></type> <name><name>ambari</name><operator>.</operator><name>host_role_command</name></name> <argument_list>(<argument><expr><name>status</name></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_rsc_request_id</name> <name>ON</name></type> <name><name>ambari</name><operator>.</operator><name>role_success_criteria</name></name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 
 <expr_stmt><expr><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><name>altering</name> <name>tables</name> <name>by</name> <name>creating</name> <name>unique</name> <name>constraints</name><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLAnywhere</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLAnywhere</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<name>index</name> <name>c9d6ac22f0</name><operator>..</operator><literal type="number">1f45bc72fc</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLAnywhere</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLAnywhere</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
@@ <operator>-</operator><literal type="number">666</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">666</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <name>CREATE</name> <name>TABLE</name> <call><name>setting</name> <argument_list>(
 <argument><expr><operator>--</operator> <name>tasks</name> <name>indices</name> <operator>--</operator>
 <name>CREATE</name> <name>INDEX</name> <name>idx_stage_request_id</name> <name>ON</name> <call><name>stage</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></call></expr></argument>;</argument_list></call></expr></expr_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_request_id</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
<decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_status_role</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>status</name></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_rsc_request_id</name> <name>ON</name></type> <name>role_success_criteria</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 
 <expr_stmt><expr><operator>--</operator> <name>altering</name> <name>tables</name> <name>by</name> <name>creating</name> <name>unique</name> <name>constraints</name><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLServer</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLServer</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<name>index</name> <literal type="number">4d6f0e8dd7</literal><operator>..</operator><name>b1edbbd127</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLServer</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>resources</name><operator>/</operator><name>Ambari</name><operator>-</operator><name>DDL</name><operator>-</operator><name>SQLServer</name><operator>-</operator><name><name>CREATE</name><operator>.</operator><name>sql</name></name>
@@ <operator>-</operator><literal type="number">775</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">775</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <name>CREATE</name> <name>TABLE</name> <call><name>setting</name> <argument_list>(
 <argument><expr><operator>--</operator> <name>tasks</name> <name>indices</name> <operator>--</operator>
 <name>CREATE</name> <name>INDEX</name> <name>idx_stage_request_id</name> <name>ON</name> <call><name>stage</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></call></expr></argument>;</argument_list></call></expr></expr_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_request_id</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
<decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_hrc_status_role</name> <name>ON</name></type> <name>host_role_command</name> <argument_list>(<argument><expr><name>status</name></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 <decl_stmt><decl><type><name>CREATE</name> <name>INDEX</name> <name>idx_rsc_request_id</name> <name>ON</name></type> <name>role_success_criteria</name> <argument_list>(<argument><expr><name>request_id</name></expr></argument>)</argument_list></decl>;</decl_stmt>
 
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>actionmanager</name><operator>/</operator><name><name>TestActionScheduler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>actionmanager</name><operator>/</operator><name><name>TestActionScheduler</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>bc4d397b4c</name><operator>..</operator><name>af6fb9b7ff</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>actionmanager</name><operator>/</operator><name><name>TestActionScheduler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>actionmanager</name><operator>/</operator><name><name>TestActionScheduler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">607</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">607</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestActionScheduler</name> <block>{
     <expr><call><name>doAnswer</name><argument_list>(<argument><expr><operator>new</operator> <class><super><name><name>Answer</name><argument_list type="generic">&lt;<argument><name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name></super><argument_list>()</argument_list> <block>{
       <function><annotation>@<name>Override</name></annotation>
       <type><specifier>public</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></type> <name>answer</name><parameter_list>(<parameter><decl><type><name>InvocationOnMock</name></type> <name>invocation</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>Throwable</name></expr></argument></throws> <block>{<block_content>
        <decl_stmt><decl><type><name>String</name></type> <name>role</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">1</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HostRoleStatus</name></type> <name>status</name> <init>= <expr><operator>(</operator><name>HostRoleStatus</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">2</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>String</name></type> <name>role</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">0</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HostRoleStatus</name></type> <name>status</name> <init>= <expr><operator>(</operator><name>HostRoleStatus</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">1</literal></expr>]</index></expr></init></decl>;</decl_stmt>
 
         <decl_stmt><decl><type><name>HostRoleCommand</name></type> <name>task</name> <init>= <expr><call><name><name>s</name><operator>.</operator><name>getHostRoleCommand</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">618</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">618</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>TestActionScheduler</name> <block>{
           <return>return <expr><call><name><name>Collections</name><operator>.</operator><name>emptyList</name></name><argument_list>()</argument_list></call></expr>;</return>
         }</block>
       }
    }</expr></expr_stmt></block_content></block></function></block></class></expr></argument>)</argument_list></call><operator>.</operator><call><name>when</name><argument_list>(<argument><expr><name>db</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getTasksByHostRoleAndStatus</name><argument_list>(<argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>any</name><argument_list>(<argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
    }</block></expr></expr_stmt>)</block_content>.when(db</block></function>)</block_content>.getTasksByRoleAndStatus(anyString(</block></finally>)</block_content></block><operator>,</operator> <expr_stmt><expr><call><name>any</name><argument_list>(<argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></expr_stmt></for>)</block_content></block><empty_stmt>;</empty_stmt></for>
 
     <expr_stmt><expr><call><name><name>ServerActionExecutor</name><operator>.</operator><name>init</name></name><argument_list>(<argument><expr><name>injector</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <decl_stmt><decl><type><name>ActionScheduler</name></type> <name>scheduler</name> <init>= <expr><operator>new</operator> <call><name>ActionScheduler</name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>, <argument><expr><literal type="number">50</literal></expr></argument>, <argument><expr><name>db</name></expr></argument>, <argument><expr><name>aq</name></expr></argument>, <argument><expr><name>fsm</name></expr></argument>, <argument><expr><literal type="number">3</literal></expr></argument>,
<argument>@@ <expr><operator>-</operator><literal type="number">762</literal></expr></argument>,<argument><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">762</literal></expr></argument>,<argument><expr><literal type="number">8</literal> @@ <specifier>public</specifier> class <name>TestActionScheduler</name> <block>{
     <expr><call><name>doAnswer</name><argument_list>(<argument><expr><operator>new</operator> <class><super><name><name>Answer</name><argument_list type="generic">&lt;<argument><name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name></super><argument_list>()</argument_list> <block>{
       <function><annotation>@<name>Override</name></annotation>
       <type><specifier>public</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></type> <name>answer</name><parameter_list>(<parameter><decl><type><name>InvocationOnMock</name></type> <name>invocation</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>Throwable</name></expr></argument></throws> <block>{<block_content>
        <decl_stmt><decl><type><name>String</name></type> <name>role</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">1</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HostRoleStatus</name></type> <name>status</name> <init>= <expr><operator>(</operator><name>HostRoleStatus</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">2</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>String</name></type> <name>role</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">0</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HostRoleStatus</name></type> <name>status</name> <init>= <expr><operator>(</operator><name>HostRoleStatus</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">1</literal></expr>]</index></expr></init></decl>;</decl_stmt>
 
         <decl_stmt><decl><type><name>HostRoleCommand</name></type> <name>task</name> <init>= <expr><call><name><name>s</name><operator>.</operator><name>getHostRoleCommand</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">774</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">774</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>TestActionScheduler</name> <block>{
         }</block></expr></expr_stmt>
 
       }</block_content>
    }</block></function>)</block><expr_stmt><expr><operator>.</operator><call><name>when</name><argument_list>(<argument><expr><name>db</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getTasksByHostRoleAndStatus</name><argument_list>(<argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>any</name><argument_list>(<argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt></class></expr></argument></argument_list></call></expr>
    }</block></expr></argument></argument_list></call></expr></init></decl></decl_stmt>)</block_content>.when(db</block></try>)</block_content>.getTasksByRoleAndStatus(anyString(</block></for>)</block_content></block><operator>,</operator> <expr_stmt><expr><call><name>any</name><argument_list>(<argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></expr_stmt></if></if_stmt>)</block_content></block>;</function>
 
     <expr_stmt><expr><call><name><name>ServerActionExecutor</name><operator>.</operator><name>init</name></name><argument_list>(<argument><expr><name>injector</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     <decl_stmt><decl><type><name>ActionScheduler</name></type> <name>scheduler</name> <init>= <expr><operator>new</operator> <call><name>ActionScheduler</name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>, <argument><expr><literal type="number">50</literal></expr></argument>, <argument><expr><name>db</name></expr></argument>, <argument><expr><name>aq</name></expr></argument>, <argument><expr><name>fsm</name></expr></argument>, <argument><expr><literal type="number">3</literal></expr></argument>,
<argument>@@ <expr><operator>-</operator><literal type="number">843</literal></expr></argument>,<argument><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">843</literal></expr></argument>,<argument><expr><literal type="number">8</literal> @@ <specifier>public</specifier> class <name>TestActionScheduler</name> <block>{
     <expr><call><name>doAnswer</name><argument_list>(<argument><expr><operator>new</operator> <class><super><name><name>Answer</name><argument_list type="generic">&lt;<argument><name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name></super><argument_list>()</argument_list> <block>{
       <function><annotation>@<name>Override</name></annotation>
       <type><specifier>public</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></type> <name>answer</name><parameter_list>(<parameter><decl><type><name>InvocationOnMock</name></type> <name>invocation</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>Throwable</name></expr></argument></throws> <block>{<block_content>
        <decl_stmt><decl><type><name>String</name></type> <name>role</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">1</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HostRoleStatus</name></type> <name>status</name> <init>= <expr><operator>(</operator><name>HostRoleStatus</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">2</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>String</name></type> <name>role</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">0</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HostRoleStatus</name></type> <name>status</name> <init>= <expr><operator>(</operator><name>HostRoleStatus</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">1</literal></expr>]</index></expr></init></decl>;</decl_stmt>
 
         <decl_stmt><decl><type><name>HostRoleCommand</name></type> <name>task</name> <init>= <expr><call><name><name>s</name><operator>.</operator><name>getHostRoleCommand</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">854</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">854</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>TestActionScheduler</name> <block>{
           <return>return <expr><call><name><name>Collections</name><operator>.</operator><name>emptyList</name></name><argument_list>()</argument_list></call></expr>;</return>
         }</block>
       }
    }</expr></expr_stmt></block_content></block></function></block></class></expr></argument>)</argument_list></call><operator>.</operator><call><name>when</name><argument_list>(<argument><expr><name>db</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getTasksByHostRoleAndStatus</name><argument_list>(<argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>any</name><argument_list>(<argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
    }</block></expr></argument>)</argument_list></call><operator>.</operator><call><name>when</name><argument_list>(<argument><expr><name>db</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getTasksByRoleAndStatus</name><argument_list>(<argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>any</name><argument_list>(<argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
     <decl_stmt><decl><type><name>ActionScheduler</name></type> <name>scheduler</name> <init>= <expr><operator>new</operator> <call><name>ActionScheduler</name><argument_list>(<argument><expr><literal type="number">100</literal></expr></argument>, <argument><expr><literal type="number">50</literal></expr></argument>, <argument><expr><name>db</name></expr></argument>, <argument><expr><name>aq</name></expr></argument>, <argument><expr><name>fsm</name></expr></argument>, <argument><expr><literal type="number">3</literal></expr></argument>,
         <argument><expr><operator>new</operator> <call><name>HostsMap</name><argument_list>(<argument><expr><operator>(</operator><name>String</name><operator>)</operator> <literal type="null">null</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name>unitOfWork</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>conf</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1951</literal></expr><operator>,</operator><expr><literal type="number">8</literal> <operator>+</operator><literal type="number">1951</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>TestActionScheduler</name> <block>{
     <expr><call><name>doAnswer</name><argument_list>(<argument><expr><operator>new</operator> <class><super><name><name>Answer</name><argument_list type="generic">&lt;<argument><name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></argument>&gt;</argument_list></name></super><argument_list>()</argument_list> <block>{
       <function><annotation>@<name>Override</name></annotation>
       <type><specifier>public</specifier> <name><name>List</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></type> <name>answer</name><parameter_list>(<parameter><decl><type><name>InvocationOnMock</name></type> <name>invocation</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>Throwable</name></expr></argument></throws> <block>{<block_content>
        <decl_stmt><decl><type><name>String</name></type> <name>role</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">1</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HostRoleStatus</name></type> <name>status</name> <init>= <expr><operator>(</operator><name>HostRoleStatus</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">2</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>String</name></type> <name>role</name> <init>= <expr><operator>(</operator><name>String</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">0</literal></expr>]</index></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>HostRoleStatus</name></type> <name>status</name> <init>= <expr><operator>(</operator><name>HostRoleStatus</name><operator>)</operator> <call><name><name>invocation</name><operator>.</operator><name>getArguments</name></name><argument_list>()</argument_list></call><index>[<expr><literal type="number">1</literal></expr>]</index></expr></init></decl>;</decl_stmt>
 
         <decl_stmt><decl><type><name>HostRoleCommand</name></type> <name>task</name> <init>= <expr><call><name><name>s</name><operator>.</operator><name>getHostRoleCommand</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>role</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">1962</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">1962</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>TestActionScheduler</name> <block>{
           <return>return <expr><call><name><name>Collections</name><operator>.</operator><name>emptyList</name></name><argument_list>()</argument_list></call></expr>;</return>
         }</block>
       }
    }</expr></expr_stmt></block_content></block></function></block></class></expr></argument>)</argument_list></call><operator>.</operator><call><name>when</name><argument_list>(<argument><expr><name>db</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getTasksByHostRoleAndStatus</name><argument_list>(<argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>any</name><argument_list>(<argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
    }</block></expr></expr_stmt>)<expr_stmt><expr><operator>.</operator><call><name>when</name><argument_list>(<argument><expr><name>db</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getTasksByRoleAndStatus</name><argument_list>(<argument><expr><call><name>anyString</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>any</name><argument_list>(<argument><expr><name><name>HostRoleStatus</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
 
     <expr_stmt><expr><call><name>doAnswer</name><argument_list>(<argument><expr><operator>new</operator> <class><super><name><name>Answer</name><argument_list type="generic">&lt;<argument><name>HostRoleCommand</name></argument>&gt;</argument_list></name></super><argument_list>()</argument_list> <block>{
       <annotation>@<name>Override</name></annotation>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>agent</name><operator>/</operator><name><name>AgentResourceTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>agent</name><operator>/</operator><name><name>AgentResourceTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">510e1fba72</literal><operator>..</operator><literal type="number">6cb9e6f353</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>agent</name><operator>/</operator><name><name>AgentResourceTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>agent</name><operator>/</operator><name><name>AgentResourceTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">36</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">36</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>agent</name><operator>.</operator><name>rest</name><operator>.</operator><name>AgentResource</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>api</name><operator>.</operator><name>services</name><operator>.</operator><name>AmbariMetaInfo</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>events</name><operator>.</operator><name>publishers</name><operator>.</operator><name>AmbariEventPublisher</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessor</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>HostRoleCommandDAO</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>SecurityHelper</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>SecurityHelperImpl</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>stack</name><operator>.</operator><name>StackManagerFactory</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">308</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">309</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> class <name>AgentResourceTest</name> extends <name>RandomPortJerseyTest</name> <block>{
       <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>HeartBeatHandler</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><name>handler</name></expr></argument>)</argument_list></call></expr>;
       <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>AmbariMetaInfo</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><name>ambariMetaInfo</name></expr></argument>)</argument_list></call></expr>;
       <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>DBAccessor</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>mock</name><argument_list>(<argument><expr><name><name>DBAccessor</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
      <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>mock</name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
     }</block>
 
     <specifier>private</specifier> <name>void</name> <call><name>installDependencies</name><argument_list>()</argument_list></call> <block>{
<expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>ConfigurationTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>ConfigurationTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">4e236f37b0</literal><operator>..</operator><literal type="number">3ecb5aa703</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>ConfigurationTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>configuration</name><operator>/</operator><name><name>ConfigurationTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">563</literal></expr>,<expr><literal type="number">4</literal> <operator>+</operator><literal type="number">563</literal></expr>,<expr><literal type="number">99</literal> @@ <specifier>public</specifier> class <name>ConfigurationTest</name> <block>{
     <expr><call><name><name>Assert</name><operator>.</operator><name>assertEquals</name></name><argument_list>(<argument><expr><literal type="number">44</literal></expr></argument>, <argument><expr><call><name><name>configuration</name><operator>.</operator><name>getPropertyProvidersThreadPoolMaxSize</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
   }</block>
 

  <specifier>public</specifier> <name>void</name> <call><name>testGetHostRoleCommandStatusSummaryCacheSize</name><argument_list>()</argument_list></call> <throws>throws  <argument><expr><name>Exception</name> <block>{
    <comment type="line">// Given</comment>
    <expr><name>final</name> <name>Properties</name> <name>ambariProperties</name> <operator>=</operator> <operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr></block></expr></argument></throws></expr>;
    <expr><name>final</name> <name>Configuration</name> <name>configuration</name> <operator>=</operator> <operator>new</operator> <call><name>Configuration</name><argument_list>(<argument><expr><name>ambariProperties</name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>ambariProperties</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><name><name>Configuration</name><operator>.</operator><name>SERVER_HRC_STATUS_SUMMARY_CACHE_SIZE</name></name></expr></argument>, <argument><expr><literal type="string">"3000"</literal></expr></argument>)</argument_list></call></expr>;

    <comment type="line">// When</comment>
    <expr><name>long</name> <name>actualCacheSize</name> <operator>=</operator> <call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheSize</name></name><argument_list>()</argument_list></call></expr>;

    <comment type="line">// Then</comment>
    <expr><call><name><name>Assert</name><operator>.</operator><name>assertEquals</name></name><argument_list>(<argument><expr><name>actualCacheSize</name></expr></argument>, <argument><expr><literal type="number">3000L</literal></expr></argument>)</argument_list></call></expr>;
  }</block>

  @<name>Test</name>
  <specifier>public</specifier> <name>void</name> <call><name>testGetHostRoleCommandStatusSummaryCacheSizeDefault</name><argument_list>()</argument_list></call> <throws>throws  <argument><expr><name>Exception</name> <block>{
    <comment type="line">// Given</comment>
    <expr><name>final</name> <name>Properties</name> <name>ambariProperties</name> <operator>=</operator> <operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr></block></expr></argument></throws></expr>;</expr_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Configuration</name></type> <name>configuration</name> <init>= <expr><operator>new</operator> <call><name>Configuration</name><argument_list>(<argument><expr><name>ambariProperties</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="line">// When</comment>
    <decl_stmt><decl><type><name>long</name></type> <name>actualCacheSize</name> <init>= <expr><call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheSize</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="line">// Then</comment>
    <constructor_decl><name><name>Assert</name><operator>.</operator><name>assertEquals</name></name><parameter_list>(<parameter><decl><type><name>actualCacheSize</name></type></decl></parameter>, <parameter><decl><type><name><name>Configuration</name><operator>.</operator><name>SERVER_HRC_STATUS_SUMMARY_CACHE_SIZE_DEFAULT</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
  }</block></class>

  @<name>Test</name>
  <specifier>public</specifier> <name>void</name> <call><name>testGetHostRoleCommandStatusSummaryCacheExpiryDuration</name><argument_list>()</argument_list></call> <throws>throws  <argument><expr><name>Exception</name> <block>{
    <comment type="line">// Given</comment>
    <expr><name>final</name> <name>Properties</name> <name>ambariProperties</name> <operator>=</operator> <operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr></block></expr></argument></throws></expr></argument>;
    <argument><expr><name>final</name> <name>Configuration</name> <name>configuration</name> <operator>=</operator> <operator>new</operator> <call><name>Configuration</name><argument_list>(<argument><expr><name>ambariProperties</name></expr></argument>)</argument_list></call></expr></argument>;
    <argument><expr><call><name><name>ambariProperties</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><name><name>Configuration</name><operator>.</operator><name>SERVER_HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION</name></name></expr></argument>, <argument><expr><literal type="string">"60"</literal></expr></argument>)</argument_list></call></expr></argument>;

    <comment type="line">// When</comment>
    <argument><expr><name>long</name> <name>actualCacheExpiryDuration</name> <operator>=</operator> <call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheExpiryDuration</name></name><argument_list>()</argument_list></call></expr></argument>;

    <comment type="line">// Then</comment>
    <argument><expr><call><name><name>Assert</name><operator>.</operator><name>assertEquals</name></name><argument_list>(<argument><expr><name>actualCacheExpiryDuration</name></expr></argument>, <argument><expr><literal type="number">60L</literal></expr></argument>)</argument_list></call></expr></argument>;</argument_list></call></expr></expr_stmt>
  }

  @<function><type><name>Test</name>
  <specifier>public</specifier> <name>void</name></type> <name>testGetHostRoleCommandStatusSummaryCacheExpiryDurationDefault</name><parameter_list>()</parameter_list> <throws>throws  <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
    <comment type="line">// Given</comment>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Properties</name></type> <name>ambariProperties</name> <init>= <expr><operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Configuration</name></type> <name>configuration</name> <init>= <expr><operator>new</operator> <call><name>Configuration</name><argument_list>(<argument><expr><name>ambariProperties</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="line">// When</comment>
    <decl_stmt><decl><type><name>long</name></type> <name>actualCacheExpiryDuration</name> <init>= <expr><call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheExpiryDuration</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="line">// Then</comment>
    <expr_stmt><expr><call><name><name>Assert</name><operator>.</operator><name>assertEquals</name></name><argument_list>(<argument><expr><name>actualCacheExpiryDuration</name></expr></argument>, <argument><expr><name><name>Configuration</name><operator>.</operator><name>SERVER_HRC_STATUS_SUMMARY_CACHE_EXPIRY_DURATION_DEFAULT</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>

  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testGetHostRoleCommandStatusSummaryCacheEnabled</name><parameter_list>()</parameter_list> <throws>throws  <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
    <comment type="line">// Given</comment>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Properties</name></type> <name>ambariProperties</name> <init>= <expr><operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Configuration</name></type> <name>configuration</name> <init>= <expr><operator>new</operator> <call><name>Configuration</name><argument_list>(<argument><expr><name>ambariProperties</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>ambariProperties</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><name><name>Configuration</name><operator>.</operator><name>SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED</name></name></expr></argument>, <argument><expr><literal type="string">"true"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <comment type="line">// When</comment>
    <decl_stmt><decl><type><name>boolean</name></type> <name>actualCacheEnabledConfig</name> <init>= <expr><call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheEnabled</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="line">// Then</comment>
    <expr_stmt><expr><call><name><name>Assert</name><operator>.</operator><name>assertEquals</name></name><argument_list>(<argument><expr><name>actualCacheEnabledConfig</name></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>

  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testGetHostRoleCommandStatusSummaryCacheDisabled</name><parameter_list>()</parameter_list> <throws>throws  <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
    <comment type="line">// Given</comment>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Properties</name></type> <name>ambariProperties</name> <init>= <expr><operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Configuration</name></type> <name>configuration</name> <init>= <expr><operator>new</operator> <call><name>Configuration</name><argument_list>(<argument><expr><name>ambariProperties</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <expr_stmt><expr><call><name><name>ambariProperties</name><operator>.</operator><name>setProperty</name></name><argument_list>(<argument><expr><name><name>Configuration</name><operator>.</operator><name>SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED</name></name></expr></argument>, <argument><expr><literal type="string">"false"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <comment type="line">// When</comment>
    <decl_stmt><decl><type><name>boolean</name></type> <name>actualCacheEnabledConfig</name> <init>= <expr><call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheEnabled</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="line">// Then</comment>
    <expr_stmt><expr><call><name><name>Assert</name><operator>.</operator><name>assertEquals</name></name><argument_list>(<argument><expr><name>actualCacheEnabledConfig</name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>

  <function><annotation>@<name>Test</name></annotation>
  <type><specifier>public</specifier> <name>void</name></type> <name>testGetHostRoleCommandStatusSummaryCacheEnabledDefault</name><parameter_list>()</parameter_list> <throws>throws  <argument><expr><name>Exception</name></expr></argument></throws> <block>{<block_content>
    <comment type="line">// Given</comment>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Properties</name></type> <name>ambariProperties</name> <init>= <expr><operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>final</specifier> <name>Configuration</name></type> <name>configuration</name> <init>= <expr><operator>new</operator> <call><name>Configuration</name><argument_list>(<argument><expr><name>ambariProperties</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="line">// When</comment>
    <decl_stmt><decl><type><name>boolean</name></type> <name>actualCacheEnabledConfig</name> <init>= <expr><call><name><name>configuration</name><operator>.</operator><name>getHostRoleCommandStatusSummaryCacheEnabled</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="line">// Then</comment>
    <expr_stmt><expr><call><name><name>Assert</name><operator>.</operator><name>assertEquals</name></name><argument_list>(<argument><expr><name>actualCacheEnabledConfig</name></expr></argument>, <argument><expr><name><name>Configuration</name><operator>.</operator><name>SERVER_HRC_STATUS_SUMMARY_CACHE_ENABLED_DEFAULT</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
  </block_content>}</block></function>

 }
diff <expr_stmt><expr><operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>KerberosHelperTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>KerberosHelperTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">2dcde00adf</literal><operator>..</operator><name>f6027f361b</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>KerberosHelperTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>controller</name><operator>/</operator><name><name>KerberosHelperTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">42</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">42</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>controller</name><operator>.</operator><name>spi</name><operator>.</operator><name>Resource</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>controller</name><operator>.</operator><name>spi</name><operator>.</operator><name>ResourceProvider</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>metadata</name><operator>.</operator><name>RoleCommandOrder</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessor</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>HostRoleCommandDAO</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>SecurityHelper</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>credential</name><operator>.</operator><name>PrincipalKeyCredential</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>encryption</name><operator>.</operator><name>CredentialStoreService</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">215</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">216</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>KerberosHelperTest</name> extends <name>EasyMockSupport</name> <block>{
         <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>CreatePrincipalsServerAction</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createMock</name><argument_list>(<argument><expr><name><name>CreatePrincipalsServerAction</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
         <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>CreateKeytabFilesServerAction</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createMock</name><argument_list>(<argument><expr><name><name>CreateKeytabFilesServerAction</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
         <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>StackAdvisorHelper</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createMock</name><argument_list>(<argument><expr><name><name>StackAdvisorHelper</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
        <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
       }</block></expr></expr_stmt>
     })<empty_stmt>;</empty_stmt>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name><name>ConfigHelperTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name><name>ConfigHelperTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">98424b796a</literal><operator>..</operator><literal type="number">9fe0fc3a19</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name><name>ConfigHelperTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>state</name><operator>/</operator><name><name>ConfigHelperTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">48</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">48</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>controller</name><operator>.</operator><name>spi</name><operator>.</operator><name>ClusterController</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>GuiceJpaInitializer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>InMemoryDefaultTestModule</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>HostRoleCommandDAO</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>SecurityHelper</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>TestAuthenticationFactory</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>stack</name><operator>.</operator><name>StackManagerFactory</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">754</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">755</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ConfigHelperTest</name> <block>{
           <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>Clusters</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>ClustersImpl</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
           <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>ClusterController</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><name>clusterController</name></expr></argument>)</argument_list></call></expr>;
           <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>StackManagerFactory</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>StackManagerFactory</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
          <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
         }</block></expr></expr_stmt>
       })<empty_stmt>;</empty_stmt>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222Test</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222Test</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">6061e067bc</literal><operator>..</operator><literal type="number">077df33484</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222Test</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>upgrade</name><operator>/</operator><name><name>UpgradeCatalog222Test</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">19</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">19</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@</expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>upgrade</name></name>;</package>
 
 
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>collect</name><operator>.</operator><name>Maps</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>gson</name><operator>.</operator><name>Gson</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Guice</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Injector</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Provider</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>persist</name><operator>.</operator><name>PersistService</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>reflect</name><operator>.</operator><name>Method</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>HashMap</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>

<import>import <name><name>javax</name><operator>.</operator><name>persistence</name><operator>.</operator><name>EntityManager</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>actionmanager</name><operator>.</operator><name>ActionManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>api</name><operator>.</operator><name>services</name><operator>.</operator><name>AmbariMetaInfo</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>controller</name><operator>.</operator><name>AmbariManagementController</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">33</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">33</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>controller</name><operator>.</operator><name>ConfigurationRequest</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>controller</name><operator>.</operator><name>ConfigurationResponse</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>controller</name><operator>.</operator><name>KerberosHelper</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>controller</name><operator>.</operator><name>MaintenanceStateHelper</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>GuiceJpaInitializer</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>InMemoryDefaultTestModule</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>StackDAO</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">40</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">41</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>entities</name><operator>.</operator><name>StackEntity</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>state</name><operator>.</operator><name>Cluster</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>state</name><operator>.</operator><name>Clusters</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>state</name><operator>.</operator><name>Config</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>state</name><operator>.</operator><name>stack</name><operator>.</operator><name>OsFamily</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>Capture</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMockSupport</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">47</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">49</literal></expr><operator>,</operator><expr><literal type="number">14</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>After</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Before</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>junit</name><operator>.</operator><name>Test</name></name>;</import>
 
<import>import <name><name>javax</name><operator>.</operator><name>persistence</name><operator>.</operator><name>EntityManager</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>lang</name><operator>.</operator><name>reflect</name><operator>.</operator><name>Method</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>HashMap</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>common</name><operator>.</operator><name>collect</name><operator>.</operator><name>Maps</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>gson</name><operator>.</operator><name>Gson</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Binder</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Guice</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Injector</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Module</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>Provider</name></name>;</import>
<import>import <name><name>com</name><operator>.</operator><name>google</name><operator>.</operator><name>inject</name><operator>.</operator><name>persist</name><operator>.</operator><name>PersistService</name></name>;</import>
 
 <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>anyObject</name></name>;</import>
 <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>anyString</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">58</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">64</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>capture</name></name>;</import>
 <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>createMockBuilder</name></name>;</import>
 <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>createNiceMock</name></name>;</import>
 <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>createStrictMock</name></name>;</import>
<import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>eq</name></name>;</import>
 <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>expect</name></name>;</import>
 <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>expectLastCall</name></name>;</import>
 <import>import static <name><name>org</name><operator>.</operator><name>easymock</name><operator>.</operator><name>EasyMock</name><operator>.</operator><name>replay</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">101</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">108</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>UpgradeCatalog222Test</name> <block>{
     <expr><name>Method</name> <name>updateAlerts</name> <operator>=</operator> <call><name><name>UpgradeCatalog222</name><operator>.</operator><name><name>class</name><operator>.</operator><name>getDeclaredMethod</name></name></name><argument_list>(<argument><expr><literal type="string">"updateAlerts"</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>Method</name> <name>updateStormConfigs</name> <operator>=</operator> <call><name><name>UpgradeCatalog222</name><operator>.</operator><name><name>class</name><operator>.</operator><name>getDeclaredMethod</name></name></name><argument_list>(<argument><expr><literal type="string">"updateStormConfigs"</literal></expr></argument>)</argument_list></call></expr>;
     <expr><name>Method</name> <name>updateAMSConfigs</name> <operator>=</operator> <call><name><name>UpgradeCatalog222</name><operator>.</operator><name><name>class</name><operator>.</operator><name>getDeclaredMethod</name></name></name><argument_list>(<argument><expr><literal type="string">"updateAMSConfigs"</literal></expr></argument>)</argument_list></call></expr>;
    <expr><name>Method</name> <name>updateHostRoleCommands</name> <operator>=</operator> <call><name><name>UpgradeCatalog222</name><operator>.</operator><name><name>class</name><operator>.</operator><name>getDeclaredMethod</name></name></name><argument_list>(<argument><expr><literal type="string">"updateHostRoleCommands"</literal></expr></argument>)</argument_list></call></expr>;
 
 
     <expr><name>UpgradeCatalog222</name> <name>upgradeCatalog222</name> <operator>=</operator> <call><name>createMockBuilder</name><argument_list>(<argument><expr><name><name>UpgradeCatalog222</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call>
@@ <operator>-</operator><literal type="number">108</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">116</literal></expr>,<expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>UpgradeCatalog222Test</name> <block>{
             <expr><operator>.</operator><call><name>addMockedMethod</name><argument_list>(<argument><expr><name>updateAlerts</name></expr></argument>)</argument_list></call>
             <operator>.</operator><call><name>addMockedMethod</name><argument_list>(<argument><expr><name>updateStormConfigs</name></expr></argument>)</argument_list></call>
             <operator>.</operator><call><name>addMockedMethod</name><argument_list>(<argument><expr><name>updateAMSConfigs</name></expr></argument>)</argument_list></call>
            <operator>.</operator><call><name>addMockedMethod</name><argument_list>(<argument><expr><name>updateHostRoleCommands</name></expr></argument>)</argument_list></call>
             <operator>.</operator><call><name>createMock</name><argument_list>()</argument_list></call></expr>;
 
     <expr><call><name><name>upgradeCatalog222</name><operator>.</operator><name>addNewConfigurationsFromXml</name></name><argument_list>()</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">118</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">127</literal></expr>,<expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>UpgradeCatalog222Test</name> <block>{
     <expr><call><name>expectLastCall</name><argument_list>()</argument_list></call><operator>.</operator><call><name>once</name><argument_list>()</argument_list></call></expr>;
     <expr><call><name><name>upgradeCatalog222</name><operator>.</operator><name>updateAMSConfigs</name></name><argument_list>()</argument_list></call></expr>;
     <expr><call><name>expectLastCall</name><argument_list>()</argument_list></call><operator>.</operator><call><name>once</name><argument_list>()</argument_list></call></expr>;
    <expr><call><name><name>upgradeCatalog222</name><operator>.</operator><name>updateHostRoleCommands</name></name><argument_list>()</argument_list></call></expr>;
    <expr><call><name>expectLastCall</name><argument_list>()</argument_list></call><operator>.</operator><call><name>once</name><argument_list>()</argument_list></call></expr>;
 
     <expr><call><name>replay</name><argument_list>(<argument><expr><name>upgradeCatalog222</name></expr></argument>)</argument_list></call></expr>;
 
@@ <expr><operator>-</operator><literal type="number">203</literal></expr>,<expr><literal type="number">4</literal> <operator>+</operator><literal type="number">214</literal></expr>,<expr><literal type="number">28</literal> @@ <specifier>public</specifier> <name>class</name> <name>UpgradeCatalog222Test</name> <block>{
 
   }</block>
 
  @<name>Test</name>
  <specifier>public</specifier> <name>void</name> <call><name>testUpdateHostRoleCommands</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>Exception</name> <block>{
    <expr><name>final</name> <name>DBAccessor</name> <name>dbAccessor</name> <operator>=</operator> <call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>DBAccessor</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;
    <expr><call><name><name>dbAccessor</name><operator>.</operator><name>createIndex</name></name><argument_list>(<argument><expr><call><name>eq</name><argument_list>(<argument><expr><literal type="string">"idx_hrc_status"</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name>eq</name><argument_list>(<argument><expr><literal type="string">"host_role_command"</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name>eq</name><argument_list>(<argument><expr><literal type="string">"status"</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name>eq</name><argument_list>(<argument><expr><literal type="string">"role"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
    <expr><call><name>expectLastCall</name><argument_list>()</argument_list></call><operator>.</operator><call><name>once</name><argument_list>()</argument_list></call></expr>;

    <expr><call><name>replay</name><argument_list>(<argument><expr><name>dbAccessor</name></expr></argument>)</argument_list></call></expr>;

    <expr><name>Module</name> <name>module</name> <operator>=</operator> <operator>new</operator> <class><super><name>Module</name></super><argument_list>()</argument_list> <block>{
      <function><annotation>@<name>Override</name></annotation>
      <type><specifier>public</specifier> <name>void</name></type> <name>configure</name><parameter_list>(<parameter><decl><type><name>Binder</name></type> <name>binder</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name><name>binder</name><operator>.</operator><name>bind</name></name><argument_list>(<argument><expr><name><name>DBAccessor</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><name>dbAccessor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>binder</name><operator>.</operator><name>bind</name></name><argument_list>(<argument><expr><name><name>OsFamily</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>OsFamily</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
      <expr_stmt/></block_content></block></function></block></class></expr>}</block></expr>
    }</block></expr>;

    <expr><name>Injector</name> <name>injector</name> <operator>=</operator> <call><name><name>Guice</name><operator>.</operator><name>createInjector</name></name><argument_list>(<argument><expr><name>module</name></expr></argument>)</argument_list></call></expr>;
    <expr><name>UpgradeCatalog222</name> <name>upgradeCatalog222</name> <operator>=</operator> <call><name><name>injector</name><operator>.</operator><name>getInstance</name></name><argument_list>(<argument><expr><name><name>UpgradeCatalog222</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;
    <expr><call><name><name>upgradeCatalog222</name><operator>.</operator><name>updateHostRoleCommands</name></name><argument_list>()</argument_list></call></expr>;


    <expr><call><name>verify</name><argument_list>(<argument><expr><name>dbAccessor</name></expr></argument>)</argument_list></call></expr>;
  }</block></expr></expr_stmt>

 }
diff <expr_stmt><expr><operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>utils</name><operator>/</operator><name><name>StageUtilsTest</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>utils</name><operator>/</operator><name><name>StageUtilsTest</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">854263c911</literal><operator>..</operator><literal type="number">215d13791f</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>utils</name><operator>/</operator><name><name>StageUtilsTest</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>ambari</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>test</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>ambari</name><operator>/</operator><name>server</name><operator>/</operator><name>utils</name><operator>/</operator><name><name>StageUtilsTest</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">37</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">37</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>agent</name><operator>.</operator><name>ExecutionCommand</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>api</name><operator>.</operator><name>services</name><operator>.</operator><name>AmbariMetaInfo</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>DBAccessor</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>HostDAO</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>orm</name><operator>.</operator><name>dao</name><operator>.</operator><name>HostRoleCommandDAO</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>SecurityHelper</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>security</name><operator>.</operator><name>encryption</name><operator>.</operator><name>CredentialStoreService</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>ambari</name><operator>.</operator><name>server</name><operator>.</operator><name>stack</name><operator>.</operator><name>StackManagerFactory</name></name>;</import>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">118</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">119</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>StageUtilsTest</name> extends <name>EasyMockSupport</name> <block>{
         <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>HostRoleCommandFactory</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>to</name><argument_list>(<argument><expr><name><name>HostRoleCommandFactoryImpl</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;
         <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>HostDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>HostDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
         <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>PersistedState</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>PersistedState</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
        <expr><call><name>bind</name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toInstance</name><argument_list>(<argument><expr><call><name>createNiceMock</name><argument_list>(<argument><expr><name><name>HostRoleCommandDAO</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;
       }</block></expr></expr_stmt>
     })<empty_stmt>;</empty_stmt>
 
<expr><operator>-</operator> 
<literal type="number">2.19.1.windows</literal><literal type="number">.1</literal></expr>

</unit>
