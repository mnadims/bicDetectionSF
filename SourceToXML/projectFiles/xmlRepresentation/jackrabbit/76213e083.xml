<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" revision="1.0.0" language="Java" filename="E:/01Courses@USASK/CMPT898-HumanDrivenSoftwareEngineeringForScientificResearch/ProjectProgress/data_files/final_dataset/gen_patch_codes/filtered/jackrabbit/76213e083.java"><expr_stmt><expr><name>From</name> <literal type="number">76213e083ee1818cacb64b612656d48af5e956e3</literal> <name>Mon</name> <name>Sep</name> <literal type="number">17</literal> <literal type="number">00</literal><operator>:</operator><literal type="number">00</literal><operator>:</operator><literal type="number">00</literal> <literal type="number">2001</literal>
<name>From</name><operator>:</operator> <name>Jukka</name> <name><name>Zitting</name> <argument_list type="generic">&lt;<argument><name>jukka</name><annotation>@<name><name>apache</name><operator>.</operator><name>org</name></name></annotation></argument>&gt;</argument_list></name>
<name>Date</name><operator>:</operator> <name>Wed</name></expr><operator>,</operator> <expr><literal type="number">28</literal> <name>Oct</name> <literal type="number">2009</literal> <literal type="number">16</literal><operator>:</operator><literal type="number">50</literal><operator>:</operator><literal type="number">36</literal> <operator>+</operator><literal type="number">0000</literal>
<name>Subject</name><operator>:</operator> <index>[<expr><name>PATCH</name></expr>]</index> <name>JCR</name><operator>-</operator><literal type="number">2334</literal><operator>:</operator> <name>Tika</name><operator>-</operator><name>based</name> <name>type</name> <name>detection</name> <name>in</name> <name>jcr</name><operator>-</operator><name>server</name>

<name>git</name><operator>-</operator><name>svn</name><operator>-</operator><name>id</name><operator>:</operator> <name>https</name><operator>:</operator><comment type="line">//svn.apache.org/repos/asf/jackrabbit/trunk@830670 13f79535-47bb-0310-9956-ffa450edef68</comment>
<operator>--</operator>
 <name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name><name>pom</name><operator>.</operator><name>xml</name></name>                 <operator>|</operator>   <literal type="number">5</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>AbstractExportContext</name><operator>.</operator><name>java</name></name>      <operator>|</operator>  <literal type="number">15</literal> <operator>+</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>DefaultHandler</name><operator>.</operator><name>java</name></name>  <operator>|</operator>  <literal type="number">53</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>DefaultIOManager</name><operator>.</operator><name>java</name></name>           <operator>|</operator>   <literal type="number">1</literal> <operator>+</operator>
 <operator>...</operator><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ExportContext</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">8</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ExportContextImpl</name><operator>.</operator><name>java</name></name>          <operator>|</operator>  <literal type="number">11</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>IOManager</name><operator>.</operator><name>java</name></name>       <operator>|</operator>  <literal type="number">15</literal> <operator>++</operator><operator>+</operator>
 <operator>...</operator><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>IOManagerImpl</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">34</literal> <operator>++</operator><operator>++</operator><operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>IOUtil</name><operator>.</operator><name>java</name></name>   <operator>|</operator>   <literal type="number">6</literal> <operator>-</operator>
 <operator>...</operator><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ImportContext</name><operator>.</operator><name>java</name></name>   <operator>|</operator>  <literal type="number">10</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ImportContextImpl</name><operator>.</operator><name>java</name></name>          <operator>|</operator> <literal type="number">114</literal> <operator>++</operator><operator>++</operator><operator>+</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>MimeResolver</name><operator>.</operator><name>java</name></name>    <operator>|</operator> <literal type="number">103</literal> <operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>XmlHandler</name><operator>.</operator><name>java</name></name>      <operator>|</operator>   <literal type="number">2</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ZipHandler</name><operator>.</operator><name>java</name></name>      <operator>|</operator>   <literal type="number">7</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>DavResourceImpl</name><operator>.</operator><name>java</name></name>        <operator>|</operator>   <literal type="number">7</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>ResourceConfig</name><operator>.</operator><name>java</name></name>         <operator>|</operator>  <literal type="number">75</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>--</operator><operator>--</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>ResourceFactoryImpl</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">13</literal> <operator>+</operator><operator>-</operator>
 <operator>...</operator><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>SimpleWebdavServlet</name><operator>.</operator><name>java</name></name>    <operator>|</operator>  <literal type="number">53</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>+</operator><operator>-</operator>
 <literal type="number">18</literal> <name>files</name> <name>changed</name></expr><operator>,</operator> <expr><literal type="number">236</literal> <call><name>insertions</name><argument_list>(<argument><expr><operator>+</operator></expr></argument>)</argument_list></call></expr><operator>,</operator> <expr><literal type="number">296</literal> <call><name>deletions</name><argument_list>(<argument><expr><operator>-</operator></expr></argument>)</argument_list></call>

<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name><name>pom</name><operator>.</operator><name>xml</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name><name>pom</name><operator>.</operator><name>xml</name></name>
<name>index</name> <name>c7c3c3303</name><operator>..</operator><literal type="number">210b46900</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name><name>pom</name><operator>.</operator><name>xml</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name><name>pom</name><operator>.</operator><name>xml</name></name>
@@ <operator>-</operator><literal type="number">77</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">77</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@
       <operator>&lt;</operator><name>groupId</name><operator>&gt;</operator><name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name><name>tika</name><argument_list type="generic">&lt;<argument><operator>/</operator><name>groupId</name></argument>&gt;</argument_list></name></name>
       <operator>&lt;</operator><name>artifactId</name><operator>&gt;</operator><name>tika</name><operator>-</operator><name><name>core</name><argument_list type="generic">&lt;<argument><operator>/</operator><name>artifactId</name></argument>&gt;</argument_list></name>
     <operator>&lt;</operator><operator>/</operator><name>dependency</name><operator>&gt;</operator>
    <operator>&lt;</operator><name>dependency</name><operator>&gt;</operator>
      <operator>&lt;</operator><name>groupId</name><operator>&gt;</operator><name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name><name>tika</name><argument_list type="generic">&lt;<argument><operator>/</operator><name>groupId</name></argument>&gt;</argument_list></name></name>
      <operator>&lt;</operator><name>artifactId</name><operator>&gt;</operator><name>tika</name><operator>-</operator><name><name>core</name><argument_list type="generic">&lt;<argument><operator>/</operator><name>artifactId</name></argument>&gt;</argument_list></name>
      <operator>&lt;</operator><name>version</name><operator>&gt;</operator><literal type="number">0.4</literal><operator>&lt;</operator><operator>/</operator><name>version</name><operator>&gt;</operator>
    <operator>&lt;</operator><operator>/</operator><name>dependency</name><operator>&gt;</operator>
     <operator>&lt;</operator><name>dependency</name><operator>&gt;</operator>
       <operator>&lt;</operator><name>groupId</name><operator>&gt;</operator><name><name>org</name><operator>.</operator><name><name>slf4j</name><argument_list type="generic">&lt;<argument><operator>/</operator><name>groupId</name></argument>&gt;</argument_list></name></name>
       <operator>&lt;</operator><name>artifactId</name><operator>&gt;</operator><name>slf4j</name><operator>-</operator><name><name>api</name><argument_list type="generic">&lt;<argument><operator>/</operator><name>artifactId</name></argument>&gt;</argument_list></name>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>AbstractExportContext</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>AbstractExportContext</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>ad8b64dfd</name><operator>..</operator><literal type="number">461dbae25</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>AbstractExportContext</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>AbstractExportContext</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">21</literal> <operator>+</operator><literal type="number">32</literal></expr><operator>,</operator><expr><literal type="number">14</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>AbstractExportContext</name> implements <name>ExportContext</name> <block>{
     <expr><specifier>private</specifier> <name>final</name> <name>IOListener</name> <name>ioListener</name></expr>;
     <expr><specifier>private</specifier> <name>final</name> <name>Item</name> <name>exportRoot</name></expr>;
     <expr><specifier>private</specifier> <name>final</name> <name>boolean</name> <name>hasStream</name></expr>;
    <expr><specifier>private</specifier> <name>final</name> <name>MimeResolver</name> <name>mimeResolver</name></expr>;
 
     <expr><specifier>protected</specifier> <name>boolean</name> <name>completed</name></expr>;
 
    <expr><specifier>public</specifier> <call><name>AbstractExportContext</name><argument_list>(<argument><expr><name>Item</name> <name>exportRoot</name></expr></argument>, <argument><expr><name>boolean</name> <name>hasStream</name></expr></argument>,
                                 <argument><expr><name>IOListener</name> <name>ioListener</name></expr></argument>)</argument_list></call> <block>{
        <expr><call><name>this</name><argument_list>(<argument><expr><name>exportRoot</name></expr></argument>, <argument><expr><name>hasStream</name></expr></argument>, <argument><expr><name>ioListener</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;
    }</block>

    <specifier>public</specifier> <call><name>AbstractExportContext</name><argument_list>(<argument><expr><name>Item</name> <name>exportRoot</name></expr></argument>, <argument><expr><name>boolean</name> <name>hasStream</name></expr></argument>,
                                 <argument><expr><name>IOListener</name> <name>ioListener</name></expr></argument>, <argument><expr><name>MimeResolver</name> <name>mimeResolver</name></expr></argument>)</argument_list></call> <block>{
    <expr><specifier>public</specifier> <call><name>AbstractExportContext</name><argument_list>(
            <argument><expr><name>Item</name> <name>exportRoot</name></expr></argument>, <argument><expr><name>boolean</name> <name>hasStream</name></expr></argument>, <argument><expr><name>IOListener</name> <name>ioListener</name></expr></argument>)</argument_list></call> <block>{
         <expr><name><name>this</name><operator>.</operator><name>exportRoot</name></name> <operator>=</operator> <name>exportRoot</name></expr>;
         <expr><name><name>this</name><operator>.</operator><name>hasStream</name></name> <operator>=</operator> <name>hasStream</name></expr>;
         <expr><name><name>this</name><operator>.</operator><name>ioListener</name></name> <operator>=</operator> <ternary><condition><expr><operator>(</operator><name>ioListener</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><name>ioListener</name></expr> </then><else>: <expr><operator>new</operator> <call><name>DefaultIOListener</name><argument_list>(<argument><expr><name>log</name></expr></argument>)</argument_list></call></expr></else></ternary></expr>;
        <expr><name><name>this</name><operator>.</operator><name>mimeResolver</name></name> <operator>=</operator> <ternary><condition><expr><operator>(</operator><name>mimeResolver</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><name>mimeResolver</name></expr> </then><else>: <expr><name><name>IOUtil</name><operator>.</operator><name>MIME_RESOLVER</name></name></expr></else></ternary></expr>;
     }</block>
 
     <specifier>public</specifier> <name>IOListener</name> <call><name>getIOListener</name><argument_list>()</argument_list></call> <block>{
@@ <expr><operator>-</operator><literal type="number">57</literal></expr>,<expr><literal type="number">10</literal> <operator>+</operator><literal type="number">50</literal></expr>,<expr><literal type="number">6</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>AbstractExportContext</name> implements <name>ExportContext</name> <block>{
         <return>return <expr><name>exportRoot</name></expr>;</return></block></expr>
     }</block>
 
    <specifier>public</specifier> <name>MimeResolver</name> <call><name>getMimeResolver</name><argument_list>()</argument_list></call> <block>{
        <return>return <expr><name>mimeResolver</name></expr>;</return></block></expr>
    }</block>

     <specifier>public</specifier> <name>boolean</name> <call><name>hasStream</name><argument_list>()</argument_list></call> <block>{
         <return>return <expr><name>hasStream</name></expr>;</return></block></expr>
     }</block>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>DefaultHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>DefaultHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">35faa0c00</literal><operator>..</operator><literal type="number">4dd4bc803</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>DefaultHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>DefaultHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">24</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">24</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@</expr></expr_stmt> <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>DavResource</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>xml</name><operator>.</operator><name>Namespace</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>property</name><operator>.</operator><name>DavPropertyName</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>property</name><operator>.</operator><name>DavProperty</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>tika</name><operator>.</operator><name>config</name><operator>.</operator><name>TikaConfig</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>tika</name><operator>.</operator><name>detect</name><operator>.</operator><name>Detector</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>tika</name><operator>.</operator><name>exception</name><operator>.</operator><name>TikaException</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>tika</name><operator>.</operator><name>metadata</name><operator>.</operator><name>Metadata</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">70</literal></expr><operator>,</operator><expr><literal type="number">21</literal> <operator>+</operator><literal type="number">74</literal></expr><operator>,</operator><expr><literal type="number">26</literal> @@ <specifier>public</specifier> <name>class</name> <name>DefaultHandler</name> implements <name>IOHandler</name></expr><operator>,</operator> <expr><name>PropertyHandler</name> <block>{
 
     <expr><specifier>private</specifier> <specifier>static</specifier> <name>Logger</name> <name>log</name> <operator>=</operator> <call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><name><name>DefaultHandler</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;
 
    <expr><specifier>private</specifier> <name>String</name> <name>collectionNodetype</name> <operator>=</operator> <name><name>JcrConstants</name><operator>.</operator><name>NT_FOLDER</name></name></expr>;
    <expr><specifier>private</specifier> <name>String</name> <name>defaultNodetype</name> <operator>=</operator> <name><name>JcrConstants</name><operator>.</operator><name>NT_FILE</name></name></expr>;
    <comment type="block">/* IMPORTANT NOTE: for webDAV compliance the default nodetype of the content
       node has been changed from nt:resource to nt:unstructured. */</comment>
    <expr><specifier>private</specifier> <name>String</name> <name>contentNodetype</name> <operator>=</operator> <name><name>JcrConstants</name><operator>.</operator><name>NT_UNSTRUCTURED</name></name></expr>;
    <expr><specifier>private</specifier> <name>String</name> <name>collectionNodetype</name></expr>;

    <expr><specifier>private</specifier> <name>String</name> <name>defaultNodetype</name></expr>;

    <expr><specifier>private</specifier> <name>String</name> <name>contentNodetype</name></expr>;
 
     <expr><specifier>private</specifier> <name>IOManager</name> <name>ioManager</name></expr>;
 
     <comment type="block" format="javadoc">/**
     * Creates a new &lt;code&gt;DefaultHandler&lt;/code&gt; with default nodetype definitions
     * and without setting the IOManager.
     * Creates a new &lt;code&gt;DefaultHandler&lt;/code&gt; with default nodetype definitions:&lt;br&gt;
     * &lt;ul&gt;
     * &lt;li&gt;Nodetype for Collection: {@link JcrConstants#NT_FOLDER nt:folder}&lt;/li&gt;
     * &lt;li&gt;Nodetype for Non-Collection: {@link JcrConstants#NT_FILE nt:file}&lt;/li&gt;
     * &lt;li&gt;Nodetype for Non-Collection content: {@link JcrConstants#NT_UNSTRUCTURED nt:unstructured}&lt;/li&gt;
     * &lt;/ul&gt;
      *
     * @see IOHandler#setIOManager(IOManager)
     * @param ioManager the I/O manager
      */</comment>
     <expr><specifier>public</specifier> <call><name>DefaultHandler</name><argument_list>()</argument_list></call> <block>{
        <expr><call><name>this</name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;
     }</block>
 
     <comment type="block" format="javadoc">/**
@@ -92,13 +101,19 @@ public class DefaultHandler implements IOHandler, PropertyHandler {
      * &lt;ul&gt;
      * &lt;li&gt;Nodetype for Collection: {@link JcrConstants#NT_FOLDER nt:folder}&lt;/li&gt;
      * &lt;li&gt;Nodetype for Non-Collection: {@link JcrConstants#NT_FILE nt:file}&lt;/li&gt;
     * &lt;li&gt;Nodetype for Non-Collection content: {@link JcrConstants#NT_RESOURCE nt:resource}&lt;/li&gt;
     * &lt;li&gt;Nodetype for Non-Collection content: {@link JcrConstants#NT_UNSTRUCTURED nt:unstructured}&lt;/li&gt;
      * &lt;/ul&gt;
      *
      * @param ioManager the I/O manager
      */</comment>
     <specifier>public</specifier> <call><name>DefaultHandler</name><argument_list>(<argument><expr><name>IOManager</name> <name>ioManager</name></expr></argument>)</argument_list></call> <block>{
        <expr><name><name>this</name><operator>.</operator><name>ioManager</name></name> <operator>=</operator> <name>ioManager</name></expr>;
        <expr><call><name>this</name><argument_list>(<argument><expr><name>ioManager</name></expr></argument>,
                <argument><expr><name><name>JcrConstants</name><operator>.</operator><name>NT_FOLDER</name></name></expr></argument>,
                <argument><expr><name><name>JcrConstants</name><operator>.</operator><name>NT_FILE</name></name></expr></argument>,
                <comment type="line">// IMPORTANT NOTE: for webDAV compliance the default type</comment>
                <comment type="line">// of the content node has been changed from nt:resource to</comment>
                <comment type="line">// nt:unstructured</comment>
                <argument><expr><name><name>JcrConstants</name><operator>.</operator><name>NT_UNSTRUCTURED</name></name></expr></argument>)</argument_list></call></expr>;
     }</block>
 
     <comment type="block" format="javadoc">/**
@@ -640,6 +655,24 @@ public class DefaultHandler implements IOHandler, PropertyHandler {
         return failures;
     }
 
    /**
     * Detects the media type of a document based on the given name.
     *
     * @param name document name
     * @return detected content type (or application/octet-stream)
     */</comment>
    <specifier>protected</specifier> <name>String</name> <call><name>detect</name><argument_list>(<argument><expr><name>String</name> <name>name</name></expr></argument>)</argument_list></call> <block>{
        <try>try <block>{<block_content>
            <decl_stmt><decl><type><name>Metadata</name></type> <name>metadata</name> <init>= <expr><operator>new</operator> <call><name>Metadata</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>metadata</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>Metadata</name><operator>.</operator><name>RESOURCE_NAME_KEY</name></name></expr></argument>, <argument><expr><name>name</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <return>return <expr><call><name><name>ioManager</name><operator>.</operator><name>getDetector</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>detect</name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>metadata</name></expr></argument>)</argument_list></call><operator>.</operator><call><name>toString</name><argument_list>()</argument_list></call></expr>;</return>
        <expr_stmt/></block_content></block></try>}</block></expr> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <comment type="line">// Can not happen since the InputStream above is null</comment>
            <throw>throw <expr><operator>new</operator> <call><name>IllegalStateException</name><argument_list>(
                    <argument><expr><literal type="string">"Unexpected IOException"</literal></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</throw>
        <expr_stmt/></block_content></block></catch>}</block></expr></expr_stmt>
    }

     <comment type="line">//------------------------------------------------------------&lt; private &gt;---</comment>
     <comment type="block" format="javadoc">/**
      * Builds a webdav property name from the given jcrName. In case the jcrName
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/DefaultIOManager.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/DefaultIOManager.java
index d0c47e64a..0fa5be62e 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/DefaultIOManager.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/DefaultIOManager.java
@@ -16,6 +16,7 @@
  */</comment>
 package <expr_stmt><expr><name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name></name></expr>;</expr_stmt>
 
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>tika</name><operator>.</operator><name>detect</name><operator>.</operator><name>Detector</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ExportContext</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ExportContext</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>a807d44cd</name><operator>..</operator><literal type="number">9fa428bbe</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ExportContext</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ExportContext</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">17</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">17</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@</expr></expr_stmt>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name></name>;</package>
 
 <import>import <name><name>javax</name><operator>.</operator><name>jcr</name><operator>.</operator><name>Item</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>OutputStream</name></name>;</import>
 
 <comment type="block" format="javadoc">/**
@@ -38,13 +39,6 @@ public interface ExportContext extends IOContext {
      */</comment>
     <function_decl><type><specifier>public</specifier> <name>OutputStream</name></type> <name>getOutputStream</name><parameter_list>()</parameter_list>;</function_decl>
 
    <comment type="block" format="javadoc">/**
     * Return the &lt;code&gt;MimeResolver&lt;/code&gt; defined for this export context.
     *
     * @return mimetype resolver defined for this export context.
     */</comment>
    <function_decl><type><specifier>public</specifier> <name>MimeResolver</name></type> <name>getMimeResolver</name><parameter_list>()</parameter_list>;</function_decl>

     <comment type="block" format="javadoc">/**
      * Set the content type for the resource content
      *
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ExportContextImpl.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ExportContextImpl.java
index ba7679f31..173b34117 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ExportContextImpl.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ExportContextImpl.java
@@ -19,6 +19,7 @@ package org.apache.jackrabbit.server.io;
 import org.apache.jackrabbit.webdav.DavConstants;
 import org.apache.jackrabbit.webdav.DavResource;
 import org.apache.jackrabbit.webdav.io.OutputContext;
import org.apache.tika.detect.Detector;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -53,13 +54,9 @@ public class ExportContextImpl extends AbstractExportContext {
     private File outFile;
     private OutputStream outStream;
 
    public ExportContextImpl(Item exportRoot, OutputContext outputCtx) throws IOException {
        this(exportRoot, outputCtx, null);
    }

    public ExportContextImpl(Item exportRoot, OutputContext outputCtx,
                             MimeResolver mimeResolver) throws IOException {
        super(exportRoot, (outputCtx != null) ? outputCtx.hasStream() : false, null, mimeResolver);
    public ExportContextImpl(Item exportRoot, OutputContext outputCtx)
            throws IOException {
        super(exportRoot, outputCtx != null &amp;&amp; outputCtx.hasStream(), null);
         this.outputCtx = outputCtx;
         if (hasStream()) {
             // we need a tmp file, since the export could fail
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/IOManager.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/IOManager.java
index 99bfd5bb4..a31031eea 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/IOManager.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/IOManager.java
@@ -17,6 +17,7 @@
 package org.apache.jackrabbit.server.io;
 
 import org.apache.jackrabbit.webdav.DavResource;
import org.apache.tika.detect.Detector;
 
 import java.io.IOException;
 
@@ -40,6 +41,20 @@ public interface IOManager {
      */</comment>
     <function_decl><type><specifier>public</specifier> <name><name>IOHandler</name><index>[]</index></name></type> <name>getIOHandlers</name><parameter_list>()</parameter_list>;</function_decl>
 
    <comment type="block" format="javadoc">/**
     * Return the configured type detector.
     *
     * @return content type detector
     */</comment>
    <function_decl><type><name>Detector</name></type> <name>getDetector</name><parameter_list>()</parameter_list>;</function_decl>

    <comment type="block" format="javadoc">/**
     * Sets the configured type detector.
     *
     * @param detector content type detector.
     */</comment>
    <function_decl><type><name>void</name></type> <name>setDetector</name><parameter_list>(<parameter><decl><type><name>Detector</name></type> <name>detector</name></decl></parameter>)</parameter_list>;</function_decl>

     <comment type="block" format="javadoc">/**
      * Passes the specified context and boolean value to the IOHandlers present
      * on this manager.
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/IOManagerImpl.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/IOManagerImpl.java
index cb3b38b2f..ddd1524ba 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/IOManagerImpl.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/IOManagerImpl.java
@@ -16,13 +16,14 @@
  */</comment>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name></name>;</package>
 
<import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>DavResource</name></name>;</import>

 <import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
 <import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>ArrayList</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>DavResource</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>tika</name><operator>.</operator><name>detect</name><operator>.</operator><name>Detector</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
 
 <comment type="block" format="javadoc">/**
  * &lt;code&gt;IOManagerImpl&lt;/code&gt; represents the most simple &lt;code&gt;IOManager&lt;/code&gt;
@@ -33,6 +34,11 @@ public class IOManagerImpl implements IOManager {
 
     private static Logger log = LoggerFactory.getLogger(IOManagerImpl.class);
 
    /**
     * Content type detector.
     */</comment>
    <decl_stmt><decl><type><specifier>private</specifier> <name>Detector</name></type> <name>detector</name></decl>;</decl_stmt>

     <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name>List</name></type> <name>ioHandlers</name> <init>= <expr><operator>new</operator> <call><name>ArrayList</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
 
     <comment type="block" format="javadoc">/**
@@ -63,6 +69,24 @@ public class IOManagerImpl implements IOManager {
         return (IOHandler[]) ioHandlers.toArray(new IOHandler[ioHandlers.size()]);
     }
 
    /**
     * Return the configured type detector.
     *
     * @return content type detector
     */</comment>
    <function><type><specifier>public</specifier> <name>Detector</name></type> <name>getDetector</name><parameter_list>()</parameter_list> <block>{<block_content>
        <return>return <expr><name>detector</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Sets the configured type detector.
     *
     * @param detector content type detector
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>setDetector</name><parameter_list>(<parameter><decl><type><name>Detector</name></type> <name>detector</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>detector</name></name> <operator>=</operator> <name>detector</name></expr>;</expr_stmt>
    </block_content>}</block></function>

     <comment type="block" format="javadoc">/**
      * @see IOManager#importContent(ImportContext, boolean)
      */</comment>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>IOUtil</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>IOUtil</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">10dbda6d7</literal><operator>..</operator><literal type="number">9c11e39aa</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>IOUtil</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>IOUtil</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">48</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">48</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>IOUtil</name> <block>{
      <expr><operator>*</operator><operator>/</operator>
     <specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>long</name> <name>UNDEFINED_LENGTH</name> <operator>=</operator> <operator>-</operator><literal type="number">1</literal></expr>;
 
    <comment type="block" format="javadoc">/**
     * MimeType resolver used to retrieve the mimetype if no content type is
     * available during import.
     */</comment>
    <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>MimeResolver</name> <name>MIME_RESOLVER</name> <operator>=</operator> <operator>new</operator> <call><name>MimeResolver</name><argument_list>()</argument_list></call></expr>;

     <comment type="block" format="javadoc">/**
      * Return the last modification time as formatted string.
      *
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ImportContext.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ImportContext.java
index ab58f51cd..b30df6392 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ImportContext.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ImportContext.java
@@ -17,6 +17,9 @@
 package org.apache.jackrabbit.server.io;
 
 import javax.jcr.Item;

import org.apache.tika.detect.Detector;

 import java.io.InputStream;
 
 /**
@@ -32,13 +35,6 @@ public interface ImportContext extends IOContext {
      */</comment>
     <expr><specifier>public</specifier> <name>Item</name> <call><name>getImportRoot</name><argument_list>()</argument_list></call></expr>;
 
    <comment type="block" format="javadoc">/**
     * Return the &lt;code&gt;MimeResolver&lt;/code&gt; defined for this import context.
     *
     * @return mimetype resolver defined for this import context.
     */</comment>
    <expr><specifier>public</specifier> <name>MimeResolver</name> <call><name>getMimeResolver</name><argument_list>()</argument_list></call></expr>;

     <comment type="block" format="javadoc">/**
      * Returns the system id of the resource to be imported. This id depends on
      * the system the resource is comming from. it can be a filename, a
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ImportContextImpl.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ImportContextImpl.java
index 51352a03b..05433c203 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ImportContextImpl.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/ImportContextImpl.java
@@ -17,10 +17,15 @@
 package org.apache.jackrabbit.server.io;
 
 import org.apache.jackrabbit.webdav.io.InputContext;
import org.apache.tika.detect.Detector;
import org.apache.tika.metadata.Metadata;
import org.apache.tika.mime.MediaType;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
 import javax.jcr.Item;

import java.io.BufferedInputStream;
 import java.io.File;
 import java.io.FileInputStream;
 import java.io.IOException;
@@ -38,64 +43,13 @@ public class ImportContextImpl implements ImportContext {
     private final Item importRoot;
     private final String systemId;
     private final File inputFile;
    private final MimeResolver mimeResolver;
 
     private InputContext inputCtx;
     private boolean completed;
 
    /**
     * Creates a new item import context with the given root item and the
     * specified &lt;code&gt;InputContext&lt;/code&gt;. If the input context provides an
     * input stream, the stream is written to a temporary file in order to avoid
     * problems with multiple IOHandlers that try to run the import but fail.
     * The temporary file is deleted as soon as this context is informed that
     * the import has been completed and it will not be used any more.
     *
     * @param importRoot the import root node
     * @param systemId
     * @param inputCtx wrapped by this &lt;code&gt;ImportContext&lt;/code&gt;
     */</comment>
    <expr><specifier>public</specifier> <call><name>ImportContextImpl</name><argument_list>(<argument><expr><name>Item</name> <name>importRoot</name></expr></argument>, <argument><expr><name>String</name> <name>systemId</name></expr></argument>, <argument><expr><name>InputContext</name> <name>inputCtx</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{
        <expr><call><name>this</name><argument_list>(<argument><expr><name>importRoot</name></expr></argument>, <argument><expr><name>systemId</name></expr></argument>, <argument><expr><name>inputCtx</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;
    }</block>
    <specifier>private</specifier> <name>final</name> <name>Detector</name> <name>detector</name></expr>;</expr_stmt>
 
    <comment type="block" format="javadoc">/**
     * Creates a new item import context with the given root item and the
     * specified &lt;code&gt;InputContext&lt;/code&gt;. If the input context provides an
     * input stream, the stream is written to a temporary file in order to avoid
     * problems with multiple IOHandlers that try to run the import but fail.
     * The temporary file is deleted as soon as this context is informed that
     * the import has been completed and it will not be used any more.
     *
     * @param importRoot the import root node
     * @param systemId
     * @param inputCtx wrapped by this &lt;code&gt;ImportContext&lt;/code&gt;
     * @param mimeResolver
     */</comment>
    <constructor><specifier>public</specifier> <name>ImportContextImpl</name><parameter_list>(<parameter><decl><type><name>Item</name></type> <name>importRoot</name></decl></parameter>, <parameter><decl><type><name>String</name></type> <name>systemId</name></decl></parameter>, <parameter><decl><type><name>InputContext</name></type> <name>inputCtx</name></decl></parameter>,
                             <parameter><decl><type><name>MimeResolver</name></type> <name>mimeResolver</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>
        <expr_stmt><expr><call><name>this</name><argument_list>(<argument><expr><name>importRoot</name></expr></argument>, <argument><expr><name>systemId</name></expr></argument>, <argument><expr><ternary><condition><expr><operator>(</operator><name>inputCtx</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><call><name><name>inputCtx</name><operator>.</operator><name>getInputStream</name></name><argument_list>()</argument_list></call></expr> </then><else>: <expr><literal type="null">null</literal></expr></else></ternary></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>mimeResolver</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>inputCtx</name></name> <operator>=</operator> <name>inputCtx</name></expr>;</expr_stmt>
    </block_content>}</block></constructor>

    <comment type="block" format="javadoc">/**
     * Creates a new item import context. The specified InputStream is written
     * to a temporary file in order to avoid problems with multiple IOHandlers
     * that try to run the import but fail. The temporary file is deleted as soon
     * as this context is informed that the import has been completed and it
     * will not be used any more.
     *
     * @param importRoot
     * @param systemId
     * @param in
     * @param ioListener
     * @throws IOException
     * @see ImportContext#informCompleted(boolean)
     */</comment>
    <constructor><specifier>public</specifier> <name>ImportContextImpl</name><parameter_list>(<parameter><decl><type><name>Item</name></type> <name>importRoot</name></decl></parameter>, <parameter><decl><type><name>String</name></type> <name>systemId</name></decl></parameter>, <parameter><decl><type><name>InputStream</name></type> <name>in</name></decl></parameter>,
                             <parameter><decl><type><name>IOListener</name></type> <name>ioListener</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>IOException</name></expr></argument></throws> <block>{<block_content>
        <expr_stmt><expr><call><name>this</name><argument_list>(<argument><expr><name>importRoot</name></expr></argument>, <argument><expr><name>systemId</name></expr></argument>, <argument><expr><name>in</name></expr></argument>, <argument><expr><name>ioListener</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></constructor>
    <decl_stmt><decl><type><specifier>private</specifier> <specifier>final</specifier> <name>MediaType</name></type> <name>type</name></decl>;</decl_stmt>
 
     <comment type="block" format="javadoc">/**
      * Creates a new item import context. The specified InputStream is written
@@ -106,20 +60,35 @@ public class ImportContextImpl implements ImportContext {
      *
      * @param importRoot
      * @param systemId
     * @param in
     * @param inputCtx input context, or &lt;code&gt;null&lt;/code&gt;
     * @param stream document input stream, or &lt;code&gt;null&lt;/code&gt;
      * @param ioListener
     * @param mimeResolver
     * @param detector content type detector
      * @throws IOException
      * @see ImportContext#informCompleted(boolean)
      */</comment>
    <expr_stmt><expr><specifier>public</specifier> <call><name>ImportContextImpl</name><argument_list>(<argument><expr><name>Item</name> <name>importRoot</name></expr></argument>, <argument><expr><name>String</name> <name>systemId</name></expr></argument>, <argument><expr><name>InputStream</name> <name>in</name></expr></argument>,
                             <argument><expr><name>IOListener</name> <name>ioListener</name></expr></argument>, <argument><expr><name>MimeResolver</name> <name>mimeResolver</name></expr></argument>)</argument_list></call>
    <specifier>public</specifier> <call><name>ImportContextImpl</name><argument_list>(
            <argument><expr><name>Item</name> <name>importRoot</name></expr></argument>, <argument><expr><name>String</name> <name>systemId</name></expr></argument>, <argument><expr><name>InputContext</name> <name>inputCtx</name></expr></argument>,
            <argument><expr><name>InputStream</name> <name>stream</name></expr></argument>, <argument><expr><name>IOListener</name> <name>ioListener</name></expr></argument>, <argument><expr><name>Detector</name> <name>detector</name></expr></argument>)</argument_list></call>
             <throws>throws <argument><expr><name>IOException</name> <block>{
         <expr><name><name>this</name><operator>.</operator><name>importRoot</name></name> <operator>=</operator> <name>importRoot</name></expr></block></expr></argument></throws></expr>;</expr_stmt>
         <expr_stmt><expr><name><name>this</name><operator>.</operator><name>systemId</name></name> <operator>=</operator> <name>systemId</name></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>inputFile</name></name> <operator>=</operator> <call><name><name>IOUtil</name><operator>.</operator><name>getTempFile</name></name><argument_list>(<argument><expr><name>in</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>inputCtx</name></name> <operator>=</operator> <name>inputCtx</name></expr>;</expr_stmt>
         <expr_stmt><expr><name><name>this</name><operator>.</operator><name>ioListener</name></name> <operator>=</operator> <ternary><condition><expr><operator>(</operator><name>ioListener</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><name>ioListener</name></expr> </then><else>: <expr><operator>new</operator> <call><name>DefaultIOListener</name><argument_list>(<argument><expr><name>log</name></expr></argument>)</argument_list></call></expr></else></ternary></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>mimeResolver</name></name> <operator>=</operator> <ternary><condition><expr><operator>(</operator><name>mimeResolver</name> <operator>==</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><name><name>IOUtil</name><operator>.</operator><name>MIME_RESOLVER</name></name></expr> </then><else>: <expr><name>mimeResolver</name></expr></else></ternary></expr>;</expr_stmt>

        <decl_stmt><decl><type><name>Metadata</name></type> <name>metadata</name> <init>= <expr><operator>new</operator> <call><name>Metadata</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>inputCtx</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <call><name><name>inputCtx</name><operator>.</operator><name>getContentType</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><call><name><name>metadata</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>Metadata</name><operator>.</operator><name>CONTENT_TYPE</name></name></expr></argument>, <argument><expr><call><name><name>inputCtx</name><operator>.</operator><name>getContentType</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
        <if_stmt><if>if <condition>(<expr><name>systemId</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><call><name><name>metadata</name><operator>.</operator><name>set</name></name><argument_list>(<argument><expr><name><name>Metadata</name><operator>.</operator><name>RESOURCE_NAME_KEY</name></name></expr></argument>, <argument><expr><name>systemId</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
        <if_stmt><if>if <condition>(<expr><name>stream</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <operator>!</operator><call><name><name>stream</name><operator>.</operator><name>markSupported</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>stream</name> <operator>=</operator> <operator>new</operator> <call><name>BufferedInputStream</name><argument_list>(<argument><expr><name>stream</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>detector</name></name> <operator>=</operator> <name>detector</name></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>type</name></name> <operator>=</operator> <call><name><name>detector</name><operator>.</operator><name>detect</name></name><argument_list>(<argument><expr><name>stream</name></expr></argument>, <argument><expr><name>metadata</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>inputFile</name></name> <operator>=</operator> <call><name><name>IOUtil</name><operator>.</operator><name>getTempFile</name></name><argument_list>(<argument><expr><name>stream</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
     }
 
     <comment type="block" format="javadoc">/**
@@ -137,10 +106,10 @@ public class ImportContextImpl implements ImportContext {
     }
 
     /**
     * @see ImportContext#getImportRoot()
     * @see ImportContext#getDetector()
      */</comment>
    public <function><type><name>MimeResolver</name></type> <name>getMimeResolver</name><parameter_list>()</parameter_list> <block>{<block_content>
        <return>return <expr><name>mimeResolver</name></expr>;</return>
    <function><type><specifier>public</specifier> <name>Detector</name></type> <name>getDetector</name><parameter_list>()</parameter_list> <block>{<block_content>
        <return>return <expr><name>detector</name></expr>;</return>
     </block_content>}</block></function>
 
     <comment type="block" format="javadoc">/**
@@ -209,35 +178,18 @@ public class ImportContextImpl implements ImportContext {
         return length;
     }
 
    /**
     * @return the content type present on the &lt;code&gt;InputContext&lt;/code&gt; or
     * &lt;code&gt;null&lt;/code&gt;
     * @see InputContext#getContentType()
     */</comment>
    <function><type><specifier>private</specifier> <name>String</name></type> <name>getContentType</name><parameter_list>()</parameter_list> <block>{<block_content>
        <return>return <expr><ternary><condition><expr><operator>(</operator><name>inputCtx</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><call><name><name>inputCtx</name><operator>.</operator><name>getContentType</name></name><argument_list>()</argument_list></call></expr> </then><else>: <expr><literal type="null">null</literal></expr></else></ternary></expr>;</return>
    </block_content>}</block></function>

     <comment type="block" format="javadoc">/**
      * @see ImportContext#getMimeType()
      */</comment>
     <function><type><specifier>public</specifier> <name>String</name></type> <name>getMimeType</name><parameter_list>()</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>String</name></type> <name>contentType</name> <init>= <expr><call><name>getContentType</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>String</name></type> <name>mimeType</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>contentType</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>mimeType</name> <operator>=</operator> <call><name><name>IOUtil</name><operator>.</operator><name>getMimeType</name></name><argument_list>(<argument><expr><name>contentType</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <if type="elseif">else if <condition>(<expr><call><name>getSystemId</name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>mimeType</name> <operator>=</operator> <call><name><name>mimeResolver</name><operator>.</operator><name>getMimeType</name></name><argument_list>(<argument><expr><call><name>getSystemId</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
        <return>return <expr><name>mimeType</name></expr>;</return>
        <return>return <expr><call><name><name>IOUtil</name><operator>.</operator><name>getMimeType</name></name><argument_list>(<argument><expr><call><name><name>type</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
     </block_content>}</block></function>
 
     <comment type="block" format="javadoc">/**
      * @see ImportContext#getEncoding()
      */</comment>
     <function><type><specifier>public</specifier> <name>String</name></type> <name>getEncoding</name><parameter_list>()</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>String</name></type> <name>contentType</name> <init>= <expr><call><name>getContentType</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <return>return <expr><ternary><condition><expr><operator>(</operator><name>contentType</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><call><name><name>IOUtil</name><operator>.</operator><name>getEncoding</name></name><argument_list>(<argument><expr><name>contentType</name></expr></argument>)</argument_list></call></expr> </then><else>: <expr><literal type="null">null</literal></expr></else></ternary></expr>;</return>
        <return>return <expr><call><name><name>IOUtil</name><operator>.</operator><name>getEncoding</name></name><argument_list>(<argument><expr><call><name><name>type</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
     </block_content>}</block></function>
 
     <comment type="block" format="javadoc">/**
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/MimeResolver.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/MimeResolver.java
index 58fe5e4a7..e69de29bb 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/MimeResolver.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/server/io/MimeResolver.java
@@ -1,103 +0,0 @@
/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</comment>
<package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name></name>;</package>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>util</name><operator>.</operator><name>Text</name></name>;</import>

<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Properties</name></name>;</import>

<comment type="block" format="javadoc">/**
 * This Class implements a very simple mime type resolver.
 */</comment>
<class><specifier>public</specifier> class <name>MimeResolver</name> <block>{

    <comment type="block" format="javadoc">/**
     * the loaded mimetypes
     */</comment>
    <decl_stmt><decl><type><specifier>private</specifier> <name>Properties</name></type> <name>mimeTypes</name> <init>= <expr><operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

    <comment type="block" format="javadoc">/**
     * the default mimetype
     */</comment>
    <decl_stmt><decl><type><specifier>private</specifier> <name>String</name></type> <name>defaultMimeType</name> <init>= <expr><literal type="string">"application/octet-stream"</literal></expr></init></decl>;</decl_stmt>

    <comment type="block" format="javadoc">/**
     * Creates a new mimetype resolver containing the default mappings and having
     * "application/octet-stream" set as default mimetype.
     */</comment>
    <constructor><specifier>public</specifier> <name>MimeResolver</name><parameter_list>()</parameter_list> <block>{<block_content>
        <try>try <block>{<block_content>
            <comment type="line">// init the mime types</comment>
            <expr_stmt><expr><call><name><name>mimeTypes</name><operator>.</operator><name>load</name></name><argument_list>(<argument><expr><call><name>getClass</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getResourceAsStream</name><argument_list>(<argument><expr><literal type="string">"mimetypes.properties"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <throw>throw <expr><operator>new</operator> <call><name>InternalError</name><argument_list>(<argument><expr><literal type="string">"Unable to load mimetypes: "</literal> <operator>+</operator> <call><name><name>e</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</throw>
        </block_content>}</block></catch></try>
    </block_content>}</block></constructor>

    <comment type="block" format="javadoc">/**
     * Creates a new mime type resolver extending the default mapping by the
     * entries of the given Properties. The default mimetype is set to the
     * given &lt;code&gt;defaultMimeType&lt;/code&gt;.
     *
     * @param additionalProperties MimeType mappings to be added to the default
     * properties.
     * @param defaultMimeType The default mimetype. A non-null String with a
     * length greater than 0.
     */</comment>
    <constructor><specifier>public</specifier> <name>MimeResolver</name><parameter_list>(<parameter><decl><type><name>Properties</name></type> <name>additionalProperties</name></decl></parameter>, <parameter><decl><type><name>String</name></type> <name>defaultMimeType</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <comment type="line">// init default mimetypes.</comment>
        <expr_stmt><expr><call><name>this</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <comment type="line">// extend or adjust mapping.</comment>
        <if_stmt><if>if <condition>(<expr><name>additionalProperties</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <operator>!</operator><call><name><name>additionalProperties</name><operator>.</operator><name>isEmpty</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><call><name><name>mimeTypes</name><operator>.</operator><name>putAll</name></name><argument_list>(<argument><expr><name>additionalProperties</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
        <comment type="line">// set the default type.</comment>
        <if_stmt><if>if <condition>(<expr><name>defaultMimeType</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <call><name><name>defaultMimeType</name><operator>.</operator><name>length</name></name><argument_list>()</argument_list></call> <operator>&gt;</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name><name>this</name><operator>.</operator><name>defaultMimeType</name></name> <operator>=</operator> <name>defaultMimeType</name></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
    </block_content>}</block></constructor>

    <comment type="block" format="javadoc">/**
     * Returns the default mime type
     * @return
     */</comment>
    <function><type><specifier>public</specifier> <name>String</name></type> <name>getDefaultMimeType</name><parameter_list>()</parameter_list> <block>{<block_content>
        <return>return <expr><name>defaultMimeType</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Sets the default mime type
     * @param defaultMimeType
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>setDefaultMimeType</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>defaultMimeType</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>defaultMimeType</name></name> <operator>=</operator> <name>defaultMimeType</name></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Retrusn the mime type for the given name.
     * @param filename
     * @return
     */</comment>
    <function><type><specifier>public</specifier> <name>String</name></type> <name>getMimeType</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>filename</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>String</name></type> <name>ext</name> <init>= <expr><call><name><name>Text</name><operator>.</operator><name>getName</name></name><argument_list>(<argument><expr><name>filename</name></expr></argument>, <argument><expr><literal type="char">'.'</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><call><name><name>ext</name><operator>.</operator><name>equals</name></name><argument_list>(<argument><expr><literal type="string">""</literal></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>ext</name> <operator>=</operator> <name>filename</name></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
        <return>return <expr><call><name><name>mimeTypes</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><call><name><name>ext</name><operator>.</operator><name>toLowerCase</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>defaultMimeType</name></expr></argument>)</argument_list></call></expr>;</return>
    </block_content>}</block></function>
}</block></class>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>XmlHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>XmlHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">060d29a26</literal><operator>..</operator><name>e41e57ca2</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>XmlHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>XmlHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">149</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">149</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>XmlHandler</name> extends <name>DefaultHandler</name> <block>{
                 <if_stmt><if>if <condition>(<expr><call><name><name>contentNode</name><operator>.</operator><name>hasProperty</name></name><argument_list>(<argument><expr><name><name>JcrConstants</name><operator>.</operator><name>JCR_MIMETYPE</name></name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
                     <expr_stmt><expr><name>mimeType</name> <operator>=</operator> <call><name><name>contentNode</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><name><name>JcrConstants</name><operator>.</operator><name>JCR_MIMETYPE</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getString</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
                 <expr_stmt/></block_content></block></if></if_stmt>}</block></expr></expr_stmt> <if_stmt><else>else <block>{<block_content>
                    <expr_stmt><expr><name>mimeType</name> <operator>=</operator> <call><name><name>context</name><operator>.</operator><name>getMimeResolver</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getMimeType</name><argument_list>(<argument><expr><call><name><name>context</name><operator>.</operator><name>getExportRoot</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getName</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                    <expr_stmt><expr><name>mimeType</name> <operator>=</operator> <call><name>detect</name><argument_list>(<argument><expr><call><name><name>context</name><operator>.</operator><name>getExportRoot</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getName</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                 </block_content>}</block></else></if_stmt>
             </block_content>}</block></function> <catch>catch <parameter_list>(<parameter><decl><type><name>RepositoryException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
                 <comment type="line">// ignore and return false</comment>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ZipHandler</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ZipHandler</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">347f47eaf</literal><operator>..</operator><literal type="number">1047e7bb1</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ZipHandler</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>server</name><operator>/</operator><name>io</name><operator>/</operator><name><name>ZipHandler</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">153</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">153</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ZipHandler</name> extends <name>DefaultHandler</name> <block>{
                 <if_stmt><if>if <condition>(<expr><call><name><name>contentNode</name><operator>.</operator><name>hasProperty</name></name><argument_list>(<argument><expr><name><name>JcrConstants</name><operator>.</operator><name>JCR_MIMETYPE</name></name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
                     <expr_stmt><expr><name>mimeType</name>  <operator>=</operator> <call><name><name>contentNode</name><operator>.</operator><name>getProperty</name></name><argument_list>(<argument><expr><name><name>JcrConstants</name><operator>.</operator><name>JCR_MIMETYPE</name></name></expr></argument>)</argument_list></call><operator>.</operator><call><name>getString</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
                 <expr_stmt/></block_content></block></if></if_stmt>}</block></expr></expr_stmt> <if_stmt><else>else <block>{<block_content>
                    <expr_stmt><expr><name>mimeType</name> <operator>=</operator> <call><name><name>context</name><operator>.</operator><name>getMimeResolver</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getMimeType</name><argument_list>(<argument><expr><call><name><name>context</name><operator>.</operator><name>getExportRoot</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getName</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                    <expr_stmt><expr><name>mimeType</name> <operator>=</operator> <call><name>detect</name><argument_list>(<argument><expr><call><name><name>context</name><operator>.</operator><name>getExportRoot</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>getName</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                 </block_content>}</block></else></if_stmt>
             </block_content>}</block></catch> <catch>catch <parameter_list>(<parameter><decl><type><name>RepositoryException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
                 <comment type="line">// ignore and return false</comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">283</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">283</literal></expr><operator>,</operator><expr><literal type="number">8</literal> @@ <specifier>public</specifier> <name>class</name> <name>ZipHandler</name> extends <name>DefaultHandler</name> <block>{
         <expr><specifier>private</specifier> <name>final</name> <name>ZipEntry</name> <name>entry</name></expr>;
 
         <expr><specifier>private</specifier> <call><name>ZipEntryImportContext</name><argument_list>(<argument><expr><name>ImportContext</name> <name>context</name></expr></argument>, <argument><expr><name>ZipEntry</name> <name>entry</name></expr></argument>, <argument><expr><name>BoundedInputStream</name> <name>bin</name></expr></argument>, <argument><expr><name>Node</name> <name>contentNode</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>IOException</name></expr></argument>, <argument><expr><name>RepositoryException</name> <block>{
            <expr><call><name>super</name><argument_list>(<argument><expr><name>contentNode</name></expr></argument>, <argument><expr><call><name><name>Text</name><operator>.</operator><name>getName</name></name><argument_list>(<argument><expr><call><name>makeValidJCRPath</name><argument_list>(<argument><expr><call><name><name>entry</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><name>bin</name></expr></argument>, <argument><expr><call><name><name>context</name><operator>.</operator><name>getIOListener</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>context</name><operator>.</operator><name>getMimeResolver</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></block></expr></argument></throws></expr>;
            <expr><call><name>super</name><argument_list>(<argument><expr><name>contentNode</name></expr></argument>, <argument><expr><call><name><name>Text</name><operator>.</operator><name>getName</name></name><argument_list>(<argument><expr><call><name>makeValidJCRPath</name><argument_list>(<argument><expr><call><name><name>entry</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>,
                    <argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>bin</name></expr></argument>, <argument><expr><call><name><name>context</name><operator>.</operator><name>getIOListener</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>getIOManager</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getDetector</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
             <expr><name><name>this</name><operator>.</operator><name>entry</name></name> <operator>=</operator> <name>entry</name></expr>;
             <expr><name>String</name> <name>path</name> <operator>=</operator> <call><name>makeValidJCRPath</name><argument_list>(<argument><expr><call><name><name>entry</name><operator>.</operator><name>getName</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;
             <expr><name>importRoot</name> <operator>=</operator> <call><name><name>IOUtil</name><operator>.</operator><name>mkDirs</name></name><argument_list>(<argument><expr><name>contentNode</name></expr></argument>, <argument><expr><call><name><name>Text</name><operator>.</operator><name>getRelativeParent</name></name><argument_list>(<argument><expr><name>path</name></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name>getCollectionNodeType</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
@@ <expr><operator>-</operator><literal type="number">312</literal></expr>,<expr><literal type="number">7</literal> <operator>+</operator><literal type="number">313</literal></expr>,<expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ZipHandler</name> extends <name>DefaultHandler</name> <block>{
         <expr><specifier>private</specifier> <name>OutputStream</name> <name>out</name></expr>;
 
         <expr><specifier>private</specifier> <call><name>ZipEntryExportContext</name><argument_list>(<argument><expr><name>Item</name> <name>exportRoot</name></expr></argument>, <argument><expr><name>OutputStream</name> <name>out</name></expr></argument>, <argument><expr><name>ExportContext</name> <name>context</name></expr></argument>, <argument><expr><name>int</name> <name>pos</name></expr></argument>)</argument_list></call> <block>{
            <expr><call><name>super</name><argument_list>(<argument><expr><name>exportRoot</name></expr></argument>, <argument><expr><name>out</name> <operator>!=</operator> <literal type="null">null</literal></expr></argument>, <argument><expr><call><name><name>context</name><operator>.</operator><name>getIOListener</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name><name>context</name><operator>.</operator><name>getMimeResolver</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
            <expr><call><name>super</name><argument_list>(<argument><expr><name>exportRoot</name></expr></argument>, <argument><expr><name>out</name> <operator>!=</operator> <literal type="null">null</literal></expr></argument>, <argument><expr><call><name><name>context</name><operator>.</operator><name>getIOListener</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
             <expr><name><name>this</name><operator>.</operator><name>out</name></name> <operator>=</operator> <name>out</name></expr>;
             <try>try <block>{<block_content>
                 <decl_stmt><decl><type><name>String</name></type> <name>entryPath</name> <init>= <expr><ternary><condition><expr><operator>(</operator><call><name><name>exportRoot</name><operator>.</operator><name>getPath</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>length</name><argument_list>()</argument_list></call> <operator>&gt;</operator> <name>pos</name><operator>)</operator></expr> ?</condition><then> <expr><call><name><name>exportRoot</name><operator>.</operator><name>getPath</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>substring</name><argument_list>(<argument><expr><name>pos</name></expr></argument>)</argument_list></call></expr> </then><else>: <expr><literal type="string">""</literal></expr></else></ternary></expr></init></decl>;</decl_stmt>
<expr_stmt><expr><name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>DavResourceImpl</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>DavResourceImpl</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">285f0374a</literal><operator>..</operator><name>efc59acd4</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>DavResourceImpl</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>DavResourceImpl</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">897</literal></expr><operator>,</operator><expr><literal type="number">7</literal> <operator>+</operator><literal type="number">897</literal></expr><operator>,</operator><expr><literal type="number">10</literal> @@ <specifier>public</specifier> <name>class</name> <name>DavResourceImpl</name> implements <name>DavResource</name></expr><operator>,</operator> <expr><name>BindableResource</name></expr><operator>,</operator> <expr><name>JcrConsta</name>
      <operator>*</operator> @<throws>throws <argument><expr><name>IOException</name>
      <operator>*</operator><operator>/</operator>
     <specifier>protected</specifier> <name>ImportContext</name> <call><name>getImportContext</name><argument_list>(<argument><expr><name>InputContext</name> <name>inputCtx</name></expr></argument>, <argument><expr><name>String</name> <name>systemId</name></expr></argument>)</argument_list></call></expr></argument></throws> <throws>throws <argument><expr><name>IOException</name> <block>{</block></expr></argument></throws></expr></expr_stmt>
        <return>return <expr><operator>new</operator> <call><name>ImportContextImpl</name><argument_list>(<argument><expr><name>node</name></expr></argument>, <argument><expr><name>systemId</name></expr></argument>, <argument><expr><name>inputCtx</name></expr></argument>, <argument><expr><call><name><name>config</name><operator>.</operator><name>getMimeResolver</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
        <return>return <expr><operator>new</operator> <call><name>ImportContextImpl</name><argument_list>(
                <argument><expr><name>node</name></expr></argument>, <argument><expr><name>systemId</name></expr></argument>, <argument><expr><name>inputCtx</name></expr></argument>,
                <argument><expr><ternary><condition><expr><operator>(</operator><name>inputCtx</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><call><name><name>inputCtx</name><operator>.</operator><name>getInputStream</name></name><argument_list>()</argument_list></call></expr> </then><else>: <expr><literal type="null">null</literal></expr></else></ternary></expr></argument>,
                <argument><expr><operator>new</operator> <call><name>DefaultIOListener</name><argument_list>(<argument><expr><name>log</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name><name>config</name><operator>.</operator><name>getDetector</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</return>
     <expr_stmt/></block_content></block></try>}</block>
 
     <comment type="block" format="javadoc">/**
@@ -908,7 +911,7 @@ public class DavResourceImpl implements DavResource, BindableResource, JcrConsta
      * @throws IOException
      */</comment>
     <specifier>protected</specifier> <name>ExportContext</name> <call><name>getExportContext</name><argument_list>(<argument><expr><name>OutputContext</name> <name>outputCtx</name></expr></argument>)</argument_list></call> <throws>throws <argument><expr><name>IOException</name> <block>{</block></expr></argument></throws></expr>
        <return>return <expr><operator>new</operator> <call><name>ExportContextImpl</name><argument_list>(<argument><expr><name>node</name></expr></argument>, <argument><expr><name>outputCtx</name></expr></argument>, <argument><expr><call><name><name>config</name><operator>.</operator><name>getMimeResolver</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</return></block></expr>
        <return>return <expr><operator>new</operator> <call><name>ExportContextImpl</name><argument_list>(<argument><expr><name>node</name></expr></argument>, <argument><expr><name>outputCtx</name></expr></argument>)</argument_list></call></expr>;</return>
     }</block></expr></expr_stmt>
 
     <comment type="block" format="javadoc">/**
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/simple/ResourceConfig.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/simple/ResourceConfig.java
index 064c8b9ac..79d7e035b 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/simple/ResourceConfig.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/simple/ResourceConfig.java
@@ -16,33 +16,33 @@
  */</comment>
 <package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>simple</name></name>;</package>
 
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>IOManager</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>InputStream</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>URL</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>ArrayList</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>

<import>import <name><name>javax</name><operator>.</operator><name>jcr</name><operator>.</operator><name>Item</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>jcr</name><operator>.</operator><name>Node</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>jcr</name><operator>.</operator><name>RepositoryException</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>xml</name><operator>.</operator><name>parsers</name><operator>.</operator><name>DocumentBuilder</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>xml</name><operator>.</operator><name>parsers</name><operator>.</operator><name>ParserConfigurationException</name></name>;</import>

 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>DefaultIOManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>IOHandler</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>PropertyManager</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>IOManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>PropertyHandler</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>PropertyManager</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>PropertyManagerImpl</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>server</name><operator>.</operator><name>io</name><operator>.</operator><name>MimeResolver</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>xml</name><operator>.</operator><name>ElementIterator</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>xml</name><operator>.</operator><name>DomUtil</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>jackrabbit</name><operator>.</operator><name>webdav</name><operator>.</operator><name>xml</name><operator>.</operator><name>ElementIterator</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>tika</name><operator>.</operator><name>detect</name><operator>.</operator><name>Detector</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>Logger</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>slf4j</name><operator>.</operator><name>LoggerFactory</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>w3c</name><operator>.</operator><name>dom</name><operator>.</operator><name>Element</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>w3c</name><operator>.</operator><name>dom</name><operator>.</operator><name>Document</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>w3c</name><operator>.</operator><name>dom</name><operator>.</operator><name>Element</name></name>;</import>
 <import>import <name><name>org</name><operator>.</operator><name>xml</name><operator>.</operator><name>sax</name><operator>.</operator><name>SAXException</name></name>;</import>
 
<import>import <name><name>javax</name><operator>.</operator><name>jcr</name><operator>.</operator><name>Item</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>jcr</name><operator>.</operator><name>Node</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>jcr</name><operator>.</operator><name>RepositoryException</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>xml</name><operator>.</operator><name>parsers</name><operator>.</operator><name>DocumentBuilder</name></name>;</import>
<import>import <name><name>javax</name><operator>.</operator><name>xml</name><operator>.</operator><name>parsers</name><operator>.</operator><name>ParserConfigurationException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>net</name><operator>.</operator><name>URL</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>ArrayList</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Properties</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>InputStream</name></name>;</import>

 <comment type="block" format="javadoc">/**
  * &lt;code&gt;ResourceConfig&lt;/code&gt;...
  */</comment>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">50</literal></expr><operator>,</operator><expr><literal type="number">12</literal> <operator>+</operator><literal type="number">50</literal></expr><operator>,</operator><expr><literal type="number">20</literal> @@ <specifier>public</specifier> <name>class</name> <name>ResourceConfig</name> <block>{
 
     <expr><specifier>private</specifier> <specifier>static</specifier> <name>Logger</name> <name>log</name> <operator>=</operator> <call><name><name>LoggerFactory</name><operator>.</operator><name>getLogger</name></name><argument_list>(<argument><expr><name><name>ResourceConfig</name><operator>.</operator><name>class</name></name></expr></argument>)</argument_list></call></expr>;
 
    <comment type="block" format="javadoc">/**
     * Content type detector.
     */</comment>
    <expr><specifier>private</specifier> <name>final</name> <name>Detector</name> <name>detector</name></expr>;

     <expr><specifier>private</specifier> <name>ItemFilter</name> <name>itemFilter</name></expr>;
     <expr><specifier>private</specifier> <name>IOManager</name> <name>ioManager</name></expr>;
     <expr><specifier>private</specifier> <name>PropertyManager</name> <name>propManager</name></expr>;
     <expr><specifier>private</specifier> <name><name>String</name><index>[]</index></name> <name>nodetypeNames</name> <operator>=</operator> <operator>new</operator> <name><name>String</name><index>[<expr><literal type="number">0</literal></expr>]</index></name></expr>;
     <expr><specifier>private</specifier> <name>boolean</name> <name>collectionNames</name> <operator>=</operator> <literal type="boolean">false</literal></expr>;
    <expr><specifier>private</specifier> <name>MimeResolver</name> <name>mimeResolver</name></expr>;

    <expr><specifier>public</specifier> <call><name>ResourceConfig</name><argument_list>(<argument><expr><name>Detector</name> <name>detector</name></expr></argument>)</argument_list></call> <block>{
        <expr><name><name>this</name><operator>.</operator><name>detector</name></name> <operator>=</operator> <name>detector</name></expr>;
    }</block>
 
     <comment type="block" format="javadoc">/**
      * Tries to parse the given xml configuration file.
@@ -86,6 +94,11 @@ public class ResourceConfig {
      *    &amp;gt;
      * &amp;lt;!ELEMENT defaultmimetype (CDATA) &amp;gt;
      * &lt;/pre&gt;
     * &lt;p&gt;
     * The &amp;lt;mimetypeproperties/&amp;gt; settings have been deprecated and will
     * be ignored with a warning. Instead you can use the
     * {@link SimpleWebdavServlet#INIT_PARAM_MIME_INFO mime-info}
     * servlet initialization parameter to customize the media type settings.
      *
      * @param configURL
      */</comment>
@@ <operator>-</operator><literal type="number">107</literal></expr>,<expr><literal type="number">6</literal> <operator>+</operator><literal type="number">120</literal></expr>,<expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ResourceConfig</name> <block>{
                 <expr><name>Object</name> <name>inst</name> <operator>=</operator> <call><name>buildClassFromConfig</name><argument_list>(<argument><expr><name>el</name></expr></argument>)</argument_list></call></expr>;
                 <if_stmt><if>if <condition>(<expr><name>inst</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <name>inst</name> <operator>instanceof</operator> <name>IOManager</name></expr>)</condition> <block>{<block_content>
                     <expr_stmt><expr><name>ioManager</name> <operator>=</operator> <operator>(</operator><name>IOManager</name><operator>)</operator><name>inst</name></expr>;</expr_stmt>
                    <expr_stmt><expr><call><name><name>ioManager</name><operator>.</operator><name>setDetector</name></name><argument_list>(<argument><expr><name>detector</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                     <comment type="line">// get optional 'iohandler' child elements and populate the</comment>
                     <comment type="line">// ioManager with the instances</comment>
                     <decl_stmt><decl><type><name>ElementIterator</name></type> <name>iohElements</name> <init>= <expr><call><name><name>DomUtil</name><operator>.</operator><name>getChildren</name></name><argument_list>(<argument><expr><name>el</name></expr></argument>, <argument><expr><literal type="string">"iohandler"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">177</literal></expr><operator>,</operator><expr><literal type="number">21</literal> <operator>+</operator><literal type="number">191</literal></expr><operator>,</operator><expr><literal type="number">11</literal> @@ <specifier>public</specifier> <name>class</name> <name>ResourceConfig</name> <block>{
                 <expr><call><name><name>log</name><operator>.</operator><name>debug</name></name><argument_list>(<argument><expr><literal type="string">"Resource configuration: no 'filter' element specified."</literal></expr></argument>)</argument_list></call></expr>;</block></expr></expr_stmt></block_content></block></if></if_stmt>
             }</block>
 
            <comment type="line">// optional mimetype properties</comment>
            <name>Properties</name> <name>properties</name> <operator>=</operator> <operator>new</operator> <call><name>Properties</name><argument_list>()</argument_list></call></expr>;
            <expr><name>String</name> <name>defaultMimetype</name> <operator>=</operator> <literal type="null">null</literal></expr>;
             <expr><name>el</name> <operator>=</operator> <call><name><name>DomUtil</name><operator>.</operator><name>getChildElement</name></name><argument_list>(<argument><expr><name>config</name></expr></argument>, <argument><expr><literal type="string">"mimetypeproperties"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;
             <if_stmt><if>if <condition>(<expr><name>el</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
                <expr_stmt><expr><name>defaultMimetype</name> <operator>=</operator> <call><name><name>DomUtil</name><operator>.</operator><name>getChildText</name></name><argument_list>(<argument><expr><name>el</name></expr></argument>, <argument><expr><literal type="string">"defaultmimetype"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <decl_stmt><decl><type><name>ElementIterator</name></type> <name>it</name> <init>= <expr><call><name><name>DomUtil</name><operator>.</operator><name>getChildren</name></name><argument_list>(<argument><expr><name>el</name></expr></argument>, <argument><expr><literal type="string">"mimemapping"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
                <while>while <condition>(<expr><call><name><name>it</name><operator>.</operator><name>hasNext</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
                    <decl_stmt><decl><type><name>Element</name></type> <name>mimeMapping</name> <init>= <expr><call><name><name>it</name><operator>.</operator><name>nextElement</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
                    <decl_stmt><decl><type><name>String</name></type> <name>extension</name> <init>= <expr><call><name><name>DomUtil</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name>mimeMapping</name></expr></argument>, <argument><expr><literal type="string">"extension"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
                    <decl_stmt><decl><type><name>String</name></type> <name>mimetype</name> <init>= <expr><call><name><name>DomUtil</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name>mimeMapping</name></expr></argument>, <argument><expr><literal type="string">"mimetype"</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
                    <expr_stmt><expr><call><name><name>properties</name><operator>.</operator><name>put</name></name><argument_list>(<argument><expr><name>extension</name></expr></argument>, <argument><expr><name>mimetype</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt/></block_content></block></while></block_content></block></if></if_stmt>}</block>
                <call><name><name>log</name><operator>.</operator><name>warn</name></name><argument_list>(<argument><expr><literal type="string">"Ignoring deprecated mimetypeproperties settings: {}"</literal></expr></argument>,
                        <argument><expr><name>configURL</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
             </block_content>}</block></catch>
            <expr_stmt><expr><name>mimeResolver</name> <operator>=</operator> <operator>new</operator> <call><name>MimeResolver</name><argument_list>(<argument><expr><name>properties</name></expr></argument>, <argument><expr><name>defaultMimetype</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         } catch <expr_stmt><expr><operator>(</operator><name>IOException</name> <name>e</name><operator>)</operator> <block>{
             <expr><call><name><name>log</name><operator>.</operator><name>debug</name></name><argument_list>(<argument><expr><literal type="string">"Invalid resource configuration: "</literal> <operator>+</operator> <call><name><name>e</name><operator>.</operator><name>getMessage</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;
         }</block></expr></expr_stmt> <catch>catch <parameter_list>(<parameter><decl><type><name>ParserConfigurationException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">270</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">274</literal></expr><operator>,</operator><expr><literal type="number">7</literal> @@ <specifier>public</specifier> <name>class</name> <name>ResourceConfig</name> <block>{
         <if_stmt><if>if <condition>(<expr><name>ioManager</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
             <expr_stmt><expr><call><name><name>log</name><operator>.</operator><name>debug</name></name><argument_list>(<argument><expr><literal type="string">"ResourceConfig: missing io-manager &gt; building DefaultIOManager "</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
             <expr_stmt><expr><name>ioManager</name> <operator>=</operator> <operator>new</operator> <call><name>DefaultIOManager</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>ioManager</name><operator>.</operator><name>setDetector</name></name><argument_list>(<argument><expr><name>detector</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
         <expr_stmt/></block_content></block></if></if_stmt>}</block></expr></expr_stmt>
         <return>return <expr><name>ioManager</name></expr>;</return>
     </block_content>}</block></catch>
<annotation>@</annotation>@ <expr_stmt><expr><operator>-</operator><literal type="number">331</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">336</literal></expr><operator>,</operator><expr><literal type="number">12</literal> @@ <specifier>public</specifier> <name>class</name> <name>ResourceConfig</name> <block>{
     }</block>
 
     <comment type="block" format="javadoc">/**
     * Returns the configured content type detector.
      *
     * @return
     * @return content type detector
      */</comment>
    <specifier>public</specifier> <name>MimeResolver</name> <call><name>getMimeResolver</name><argument_list>()</argument_list></call> <block>{
        <return>return <expr><name>mimeResolver</name></expr>;</return>
    <specifier>public</specifier> <name>Detector</name> <call><name>getDetector</name><argument_list>()</argument_list></call> <block>{
        <return>return <expr><name>detector</name></expr>;</return>
     }</block>
}</block></expr></expr_stmt>
<expr_stmt><expr><operator>\</operator> <name>No</name> <name>newline</name> <name>at</name> <name>end</name> <name>of</name> <name>file</name></expr></expr_stmt>

}
diff <expr_stmt><expr><operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>ResourceFactoryImpl</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>ResourceFactoryImpl</name><operator>.</operator><name>java</name></name>
<name>index</name> <name>cd0db7ef8</name><operator>..</operator><name>ad2c48d5d</name> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>ResourceFactoryImpl</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>jackrabbit</name><operator>-</operator><name>jcr</name><operator>-</operator><name>server</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>jackrabbit</name><operator>/</operator><name>webdav</name><operator>/</operator><name>simple</name><operator>/</operator><name><name>ResourceFactoryImpl</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">48</literal></expr><operator>,</operator><expr><literal type="number">17</literal> <operator>+</operator><literal type="number">48</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <name>class</name> <name>ResourceFactoryImpl</name> implements <name>DavResourceFactory</name> <block>{
     <expr><specifier>private</specifier> <name>final</name> <name>LockManager</name> <name>lockMgr</name></expr>;
     <expr><specifier>private</specifier> <name>final</name> <name>ResourceConfig</name> <name>resourceConfig</name></expr>;
 
    <comment type="block" format="javadoc">/**
     * Create a new &lt;code&gt;ResourceFactory&lt;/code&gt; that uses the given lock
     * manager and the default {@link ResourceConfig resource config}.
     *
     * @param lockMgr
     */</comment>
    <expr><specifier>public</specifier> <call><name>ResourceFactoryImpl</name><argument_list>(<argument><expr><name>LockManager</name> <name>lockMgr</name></expr></argument>)</argument_list></call> <block>{
        <expr><name><name>this</name><operator>.</operator><name>lockMgr</name></name> <operator>=</operator> <name>lockMgr</name></expr>;
        <expr><name><name>this</name><operator>.</operator><name>resourceConfig</name></name> <operator>=</operator> <operator>new</operator> <call><name>ResourceConfig</name><argument_list>()</argument_list></call></expr>;
    }</block>

     <comment type="block" format="javadoc">/**
      * Create a new &lt;code&gt;ResourceFactory&lt;/code&gt; that uses the given lock
      * manager and resource filter.
@@ -68,7 +57,7 @@ public class ResourceFactoryImpl implements DavResourceFactory {
      */</comment>
     <specifier>public</specifier> <call><name>ResourceFactoryImpl</name><argument_list>(<argument><expr><name>LockManager</name> <name>lockMgr</name></expr></argument>, <argument><expr><name>ResourceConfig</name> <name>resourceConfig</name></expr></argument>)</argument_list></call> <block>{
         <expr><name><name>this</name><operator>.</operator><name>lockMgr</name></name> <operator>=</operator> <name>lockMgr</name></expr>;
        <expr><name><name>this</name><operator>.</operator><name>resourceConfig</name></name> <operator>=</operator> <ternary><condition><expr><operator>(</operator><name>resourceConfig</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr> ?</condition><then> <expr><name>resourceConfig</name></expr> </then><else>: <expr><operator>new</operator> <call><name>ResourceConfig</name><argument_list>()</argument_list></call></expr></else></ternary></expr>;
        <expr><name><name>this</name><operator>.</operator><name>resourceConfig</name></name> <operator>=</operator> <name>resourceConfig</name></expr>;
     }</block>
 
     <comment type="block" format="javadoc">/**
diff --git a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/simple/SimpleWebdavServlet.java b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/simple/SimpleWebdavServlet.java
index eca5a3023..023d9f41d 100644
-- a/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/simple/SimpleWebdavServlet.java
++ b/jackrabbit-jcr-server/src/main/java/org/apache/jackrabbit/webdav/simple/SimpleWebdavServlet.java
@@ -28,13 +28,19 @@ import org.apache.jackrabbit.webdav.WebdavRequest;
 import org.apache.jackrabbit.webdav.lock.LockManager;
 import org.apache.jackrabbit.webdav.lock.SimpleLockManager;
 import org.apache.jackrabbit.webdav.server.AbstractWebdavServlet;
import org.apache.tika.detect.Detector;
import org.apache.tika.mime.MimeTypeException;
import org.apache.tika.mime.MimeTypesFactory;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
 import javax.jcr.Repository;
 import javax.servlet.ServletContext;
 import javax.servlet.ServletException;

import java.io.IOException;
 import java.net.MalformedURLException;
import java.net.URL;
 
 /**
  * WebdavServlet provides webdav support (level 1 and 2 complient) for
@@ -75,6 +81,13 @@ public abstract class SimpleWebdavServlet extends AbstractWebdavServlet {
      */</comment>
     <specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>INIT_PARAM_RESOURCE_CONFIG</name> <operator>=</operator> <literal type="string">"resource-config"</literal></expr>;
 
    <comment type="block" format="javadoc">/**
     * Name of the parameter that specifies the servlet resource path of
     * a custom &amp;lt;mime-info/&amp;gt; configuration file. The default setting
     * is to use the MIME media type database included in Apache Tika.
     */</comment>
    <expr><specifier>public</specifier> <specifier>static</specifier> <name>final</name> <name>String</name> <name>INIT_PARAM_MIME_INFO</name> <operator>=</operator> <literal type="string">"mime-info"</literal></expr>;

     <comment type="block" format="javadoc">/**
      * Servlet context attribute used to store the path prefix instead of
      * having a static field with this servlet. The latter causes problems
@@ -150,10 +163,10 @@ public abstract class SimpleWebdavServlet extends AbstractWebdavServlet {
         }
         log.info("WWW-Authenticate header = '" + authenticate_header + "'");
 
        config = new ResourceConfig(getDetector());
         String configParam = getInitParameter(INIT_PARAM_RESOURCE_CONFIG);
         if (configParam != null) {
             try {
                config = new ResourceConfig();
                 config.parse(getServletContext().getResource(configParam));
             } catch (MalformedURLException e) {
                 log.debug("Unable to build resource filter provider.");
@@ -161,6 +174,40 @@ public abstract class SimpleWebdavServlet extends AbstractWebdavServlet {
         }
     }
 
    /**
     * Reads and returns the configured &amp;lt;mime-info/&amp;gt; database.
     *
     * @see #INIT_PARAM_MIME_INFO
     * @return MIME media type database
     * @throws ServletException if the database is invalid or can not be read
     */</comment>
    <expr><specifier>private</specifier> <name>Detector</name> <call><name>getDetector</name><argument_list>()</argument_list></call> <throws>throws <argument><expr><name>ServletException</name> <block>{
        <expr><name>URL</name> <name>url</name></expr></block></expr></argument></throws></expr>;

        <expr><name>String</name> <name>mimeInfo</name> <operator>=</operator> <call><name>getInitParameter</name><argument_list>(<argument><expr><name>INIT_PARAM_MIME_INFO</name></expr></argument>)</argument_list></call></expr>;
        <if_stmt><if>if <condition>(<expr><name>mimeInfo</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <try>try <block>{<block_content>
                <expr_stmt><expr><name>url</name> <operator>=</operator> <call><name>getServletContext</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getResource</name><argument_list>(<argument><expr><name>mimeInfo</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt/></block_content></block></try></block_content></block></if></if_stmt>}</block></expr></expr_stmt> <catch>catch <parameter_list>(<parameter><decl><type><name>MalformedURLException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
                <throw>throw <expr><operator>new</operator> <call><name>ServletException</name><argument_list>(
                        <argument><expr><literal type="string">"Invalid "</literal> <operator>+</operator> <name>INIT_PARAM_MIME_INFO</name>
                        <operator>+</operator> <literal type="string">" configuration setting: "</literal> <operator>+</operator> <name>mimeInfo</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</throw>
            </block_content>}</block></catch>
        } else <block>{<block_content>
            <expr_stmt><expr><name>url</name> <operator>=</operator> <call><name><name>MimeTypesFactory</name><operator>.</operator><name><name>class</name><operator>.</operator><name>getResource</name></name></name><argument_list>(<argument><expr><literal type="string">"tika-mimetypes.xml"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block>

        <try>try <block>{<block_content>
            <return>return <expr><call><name><name>MimeTypesFactory</name><operator>.</operator><name>create</name></name><argument_list>(<argument><expr><name>url</name></expr></argument>)</argument_list></call></expr>;</return>
        </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>MimeTypeException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <throw>throw <expr><operator>new</operator> <call><name>ServletException</name><argument_list>(
                    <argument><expr><literal type="string">"Invalid MIME media type database: "</literal> <operator>+</operator> <name>url</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</throw>
        </block_content>}</block></catch> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <throw>throw <expr><operator>new</operator> <call><name>ServletException</name><argument_list>(
                    <argument><expr><literal type="string">"Unable to read MIME media type database: "</literal> <operator>+</operator> <name>url</name></expr></argument>, <argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</throw>
        </block_content>}</block></catch></try>
    }

     <comment type="block" format="javadoc">/**
      * {@inheritDoc}
      */</comment>
@<annotation>@</annotation> -<expr_stmt><expr><literal type="number">345</literal></expr><operator>,</operator><expr><literal type="number">10</literal> <operator>+</operator><literal type="number">392</literal></expr><operator>,</operator><expr><literal type="number">6</literal> @@ <specifier>public</specifier> <specifier>abstract</specifier> <name>class</name> <name>SimpleWebdavServlet</name> extends <name>AbstractWebdavServlet</name> <block>{
      <expr><operator>*</operator> @</expr><return>return <expr><name>the</name> <name>resource</name> <name><name>configuration</name><operator>.</operator></name>
      *<operator>/</operator>
     <specifier>public</specifier> <name>ResourceConfig</name> <call><name>getResourceConfig</name><argument_list>()</argument_list></call> <block>{
        <comment type="line">// fallback if no config present</comment>
        <if_stmt><if>if <condition>(<expr><name>config</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>config</name> <operator>=</operator> <operator>new</operator> <call><name>ResourceConfig</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <expr_stmt/></block_content></block></if></if_stmt>}</block></expr></return>
         <return>return <expr><name>config</name></expr>;</return>
     }</block></expr></expr_stmt>
 
<expr><operator>-</operator> 
<literal type="number">2.19.1.windows</literal><literal type="number">.1</literal></expr>

</unit>
