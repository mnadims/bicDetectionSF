<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" revision="1.0.0" language="Java" filename="E:/01Courses@USASK/CMPT898-HumanDrivenSoftwareEngineeringForScientificResearch/ProjectProgress/data_files/final_dataset/gen_patch_codes/filtered/hadoop/6a059dc40e0.java"><expr_stmt><expr><name>From</name> <literal type="number">6a059dc40e0020acc64d8049bf7fe6c7c0aad358</literal> <name>Mon</name> <name>Sep</name> <literal type="number">17</literal> <literal type="number">00</literal><operator>:</operator><literal type="number">00</literal><operator>:</operator><literal type="number">00</literal> <literal type="number">2001</literal>
<name>From</name><operator>:</operator> <name>Robert</name> <name>Joseph</name> <name><name>Evans</name> <argument_list type="generic">&lt;<argument><name>bobby</name><annotation>@<name><name>apache</name><operator>.</operator><name>org</name></name></annotation></argument>&gt;</argument_list></name>
<name>Date</name><operator>:</operator> <name>Tue</name></expr><operator>,</operator> <expr><literal type="number">16</literal> <name>Oct</name> <literal type="number">2012</literal> <literal type="number">18</literal><operator>:</operator><literal type="number">00</literal><operator>:</operator><literal type="number">01</literal> <operator>+</operator><literal type="number">0000</literal>
<name>Subject</name><operator>:</operator> <index>[<expr><name>PATCH</name></expr>]</index> <name>HADOOP</name><operator>-</operator><literal type="number">8922.</literal> <name>Provide</name> <name>alternate</name> <name>JSONP</name> <name>output</name></expr></expr_stmt> <for>for
 JMXJsonServlet to allow javascript in browser dashboard <control>(<init><expr><name>Damien</name> <name>Hardy</name> <name>via</name>
 <name>bobby</name></expr></init>)</control><block type="pseudo"><block_content>

<expr_stmt><expr><name>git</name><operator>-</operator><name>svn</name><operator>-</operator><name>id</name><operator>:</operator> <name>https</name><operator>:</operator><comment type="line">//svn.apache.org/repos/asf/hadoop/common/trunk@1398904 13f79535-47bb-0310-9956-ffa450edef68</comment>
<operator>--</operator>
 <operator>...</operator><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name>                 <operator>|</operator>  <literal type="number">3</literal> <operator>++</operator><operator>+</operator>
 <operator>...</operator><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>hadoop</name><operator>/</operator><name>jmx</name><operator>/</operator><name><name>JMXJsonServlet</name><operator>.</operator><name>java</name></name> <operator>|</operator> <literal type="number">26</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>+</operator><operator>--</operator>
 <operator>...</operator><operator>/</operator><name>apache</name><operator>/</operator><name>hadoop</name><operator>/</operator><name>jmx</name><operator>/</operator><name><name>TestJMXJsonServlet</name><operator>.</operator><name>java</name></name> <operator>|</operator> <literal type="number">24</literal> <operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>++</operator><operator>+</operator>
 <literal type="number">3</literal> <name>files</name> <name>changed</name></expr><operator>,</operator> <expr><literal type="number">51</literal> <call><name>insertions</name><argument_list>(<argument><expr><operator>+</operator></expr></argument>)</argument_list></call></expr><operator>,</operator> <expr><literal type="number">2</literal> <call><name>deletions</name><argument_list>(<argument><expr><operator>-</operator></expr></argument>)</argument_list></call>

<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>-</operator><name>project</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name> <name>b</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>-</operator><name>project</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name>
<name>index</name> <name>df0585cff7e</name><operator>..</operator><literal type="number">3df1039730d</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>-</operator><name>project</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>-</operator><name>project</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name><name>CHANGES</name><operator>.</operator><name>txt</name></name>
@@ <operator>-</operator><literal type="number">320</literal></expr><operator>,</operator><expr><literal type="number">6</literal> <operator>+</operator><literal type="number">320</literal></expr><operator>,</operator><expr><literal type="number">9</literal> @@ <name>Release</name> <literal type="number">2.0.3</literal><operator>-</operator><name>alpha</name> <operator>-</operator> <name>Unreleased</name>
 
     <name>HADOOP</name><operator>-</operator><literal type="number">8929.</literal> <name>Add</name> <name>toString</name></expr><operator>,</operator> <expr><name>other</name> <name>improvements</name></expr></expr_stmt></block_content></block></for> <for>for SampleQuantiles <control>(<init><expr><name>todd</name></expr></init>)</control><block type="pseudo"><block_content>
 
    <expr_stmt><expr><name>HADOOP</name><operator>-</operator><literal type="number">8922.</literal> <name>Provide</name> <name>alternate</name> <name>JSONP</name> <name>output</name></expr></expr_stmt></block_content></block></for> <for>for JMXJsonServlet to allow
    javascript in browser dashboard <control>(<init><expr><name>Damien</name> <name>Hardy</name> <name>via</name> <name>bobby</name></expr></init>)</control><block type="pseudo"><block_content>

   <expr_stmt><expr><name>OPTIMIZATIONS</name>
 
     <name>HADOOP</name><operator>-</operator><literal type="number">8866.</literal> <name>SampleQuantiles</name><operator>#</operator><name>query</name> <name>is</name> <call><name>O</name><argument_list>(<argument><expr><name>N</name><operator>^</operator><literal type="number">2</literal></expr></argument>)</argument_list></call> <name>instead</name> <name>of</name> <call><name>O</name><argument_list>(<argument><expr><name>N</name></expr></argument>)</argument_list></call><operator>.</operator> <operator>(</operator><name>Andrew</name> <name>Wang</name>
<name>diff</name> <operator>--</operator><name>git</name> <name>a</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>-</operator><name>project</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>hadoop</name><operator>/</operator><name>jmx</name><operator>/</operator><name><name>JMXJsonServlet</name><operator>.</operator><name>java</name></name> <name>b</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>-</operator><name>project</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>hadoop</name><operator>/</operator><name>jmx</name><operator>/</operator><name><name>JMXJsonServlet</name><operator>.</operator><name>java</name></name>
<name>index</name> <literal type="number">84dc15c882f</literal><operator>..</operator><literal type="number">076ffb4c231</literal> <literal type="number">100644</literal>
<operator>--</operator> <name>a</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>-</operator><name>project</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>hadoop</name><operator>/</operator><name>jmx</name><operator>/</operator><name><name>JMXJsonServlet</name><operator>.</operator><name>java</name></name>
<operator>++</operator> <name>b</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>-</operator><name>project</name><operator>/</operator><name>hadoop</name><operator>-</operator><name>common</name><operator>/</operator><name>src</name><operator>/</operator><name>main</name><operator>/</operator><name>java</name><operator>/</operator><name>org</name><operator>/</operator><name>apache</name><operator>/</operator><name>hadoop</name><operator>/</operator><name>jmx</name><operator>/</operator><name><name>JMXJsonServlet</name><operator>.</operator><name>java</name></name>
@@ <operator>-</operator><literal type="number">113</literal><operator>,</operator><literal type="number">12</literal> <operator>+</operator><literal type="number">113</literal><operator>,</operator><literal type="number">17</literal> @@
  <operator>*</operator>  <name>All</name> <name>other</name> <name>objects</name> <name>will</name> <name>be</name> <name>converted</name> <name>to</name> <name>a</name> <name>string</name> <name>and</name> <name>output</name> <name>as</name> <name><name>such</name><operator>.</operator></name>
  *  
  <operator>*</operator>  <name>The</name> <name>bean</name><literal type="char">'</literal></expr></expr_stmt></block_content></block></for>s name and modelerType will be returned for all beans.
 *
 *  Optional paramater "callback" should be used to deliver JSONP response.
 *  
  */
 public class JMXJsonServlet extends HttpServlet {
   private static final Log LOG = LogFactory.getLog(JMXJsonServlet.class);
 
   private static final long serialVersionUID = 1L;
 
  private static final String CALLBACK_PARAM = "callback";

   /**
    * MBean server.
    */
@@ -154,11 +159,22 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) {
         return;
       }
       JsonGenerator jg = null;
      String jsonpcb = null;
      PrintWriter writer = null;
       try {
        response.setContentType("application/json; charset=utf8");
        writer = response.getWriter();
 
        // "callback" parameter implies JSONP outpout
        jsonpcb = request.getParameter(CALLBACK_PARAM);
        if (jsonpcb != null) {
          response.setContentType("application/javascript; charset=utf8");
          writer.write(jsonpcb + "(");
        } else {
          response.setContentType("application/json; charset=utf8");
        }
 
        PrintWriter writer = response.getWriter();
         jg = jsonFactory.createJsonGenerator(writer);
        jg.disable(JsonGenerator.Feature.AUTO_CLOSE_TARGET);
         jg.useDefaultPrettyPrinter();
         jg.writeStartObject();
 
@@ -188,6 +204,12 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) {
         if (jg != null) {
           jg.close();
         }
        if (jsonpcb != null) {
           writer.write(");");
        }
        if (writer != null) {
          writer.close();
        }
       }
     } catch (IOException e) {
       LOG.error("Caught an exception while processing JMX request", e);
diff --git a/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/jmx/TestJMXJsonServlet.java b/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/jmx/TestJMXJsonServlet.java
index ea2f76bf10a..41303f41d91 100644
-- a/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/jmx/TestJMXJsonServlet.java
++ b/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/jmx/TestJMXJsonServlet.java
@@ -78,5 +78,29 @@ public static void assertReFind(String re, String value) {
         "/jmx?get=java.lang:type=Memory::"));
     LOG.info("/jmx RESULT: "+result);
     assertReFind("\"ERROR\"", result);

    // test to get JSONP result
    result = readOutput(new URL(baseUrl, "/jmx?qry=java.lang:type=Memory&amp;callback=mycallback1"));
    LOG.info("/jmx?qry=java.lang:type=Memory&amp;callback=mycallback RESULT: "+result);
    assertReFind("^mycallback1\\(\\{", result);
    assertReFind("\\}\\);$", result);

    // negative test to get an attribute of a mbean as JSONP
    result = readOutput(new URL(baseUrl,
        "/jmx?get=java.lang:type=Memory::&amp;callback=mycallback2"));
    LOG.info("/jmx RESULT: "+result);
    assertReFind("^mycallback2\\(\\{", result);
    assertReFind("\"ERROR\"", result);
    assertReFind("\\}\\);$", result);

    // test to get an attribute of a mbean as JSONP
    result = readOutput(new URL(baseUrl,
        "/jmx?get=java.lang:type=Memory::HeapMemoryUsage&amp;callback=mycallback3"));
    LOG.info("/jmx RESULT: "+result);
    assertReFind("^mycallback3\\(\\{", result);
    assertReFind("\"name\"\\s*:\\s*\"java.lang:type=Memory\"", result);
    assertReFind("\"committed\"\\s*:", result);
    assertReFind("\\}\\);$", result);

   }
 }
- 
2.19.1.windows.1

</unit>
